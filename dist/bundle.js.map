{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"path\"","webpack:///./src/utils/logger.ts","webpack:///./src/types.ts","webpack:///./src/utils/fs-utils.ts","webpack:///external \"fs\"","webpack:///./src/api/subsonic/format.ts","webpack:///external \"request\"","webpack:///external \"moment\"","webpack:///./src/api/subsonic/response.ts","webpack:///./src/utils/webservice-client.ts","webpack:///./src/utils/random.ts","webpack:///./src/utils/feed.ts","webpack:///./src/api/jam/error.ts","webpack:///external \"express\"","webpack:///./src/api/jam/response.ts","webpack:///./src/utils/filetype.ts","webpack:///external \"tmp\"","webpack:///./src/io/components/tag.ts","webpack:///./src/io/components/clean.ts","webpack:///./src/engine/components/playlists.ts","webpack:///./src/store/store.ts","webpack:///external \"limiter\"","webpack:///./src/utils/tool.ts","webpack:///./src/utils/download.ts","webpack:///./src/utils/debounce-promises.ts","webpack:///./src/api/jam/format.ts","webpack:///./src/utils/paginate.ts","webpack:///external \"cors\"","webpack:///external \"express-session\"","webpack:///./src/api/jam/check.ts","webpack:///./src/utils/openapi-parameters-check.ts","webpack:///./src/index.ts","webpack:///./src/engine/engine.ts","webpack:///./src/io/io.ts","webpack:///external \"winston\"","webpack:///external \"winston-timer\"","webpack:///./src/io/components/scan.ts","webpack:///external \"mkdirp\"","webpack:///./src/io/components/match.ts","webpack:///./src/io/components/merge.ts","webpack:///./src/utils/deep-compare.ts","webpack:///./src/io/components/meta.ts","webpack:///./src/store/elasticsearch/db-elastic.ts","webpack:///external \"elasticsearch\"","webpack:///./src/store/elasticsearch/es-sequence.ts","webpack:///./src/store/elasticsearch/mapping.ts","webpack:///./src/utils/wait.ts","webpack:///./src/store/nedb/db-nedb.ts","webpack:///external \"nedb\"","webpack:///external \"md5-typescript\"","webpack:///./src/utils/hex.ts","webpack:///./src/audio/audio.ts","webpack:///external \"jamp3\"","webpack:///./src/audio/clients/chartlyrics-client.ts","webpack:///./src/utils/webservice-xml-client.ts","webpack:///external \"xml2js\"","webpack:///./src/audio/clients/acoustid-client.ts","webpack:///./src/audio/tools/fpcalc.ts","webpack:///./src/utils/which.ts","webpack:///external \"child_process\"","webpack:///./src/audio/clients/lastfm-client.ts","webpack:///./src/audio/clients/musicbrainz-client.ts","webpack:///./src/audio/clients/musicbrainz-client.types.ts","webpack:///./src/utils/genres.ts","webpack:///./src/io/components/images.ts","webpack:///external \"jimp\"","webpack:///external \"mime-types\"","webpack:///./src/engine/components/indextree.ts","webpack:///./src/engine/components/metainfo.ts","webpack:///./src/engine/components/users.ts","webpack:///./src/engine/components/chat.ts","webpack:///./src/engine/components/genres.ts","webpack:///./src/engine/components/podcasts.ts","webpack:///external \"zlib\"","webpack:///external \"feedparser\"","webpack:///external \"iconv-lite\"","webpack:///./src/engine/components/nowplaying.ts","webpack:///./src/utils/compress-stream.ts","webpack:///external \"archiver\"","webpack:///./src/audio/transcoder.ts","webpack:///external \"fluent-ffmpeg\"","webpack:///./src/engine/components/roots.ts","webpack:///./src/engine/components/playqueues.ts","webpack:///./src/io/components/waveforms.ts","webpack:///./src/audio/tools/ffmpeg-waveform-svg.ts","webpack:///external \"svgo\"","webpack:///./src/api/server.ts","webpack:///external \"body-parser\"","webpack:///./src/api/jam/router.ts","webpack:///./src/api/jam/login.ts","webpack:///external \"multer\"","webpack:///./src/api/jam/api.ts","webpack:///./src/io/components/health.ts","webpack:///./src/utils/session-storage.ts","webpack:///external \"passport\"","webpack:///external \"passport-jwt\"","webpack:///external \"passport-local\"","webpack:///external \"jsonwebtoken\"","webpack:///./src/api/jam/routes.ts","webpack:///./src/utils/validate-json.ts","webpack:///external \"ajv\"","webpack:///./src/utils/max-age.ts","webpack:///external \"multer-autoreap\"","webpack:///external \"express-rate-limit\"","webpack:///./src/api/subsonic/router.ts","webpack:///./src/api/subsonic/login.ts","webpack:///./src/utils/to-xml.ts","webpack:///external \"util\"","webpack:///./src/api/subsonic/parameters.ts","webpack:///./src/api/subsonic/api.ts","webpack:///./src/api/subsonic/routes.ts","webpack:///./src/api/subsonic/check.ts","webpack:///external \"helmet\"","webpack:///./src/config.ts","webpack:///./src/config/app.config.ts","webpack:///./src/config/thirdparty.config.ts","webpack:///external \"../config/config.js\"","webpack:///external \"../config/firststart.config.js\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","winston_1","__importDefault","default","configureLogger","config","configure","level","log","transports","Console","format","combine","colorize","simple","Logger","[object Object]","this","params","apply","Date","toISOString","concat","join","applyLog","toString","start_log","stop_log","FolderType","DBObjectType","AudioMimeTypes","mp3","m4a","ogg","oga","webma","webm","wav","VideoMimeTypes","mp4","m4v","ogv","webmv","FolderTypeImageName","unknown","artist","multiartist","album","multialbum","extras","FolderTypesAlbum","DatabaseQuerySortType","AlbumType","FileTyp","fs_1","mkdirp_1","path_1","tmp_1","fsStat","pathName","Promise","resolve","reject","stat","err","fileDelete","unlink","fileExists","isFile","e","code","dirExist","isDirectory","fileRename","source","dest","rename","dirRename","dirRead","readdir","data","fileCopy","copyFile","fileWrite","writeFile","fileDeleteIfExists","fileSuffix","filename","extname","slice","toLowerCase","makePath","folder","replaceFileSystemChars","replace","tmpFile","file","fd","cleanupCallback","moment_1","fs_utils_1","types_1","FORMAT","txt","subsonic-response","status","xmlns","error","message","0","10","20","30","40","50","70","version","assign","date","utc","root","id","parseInt","user","username","email","maxBitRate","avatarLastChanged","undefined","formatSubSonicDate","allowedfolder","map","scrobblingEnabled","adminRole","roles","settingsRole","downloadRole","uploadRole","playlistRole","coverArtRole","commentRole","podcastRole","streamRole","jukeboxRole","shareRole","videoConversionRole","entry","state","starred","faved","userRating","rated","index","states","groups","entries","packFolderIndexArtist","packArtist","parent","parentID","basename","path","tag","title","artistId","artistID","coverArt","songCount","trackIDs","length","duration","year","genre","created","albumCount","albumIDs","info","notes","description","musicBrainzId","mbid","lastFmUrl","url","smallImageUrl","image","small","mediumImageUrl","medium","largeImageUrl","large","similar","biography","similarArtist","track","suffix","result","isDir","media","isNaN","Math","round","bitRate","size","contentType","isVideo","discNumber","disc","albumId","albumID","type","playCount","played","transcodedSuffix","transcodedContentType","nowPlaying","obj","packTrack","episode","packPodcastEpisode","nowPlay","minutesAgo","diff","time","asMinutes","playerId","podcast","errorMessage","originalImageUrl","streamId","channelId","podcastID","summary","publishDate","author","playlist","comment","public","isPublic","changed","allowedUser","owner","userID","tracks","packPlaylist","bookmark","child","position","childs","song","playqueue","current","currentID","changedBy","radio","streamUrl","homePageUrl","homepage","content","trackCount","artistCount","FAIL","GENERIC","PARAMETER","CLIENT_OLD","SERVER_OLD","CREDENTIALS","UNAUTH","NOTFOUND","to_xml_1","format_1","ApiResponder","req","res","send","packOK","parameters","callback","JSON","stringify","json","set","toXML","packResponse","fail","packFail","text","pipe","buffer","sendFile","limiter_1","request_1","WebserviceClient","requestPerInterval","requestIntervalMS","userAgent","limiter","RateLimiter","options","headers","User-Agent","qs","timeout","removeTokens","response","body","parse","shuffle","list","j","floor","random","randomInt","min","max","randomItems","amount","done","indexOf","push","zlib_1","feedparser_1","iconv_lite_1","PodcastStatus","fresh","downloading","completed","deleted","skipped","Feed","str","split","reduce","para","param","parts","part","trim","encoding","decompress","match","createInflate","on","createGunzip","charset","test","iv","decodeStream","emit","posts","feed","doneReported","pool","setMaxListeners","setHeader","feedparser","meta","item","read","statusCode","abort","Error","statusMessage","getParams","pipestream","maybeDecompress","maybeTranslate","fetch","link","generator","categories","episodes","post","chapters","pscChaps","pscChap","guid","enclosures","valueOf","ApiError","failCode","super","constructor","captureStackTrace","InvalidParamError","msg","NotFoundError","UnauthError","GenericError","SupportedImageFormat","SupportedAudioFormat","getFileType","IMAGE","AUDIO","TAG","BACKUP","OTHER","convert2list","keys","count","val","sort","a","b","getMostUsedTagValue","multi","cleaned","filter","getMetaStat","dir","stats","artistSort","mbArtistID","mbAlbumID","images","files","forEach","tracktag","directories","sub","subtag","artists","artistSorts","albums","genres","years","convert2Numlist","mbArtistIDs","mbAlbumIDs","cVariousArtist","isMultiArtist","isMultiAlbum","img","typ","createFolderTag","debug","metaStat","nameSplit","y","shift","splitDirectoryName","f","albumType","mix","createTagsR","find","applyFolderTagType","cUnknownArtist","cUnknownAlbum","fillMatchTags","logger_1","playlists_1","isInRoot","fullpath","clearID3","store","removeTracks","search","removeAlbums","updateAlbums","remove","removeByQuery","destIDs","replaceMany","removeArtists","updateArtists","ids","clearImageCacheByIDs","cleanStore","waveforms","removeFolders","folderIDs","playlists","updatePlayListTracks","clearWaveformCacheByIDs","scanCleanStore","changes","removedTracks","removedFolders","doneFileIds","newTracks","updateTracks","unchangedTracks","doneFolderIds","newFolders","updateFolders","unchangedFolders","roots","all","iterate","folders","__awaiter","trackHash","byIds","Playlists","now","add","db_elastic_1","db_nedb_1","md5_typescript_1","hex_1","BaseStore","db","group","getDBIndex","idOrIds","items","byId","query","queryIds","onItems","upsert","transformQuery","queryOne","QueryHelper","q","field","term","startsWith","startsWiths","terms","notNull","lte","gte","range","fieldMap","sorts","descending","ascending","offset","StoreUser","true","isAdmin","pass","hexDecode","token","salt","Md5","init","StoreState","destID","isFaved","maxRating","minRating","isPlayed","destType","lastplayed","searchOne","emptyState","StorePlaylist","trackID","StorePodcasts","StoreEpisodes","podcastIDs","StoreBookmarks","StoreRoot","StorePlayQueue","StoreRadio","StoreTrack","parentIDs","rootID","mbTrackID","inPaths","inPath","mbTrackIDs","toYear","fromYear","newerThan","distinct","StoreFolder","types","StoreArtist","names","StoreAlbum","Store","database","use","DBElastic","DBNedb","reset","check","open","close","stores","objs","which_1","child_process_1","spawnTool","binName","envName","args","bin","getBinPath","spawn","stdout","stderr","spawnToolStream","onData","spawnToolJson","downloadFile","createWriteStream","DebouncePromises","pendingPromises","cb","APIVERSION","stream","upload","admin","packRoles","rootState","mbz","musicbrainz","recordingID","mbRecordingID","releaseTrackID","mbReleaseTrackID","trackNr","includes","folderTag","packFolderTag","packState","artistAlbumIDs","artistTracksIDs","albumTrackIDs","releases","lastCheck","trackMedia","channels","sampleRate","trackTag","packTrackTag","playing","playlistTracksIDs","lastModified","folderID","playQueue","playQueueTrackIDs","paginate","openapi_parameters_check_1","response_1","openapi","JamApiSchema","apiCheck","next","checkOpenApiParameters","then","catch","validate_json_1","validOAParameter","schema","required","num","Number","minimum","maximum","enum","Array","isArray","console","forceMethod","cmdPath","paths","method","cmd","in","cookies","checkAOParameters","apiSchema","requestBody","$ref","def","definitions","validate","errors","checkAORequestBody","engine_1","server_1","config_1","store_1","loadConfig","engine","Engine","server","Server","process","argv","runClearDB","stop","exit","start","refresh","run","io_1","audio_1","images_1","indextree_1","metainfo_1","users_1","chat_1","genres_1","podcasts_1","nowplaying_1","compress_stream_1","transcoder_1","roots_1","playqueues_1","waveforms_1","error_1","audio","Audio","Waveforms","Images","chat","Chat","Genres","NowPlaying","playqueues","PlayQueues","podcasts","Podcasts","IndexTree","users","Users","Metainfo","io","IO","Roots","refreshIndexes","buildGenres","buildIndexes","rescanRoot","ratings","avg","getListAvgHighest","getFilteredIDs","getListHighestRated","getListFrequentlyPlayed","getListFaved","getListRecentlyPlayed","searchIDs","collectFolderPath","folderId","collect","unshift","imageUrl","storeImage","destFileName","destName","dirname","applyFolderMove","downloadFolderImage","checkFolderInfoImage","getFolderImage","avatar","getDataPath","getTrackImage","getArtistImage","getAlbumImage","getUserImage","paintImage","getCoverArtText","paint","Transcoder","needsTranscoding","validTranscoding","PreTranscoder","reportTrack","reportEpisode","sendTrackList","fileList","CompressListStream","CompressStream","firstStart","adminUser","mail","ldapAuthenticated","firstStartRoots","first","checkDataPaths","checkFirstStart","findOrCreate","rating","scan_1","match_1","merge_1","meta_1","clean_1","scanning","rootstatus","scan","scanDir","matchDir","mtime","ctime","Merger","scanningCount","merge","cleanScanStore","MetaMerge","sync","startScanning","stopScanning","lastScan","scanRoot","newPath","filetype_1","scanDirR","substat","clone","matchDirR","subFolder","subDir","sd","deep_compare_1","tag_1","onProgress","modified","deepCompare","old","buildTrack","trackHasChanged","updateTrack","newTrack","compareFilesR","compareFile","newFolder","compareSubs","folderHasChanged","updateFolder","compareFoldersR","ignore","ignoreList","compare","oa","ob","trackInfo","mbAlbumArtistID","albumArtist","getArtistName","findArtist","rootIDs","nameSort","getArtistNameSort","getArtistMBArtistID","removeID3Artist","addArtist","getAlbumName","findAlbum","removeID3Album","addID3Album","trackInfos","artistSearchesName","artistTracks","idtracks","hasChanged","artistidtracks","albumtracks","atracks","syncID3Artist","syncAlbum","addID3s","syncID3","elasticsearch_1","es_sequence_1","mapping_1","wait_1","client","Client","host","elasticsearch","sequence","ESSequence","indexPrefix","indexRefresh","ping","requestTimeout","indexName","indices","exists","delete","getTypes","resetIndex","mapping","_default_","date_detection","mappings","createIndex","waitAfter","checkIndex","wait","DBIndexElastic","_index","_type","hit","_source","match_all","must","max_expansions","match_phrase_prefix","vals","bool","onHits","getMoreUntilDone","hits","total","_scroll_id","scroll","scrollId","getNewId","filterProperties","deleteByQuery","translateElasticQuery","_id","found","hit2Obj","mget","docs","doc","onItem","stored_fields","aggs","_count","cardinality","aggregations","fieldname","buckets","esTypeMapping","enabled","_all","isObject","isFunction","isInjectedClientValid","putMapping","bulk","initPromise","initError","cacheFillPromise","cache","cacheSize","esIndex","esType","isFinite","isInjectedCacheSizeValid","initEsIndexIfNeeded","addMappingToEsIndexIfMissing","settings","number_of_shards","auto_expand_replicas","sequenceName","bulkParams","k","_version","returnValue","interal_get","fillCache","type_bool","type_int","type_key","type_JamServe_Root","properties","type_JamServe_User","type_MusicBrainz_Rating","votesCount","type_MusicBrainz_Alias","sortName","locale","typeId","primary","beginDate","endDate","ended","type_MusicBrainz_ArtistCredit","joinphrase","disambiguation","aliases","type_JamServe_MetaInfoImage","type_JamServe_MetaInfo","tags","formatId","discCount","trackOffset","number","recording","video","artistCredit","isrcs","discs","sectors","offsetCount","offsets","score","statusId","country","packaging","packagingId","annotation","quality","barcode","asin","textRepresentation","language","script","releaseGroup","firstReleaseDate","primaryType","primaryTypeId","secondaryTypes","secondaryTypeIds","labelInfo","catalogNumber","label","labelCode","releaseEvents","area","iso31661Codes","coverArtArchive","front","back","darkened","artwork","topSongs","rank","type_JamServe_Folder","type_JamServe_PlayQueue","type_JamServe_TrackTag","albumSort","albumArtistSort","titleSort","mbAlbumType","mbReleaseGroupID","mbAlbumStatus","mbReleaseCountry","type_JamServe_TrackMedia","encoded","type_JamServe_Track","type_JamServe_Album","type_JamServe_Artist","type_JamServe_Radio","disabled","type_JamServe_State","type_JamServe_Playlist","type_JamServe_Podcast","type_JamServe_Episode","type_JamServe_Bookmark","ms","setTimeout","nedb_1","clients","db_path","loadDatabase","err2","DBIndexNedb","globaltempid","RegExp","literal_string","regExpEscape","$in","$where","$gte","$lte","$exists","$and","insert","update","numReplaced","translateQuery","hits2Objs","dbquery","translateSortQuery","skip","limit","exec","getFieldValueR","fields","getDotFieldValues","hexEncode","u","charAt","charCodeAt","hex","String","fromCharCode","substr","jamp3_1","chartlyrics_client_1","acoustid_client_1","lastfm_client_1","musicbrainz_client_1","durationEstimate","layer","simplifyTag","release_year","originalyear","original_release_year","release_date","album_sort_order","album_artist","album_artist_sort","album_artist_sort_order","artist_sort","cleanGenre","title_sort_order","TRACKID","ALBUMTYPE","ALBUMARTISTID","ARTISTID","ALBUMID","RELEASETRACKID","RELEASEGROUPID","RECORDINGID","ALBUMSTATUS","RELEASECOUNTRY","packMediaInfoImage","bio","parseFloat","wiki","MusicbrainzClient","tools","retryOn","lastFM","LastFMClient","lastfm","apiKey","acoustid","AcoustidClient","chartLyrics","ChartLyricsClient","chartlyrics","MP3","mpegQuick","mpeg","id3v2","packJamServeTag","packJamServeMpeg","frames","head","statusFlags","formatFlags","ver","rev","valid","end","ID3v2","write","id3v2tag","frame","binValue","pictureType","mimeType","artistName","packMediaInfoArtist","albumName","packMediaInfoAlbum","mb","lookup","inc","similarTrack","packMediaInfoSimilarSong","similarTrackID","topArtistSongs","packMediaInfoTopSongs","topArtistSongsID","arid","release","webservice_xml_client_1","WebserviceXMLClient","songName","opts","getJson","GetLyricResult","LyricId","trackId","TrackId","checksum","LyricChecksum","LyricSong","LyricArtist","LyricUrl","covertArtUrl","LyricCovertArtUrl","LyricRank","correctUrl","LyricCorrectUrl","lyric","Lyric","xml2js_1","parseString","fpcalc_1","webservice_client_1","META_DEFAULT","fp","toFixed","fingerprint","results","fpcalc","tool_1","cmds","raw","isWindows","platform","env","OSTYPE","COLON","isexeStat","isSymbolicLink","pathext","pathExt","PATHEXT","pathexts","checkWindowsMode","mod","uid","gid","myUid","getuid","myGid","getgid","g","checkMode","whichs","opt","colon","pathEnv","PATH","pathExtExe","cwd","ext","extExe","getPathInfo","F","er","getNotFoundError","pathPart","E","ii","ll","isexe","is","enviroment","which","arch","localBin","walk","subkey","api","sorted_params","beautify","toptracks","similartracks","albumIDTopTags","musicbrainz_client_types_1","port","basePath","retryDelay","retryCount","toUpperCase","formatKey","encodeURIComponent","retry","isRateLimitError","concatSearchQuery","LookupIncludes","invalidKey","lookupIds","LookupBrowseTypes","collection","event","instrument","place","release-group","series","work","GenresSlugs","genreByNumbers","slugify","getKnownGenre","slug","numpart","download_1","jimp_1","mime_types_1","debounce_promises_1","imageCacheDebounce","imageCachePath","filepath","imageext","font","loadFont","FONT_SANS_32_WHITE","print","alignmentX","HORIZONTAL_ALIGN_CENTER","alignmentY","VERTICAL_ALIGN_MIDDLE","resize","mime","getBufferAsync","crop","getWidth","getHeight","contain","getImage","cacheID","isPending","append","setPending","cachefile","destination","writeAsync","searches","findIndex","resizeImage","IndexTreeBuilder","app","matches","sortname","removeArticles","indexChar","getIndexChar","localeCompare","searchCount","getTotalTrackCount","folderIndex","buildFolderIndex","artistIndex","buildArtistIndex","builder","cached","forcerebuild","getIndexes","random_1","isArtist","mediaInfoArtistInfoByArtistID","mediaInfoArtistInfo","checkArtist","mediaInfoTopSongsByArtistID","mediaInfoTopSongs","checkTopSongs","mediaInfoAlbumInfoByAlbumID","checkAlbumById","mediaInfoAlbumInfo","checkAlbumByNameAndArtist","checkAlbum","getInfo","mediaInfoSimilarTrackByMBTrackID","mediaInfoSimilarTrack","createArtistInfo","createAlbumInfo","createTrackInfo","createFolderInfo","songs","similars","getSimilarSongs","sim","tr","includeNotPresent","artistsHash","includeSimilar","updateFolderInfo","getFolderSimilarArtists","updateArtistInfo","getSimilarArtists","updateAlbumInfo","top","getAlbumInfo","getSimilarArtistTracks","getArtistInfos","getFolderInfo","getTrackInfo","imagesPath","createAvatar","clearImageCacheByID","auth","authToken","messages","maxAge","unit","subtract","since","cleanOld","maxMsgs","genreHash","section","sections","sec","feed_1","podstate","podcastsPath","podcastId","podcastEpisodeId","links","mergePodcastEpisodes","refreshPodcast","removeEpisodes","np","reportPlaying","archiver_1","__importStar","streaming","archive","zlib","directory","finalize","fluent_ffmpeg_1","fs","mediaFormat","getAvailableFormats","formats","canDemux","proc","nolog","withAudioCodec","withNoVideo","toFormat","withAudioBitrate","writeToStream","statSync","rs","createReadStream","autoClose","save","getQueue","ffmpeg_waveform_svg_1","waveformCacheDebounce","waveformCachePath","getWaveFormSVG","Buffer","from","getCacheID","getWaveform","svgo_1","WaveFormSVG","generate","PeakData","lastMax","fill","lastMin","indexI","indexJ","indexJJOverflow","splitPeaks","GetPeaks","splitChannels","sampleStep","totalSamples","mergedPeaks","buffers","sampleSize","chan","peaks","jj","broken","svgo","temp","convertFile","getPeaks","svgPath","svg","optimize","totalPeaks","peakNumber","left","right","leftValue","rightValue","svgPathMixedChannel","numOfChannels","maxValue","minValue","width","precision","oddByte","sc","readable","chunk","samples","readInt8","readInt16LE","readUInt8","destpath","express_1","body_parser_1","router_1","router_2","helmet_1","urlencoded","extended","initJamRouter","initSubsonicRouter","static","jamberry","listen","getURL","login_1","multer_1","api_1","cors_1","session_storage_1","express_session_1","passport_1","passport_jwt_1","passport_local_1","jsonwebtoken_1","routes_1","check_1","max_age_1","autoUploadTempReap","LoginLimiter","rateLimit","windowMs","CallSessionLoginHandler","authenticate","login","getMaxAge","jwt","tokenData","exp","sign","secret","allowedCookieDomains","session","packUser","CallSessionLogoutHandler","logout","ok","AdminMiddleWare","ApiJam","UPLOAD_PATH","router","Router","cookie","SessionJSONFileStore","resave","saveUninitialized","secure","initialize","serializeUser","deserializeUser","getUser","Strategy","usernameField","passwordField","password","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","secretOrKey","jwt_payload","fromUrlQueryParameter","originalUrl","preflightContinue","credentials","allowedHeaders","origin","methods","registerPublicApi","origins","CheckAuthMiddleWare","registerUserApi","single","registerAdminApi","health_1","paginate_1","APIJamObj","objstore","listQuery","jamquery","getFilteredListHighestRated","getFilteredListAvgHighest","getFilteredListFrequentlyPlayed","getFilteredListFaved","getFilteredListRecentlyPlayed","prepareListByIDs","prepare","prepareList","byID","byIDs","findOrCreateMulti","packStates","fav","rate","getObjImage","getObjDownload","APIJamPodcast","packPodcast","isDownloadingPodcast","podcastState","podcastEpisodes","defaultEpisodesSort","sortField","sortDescending","refreshPodcasts","addPodcast","removePodcast","APIJamEpisode","isDownloadingPodcastEpisode","trackState","downloadPodcastEpisode","getObjStream","APIJamAlbum","packAlbum","albumState","albumInfo","packAlbumInfo","albumTracks","defaultTrackSort","getAlbumSimilarTracks","getList","APIJamArtist","artistState","artistInfo","infos","artistInfoSimilar","packArtistInfo","artistAlbums","getArtistSimilarTracks","getArtistIndex","packArtistIndex","filterArtistIndex","APiJamPlaylist","playlistState","playlistTracks","createPlaylist","updatePlaylist","removePlaylist","APIJamTrack","trackID3","tagID3","readID3v2","saveID3v2","rescanTracks","tagID3s","packBookmark","bookmarkTrack","trackBookmarkCreate","prepareBookmark","trackBookmarkRemove","bookmarks","getTrackSimilarTracks","APIJamFolder","packFolder","folderChildren","folderTracks","folderSubfolders","folderState","folderHealth","folderInfo","getFolderArtistInfo","folderInfoSimilar","packArtistFolderInfo","packAlbumFolderInfo","problems","getFolderProblems","health","folderParents","parents","getFolderParents","trackQuery","recursive","resultTracks","setFolderImage","renameFolder","getFolderSimilarTracks","getFolderIndex","packFolderIndex","filterFolderIndex","APIJamRoot","packRoot","getRootStatus","createRoot","updateRoot","removeRoot","refreshRoot","APIJamUser","roleAdmin","roleStream","roleUpload","rolePodcast","createUser","updateUser","saveQueue","getQueueOrCreate","packPlayQueue","playQueueTracks","deleteUser","setUserImage","APiJamChat","packChatMessage","APiJamMetadata","getGenres","packGenre","brainz","musicbrainzSearch","acoustidLookup","lastFMLookup","musicbrainzLookup","metadata","getNowPlaying","packNowPlaying","autocomplete","findInAll","getObjStreamSVG","ProblemDefs","FOLDER_TAG_MISSING","FOLDER_TAG_VALUES_MISSING","ALBUM_IMAGE_MISSING","ALBUM_IMAGE_NAME_NONCONFORM","ALBUM_NAME_NONCONFORM","nicename","getNiceFolderName","ALBUM_GENRE_MISSING","ALBUM_ID_MISSING","ARTIST_IMAGE_NAME_NONCONFORM","ARTIST_IMAGE_MISSING","node","probs","sid","sessionData","expired","destroy","savejson","clear","mkdir","readFile","expires","uploadAutoRemove","lastfmLookup","brainzLookup","brainzSearch","genreList","children","subfolders","artistSimilar","artistSimilarTracks","bookmarkList","refreshAll","similarTracks","download","binary","streamSVG","bookmarkDelete","favUpdate","rateUpdate","bookmarkCreate","playqueueUpdate","imageUploadUpdate","retrieve","scanAll","tagID3Update","tagID3sUpdate","imageUrlUpdate","nameUpdate","ajv","validator","compile","maxAgeSpec","asMilliseconds","parameters_1","PodcastAdminMiddleWare","ShareMiddleWare","JukeboxMiddleWare","SubsonicApi","share","jukebox","SubsonicParameterMiddleWare","SubsonicLoginMiddleWare","registerApi","validateCredentials","util_1","xmli","xmls","xmlo","xmlc","xml","v","processParams","pack","packFolderArtist","prepareObj","removeDups","pos","userIds","prepareTracks","bookmarkuser","packPlaylistWithSongs","typesObjs","findMultiInAll","license","licenseExpires","trialExpires","a1","b1","prepareFolders","packDirectory","ifModifiedSince","musicFolderId","indexes","ignoredArticles","albumList","albumList2","prepareAlbums","limitCount","averageRating","artistInfo2","packArtistInfo2","getTopTracks","similarSongs","packSimilarSongs","similarSongs2","packSimilarSongs2","prepareTrack","dummy","musicFolders","musicFolder","collectStateChangeObjects","getBool","chatMessages","chatMessage","plist","preparePlaylist","playlistId","updateQuery","songIdToAdd","songId","removetracks","songIndexToRemove","songadd","artistFolderIDs","prepareFolderArtists","albumFolderIDs","starred2","artistIDs","prepareArtists","includeEpisodes","podcastList","channel","prepareEpisodes","newestPodcasts","deletePodcastEpisode","bookmarklist","prepareBookmarks","randomSongs","trackids","songsByGenre","tracklist","any","searchResult","totalHits","searchResult2","songOffset","folderlist","artistOffset","albumOffset","searchResult3","albumlist","artistlist","scanStatus","getScanStatus","artistid3","albumid3","lyrics","getLyrics","homepageUrl","internetRadioStations","internetRadioStation","packRadio","videos","videoInfo","shares","jukeboxStatus","currentIndex","gain","addChatMessage","changePassword","createBookmark","createPodcastChannel","createShare","deleteBookmark","deleteInternetRadioStation","deletePlaylist","deletePodcastChannel","deleteShare","getAlbum","getAlbumInfo2","getAlbumList","getAlbumList2","getArtist","getArtistInfo","getArtistInfo2","getArtists","getBookmarks","getChatMessages","getInternetRadioStations","createInternetRadioStation","updateInternetRadioStation","getLicense","getMusicDirectory","getMusicFolders","getNewestPodcasts","getPlaylist","getPlaylists","getPlayQueue","getPodcasts","getRandomSongs","startScan","getShares","getSimilarSongs2","getSong","getSongsByGenre","getStarred","getStarred2","getTopSongs","getUsers","getVideoInfo","getVideos","jukeboxControl","savePlayQueue","scrobble","search2","search3","setRating","star","unstar","updateShare","getAvatar","getCaptions","getCoverArt","hls","SubsonicApiSchema","app_config_1","thirdparty_config_1","extendConfig","ThirdPartyConfig","AppConfig"],"mappings":"aACA,IAAAA,KAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,IACAG,EAAAH,EACAI,GAAA,EACAH,YAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QAKAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,GAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,EAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,eAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,aAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,cAAiDmB,OAAA,KAQjDrB,EAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,EAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,EAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAArB,EAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,EAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,KAAAqB,WACA,WAA2B,OAAArB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD/B,EAAAkC,EAAA,GAIAlC,IAAAmC,EAAA,oBClFAhC,EAAAD,QAAAkC,QAAA,2KCAA,MAAAC,EAAAC,EAAAtC,EAAA,KAGAA,EAAQ,GAARA,CAAyBqC,EAAAE,SAEzBrC,EAAAsC,gBAAA,SAAgCC,GAC/BJ,EAAAE,QAAQG,WACPC,MAAOF,EAAOG,IAAID,MAClBE,YACC,IAAIR,EAAAE,QAAQM,WAAWC,SACtBC,OACCV,EAAAE,QAAQQ,OAAOC,QAEdX,EAAAE,QAAQQ,OAAOE,WACfZ,EAAAE,QAAQQ,OAAOG,sBAQfC,EAGLC,YAAYzC,GACX0C,KAAK1C,KAAOA,EAGLyC,SAAST,EAAeI,KAAmBO,GAClDjB,EAAAE,QAAQK,IAAIW,MAAMF,MAAOV,GAAO,IAAKa,MAAQC,cAAgB,IAAMJ,KAAK1C,KAAO,MAAQoC,GAAQW,OAAOJ,GAAQK,KAAK,OAGpHP,MAAML,KAAmBO,GACxBD,KAAKO,SAAS,QAASb,EAAQO,GAGhCF,KAAKL,KAAmBO,GACvBD,KAAKO,SAAS,OAAQb,EAAQO,GAG/BF,KAAKL,KAAmBO,GACvBD,KAAKO,SAAS,OAAQb,EAAQO,GAG/BF,MAAML,KAA2BO,GAChCD,KAAKO,SAAS,QAASb,EAAOc,WAAYP,GAG3CF,KAAKzC,GACE0B,EAAAE,QAASuB,UAAUnD,EAAM,SAGhCyC,QAAQzC,GACD0B,EAAAE,QAASwB,SAASpD,EAAM,UAQhCT,EAAAqC,QAJA,SAAgB5B,GACf,OAAO,IAAIwC,EAAOxC,kCC3DnB,IAkCYqD,mDAlCZ,SAAYC,GACXA,IAAA,eACAA,IAAA,eACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,uBACAA,IAAA,qBACAA,IAAA,qBACAA,IAAA,uBACAA,IAAA,iBACAA,IAAA,oBACAA,IAAA,0BACAA,IAAA,kBAbD,CAAY/D,EAAA+D,eAAA/D,EAAA+D,kBAgBC/D,EAAAgE,gBACZC,IAAO,aACPC,IAAO,YACPC,IAAO,YACPC,IAAO,YACPC,MAAS,aACTC,KAAQ,aACRC,IAAO,aAGKvE,EAAAwE,gBACZC,IAAO,YACPC,IAAO,YACPC,IAAO,YACPC,MAAS,aACTN,KAAQ,cAGT,SAAYR,GACXA,EAAA,kBACAA,EAAA,gBACAA,EAAA,0BACAA,EAAA,cACAA,EAAA,wBACAA,EAAA,gBAND,CAAYA,EAAA9D,EAAA8D,aAAA9D,EAAA8D,gBASC9D,EAAA6E,qBACZC,QAAS,SACTC,OAAQ,SACRC,YAAa,SACbC,MAAO,QACPC,WAAY,QACZC,OAAQ,UAGInF,EAAAoF,kBAAoBtB,EAAWmB,MAAOnB,EAAWoB,YAE9D,SAAYG,GACXA,IAAA,yBAAWA,IAAA,2BADZ,CAAYrF,EAAAqF,wBAAArF,EAAAqF,2BAIZ,SAAYC,GACXA,EAAA,kBACAA,EAAA,cACAA,EAAA,UACAA,EAAA,sBAJD,CAAYtF,EAAAsF,YAAAtF,EAAAsF,eAOZ,SAAYC,GACXA,EAAA,kBACAA,EAAA,cACAA,EAAA,cACAA,EAAA,UACAA,EAAA,gBACAA,EAAA,cAND,CAAYvF,EAAAuF,UAAAvF,EAAAuF,2cCjEZ,MAAAC,EAAApD,EAAAtC,EAAA,IACA2F,EAAArD,EAAAtC,EAAA,KACA4F,EAAAtD,EAAAtC,EAAA,IACA6F,EAAAvD,EAAAtC,EAAA,KAEA,SAAsB8F,EAAOC,2CAC5B,OAAO,IAAIC,QAAkB,CAACC,EAASC,KACtCR,EAAAnD,QAAG4D,KAAKJ,EAAU,CAACK,EAAKD,KACnBC,EACHF,EAAOE,GAEPH,EAAQE,SA0CZ,SAAsBE,EAAWN,2CAChC,OAAO,IAAIC,QAAc,CAACC,EAASC,KAClCR,EAAAnD,QAAG+D,OAAOP,EAAWK,IAChBA,EACHF,EAAOE,GAEPH,UAqCJ,SAAsBM,EAAWR,2CAChC,IAEC,aADmBD,EAAOC,IACdS,SACX,MAAOC,GACR,QAAIA,GAAgB,WAAXA,EAAEC,OAGHV,QAAQE,OAAOO,MAKzB,SAAsBE,EAASZ,2CAC9B,IAEC,aADmBD,EAAOC,IACda,cACX,MAAOH,GACR,QAAIA,GAAgB,WAAXA,EAAEC,OAGHV,QAAQE,OAAOO,MAhHzBvG,EAAA4F,SAYA5F,EAAA2G,WAAA,SAAiCC,EAAgBC,2CAChD,OAAO,IAAIf,QAAc,CAACC,EAASC,KAClCR,EAAAnD,QAAGyE,OAAOF,EAAQC,EAAOX,IACpBA,EACHF,EAAOE,GAEPH,WAMJ/F,EAAA+G,UAAA,SAAgCH,EAAgBC,2CAC/C,OAAO,IAAIf,QAAc,CAACC,EAASC,KAClCR,EAAAnD,QAAGyE,OAAOF,EAAQC,EAAOX,IACpBA,EACHF,EAAOE,GAEPH,WAMJ/F,EAAAgH,QAAA,SAA8BnB,2CAC7B,OAAO,IAAIC,QAAuB,CAACC,EAASC,KAC3CR,EAAAnD,QAAG4E,QAAQpB,EAAU,CAACK,EAAKgB,KACtBhB,EACHF,EAAOE,GAEPH,EAAQmB,UAMZlH,EAAAmG,aAYAnG,EAAAmH,SAAA,SAA+BP,EAAgBC,2CAC9C,OAAO,IAAIf,QAAc,CAACC,EAASC,KAClCR,EAAAnD,QAAG+E,SAASR,EAAQC,EAAOX,IACtBA,EACHF,EAAOE,GAEPH,WAMJ/F,EAAAqH,UAAA,SAAgCxB,EAAkBqB,2CACjD,OAAO,IAAIpB,QAAc,CAACC,EAASC,KAClCR,EAAAnD,QAAGiF,UAAUzB,EAAUqB,EAAOhB,IACzBA,EACHF,EAAOE,GAEPH,WAMJ/F,EAAAuH,mBAAA,SAAyC1B,2CAExC,SADqBQ,EAAWR,GAE/B,aAAaM,EAAWN,MAI1B7F,EAAAqG,aAaArG,EAAAyG,WAaAzG,EAAAwH,WAAA,SAA2BC,GAC1B,OAAO/B,EAAArD,QAAKqF,QAAQD,GAAUE,MAAM,GAAGC,eAGxC5H,EAAA6H,SAAA,SAA+BC,2CAE9B,WADqBrB,EAASqB,IAI9B,OAAO,IAAIhC,QAAc,CAACC,EAASC,KAClCP,EAAApD,QAAOyF,EAAS5B,IACXA,EACHF,EAAOE,GAEPH,WAMJ/F,EAAA+H,uBAAA,SAAuC9F,EAAW+F,GACjD,OAAO/F,EAAE0B,WACPqE,QAAQ,KAAM,OAAOA,QAAQ,MAAO,KACpCA,QAAQ,aAAcA,IAGzBhI,EAAAiI,QAAA,mDACC,OAAO,IAAInC,QAA4D,CAACC,EAASC,KAChFL,EAAAtD,QAAI6F,KAAK,CAAChC,EAAKuB,EAAUU,EAAIC,KACxBlC,EACHF,EAAOE,GAEPH,GAAS0B,WAAUW,0CC1JvBnI,EAAAD,QAAAkC,QAAA,yKCAA,MAAAmG,EAAAjG,EAAAtC,EAAA,IAEA4F,EAAAtD,EAAAtC,EAAA,IACAwI,EAAAxI,EAAA,GACAyI,EAAAzI,EAAA,SAaa0I,EAWZtF,gBAAgBsD,EAAciC,GA8B7B,OACCC,qBACCC,OAAU,SACVC,MAAS,8BACTC,OACCrC,KAAMA,EACNsC,QAASL,IAfXM,EAAG,mBACHC,GAAI,iCACJC,GAAI,oEACJC,GAAI,oEACJC,GAAI,8BACJC,GAAI,kDACJC,GAAI,qCAS0B7C,IAE7B8C,QAAW,WAKdpG,oBAAuBvC,GAMtB,OACC+H,oBAAqB9H,OAAO2I,QAL5BZ,OAAQ,KACRC,MAAO,8BACPU,QAAS,UAGoC3I,IAI/CuC,gBACC,OACCwF,qBACCC,OAAQ,KACRC,MAAO,8BACPU,QAAS,WAKZpG,0BAA0BsG,GACzB,OAAOnB,EAAAhG,QAAOmH,GAAMC,MAAM5G,SAG3BK,gBAAgBwG,GACf,OAAQC,GAAIC,SAASF,EAAKC,GAAI,IAAKlJ,KAAMiJ,EAAKjJ,MAG/CyC,gBAAgB2G,GACf,OACCC,SAAUD,EAAKpJ,KACfsJ,MAAOF,EAAKE,MACZC,WAAYH,EAAKG,WACjBC,uBAA8CC,IAA3BL,EAAKI,kBAAkC9G,KAAKgH,mBAAmBN,EAAKI,wBAAqBC,EAC5GpC,OAAQ+B,EAAKO,cAAgBP,EAAKO,cAAcC,IAAIpI,GAAK2H,SAAS3H,EAAG,UAAOiI,EAC5EI,kBAAmBT,EAAKS,kBACxBC,UAAWV,EAAKW,MAAMD,UACtBE,aAAcZ,EAAKW,MAAMD,UACzBG,aAAcb,EAAKW,MAAMD,UACzBI,WAAYd,EAAKW,MAAMG,WACvBC,aAAcf,EAAKW,MAAMD,UACzBM,aAAchB,EAAKW,MAAMD,UACzBO,YAAajB,EAAKW,MAAMD,UACxBQ,YAAalB,EAAKW,MAAMO,YACxBC,WAAYnB,EAAKW,MAAMQ,WACvBC,YAAapB,EAAKW,MAAMD,UACxBW,UAAWrB,EAAKW,MAAMD,UACtBY,oBAAqBtB,EAAKW,MAAMD,WAIlCrH,6BAA6BkI,EAAkCC,GAU9D,OACC1B,GAAIyB,EAAMtD,OAAO6B,GACjBlJ,KAAM2K,EAAM3K,KACZ6K,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,EACvEsB,WAAYH,EAAQA,EAAMI,WAAQvB,GAKpChH,uBAAuBwI,EAA6BC,GACnD,OAAKD,EAGEA,EAAME,OAAOvB,IAAInK,KACvBO,KAAMP,EAAEO,KACRsE,OAAQ7E,EAAE2L,QAAQxB,IAAI9D,GACdiC,EAAOsD,sBAAsBvF,EAAGoF,EAAOpF,EAAEuB,OAAO6B,YAK1DzG,uBAAuBwI,EAA6BC,GACnD,OAAKD,EAGEA,EAAME,OAAOvB,IAAInK,KACvBO,KAAMP,EAAEO,KACRsE,OAAQ7E,EAAE2L,QAAQxB,IAAI9D,GAAKiC,EAAOuD,WAAWxF,EAAExB,OAAQ4G,EAAOpF,EAAExB,OAAO4E,YAIzEzG,qBAAqB4E,EAAyBuD,GAY7C,OACC1B,GAAI7B,EAAO6B,GACXqC,OAAQlE,EAAOmE,SACfxL,KAAMiF,EAAArD,QAAK6J,SAASpE,EAAOqE,MAC3Bb,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,GAIzEhH,wBAAwB4E,EAAyBuD,GAUhD,OACC1B,GAAI7B,EAAO6B,GACXlJ,KAAMqH,EAAOsE,IAAIC,OAASvE,EAAOsE,IAAIrH,QAAU,GAC/CuG,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,EACvEsB,WAAYH,EAAQA,EAAMI,WAAQvB,GAIpChH,iBAAiB+B,EAAuBoG,GAgBvC,OACC1B,GAAI1E,EAAM0E,GACVlJ,KAAMwE,EAAMxE,KACZsE,OAAQE,EAAMF,OACduH,SAAUrH,EAAMsH,SAChBC,SAAUvH,EAAM0E,GAChB8C,UAAWxH,EAAMyH,SAASC,OAC1BC,SAAU3H,EAAM2H,SAChBC,KAAM5H,EAAM4H,KACZC,MAAO7H,EAAM6H,MACbC,QAASvE,EAAO2B,mBAAmBlF,EAAM8H,SACzCzB,QAASD,GAASA,EAAME,MAAQ/C,EAAO2B,mBAAmBkB,EAAME,YAASrB,GAI3EhH,kBAAkB6B,EAAyBsG,GAU1C,OACC1B,GAAI5E,EAAO4E,GACXlJ,KAAMsE,EAAOtE,KACb+L,SAAUzH,EAAO4E,GACjBqD,WAAYjI,EAAOkI,SAASN,OAC5BrB,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,GAIzEhH,qBAAqBgK,GACpB,OACCC,MAAOD,EAAKjI,MAAMmI,YAClBC,cAAeH,EAAKjI,MAAMqI,KAC1BC,UAAWL,EAAKjI,MAAMuI,IACtBC,cAAeP,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMC,MAAQT,EAAKjI,MAAMyI,MAAMC,WAAQzD,EACrF0D,eAAgBV,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMG,OAASX,EAAKjI,MAAMyI,MAAMG,YAAS3D,EACxF4D,cAAeZ,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMK,MAAQb,EAAKjI,MAAMyI,MAAMK,WAAQ7D,GAIvFhH,sBAAsBgK,EAAyBc,GAC9C,OACCC,UAAWf,EAAKnI,OAAOqI,YACvBC,cAAeH,EAAKnI,OAAOuI,KAC3BC,UAAWL,EAAKnI,OAAOyI,IACvBC,cAAeP,EAAKnI,OAAO2I,OAASR,EAAKnI,OAAO2I,MAAMC,MAAQT,EAAKnI,OAAO2I,MAAMC,WAAQzD,EACxF0D,eAAgBV,EAAKnI,OAAO2I,OAASR,EAAKnI,OAAO2I,MAAMG,OAASX,EAAKnI,OAAO2I,MAAMG,YAAS3D,EAC3F4D,cAAeZ,EAAKnI,OAAO2I,OAASR,EAAKnI,OAAO2I,MAAMK,MAAQb,EAAKnI,OAAO2I,MAAMK,WAAQ7D,EACxFgE,cAAeF,GAIjB9K,uBAAuBgK,EAAyBc,GAC/C,OACCC,UAAWf,EAAKnI,OAAOqI,YACvBC,cAAeH,EAAKnI,OAAOuI,KAC3BC,UAAWL,EAAKnI,OAAOyI,IACvBC,cAAeP,EAAKnI,OAAO2I,OAASR,EAAKnI,OAAO2I,MAAMC,MAAQT,EAAKnI,OAAO2I,MAAMC,WAAQzD,EACxF0D,eAAgBV,EAAKnI,OAAO2I,OAASR,EAAKnI,OAAO2I,MAAMG,OAASX,EAAKnI,OAAO2I,MAAMG,YAAS3D,EAC3F4D,cAAeZ,EAAKnI,OAAO2I,OAASR,EAAKnI,OAAO2I,MAAMK,MAAQb,EAAKnI,OAAO2I,MAAMK,WAAQ7D,EACxFgE,cAAeF,GAIjB9K,iBAAiBiL,EAAuB9C,GAkCvC,MAAM+C,EAAS9F,EAAAd,WAAW2G,EAAM1N,MAC1B4N,GACL1E,GAAIwE,EAAMxE,GACVqC,OAAQmC,EAAMlC,UAAY,GAC1BI,MAAO8B,EAAM/B,IAAIC,OAAS8B,EAAM1N,KAChCwE,MAAOkJ,EAAM/B,IAAInH,MACjBF,OAAQoJ,EAAM/B,IAAIrH,OAClBuJ,OAAO,EACP9B,SAAU2B,EAAMxE,GAChBmD,MAAOqB,EAAM/B,IAAIU,MACjBD,KAAMsB,EAAM/B,IAAIS,KAChBE,QAASvE,EAAO2B,mBAAmBgE,EAAMlI,KAAK8G,SAC9CH,cAAoC1C,IAAzBiE,EAAMI,MAAM3B,UAA2B4B,MAAML,EAAMI,MAAM3B,WAAiD,EAApC6B,KAAKC,MAAMP,EAAMI,MAAM3B,UACxG+B,aAAkCzE,IAAxBiE,EAAMI,MAAMI,QAAyBF,KAAKC,MAAMP,EAAMI,MAAMI,QAAU,MAAS,EACzFR,MAAOA,EAAM/B,IAAI+B,MACjBS,KAAMT,EAAMlI,KAAK2I,KACjBR,OAAQA,EACRS,YAAatG,EAAAvE,eAAeoK,GAC5BU,SAAS,EACT3C,KAAMgC,EAAMhC,KAAO,IAAMgC,EAAM1N,KAC/BsO,WAAYZ,EAAM/B,IAAI4C,KACtBC,QAASd,EAAMe,QACf5C,SAAU6B,EAAM5B,SAChB4C,KAAM,QACN3D,WAAYH,EAAQA,EAAMI,WAAQvB,EAClCoB,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,EACvEkF,UAAW/D,GAASA,EAAMgE,OAAShE,EAAMgE,OAAS,EAClDC,sBAAkBpF,EAClBqF,2BAAuBrF,GASxB,MAJe,QAAXkE,IACHC,EAAOiB,iBAAmB,MAC1BjB,EAAOkB,sBAAwBhH,EAAAvE,eAAeqK,EAAOiB,mBAE/CjB,EAGRnL,sBAAsBsM,EAAiCnE,GACtD,IAAID,EACJ,OAAQoE,EAAWC,IAAIN,MACtB,KAAK5G,EAAAxE,aAAaoK,MACjB/C,EAAQ5C,EAAOkH,UAA0BF,EAAWC,IAAKpE,GACzD,MACD,KAAK9C,EAAAxE,aAAa4L,QACjBvE,EAAQ5C,EAAOoH,mBAAqCJ,EAAWC,IAAKpE,GACpE,MACD,QACCD,GACCzB,GAAI6F,EAAWC,IAAI9F,GACnB2E,OAAO,EACPjC,MAAO,WAGV,MAAMwD,EAAoCzE,EAI1C,OAHAyE,EAAQ/F,SAAW0F,EAAW3F,KAAKpJ,KACnCoP,EAAQC,WAAarB,KAAKC,MAAMrG,EAAAhG,QAAOuK,SAASvE,EAAAhG,UAAS0N,KAAK1H,EAAAhG,QAAOmN,EAAWQ,QAAQC,aACxFJ,EAAQK,SAAW,EACZL,EAGR3M,kBAAkB4E,EAAyBuD,GAC1C,OACC1B,GAAI7B,EAAO6B,GACXwC,KAAMrE,EAAOqE,KACbH,OAAQlE,EAAOmE,SACfc,QAASvE,EAAO2B,mBAAmBrC,EAAO7B,KAAK8G,SAC/CV,MAAOvE,EAAOsE,IAAIC,OAAS,GAC3BpH,MAAO6C,EAAOsE,IAAInH,MAClB6H,MAAOhF,EAAOsE,IAAIU,MAClB/H,OAAQ+C,EAAOsE,IAAIrH,OACnB8H,KAAM/E,EAAOsE,IAAIS,KACjBL,SAAU1E,EAAO6B,GACjB6B,WAAYH,EAAQA,EAAMI,WAAQvB,EAGlCoE,OAAO,EACPhD,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,GAIzEhH,mBAAmBiN,EAA2BxH,GAC7C,OACCgB,GAAIwG,EAAQxG,GACZ6D,IAAK2C,EAAQ3C,IACb4C,aAAcD,EAAQC,aACtB/D,MAAO8D,EAAQ/D,IAAM+D,EAAQ/D,IAAIC,WAAQnC,EACzCvB,OAAQA,IAAmBwH,EAAQ/D,IAAM+D,EAAQ/D,IAAIzD,OAASwH,EAAQxH,QACtEyE,YAAa+C,EAAQ/D,IAAM+D,EAAQ/D,IAAIgB,iBAAclD,EACrDsC,SAAU2D,EAAQxG,GAClB0G,iBAAkBF,EAAQ/D,IAAM+D,EAAQ/D,IAAIsB,WAAQxD,GAItDhH,0BAA0ByM,EAA2BtE,EAAuB1C,GAC3E,MAAM0F,GAKLiC,SAAUX,EAAQhG,GAClB6C,SAAUmD,EAAQhG,GAClB4G,UAAWZ,EAAQa,UACnBpD,YAAauC,EAAQc,QACrBC,iBAA8BxG,IAAjByF,EAAQnG,KAAqBrG,KAAKgH,mBAAmBwF,EAAQnG,WAAQU,EAClFmC,MAAOsD,EAAQtD,MACf1D,OAAQgH,EAAQhH,OAChBgB,GAAIgG,EAAQhG,GACZqC,OAAQ2D,EAAQa,UAChBzL,OAAQ4K,EAAQvD,IAAMuD,EAAQvD,IAAIrH,OAAS4K,EAAQgB,OACnD1L,MAAO0K,EAAQvD,IAAMuD,EAAQvD,IAAInH,WAAQiF,EACzCiE,MAAOwB,EAAQvD,IAAMuD,EAAQvD,IAAI+B,WAAQjE,EACzC2C,KAAM8C,EAAQvD,IAAMuD,EAAQvD,IAAIS,UAAO3C,EACvC4C,MAAO6C,EAAQvD,IAAMuD,EAAQvD,IAAIU,WAAQ5C,EACzC6E,WAAYY,EAAQvD,IAAMuD,EAAQvD,IAAI4C,UAAO9E,EAC7CiF,KAAM,UACNC,UAAW/D,GAASA,EAAMgE,OAAShE,EAAMgE,OAAS,EAClD/D,QAASD,GAASA,EAAME,MAAQpI,KAAKgH,mBAAmBkB,EAAME,YAASrB,EACvEsB,WAAYH,EAAQA,EAAMI,WAAQvB,EAClC4E,SAAS,EACTR,OAAO,EACPF,YAAQlE,EACRoF,sBAAkBpF,EAClBqF,2BAAuBrF,EACvBiC,UAAMjC,EACN0E,UAAM1E,EACN6C,aAAS7C,EACT0C,cAAU1C,EACVyE,aAASzE,GAqBV,OAnBIyF,EAAQxD,OACXkC,EAAOD,OAAS9F,EAAAd,WAAWmI,EAAQxD,MACb,QAAlBkC,EAAOD,SACVC,EAAOiB,iBAAmB,MAC1BjB,EAAOkB,sBAAwBhH,EAAAvE,eAAeqK,EAAOiB,mBAEtDjB,EAAOQ,YAActG,EAAAvE,eAAeqK,EAAOD,QACvCuB,EAAQ1J,OACXoI,EAAOO,KAAOe,EAAQ1J,KAAK2I,KAC3BP,EAAOtB,QAAUvE,EAAO2B,mBAAmBwF,EAAQ1J,KAAK8G,UAErD4C,EAAQpB,QACXF,EAAOzB,SAAW+C,EAAQpB,MAAM3B,SAChCyB,EAAOM,aAAoCzE,IAA1ByF,EAAQpB,MAAMI,QAAwBF,KAAKC,MAAMiB,EAAQpB,MAAMI,QAAU,MAAS,IAGjGhG,IACH0F,EAAO1F,OAASA,GAEV0F,EAGRnL,oBAAoB0N,GACnB,OACCjH,GAAIiH,EAASjH,GACblJ,KAAMmQ,EAASnQ,KACfoQ,QAASD,EAASC,SAAW,GAC7BC,OAAUF,EAASG,SACnBnE,SAAUgE,EAAShE,SACnBG,QAASvE,EAAO2B,mBAAmByG,EAAS7D,SAC5CiE,QAASxI,EAAO2B,mBAAmByG,EAASI,SAC5CxE,SAAUoE,EAASpE,SACnByE,YAAaL,EAASK,YACtBxE,UAAWmE,EAASlE,SAASC,OAC7BuE,MAAON,EAASO,QAIlBjO,6BAA6B0N,EAA6BQ,EAA+BzF,GACxF,MAAM0C,EAAqC7F,EAAO6I,aAAaT,GAE/D,OADAvC,EAAOjD,MAAQgG,EAAO/G,IAAI8D,GAAS3F,EAAOkH,UAAUvB,EAAOxC,EAAOwC,EAAMxE,MACjE0E,EAGRnL,oBAAoBoO,EAA6BxH,EAAkByH,GAClE,OACCnG,MAAOmG,EACPzH,SAAUA,EACV0H,SAAUF,EAASE,SACnBX,QAASS,EAAST,QAClB9D,QAASvE,EAAO2B,mBAAmBmH,EAASvE,SAC5CiE,QAASxI,EAAO2B,mBAAmBmH,EAASN,UAI9C9N,wBAAwBuO,GACvB,OACCC,KAAMD,GAIRvO,yBAAyBuO,GACxB,OACCC,KAAMD,GAIRvO,qBAAqByO,EAA+B9H,EAAqB4H,GACxE,OACCrG,MAAOqG,EACPG,aAAiC1H,IAAxByH,EAAUE,UAA0BjI,SAAS+H,EAAUE,UAAW,SAAM3H,EACjFsH,SAAUG,EAAUH,SACpB1H,SAAUD,EAAKpJ,KACfuQ,QAASW,EAAUX,QAAU,EAAIxI,EAAO2B,mBAAmBwH,EAAUX,SAAW,GAChFc,UAAWH,EAAUG,WAAa,IAIpC5O,iBAAiB6O,GAChB,OACCpI,GAAIoI,EAAMpI,GACVlJ,KAAMsR,EAAMtR,KACZuR,UAAWD,EAAMvE,IACjByE,YAAaF,EAAMG,UAIrBhP,iBAAiB4J,GAChB,OACCqF,QAASrF,EAAMrM,KACfgM,UAAWK,EAAMsF,WACjBpF,WAAYF,EAAME,WAClBqF,YAAavF,EAAMuF,aAIrBnP,uBAAuB4F,GACtB,OACCgB,SAAUhB,EAAQgB,SAClBkG,KAAMlH,EAAQkH,KACdlH,QAASA,EAAQA,UAvhBZN,EAAA8J,MACNC,QAAS,EACTC,UAAW,GACXC,WAAY,GACZC,WAAY,GACZC,YAAa,GACbC,OAAQ,GACRC,SAAU,IARZ7S,EAAAwI,wBCjBAvI,EAAAD,QAAAkC,QAAA,0BCAAjC,EAAAD,QAAAkC,QAAA,6KCEA,MAAAwD,EAAAtD,EAAAtC,EAAA,IACAgT,EAAAhT,EAAA,KAEAiT,EAAAjT,EAAA,SAEakT,EAEL9P,UAAU+P,EAAsBC,GACtCF,EAAaG,KAAKF,EAAKC,EAAKH,EAAAvK,OAAO4K,UAG5BlQ,YAAY+P,EAAsBC,EAAuBhM,GAChE,MAAM9D,EAAoC6P,EAAKI,WACxB,UAAlBjQ,EAAOP,QAAwBO,EAAe,SAClD8P,EAAIvK,OAAO,KAAKwK,KAAK/P,EAAOkQ,SAAW,IAAMC,KAAKC,UAAUtM,GAAQ,MACxC,SAAlB9D,EAAOP,OACjBqQ,EAAIvK,OAAO,KAAK8K,KAAKvM,IAErBgM,EAAIQ,IAAI,eAAgB,mBACxBR,EAAIvK,OAAO,KAAKwK,KAAKL,EAAAa,MAAMzM,KAItBhE,YAAY+P,EAAsBC,EAAuBhM,GAC/D8L,EAAaG,KAAKF,EAAKC,EAAKH,EAAAvK,OAAOoL,aAAa1M,IAG1ChE,aAAa+P,EAAsBC,EAAuBhN,GAC5DA,EAAI2N,KACPb,EAAaG,KAAKF,EAAKC,EAAKH,EAAAvK,OAAOsL,SAAS5N,EAAI2N,KAAM3N,EAAI6N,OAE1Df,EAAaG,KAAKF,EAAKC,EAAKH,EAAAvK,OAAOsL,SAASf,EAAAvK,OAAO8J,KAAKC,SAAyB,iBAARrM,EAAmBA,EAAOA,EAAI4C,SAAW,iBAAkBnF,aAI/HT,cAAc+P,EAAsBC,EAAuBhM,GAC7DA,EAAK8M,KACR9M,EAAK8M,KAAKA,KAAKd,GACLhM,EAAK+M,QACff,EAAIQ,IAAI,eAAgBxM,EAAK+M,OAAOpF,aACpCqE,EAAIQ,IAAI,iBAAkBxM,EAAK+M,OAAOA,OAAOtH,OAAOhJ,YAEpDuP,EAAIvK,OAAO,KAAKwK,KAAKjM,EAAK+M,OAAOA,SACvB/M,EAAKgB,MACfgL,EAAIgB,SAAShN,EAAKgB,KAAKT,SAAUP,EAAKgB,KAAKzH,MAAQiF,EAAArD,QAAK6J,SAAShF,EAAKgB,KAAKT,YAvC9EzH,EAAAgT,6cCPA,MAAAmB,EAAA/R,EAAAtC,EAAA,KACAsU,EAAAhS,EAAAtC,EAAA,IAEAE,EAAAqU,uBAICnR,YAAYoR,EAA4BC,EAA2BC,GAClErR,KAAKsR,QAAU,IAAIN,EAAA9R,QAAYqS,YAAYJ,EAAoBC,GAC/DpR,KAAKqR,UAAYA,EAGFtR,QAAWsK,EAAa6F,2CACvC,MAAMsB,GACLnH,MACAoH,SAAUC,aAAc1R,KAAKqR,WAC7BM,GAAIzB,EACJ0B,QAAS,KAEJN,EAAUtR,KAAKsR,QACrB,OAAO,IAAI3O,QAAW,CAACC,EAASC,KAC/ByO,EAAQO,aAAa,EAAG,KACvBZ,EAAA/R,QAAQsS,EAAS,CAACzO,EAAK+O,EAAUC,KAChC,GAAIhP,EACHF,EAAOE,QAEP,IACCH,EAAWwN,KAAK4B,MAAMD,IACrB,MAAOhP,GACRF,EAAOE,4CC7Bd,SAAgBkP,EAAWC,GAC1B,IAAK,IAAInV,EAAImV,EAAK1I,OAAS,EAAGzM,EAAI,EAAGA,IAAK,CACzC,MAAMoV,EAAI7G,KAAK8G,MAAM9G,KAAK+G,UAAYtV,EAAI,KACzCmV,EAAKnV,GAAImV,EAAKC,KAAOD,EAAKC,GAAID,EAAKnV,IAErC,OAAOmV,EAGR,SAAgBI,EAAUC,EAAaC,GACtC,OAAOlH,KAAK8G,MAAM9G,KAAK+G,UAAYG,EAAMD,EAAM,IAAMA,mDATtD1V,EAAAoV,UAQApV,EAAAyV,YAKAzV,EAAA4V,YAAA,SAA+BP,EAAgBQ,GAC9C,QAAe3L,IAAX2L,GAAwBA,EAAS,GAAKR,EAAK1I,QAAUkJ,EACxD,OAAOT,EAAWC,GAEnB,MAAMhH,KACAyH,KACN,KAAQzH,EAAO1B,OAASkJ,GAAS,CAChC,MAAM3V,EAAIuV,EAAU,EAAGJ,EAAK1I,OAAS,GACjCmJ,EAAKC,QAAQ7V,GAAK,IACrBmO,EAAO2H,KAAKX,EAAKnV,IACjB4V,EAAKE,KAAK9V,IAGZ,OAAOmO,icCzBR,MAAA4H,EAAA7T,EAAAtC,EAAA,KAEAsU,EAAAhS,EAAAtC,EAAA,IACAoW,EAAA9T,EAAAtC,EAAA,KACAqW,EAAA/T,EAAAtC,EAAA,KACAyI,EAAAzI,EAAA,GAIaE,EAAAoW,eACZC,MAAO,MACPC,YAAa,cACbC,UAAW,YACXC,QAAS,UACT3N,MAAO,QACP4N,QAAS,WAGVzW,EAAA0W,WAECxT,eAIQA,UAAUyT,GACjB,OAAOA,EAAIC,MAAM,KAAKC,OACrB,CAACC,EAAiCC,KACjC,MAAMC,EAAQD,EAAMH,MAAM,KAAKvM,IAAI,SAAS4M,GAC3C,OAAOA,EAAKC,SAKb,OAHqB,IAAjBF,EAAMrK,SACTmK,EAAKE,EAAM,IAAMA,EAAM,IAEjBF,OAIF5T,gBAAgBgQ,EAAsBiE,EAAkBrB,GAC/D,IAAIsB,EAQJ,OAPID,EAASE,MAAM,gBAClBD,EAAanB,EAAA5T,QAAKiV,iBACPC,GAAG,QAASzB,GACbqB,EAASE,MAAM,cACzBD,EAAanB,EAAA5T,QAAKmV,gBACPD,GAAG,QAASzB,GAEjBsB,EAAalE,EAAIc,KAAKoD,GAAclE,EAGpChQ,eAAegQ,EAAsBuE,EAAiB3B,GAE7D,GAAI2B,IAAY,UAAUC,KAAKD,GAC9B,IACC,MAAME,EAAKxB,EAAA9T,QAAMuV,aAAaH,GAE9BE,EAAGJ,GAAG,QAASzB,GAGf5C,EAAWA,EAAIc,KAAK2D,GACnB,MAAOzR,GACRgN,EAAI2E,KAAK,QAAS3R,GAGpB,OAAOgN,EAGMhQ,MAAMsK,2CACnB,MAAMsK,KACN,IAAIC,EACAC,GAAe,EACnB,MAAM/E,EAAMmB,EAAA/R,QAAQmL,GAAMuH,QAAS,IAAOkD,MAAM,IAChDhF,EAAIiF,gBAAgB,IAEpBjF,EAAIkF,UAAU,aAAc,2HAC5BlF,EAAIkF,UAAU,SAAU,mCAExB,MAAMC,EAAa,IAAIlC,EAAA7T,YAYvB,OAVA+V,EAAWb,GAAG,WAAY,WACzB,MAAMtC,EAAWmD,EACjBL,EAAO9C,EAASoD,KAChB,IAAIC,EAAOrD,EAASsD,OACpB,KAAOD,GACNR,EAAM9B,KAAKsC,GACXA,EAAOrD,EAASsD,SAIX,IAAIzS,QAAkE,CAACC,EAASC,KACtF,MAAM8P,EAAQ5P,IACT8R,IAGJA,GAAe,EACX9R,EACHF,EAAOE,GAEPH,GAASgS,OAAMD,YAIjB7E,EAAIsE,GAAG,QAASzB,GAChB7C,EAAIsE,GAAG,WAAarE,IACnB,GAAuB,MAAnBA,EAAIsF,WAEP,OADAvF,EAAIwF,QACG3C,EAAK,IAAI4C,MAAM,mBAAqBxF,EAAIsF,WAAa,IAAMtF,EAAIyF,gBAEvE,MAAMxB,EAAWjE,EAAI0B,QAAQ,qBAAuB,WAC9C6C,EAAUtU,KAAKyV,UAAU1F,EAAI0B,QAAQ,iBAAmB,IAAI6C,QAClE,IAAIoB,EAAa1V,KAAK2V,gBAAgB5F,EAAKiE,EAAUrB,IACrD+C,EAAa1V,KAAK4V,eAAeF,EAAYpB,EAAS3B,IAC3C9B,KAAKoE,KAGjBA,EAAWb,GAAG,QAASzB,GACvBsC,EAAWb,GAAG,MAAOzB,OAKV5S,IAAIiN,2CAChB,MAAMjJ,QAAa/D,KAAK6V,MAAM7I,EAAQ3C,KAChCpB,GACLC,MAAOnF,EAAK6Q,KAAK1L,MACjB1D,OAAQ3I,EAAAoW,cAAcG,UACtBnJ,YAAalG,EAAK6Q,KAAK3K,YACvB6L,KAAM/R,EAAK6Q,KAAKkB,KAChBtI,OAAQzJ,EAAK6Q,KAAKpH,OAClBuI,UAAWhS,EAAK6Q,KAAKmB,UACrBxL,MAAOxG,EAAK6Q,KAAKrK,OAASxG,EAAK6Q,KAAKrK,MAAMF,IAAMtG,EAAK6Q,KAAKrK,MAAMF,SAAMtD,EACtEiP,WAAYjS,EAAK6Q,KAAKoB,YA8BvB,OA5BIjS,EAAK6Q,KAAK,mBAAqB7Q,EAAK6Q,KAAK,kBAAkB,OAC9D3L,EAAIgB,YAAclG,EAAK6Q,KAAK,kBAAkB,OA2BvC3L,MAAKgN,SAzB6BlS,EAAK4Q,MAAMzN,IAAIgP,IACxD,IAAIC,KAEJ,MAAMC,EAAsBF,EAAM,gBAClC,GAAIE,EAAU,CACb,MAAMC,EAAsBD,EAAS,eACjCC,IACHF,EAAWE,EAAQnP,IAAIiO,GAAQA,EAAK,OAGtC,OACC3O,GAAI,GACJ6G,UAAWL,EAAQxG,GACnBhB,OAAQ3I,EAAAoW,cAAcC,MACtBlH,KAAM5G,EAAAxE,aAAa4L,QACnBgB,OAAQ0I,EAAK1I,OACbsI,KAAMI,EAAKJ,KACXQ,KAAMJ,EAAKI,KACXhJ,QAAS4I,EAAK5I,QACdiJ,WAAiBL,EAAKK,WACtBlQ,KAAM6P,EAAK7P,KAAO6P,EAAK7P,KAAKmQ,UAAY,EACxCtN,MAAOgN,EAAKhN,MACZiN,SAAUA,+FCtJRM,UAAiBlB,MAGtBxV,YAAY4F,EAAiB+Q,GAG5BC,MAAMhR,GAGN3F,KAAK1C,KAAO0C,KAAK4W,YAAYtZ,KAG7BiY,MAAMsB,kBAAkB7W,KAAMA,KAAK4W,aAKnC5W,KAAK0W,SAAWA,GAAY,KAI9B7Z,EAAAia,kBAAA,SAAkCC,GACjC,OAAO,IAAIN,EAASM,GAAO,4BAA6B,MAGzDla,EAAAma,cAAA,SAA8BD,GAC7B,OAAO,IAAIN,EAASM,GAAO,iBAAkB,MAG9Cla,EAAAoa,YAAA,SAA4BF,GAC3B,OAAO,IAAIN,EAASM,GAAO,eAAgB,MAG5Cla,EAAAqa,aAAA,SAA6BH,GAC5B,OAAO,IAAIN,EAASM,GAAO,kBAAmB,qBC1C/Cja,EAAAD,QAAAkC,QAAA,8KCEA,MAAAwD,EAAAtD,EAAAtC,EAAA,IAEAE,EAAAgT,mBAEQ9P,UAAUgQ,GAChBA,EAAIvK,OAAO,KAAK8K,SAGVvQ,YAAYgQ,EAAuBhM,GACzCgM,EAAIvK,OAAO,KAAK8K,KAAKvM,GAGfhE,aAAagQ,EAAuBhN,GAC1C,MAAMgU,GAAsB,iBAARhU,EAAmBA,EAAOA,EAAI4C,SAAW,mBAAoBnF,WAC3E6C,EAAgC,iBAAjBN,EAAI2T,SAAwB3T,EAAI2T,SAAW,IAChE3G,EAAIvK,OAAOnC,GAAQ,KAAKiN,MAAM5K,MAAOqR,IAG/BhX,cAAcgQ,EAAuBhM,GACvCA,EAAK8M,KACR9M,EAAK8M,KAAKA,KAAKd,GACLhM,EAAK+M,QACff,EAAIQ,IAAI,eAAgBxM,EAAK+M,OAAOpF,aACpCqE,EAAIQ,IAAI,iBAAkBxM,EAAK+M,OAAOA,OAAOtH,OAAOhJ,YAEpDuP,EAAIvK,OAAO,KAAKwK,KAAKjM,EAAK+M,OAAOA,SACvB/M,EAAKgB,MACfgL,EAAIgB,SAAShN,EAAKgB,KAAKT,SAAUP,EAAKgB,KAAKzH,MAAQiF,EAAArD,QAAK6J,SAAShF,EAAKgB,KAAKT,4FC7B9E,MAAAc,EAAAzI,EAAA,GACAwI,EAAAxI,EAAA,GAEaE,EAAAsa,sBAAwB,MAAO,MAAO,OAAQ,MAAO,OAErDta,EAAAua,sBAAwB,MAAO,OAAQ,MAAO,MAAO,MAAO,QAAS,OAElFva,EAAAwa,YAAA,SAA4B/S,GAC3B,MAAM2G,EAAS9F,EAAAd,WAAWC,GAC1B,OAAIzH,EAAAsa,qBAAqBvE,QAAQ3H,IAAW,EACpC7F,EAAAhD,QAAQkV,MACLza,EAAAua,qBAAqBxE,QAAQ3H,IAAW,EAC3C7F,EAAAhD,QAAQmV,OACJ,OAAO3E,QAAQ3H,IAAW,EAC9B7F,EAAAhD,QAAQoV,KACJ,OAAO5E,QAAQ3H,IAAW,EAC9B7F,EAAAhD,QAAQqV,OAETrS,EAAAhD,QAAQsV,sBClBhB5a,EAAAD,QAAAkC,QAAA,0KCEA,MAAAqG,EAAAzI,EAAA,GACA4F,EAAAtD,EAAAtC,EAAA,IAGM4C,EAFNN,EAAAtC,EAAA,IAEYuC,QAAO,UAwCnB,SAASyY,EAAana,GACrB,OAAOC,OAAOma,KAAKpa,GAAG0J,IAAI5I,KACjBuZ,MAAOra,EAAEc,GAAMwZ,IAAKxZ,KAC1ByZ,KAAK,CAACC,EAAGC,IACJD,EAAEH,MAAQI,EAAEJ,OAIrB,SAASK,EAAuBhG,EAA+BiG,GAC9D,GAAoB,IAAhBjG,EAAK1I,OACR,OAED,GAAoB,IAAhB0I,EAAK1I,OACR,OAAO0I,EAAK,GAAG4F,IAGhB,MAAMM,GADNlG,EAAOA,EAAK6F,KAAK,CAACC,EAAGC,IAAMD,EAAEH,MAAQI,EAAEJ,QAClBQ,OAAQ7a,GACrBA,EAAEqa,MAAQ,GAElB,OAAIO,EAAQ5O,OAAS,QAAezC,IAAVoR,EAClBA,EAEJC,EAAQ5O,OAAS,EACb4O,EAAQ,GAAGN,IAEZ5F,EAAK,GAAG4F,IAGhB,SAASQ,EAAYC,GAEpB,MAAMC,GASL5W,UACA6W,cACA3W,SACA6H,SACAD,QACAgP,cACAC,cAEKC,KACN,IAAI3J,EAAa,EACjBsJ,EAAIM,MAAMC,QAAS/T,IAIlB,GAHIA,EAAKiH,OAAS5G,EAAAhD,QAAQmV,OACzBtI,IAEGlK,EAAKiG,OAASjG,EAAKiG,MAAM/B,IAAK,CACjC,MAAM8P,EAAWhU,EAAKiG,MAAM/B,IAgB5B,GAfI8P,EAASnX,SACZ4W,EAAM5W,OAAOmX,EAASnX,SAAW4W,EAAM5W,OAAOmX,EAASnX,SAAW,GAAK,GAEpEmX,EAASN,aACZD,EAAMC,WAAWM,EAASN,aAAeD,EAAMC,WAAWM,EAASN,aAAe,GAAK,GAEpFM,EAASjX,QACZ0W,EAAM1W,MAAMiX,EAASjX,QAAU0W,EAAM1W,MAAMiX,EAASjX,QAAU,GAAK,GAEhEiX,EAASpP,QACZ6O,EAAM7O,MAAMoP,EAASpP,QAAU6O,EAAM7O,MAAMoP,EAASpP,QAAU,GAAK,GAEhEoP,EAASrP,OACZ8O,EAAM9O,KAAKqP,EAASrP,OAAS8O,EAAM9O,KAAKqP,EAASrP,OAAS,GAAK,GAE5DqP,EAASL,WAAY,CACxB,MAAM5Z,EAAIia,EAASL,WAAWjF,MAAM,KAAK,GACzC+E,EAAME,WAAW5Z,IAAM0Z,EAAME,WAAW5Z,IAAM,GAAK,EAEpD,GAAIia,EAASJ,UAAW,CACvB,MAAM7Z,EAAIia,EAASJ,UAAUlF,MAAM,KAAK,GACxC+E,EAAMG,UAAU7Z,IAAM0Z,EAAMG,UAAU7Z,IAAM,GAAK,QAExCiG,EAAKiH,OAAS5G,EAAAhD,QAAQkV,OAChCsB,EAAO/F,KAAK9N,EAAKzH,QAGnBib,EAAIS,YAAYF,QAASG,IACxB,GAAIA,EAAItU,QAAUsU,EAAIhQ,IAAK,CAC1B,MAAMiQ,EAASD,EAAIhQ,IAgBnB,GAfIiQ,EAAOtX,SACV4W,EAAM5W,OAAOsX,EAAOtX,SAAW4W,EAAM5W,OAAOsX,EAAOtX,SAAW,GAAK,GAEhEsX,EAAOT,aACVD,EAAMC,WAAWS,EAAOT,aAAeD,EAAMC,WAAWS,EAAOT,aAAe,GAAK,GAEhFS,EAAOpX,QACV0W,EAAM1W,MAAMoX,EAAOpX,QAAU0W,EAAM1W,MAAMoX,EAAOpX,QAAU,GAAK,GAE5DoX,EAAOvP,QACV6O,EAAM7O,MAAMuP,EAAOvP,QAAU6O,EAAM7O,MAAMuP,EAAOvP,QAAU,GAAK,GAE5DuP,EAAOxP,OACV8O,EAAM9O,KAAKwP,EAAOxP,OAAS8O,EAAM9O,KAAKwP,EAAOxP,OAAS,GAAK,GAExDwP,EAAOR,WAAY,CACtB,MAAM5Z,EAAIoa,EAAOR,WAAWjF,MAAM,KAAK,GACvC+E,EAAME,WAAW5Z,IAAM0Z,EAAME,WAAW5Z,IAAM,GAAK,EAEpD,GAAIoa,EAAOP,UAAW,CACrB,MAAM7Z,EAAIoa,EAAOP,UAAUlF,MAAM,KAAK,GACtC+E,EAAMG,UAAU7Z,IAAM0Z,EAAMG,UAAU7Z,IAAM,GAAK,MAIpD,MAAMqa,EAAUxB,EAAaa,EAAM5W,QAC7BwX,EAAczB,EAAaa,EAAMC,YACjCY,EAAS1B,EAAaa,EAAM1W,OAC5BwX,EAAS3B,EAAaa,EAAM7O,OAC5B4P,EA1HP,SAAyB/b,GACxB,OAAOC,OAAOma,KAAKpa,GAAG0J,IAAI5I,KACjBuZ,MAAOra,EAAEc,GAAMwZ,IAAKrR,SAASnI,EAAK,OACxCyZ,KAAK,CAACC,EAAGC,IACJD,EAAEH,MAAQI,EAAEJ,OAsHN2B,CAAgBhB,EAAM9O,MAC9B+P,EAAc9B,EAAaa,EAAME,YACjCgB,EAAa/B,EAAaa,EAAMG,WAChC7W,EAAQoW,EAA4BmB,EAAQ9W,EAAArD,QAAK6J,SAASwP,EAAIjb,OAC9DsE,EAASsW,EAA4BiB,EAAStc,EAAA8c,gBAC9ClB,EAAaP,EAA4BkB,GACzCzP,EAAQuO,EAA4BoB,GACpCX,EAAYT,EAA4BwB,GACxChB,EAAaR,EAA4BuB,GACzC/P,EAAOwO,EAA4BqB,GACnCK,EAAgBhY,IAAW/E,EAAA8c,eAC3BE,EAAeR,EAAO7P,OAAS,EACrC,IAAIe,EAiBJ,OAfIqO,EAAOpP,OAAS,IACG,IAAlBoP,EAAOpP,OACVe,EAAQhI,EAAArD,QAAK6J,SAAS6P,EAAO,KAE7BA,EAAOE,QAASgB,IACf,MAAMC,EAAMxX,EAAArD,QAAK6J,SAAS+Q,EAAKvX,EAAArD,QAAKqF,QAAQuV,IAAMrV,eAC7C,SAAU,QAAS,SAASmO,QAAQmH,IAAQ,IAChDxP,EAAQhI,EAAArD,QAAK6J,SAAS+Q,WAGV/S,IAAVwD,IACHA,EAAQhI,EAAArD,QAAK6J,SAAS6P,EAAO,QAK/B3J,aACA2J,SACArO,QACAqP,gBACAC,eACA/X,QACAF,SACA6W,aACA9O,QACAgP,YACAD,aACAhP,QAgEF,SAASsQ,EAAgBzB,GACxBhZ,EAAI0a,MAAM,yBAA0B1B,EAAIjb,MACxC,MAAM4c,EAAW5B,EAAYC,GACvB4B,EA/DP,SAA4B7c,GAC3B,MAAM4N,GAA6ChC,MAAO3G,EAAArD,QAAK6J,SAASzL,GAAMyW,QAExEF,EAAQ3I,EAAOhC,MAAMuK,MAAM,KAC3B3U,EAAI+U,EAAM,GAAGhP,QAAQ,YAAa,IACxC,GAAiB,IAAb/F,EAAE0K,OAAc,CACnB,MAAM4Q,EAAI3T,SAAS3H,EAAG,IACjBuM,MAAM+O,KACVlP,EAAOxB,KAAO0Q,EACdvG,EAAMwG,QACW,MAAbxG,EAAM,IACTA,EAAMwG,QAEPnP,EAAOhC,MAAQ2K,EAAMvT,KAAK,MAG5B,OAAO4K,EA+CWoP,CAAmB/B,EAAIjb,MAgBzC,OAdC2Q,OAAQsK,EAAIM,MAAMR,OAAOkC,GAAKA,EAAEvO,OAAS5G,EAAAhD,QAAQmV,OAAO/N,OACxDlK,MAAOiZ,EAAIjZ,MACX0M,KAAM5G,EAAAzE,WAAWgB,QACjBG,MAAOoY,EAASpY,MAChB0Y,UAAWN,EAASN,cAAgBxU,EAAAjD,UAAUsY,IAAMrV,EAAAjD,UAAUL,MAC9DF,OAAQsY,EAAStY,OACjB6W,WAAYyB,EAASzB,WACrBvP,MAAOiR,EAAUjR,MACjBqB,MAAO2P,EAAS3P,MAChBZ,MAAOuQ,EAASvQ,MAChBgP,UAAWuB,EAASvB,UACpBD,WAAYwB,EAASxB,WACrBhP,UAA0B3C,IAAnBoT,EAAUzQ,KAAsByQ,EAAUzQ,KAAOwQ,EAASxQ,MAKnE,SAASgR,EAAYnC,GACpBA,EAAIS,YAAYF,QAAQ4B,GACpBnC,EAAI5T,SACP4T,EAAItP,IAAM+Q,EAAgBzB,IAlE5B,SAA4BA,GAC3B,IAAKA,EAAItP,IACR,OAED,MAAMiR,EAAW5B,EAAYC,GACvBjb,EAAOiF,EAAArD,QAAK6J,SAASwP,EAAIjb,MAAMmH,cACrC,IAAIyG,EAAqB9F,EAAAzE,WAAWgB,QAClB,IAAd4W,EAAIjZ,MACP4L,EAAS9F,EAAAzE,WAAWkB,YACVvE,EAAK4W,MAAM,wBAA0B5W,EAAK4W,MAAM,qBAC1DhJ,EAAS9F,EAAAzE,WAAWqB,OACVkY,EAASjL,WAAa,EAG/B/D,EADgB,IADAqN,EAAIS,YAAYX,OAAOhb,KAAOA,EAAE4L,KAAO5L,EAAE4L,IAAI+C,OAAS5G,EAAAzE,WAAWqB,QAAQwH,OAEhFpE,EAAAzE,WAAWmB,MAEXsD,EAAAzE,WAAWoB,WAGjBmY,EAASN,cACZ1O,EAAS9F,EAAAzE,WAAWoB,YAEpBmJ,EAAS9F,EAAAzE,WAAWiB,OACpB2W,EAAIS,YAAYF,QAAQzb,IACnBA,EAAE4L,KAAO5L,EAAE4L,IAAI+C,OAAS5G,EAAAzE,WAAWiB,SACtCvE,EAAE4L,IAAI+C,KAAO5G,EAAAzE,WAAWoB,eAKxBmJ,IAAW9F,EAAAzE,WAAWoB,YACfwW,EAAIS,YAAY2B,KAAKtd,KACpBA,EAAE4L,KAAO5L,EAAE4L,IAAI+C,OAAS5G,EAAAzE,WAAWiB,UAG7CsJ,EAAS9F,EAAAzE,WAAWkB,aAGtB0W,EAAItP,IAAI+C,KAAOd,EA8Bf0P,CAAmBrC,GA5RP1b,EAAA8c,eAAiB,oBACjB9c,EAAAge,eAAiB,mBACjBhe,EAAAie,cAAgB,kBA6R7Bje,EAAAke,cAAA,SAA8BxC,GAC7BmC,EAAYnC,kcCvSb,MAAApT,EAAAxI,EAAA,GACA4F,EAAAtD,EAAAtC,EAAA,IACAqe,EAAA/b,EAAAtC,EAAA,IAGAyI,EAAAzI,EAAA,GACAse,EAAAte,EAAA,IAIM4C,EAAMyb,EAAA9b,QAAO,YAEnB,SAASgc,EAAShJ,EAA4BiJ,GAE7C,IAAK,IAAIpe,EAAI,EAAGA,EAAImV,EAAK1I,OAAQzM,IAChC,GAAuC,IAAnCoe,EAASvI,QAAQV,EAAKnV,GAAGiM,MAC5B,OAAOkJ,EAAKnV,GAGd,OANe,KAqDhB,SAAsBqe,EAASC,EAAczC,EAAgB0C,2CAC5D,GAA4B,IAAxBA,EAAa9R,OAChB,OAEDjK,EAAI0a,MAAM,gBACV,MAAM1Q,EAAW+R,EAAapU,IAAI8D,GAASA,EAAMxE,IAC3C6S,QAAegC,EAAMvZ,MAAMyZ,QAAQhS,aACzC8P,EAAOP,QAAQhX,IACd,IAAI2H,EAAW,EACf3H,EAAMyH,SAAWzH,EAAMyH,SAAS8O,OAAO7R,IACtC,MAAMwE,EAAQsQ,EAAaX,KAAK1c,GAAKA,EAAEuI,KAAOA,GAC9C,OAAIwE,IACHvB,GAAauB,EAAMI,MAAM3B,UAAY,GAC9B,KAIT3H,EAAM2H,UAAYA,IAEnB,MAAM+R,EAAenC,EAAOhB,OAAOvW,GAAmC,IAA1BA,EAAMyH,SAASC,QAActC,IAAIpF,GAASA,EAAM0E,IACtFiV,EAAepC,EAAOhB,OAAOvW,GAAmC,IAA1BA,EAAMyH,SAASC,QACvDgS,EAAahS,OAAS,UACnB6R,EAAMvZ,MAAM4Z,OAAOF,SACnBH,EAAMnT,MAAMyT,eAAeC,QAASJ,EAAcxP,KAAM5G,EAAAxE,aAAakB,SAExE2Z,EAAajS,OAAS,UACnB6R,EAAMvZ,MAAM+Z,YAAYJ,IAE/B,MAAMtC,QAAgBkC,EAAMzZ,OAAO2Z,QAAQhS,aAC3C4P,EAAQL,QAAQlX,IACfA,EAAO2H,SAAW3H,EAAO2H,SAAS8O,OAAO7R,GAAM+C,EAASqJ,QAAQpM,GAAM,GACtE5E,EAAOkI,SAAWlI,EAAOkI,SAASuO,OAAO7R,GAAMgV,EAAa5I,QAAQpM,GAAM,KAE3E,MAAMsV,EAAgB3C,EAAQd,OAAOzW,GAAqC,IAA3BA,EAAO2H,SAASC,QAActC,IAAItF,GAAUA,EAAO4E,IAC5FuV,EAAgB5C,EAAQd,OAAOzW,GAAqC,IAA3BA,EAAO2H,SAASC,QAC3DsS,EAActS,OAAS,UACpB6R,EAAMzZ,OAAO8Z,OAAOI,SACpBT,EAAMnT,MAAMyT,eAAeC,QAASE,EAAe9P,KAAM5G,EAAAxE,aAAagB,UAEzEma,EAAcvS,OAAS,UACpB6R,EAAMzZ,OAAOia,YAAYE,IAEhC,MAAMC,EAAMR,EAAanb,OAAOyb,SAC1BlD,EAAOqD,qBAAqBD,KAGnC,SAAsBE,EAAWb,EAAczC,EAAgBuD,EAAsBb,EAAqCc,2CACzH,IAAIJ,KACJ,GAAII,EAAc5S,OAAS,EAAG,CAC7BjK,EAAI0a,MAAM,mBAAoBmC,EAAc5S,QAC5C,MAAM6S,EAAYD,EAAclV,IAAIvC,GAAUA,EAAO6B,UAC/C6U,EAAM1W,OAAO+W,OAAOW,SACpBhB,EAAMnT,MAAMyT,eAAeC,QAASS,EAAWrQ,KAAM5G,EAAAxE,aAAa+D,SACxEqX,EAAMK,EAEP,GAAIf,EAAa9R,OAAS,EAAG,CAC5BjK,EAAI0a,MAAM,kBAAmBqB,EAAa9R,QAC1C,MAAMD,EAAW+R,EAAapU,IAAI8D,GAASA,EAAMxE,UAC3C6U,EAAMrQ,MAAM0Q,OAAOnS,SACnB8R,EAAMnT,MAAMyT,eAAeC,QAASrS,EAAUyC,KAAM5G,EAAAxE,aAAaoK,cACjEqQ,EAAMlN,SAASwN,eAAeC,QAASrS,IAC7C,MAAM+S,QAAkBjB,EAAM5N,SAAS8N,QAAQhS,SAAUA,IAEzD,GADAyS,EAAMA,EAAI3b,OAAOkJ,GACb+S,EAAU9S,OAAS,EACtB,IAAK,MAAMiE,KAAY6O,EACtB7O,EAASlE,SAAWkE,EAASlE,SAAS8O,OAAO7R,GAAM+C,EAASqJ,QAAQpM,GAAM,GACzC,IAA7BiH,EAASlE,SAASC,aACf6R,EAAM5N,SAASiO,OAAOjO,EAASjH,WAE/ByU,EAAAsB,qBAAqBlB,EAAO5N,SAC5B4N,EAAM5N,SAAS5I,QAAQ4I,UAM3BmL,EAAOqD,qBAAqBD,SAC5BG,EAAUK,wBAAwBR,SAClCZ,EAASC,EAAOzC,EAAQ0C,KA1H/Bze,EAAA4f,eAAA,SAAqCpB,EAAczC,EAAgBuD,EAAsBO,2CAExF,MAAMpB,EAAsCoB,EAAQC,cAC9CP,EAAwCM,EAAQE,eAChDC,EAA6BH,EAAQI,UAAU5V,IAAIjJ,GAAKA,EAAE+M,MAAMxE,IACpEnG,OAAOqc,EAAQK,aAAa7V,IAAIjJ,GAAKA,EAAE+M,MAAMxE,KAC7CnG,OAAOqc,EAAQM,gBAAgB9V,IAAIjJ,GAAKA,EAAE+M,MAAMxE,KAChDnG,OAAOqc,EAAQC,cAAczV,IAAIjJ,GAAKA,EAAEuI,KACpCyW,EAA+BP,EAAQQ,WAAWhW,IAAIjJ,GAAKA,EAAEuI,IACjEnG,OAAOqc,EAAQS,cAAcjW,IAAIjJ,GAAKA,EAAEuI,KACxCnG,OAAOqc,EAAQU,iBAAiBlW,IAAIjJ,GAAKA,EAAEuI,KAC3CnG,OAAOqc,EAAQE,eAAe1V,IAAIjJ,GAAKA,EAAEuI,KAGrC6W,QAAchC,EAAM9U,KAAK+W,MAC/B/d,EAAI0a,MAAM,oCACJoB,EAAM1W,OAAO4Y,QAAeC,GAAWC,EAAAzd,UAAA,qBAC5C,IAAK,MAAM2E,KAAU6Y,EACftC,EAASmC,EAAO1Y,EAAOqE,MAEjBiU,EAAcrK,QAAQjO,EAAO6B,IAAM,WACxBrB,EAAA7B,SAASqB,EAAOqE,QAEpCoT,EAAcvJ,KAAKlO,IAJpByX,EAAcvJ,KAAKlO,MAStBpF,EAAI0a,MAAM,mCACJoB,EAAMrQ,MAAMuS,QAAetP,GAAUwP,EAAAzd,UAAA,qBAC1C,IAAK,MAAMgL,KAASiD,EACdiN,EAASmC,EAAOrS,EAAMhC,MAEhB6T,EAAYjK,QAAQ5H,EAAMxE,IAAM,WACrBrB,EAAAjC,WAAWX,EAAArD,QAAKoB,KAAK0K,EAAMhC,KAAMgC,EAAM1N,SAE3Dge,EAAazI,KAAK7H,IAJnBsQ,EAAazI,KAAK7H,YASfkR,EAAWb,EAAOzC,EAAQuD,EAAWb,EAAcc,MAG1Dvf,EAAAue,WA8CAve,EAAAqf,2XC/GA,MAAA9W,EAAAzI,EAAA,GAEA,SAAsB4f,EAAqBlB,EAAc5N,2CACxD,MACMiQ,YADerC,EAAMrQ,MAAM2S,MAAMlQ,EAASlE,WAEzCuP,QAAQ9N,IACd0S,EAAU1S,EAAMxE,IAAMwE,IAEvByC,EAASlE,SAAWkE,EAASlE,SAAS8O,OAAO7R,KAAQkX,EAAUlX,IAC/DiH,EAAShE,SAAW,EACpBgE,EAASlE,SAASuP,QAAQtS,IACzB,MAAMwE,EAAQ0S,EAAUlX,GACxBiH,EAAShE,UAAauB,EAAMI,MAAM3B,UAAY,MAVhD5M,EAAA0f,uBAcA1f,EAAA+gB,gBAGC7d,YAAYsb,GACXrb,KAAKqb,MAAQA,EAGRtb,eAAezC,EAAcoQ,EAA6BE,EAAmBI,EAAgBzE,2CAClG,MAAMsU,EAAM1d,KAAK0d,MACXpQ,GACLjH,GAAI,GACJwF,KAAM5G,EAAAxE,aAAa6M,SACnBnQ,KAAMA,EACNoQ,QAASA,EACTE,SAAUA,EACVI,OAAQA,EACRpE,QAASiU,EACThQ,QAASgQ,EACTtU,SAAUA,EACVE,SAAU,GAIX,aAFM8S,EAAqBvc,KAAKqb,MAAO5N,GACvCA,EAASjH,SAAWxG,KAAKqb,MAAM5N,SAASqQ,IAAIrQ,GACrCA,IAGF1N,eAAe0N,iDACd8O,EAAqBvc,KAAKqb,MAAO5N,SACjCzN,KAAKqb,MAAM5N,SAAS5I,QAAQ4I,KAG7B1N,eAAe0N,2CACpB,OAAOzN,KAAKqb,MAAM5N,SAASiO,OAAOjO,EAASjH,sXCjD7C,MAAApB,EAAAzI,EAAA,GACAohB,EAAAphB,EAAA,IACAqhB,EAAArhB,EAAA,IACAshB,EAAAthB,EAAA,IACAuhB,EAAAvhB,EAAA,UAIsBwhB,EAIrBpe,YAAsBiM,EAAgCoS,GACrDpe,KAAKqe,MAAQD,EAAGE,WAActS,GAC9BhM,KAAKgM,KAAOA,EAKPjM,IAAIoV,2CACT,aAAanV,KAAKqe,MAAMP,IAAI3I,KAGvBpV,QAAQoV,2CACb,aAAanV,KAAKqe,MAAMxZ,QAAQsQ,EAAK3O,GAAI2O,KAGpCpV,OAAOwe,2CACZ,aAAave,KAAKqe,MAAM3C,OAAO6C,KAG1Bxe,YAAYye,2CACjB,IAAK,MAAMrJ,KAAQqJ,QACZxe,KAAKqe,MAAMxZ,QAAQsQ,EAAK3O,GAAI2O,KAI9BpV,KAAKyG,2CACV,aAAaxG,KAAKqe,MAAMI,KAAKjY,KAGxBzG,MAAMic,2CACX,aAAahc,KAAKqe,MAAMV,MAAM3B,KAGzBjc,8CACL,aAAaC,KAAKqe,MAAMK,OAAOpB,KAAK,MAG/Bvd,gDACL,aAAaC,KAAKqe,MAAMM,UAAUrB,KAAK,MAGlCvd,gDACL,aAAaC,KAAKqe,MAAMxG,OAAOyF,KAAK,MAG/Bvd,QAAQ6e,iDACP5e,KAAKqe,MAAMd,SAASD,KAAK,GAAOsB,KAGjC7e,OAAOye,2CACZ,IAAK,MAAMrJ,KAAQqJ,QACZxe,KAAKqe,MAAMQ,OAAO1J,EAAK3O,GAAI2O,KAI7BpV,cAAc2e,2CACnB,aAAa1e,KAAKqe,MAAM1C,cAAc3b,KAAK8e,eAAeJ,MAGrD3e,UAAU2e,2CACf,aAAa1e,KAAKqe,MAAMM,SAAS3e,KAAK8e,eAAeJ,MAGhD3e,OAAO2e,2CACZ,aAAa1e,KAAKqe,MAAMK,MAAM1e,KAAK8e,eAAeJ,MAG7C3e,UAAU2e,2CACf,aAAa1e,KAAKqe,MAAMU,SAAS/e,KAAK8e,eAAeJ,MAGhD3e,YAAY2e,2CACjB,aAAa1e,KAAKqe,MAAMxG,MAAM7X,KAAK8e,eAAeJ,OA5EpD7hB,EAAAshB,kBAiFMa,EAANjf,cACSC,KAAAif,KAERlf,KAAKmf,EAAelhB,QACL+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAEE,KAAOnf,KAAKif,EAAEE,SACrBnf,KAAKif,EAAEE,KAAKD,GAASlhB,GAIvB+B,MAAMmf,EAAelhB,QACN+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAE/K,MAAQlU,KAAKif,EAAE/K,UACtBlU,KAAKif,EAAE/K,MAAMgL,GAASlhB,GAIxB+B,WAAWmf,EAAelhB,QACX+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAEG,WAAapf,KAAKif,EAAEG,eAC3Bpf,KAAKif,EAAEG,WAAWF,GAASlhB,GAI7B+B,YAAYmf,EAAelhB,QACZ+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAEI,YAAcrf,KAAKif,EAAEI,gBAC5Brf,KAAKif,EAAEI,YAAYH,GAASlhB,GAI9B+B,MAAMmf,EAAelhB,QACN+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAEK,MAAQtf,KAAKif,EAAEK,UACtBtf,KAAKif,EAAEK,MAAMJ,GAASlhB,GAIxB+B,KAAKmf,EAAelhB,QACL+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAEE,KAAOnf,KAAKif,EAAEE,SACrBnf,KAAKif,EAAEE,KAAKD,IAAS,GAIvBnf,QAAQmf,EAAelhB,QACR+I,IAAV/I,GAAiC,OAAVA,IAC1BgC,KAAKif,EAAEM,QAAUvf,KAAKif,EAAEM,YACxBvf,KAAKif,EAAEM,QAAQ1M,KAAKqM,IAItBnf,MAAMmf,EAAeM,EAAyBC,QACjC1Y,IAARyY,QAA6BzY,IAAR0Y,IACxBzf,KAAKif,EAAES,MAAQ1f,KAAKif,EAAES,UACtB1f,KAAKif,EAAES,MAAMR,IAAUO,MAAKD,QAI9Bzf,IAAI2e,EAA6BiB,GAIhC,GAHmC,IAA/BliB,OAAOma,KAAK5X,KAAKif,GAAGzV,SACvBxJ,KAAKif,EAAE3B,KAAM,GAEVoB,EAAMkB,MAAO,CAChB,MAAMA,KACNlB,EAAMkB,MAAM9G,QAAQf,IACnB,MAAMmH,EAAQS,EAAWA,EAAS5H,EAAKmH,OAASnH,EAAKmH,MACjDA,IACHU,EAAMV,GAASnH,EAAK8H,WAAaza,EAAAlD,sBAAsB2d,WAAaza,EAAAlD,sBAAsB4d,aAG5F9f,KAAKif,EAAElH,KAAO6H,EAQf,YANqB7Y,IAAjB2X,EAAMhM,QAAwBgM,EAAMhM,OAAS,IAChD1S,KAAKif,EAAEvM,OAASgM,EAAMhM,aAEF3L,IAAjB2X,EAAMqB,QAAwBrB,EAAMqB,OAAS,IAChD/f,KAAKif,EAAEc,OAASrB,EAAMqB,QAEhB/f,KAAKif,SAIRe,UAAkB7B,EAEvBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAa8F,KAAM0X,GAGhBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAKd,OAJAC,EAAEK,MAAM,KAAMZ,EAAM1C,KACpBiD,EAAEE,KAAK,OAAQT,EAAMphB,MACrB2hB,EAAEgB,KAAK,kBAAmBvB,EAAMwB,SAChCjB,EAAE/K,MAAM,OAAQwK,EAAMA,OACfO,EAAErhB,IAAI8gB,GAGR3e,IAAI2G,2CAIT,OAHkC,IAA9BA,EAAKyZ,KAAKvN,QAAQ,UACrBlM,EAAKyZ,KAAOjC,EAAAkC,UAAU1Z,EAAKyZ,aAEfngB,KAAKqe,MAAMP,IAAIpX,KAGvB3G,QAAQ2G,2CAIb,OAHkC,IAA9BA,EAAKyZ,KAAKvN,QAAQ,UACrBlM,EAAKyZ,KAAOjC,EAAAkC,UAAU1Z,EAAKyZ,aAEfngB,KAAKqe,MAAMxZ,QAAQ6B,EAAKF,GAAIE,KAGpC3G,UAAUzC,EAAc+iB,EAAeC,2CAC5C,IAAMhjB,IAAWA,EAAKkM,OACrB,OAAO7G,QAAQE,OAAO0S,MAAM,qBAE7B,IAAM8K,IAAYA,EAAM7W,OACvB,OAAO7G,QAAQE,OAAO0S,MAAM,kBAE7B,MAAM7O,QAAa1G,KAAKqe,MAAMU,UAAUI,MAAO7hB,KAAQA,KACvD,IAAKoJ,EACJ,OAAO/D,QAAQE,OAAO0S,MAAM,qBAE7B,MAAMtX,EAAIggB,EAAAsC,IAAIC,KAAK9Z,EAAKyZ,KAAOG,GAC/B,OAAID,IAAUpiB,EACN0E,QAAQE,OAAO0S,MAAM,kBAEtB7O,IAGF3G,KAAKzC,EAAc6iB,2CACxB,IAAM7iB,IAAWA,EAAKkM,OACrB,OAAO7G,QAAQE,OAAO0S,MAAM,qBAE7B,IAAM4K,IAAWA,EAAK3W,OACrB,OAAO7G,QAAQE,OAAO0S,MAAM,qBAE7B,MAAM7O,QAAa1G,KAAKqe,MAAMU,UAAUI,MAAO7hB,KAAQA,KACvD,OAAKoJ,GAGwB,IAAzByZ,EAAKvN,QAAQ,UAChBuN,EAAOjC,EAAAkC,UAAUD,EAAK3b,MAAM,IAAIuP,QAE7BoM,IAASzZ,EAAKyZ,KACVxd,QAAQE,OAAO0S,MAAM,qBAEtB7O,GARC/D,QAAQE,OAAO0S,MAAM,uBAWxBxV,IAAIzC,2CACT,aAAa0C,KAAKqe,MAAMU,UAAUI,MAAO7hB,KAAQA,GAAQ,eAKrDmjB,UAAmBtC,EAExBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAasH,MAAOkW,GAGjBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAQd,OAPAC,EAAEE,KAAK,SAAUT,EAAM1Q,QACvBiR,EAAEE,KAAK,SAAUT,EAAMgC,QACvBzB,EAAEK,MAAM,SAAUZ,EAAM9C,SACxBqD,EAAEE,KAAK,WAAYT,EAAM1S,MACzBiT,EAAEM,QAAQ,QAASb,EAAMiC,SACzB1B,EAAES,MAAM,SAAUhB,EAAMkC,UAAWlC,EAAMmC,WACzC5B,EAAES,MAAM,cAAU3Y,EAAW2X,EAAMoC,SAAW,OAAI/Z,GAC3CkY,EAAErhB,IAAI8gB,GAGN3e,WAAW2gB,EAAgBK,EAAwB/S,GAC1D,OACCxH,GAAI,GACJwF,KAAM5G,EAAAxE,aAAasH,MACnBwY,SACAK,WACA7U,OAAQ,EACR8U,WAAY,EACZ5Y,WAAOrB,EACPuB,MAAO,EACP0F,UAIIjO,aAAa2gB,EAAgB1S,EAAgBhC,2CAElD,aADoBhM,KAAKihB,WAAWjT,SAAQ0S,SAAQ1U,WACpChM,KAAKkhB,WAAWR,EAAQ1U,EAAMgC,KAGzCjO,kBAAkB6b,EAAwB5N,EAAgBhC,2CAC/D,IAAK4P,GAA8B,IAAnBA,EAAQpS,OACvB,SAED,MACM0B,KASN,aAVmBlL,KAAKub,QAAQvN,SAAQhC,OAAM4P,aAEzC9C,QAAS5Q,IACbgD,EAAOhD,EAAMwY,QAAUxY,IAExB0T,EAAQ9C,QAAStS,IACX0E,EAAO1E,KACX0E,EAAO1E,GAAMxG,KAAKkhB,WAAW1a,EAAIwF,EAAMgC,MAGlC9C,WAKHiW,UAAsBhD,EAE3Bpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAa6M,SAAU2Q,GAGpBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAOd,OANAC,EAAEE,KAAK,WAAYT,EAAM0C,SACzBnC,EAAEK,MAAM,WAAYZ,EAAMnV,UAC1B0V,EAAEE,KAAK,SAAUT,EAAM1Q,QACvBiR,EAAEE,KAAK,OAAQT,EAAMphB,MACrB2hB,EAAEgB,KAAK,WAAYvB,EAAM9Q,UACzBqR,EAAE/K,MAAM,OAAQwK,EAAMA,OACfO,EAAErhB,IAAI8gB,UAKT2C,UAAsBlD,EAE3Bpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAaoM,QAASoR,GAGnBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAKd,OAJAC,EAAEE,KAAK,MAAOT,EAAMrU,KACpB4U,EAAEE,KAAK,QAAST,EAAMxV,OACtB+V,EAAEE,KAAK,SAAUT,EAAMlZ,QACvByZ,EAAE/K,MAAM,QAASwK,EAAMA,OAChBO,EAAErhB,IAAI8gB,UAKT4C,UAAsBnD,EAU3Bpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAa4L,QAAS4R,GAV7Bpe,KAAA2f,UACC4B,WAAc,YACdlU,UAAa,YACb7H,OAAU,SACVa,KAAQ,OACR6C,MAAS,YACTU,QAAW,gBAOF7J,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAMd,OALAC,EAAEK,MAAM,YAAaZ,EAAM6C,YAC3BtC,EAAEE,KAAK,YAAaT,EAAMrR,WAC1B4R,EAAEE,KAAK,SAAUT,EAAMlZ,QACvByZ,EAAEE,KAAK,YAAaT,EAAMxV,OAC1B+V,EAAE/K,MAAM,YAAawK,EAAMA,OACpBO,EAAErhB,IAAI8gB,EAAO1e,KAAK2f,iBAKrB6B,UAAuBrD,EAE5Bpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAauN,SAAUiQ,GAGpBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAId,OAHAC,EAAEE,KAAK,SAAUT,EAAM1Q,QACvBiR,EAAEE,KAAK,SAAUT,EAAMgC,QACvBzB,EAAEK,MAAM,SAAUZ,EAAM9C,SACjBqD,EAAErhB,IAAI8gB,UAKT+C,UAAkBtD,EAEvBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAa2F,KAAM6X,GAGhBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAId,OAHAC,EAAEE,KAAK,OAAQT,EAAMphB,MACrB2hB,EAAEE,KAAK,OAAQT,EAAM1V,MACrBiW,EAAE/K,MAAM,OAAQwK,EAAMA,OACfO,EAAErhB,IAAI8gB,UAKTgD,UAAuBvD,EAE5Bpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAa4N,UAAW4P,GAGrBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAEd,OADAC,EAAEE,KAAK,SAAUT,EAAM1Q,QAChBiR,EAAErhB,IAAI8gB,UAKTiD,UAAmBxD,EAExBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAagO,MAAOwP,GAGjBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAId,OAHAC,EAAEE,KAAK,MAAOT,EAAMrU,KACpB4U,EAAEE,KAAK,OAAQT,EAAMphB,MACrB2hB,EAAE/K,MAAM,OAAQwK,EAAMA,OACfO,EAAErhB,IAAI8gB,UAITkD,UAAmBzD,EAgBxBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAaoK,MAAOoT,GAhB3Bpe,KAAA2f,UACC3W,KAAQ,OACRF,SAAY,WACZ+Y,UAAa,WACbC,OAAU,SACV1Y,SAAY,WACZxH,OAAU,aACVmgB,UAAa,gBACb7Y,MAAS,YACTpH,MAAS,YACT4H,KAAQ,WACRC,MAAS,YACTC,QAAW,gBAOF7J,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAkBd,OAjBAC,EAAEK,MAAM,KAAMZ,EAAM1C,KACpBiD,EAAEK,MAAM,WAAYZ,EAAMmD,WAC1B5C,EAAEE,KAAK,OAAQT,EAAM1V,MACrBiW,EAAEI,YAAY,OAAQX,EAAMsD,SAC5B/C,EAAEG,WAAW,OAAQV,EAAMuD,QAC3BhD,EAAEE,KAAK,YAAaT,EAAM/U,OAC1BsV,EAAEE,KAAK,SAAUT,EAAMoD,QACvB7C,EAAEE,KAAK,WAAYT,EAAM5V,UACzBmW,EAAEE,KAAK,gBAAiBT,EAAMqD,WAC9B9C,EAAEK,MAAM,gBAAiBZ,EAAMwD,YAC/BjD,EAAEE,KAAK,aAAcT,EAAM9c,QAC3Bqd,EAAEE,KAAK,YAAaT,EAAMxV,OAC1B+V,EAAE/K,MAAM,YAAawK,EAAMA,OAC3BO,EAAEE,KAAK,YAAaT,EAAM5c,OAC1Bmd,EAAEE,KAAK,WAAYT,EAAMtV,UACzB6V,EAAES,MAAM,WAAYhB,EAAMyD,OAAQzD,EAAM0D,UACxCnD,EAAES,MAAM,oBAAgB3Y,EAAW2X,EAAM2D,WAClCpD,EAAErhB,IAAI8gB,EAAO1e,KAAK2f,UAGpB5f,iDACL,aAAaC,KAAKqe,MAAMiE,SAAS,sBAK7BC,UAAoBpE,EAezBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAa+D,OAAQyZ,GAf5Bpe,KAAA2f,UACC7W,SAAY,SACZgZ,OAAU,SACVlgB,OAAU,aACVsH,MAAS,YACT8C,KAAQ,WACRtC,KAAQ,WACRE,QAAW,eACX9H,MAAS,YACTkH,KAAQ,OACR1J,MAAS,YACTqK,MAAS,aAOA5J,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAkBd,OAjBAC,EAAEE,KAAK,OAAQT,EAAM1V,MACrBiW,EAAEK,MAAM,KAAMZ,EAAM1C,KACpBiD,EAAEG,WAAW,OAAQV,EAAMuD,QAC3BhD,EAAEE,KAAK,gBAAiBT,EAAM/F,WAC9BsG,EAAEE,KAAK,iBAAkBT,EAAMhG,YAC/BuG,EAAEE,KAAK,YAAaT,EAAM/U,OAC1BsV,EAAEE,KAAK,YAAaT,EAAMxV,OAC1B+V,EAAEE,KAAK,YAAaT,EAAM5c,OAC1Bmd,EAAEE,KAAK,SAAUT,EAAMoD,QACvB7C,EAAEE,KAAK,WAAYT,EAAM5V,UACzBmW,EAAEE,KAAK,YAAaT,EAAMpf,OAC1B2f,EAAEE,KAAK,aAAcT,EAAM9c,QAC3Bqd,EAAEK,MAAM,aAAcZ,EAAMvF,SAC5B8F,EAAEK,MAAM,WAAYZ,EAAM8D,OAC1BvD,EAAES,MAAM,WAAYhB,EAAMyD,OAAQzD,EAAM0D,UACxCnD,EAAES,MAAM,oBAAgB3Y,EAAW2X,EAAM2D,WACzCpD,EAAE/K,MAAM,YAAawK,EAAMA,OACpBO,EAAErhB,IAAI8gB,EAAO1e,KAAK2f,iBAKrB8C,UAAoBtE,EAEzBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAagB,OAAQwc,GAGlBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAad,OAZAC,EAAEK,MAAM,KAAMZ,EAAM1C,KACpBiD,EAAEK,MAAM,WAAYZ,EAAMnV,UAC1B0V,EAAEK,MAAM,OAAQZ,EAAMgE,OACtBzD,EAAEE,KAAK,UAAWT,EAAMoD,QACxB7C,EAAEE,KAAK,WAAYT,EAAM3S,SACzBkT,EAAEE,KAAK,WAAYT,EAAM0C,SACzBnC,EAAEE,KAAK,OAAQT,EAAMphB,MACrB2hB,EAAEE,KAAK,QAAST,EAAM/U,OACtBsV,EAAEE,KAAK,aAAcT,EAAMhG,YAC3BuG,EAAES,MAAM,OAAQhB,EAAMyD,OAAQzD,EAAM0D,UACpCnD,EAAES,MAAM,eAAW3Y,EAAW2X,EAAM2D,WACpCpD,EAAE/K,MAAM,OAAQwK,EAAMA,OACfO,EAAErhB,IAAI8gB,UAKTiE,UAAmBxE,EAExBpe,YAAYqe,GACXzH,MAAMvR,EAAAxE,aAAakB,MAAOsc,GAGjBre,eAAe2e,GACxB,MAAMO,EAAI,IAAID,EAcd,OAbAC,EAAEE,KAAK,UAAWT,EAAMoD,QACxB7C,EAAEE,KAAK,WAAYT,EAAMtV,UACzB6V,EAAEE,KAAK,QAAST,EAAM/U,OACtBsV,EAAEE,KAAK,YAAaT,EAAM/F,WAC1BsG,EAAEE,KAAK,aAAcT,EAAMhG,YAC3BuG,EAAEE,KAAK,WAAYT,EAAM0C,SACzBnC,EAAEK,MAAM,WAAYZ,EAAMnV,UAC1B0V,EAAEE,KAAK,SAAUT,EAAM9c,QACvBqd,EAAEE,KAAK,OAAQT,EAAMphB,MACrB2hB,EAAES,MAAM,OAAQhB,EAAMyD,OAAQzD,EAAM0D,UACpCnD,EAAES,MAAM,eAAW3Y,EAAW2X,EAAM2D,WACpCpD,EAAEK,MAAM,KAAMZ,EAAM1C,KACpBiD,EAAE/K,MAAM,OAAQwK,EAAMA,OACfO,EAAErhB,IAAI8gB,IAKf7hB,EAAA+lB,YAiBC7iB,YAAYX,GACXY,KAAKZ,OAASA,EACmB,kBAA7BY,KAAKZ,OAAOyjB,SAASC,IACxB9iB,KAAKoe,GAAK,IAAIL,EAAAgF,UAAU3jB,GAExBY,KAAKoe,GAAK,IAAIJ,EAAAgF,OAAO5jB,GAEtBY,KAAKgL,MAAQ,IAAI4W,EAAW5hB,KAAKoe,IACjCpe,KAAK2E,OAAS,IAAI4d,EAAYviB,KAAKoe,IACnCpe,KAAK0G,KAAO,IAAIsZ,EAAUhgB,KAAKoe,IAC/Bpe,KAAKkI,MAAQ,IAAIuY,EAAWzgB,KAAKoe,IACjCpe,KAAKyN,SAAW,IAAI0T,EAAcnhB,KAAKoe,IACvCpe,KAAKgN,QAAU,IAAIqU,EAAcrhB,KAAKoe,IACtCpe,KAAKwM,QAAU,IAAI8U,EAActhB,KAAKoe,IACtCpe,KAAKmO,SAAW,IAAIqT,EAAexhB,KAAKoe,IACxCpe,KAAK4B,OAAS,IAAI6gB,EAAYziB,KAAKoe,IACnCpe,KAAK8B,MAAQ,IAAI6gB,EAAW3iB,KAAKoe,IACjCpe,KAAKwO,UAAY,IAAIkT,EAAe1hB,KAAKoe,IACzCpe,KAAK4O,MAAQ,IAAI+S,EAAW3hB,KAAKoe,IACjCpe,KAAKuG,KAAO,IAAIkb,EAAUzhB,KAAKoe,IAG1Bre,sDACCC,KAAKoe,GAAG6E,UAGTljB,sDACCC,KAAKoe,GAAG8E,UAGTnjB,qDACCC,KAAKoe,GAAG+E,SAGTpjB,sDACCC,KAAKoe,GAAGgF,UAGTrjB,UAAUyG,2CACf,MAAM6c,GACJrjB,KAAK2E,OAAQ3E,KAAKgL,MAAOhL,KAAK8B,MAAO9B,KAAK4B,OAAQ5B,KAAKgN,QAAShN,KAAKwM,QAASxM,KAAKyN,SAAUzN,KAAK4B,OAAQ5B,KAAK8B,MAAO9B,KAAK4O,MAAO5O,KAAK0G,MACzI,IAAK,MAAM2U,KAASgI,EAAQ,CAC3B,MAAM/W,QAAY+O,EAAMoD,KAAKjY,GAC7B,GAAI8F,EACH,OAAOA,KAKJvM,eAAeic,2CACpB,IAAI9Q,KACJ,MAAMmY,GACJrjB,KAAK2E,OAAQ3E,KAAKgL,MAAOhL,KAAK8B,MAAO9B,KAAK4B,OAAQ5B,KAAKgN,QAAShN,KAAKwM,QAASxM,KAAKyN,SAAUzN,KAAK4B,OAAQ5B,KAAK8B,MAAO9B,KAAK4O,MAAO5O,KAAK0G,MACzI,IAAK,MAAM2U,KAASgI,EAAQ,CAC3B,MAAMC,QAAajI,EAAMsC,MAAM3B,GAC/B9Q,EAASA,EAAO7K,OAAOijB,GAExB,OAAOpY,qBCjoBTpO,EAAAD,QAAAkC,QAAA,yXCAA,MAAAwkB,EAAA5mB,EAAA,IACA6mB,EAAA7mB,EAAA,IAsBA,SAAsB8mB,EAAUC,EAAiBC,EAAiBC,2CACjE,MAAMC,QAAYN,EAAAO,WAAWJ,EAASC,GACtC,OAAKE,GAAsB,IAAfA,EAAIra,OAGT,IAAI7G,QAAgB,CAACC,EAASC,KACpC,MAAMuL,EAAQoV,EAAAO,MAAMF,EAAKD,GACzB,IAAI1Y,EAAS,GACTxF,EAAQ,GACZ0I,EAAM4V,OAAO5P,GAAG,OAASrQ,IACxBmH,GAAUnH,EAAKvD,aAEhB4N,EAAM6V,OAAO7P,GAAG,OAASrQ,IACxB2B,GAAS3B,EAAKvD,aAEf4N,EAAMgG,GAAG,QAAU/Q,IAClBT,EAAQsI,OAbFvI,QAAQE,OAAO,yBAA2B6gB,KAvBnD7mB,EAAAqnB,gBAAA,SAAsCR,EAAiBC,EAAiBC,EAAqBO,2CAC5F,MAAMN,QAAYN,EAAAO,WAAWJ,EAASC,GACtC,OAAKE,GAAsB,IAAfA,EAAIra,OAGT,IAAI7G,QAAgB,CAACC,EAASC,KACpC,MAAMuL,EAAQoV,EAAAO,MAAMF,EAAKD,GACzB,IAAIK,EAAS,GACb7V,EAAM4V,OAAO5P,GAAG,OAASrQ,IACxBogB,EAAOpgB,KAERqK,EAAM6V,OAAO7P,GAAG,OAASrQ,IACxBkgB,GAAUlgB,EAAKvD,aAEhB4N,EAAMgG,GAAG,QAAU/Q,IAClBT,EAAQqhB,OAZFthB,QAAQE,OAAOF,QAAQE,OAAO,yBAA2B6gB,OAiBlE7mB,EAAA4mB,YAqBA5mB,EAAAunB,cAAA,SAAuCV,EAAiBC,EAAiBC,2CACxE,MAAM7f,QAAa0f,EAAUC,EAASC,EAASC,GAE/C,OADkBxT,KAAK4B,MAAMjO,yKC9C9B,MAAAkN,EAAAhS,EAAAtC,EAAA,IACA0F,EAAApD,EAAAtC,EAAA,IAEAE,EAAAwnB,aAAA,SAA6Bha,EAAa/F,GACzC,OAAO,IAAI3B,QAAc,CAACC,EAASC,KAClCoO,EAAA/R,QAAQmL,GACNwG,KAAKxO,EAAAnD,QAAGolB,kBAAkBhgB,IAC1B8P,GAAG,QAAUrR,IACTA,EACHF,EAAOE,GAEPH,wFCXL/F,EAAA0nB,uBAAAxkB,cACSC,KAAAwkB,mBAERzkB,OAAOyG,GACN,OAAO,IAAI7D,QAAW,CAACC,EAASC,KAQ/B7C,KAAKwkB,gBAAgBhe,GAAIqM,KAPb,CAAC9P,EAAmBmI,KAC3BnI,EACHF,EAAOE,GAEPH,EAAQsI,OAOZnL,WAAWyG,GACVxG,KAAKwkB,gBAAgBhe,MAGtBzG,UAAUyG,GACT,QAASxG,KAAKwkB,gBAAgBhe,GAG/BzG,QAAQyG,EAAY0E,GACnB,IAAK,MAAMuZ,KAAMzkB,KAAKwkB,gBAAgBhe,GACrCie,EAAG,KAAMvZ,UAEHlL,KAAKwkB,gBAAgBhe,GAG7BzG,OAAOyG,EAAYd,GAClB,IAAK,MAAM+e,KAAMzkB,KAAKwkB,gBAAgBhe,GACrCie,EAAG/e,UAEG1F,KAAKwkB,gBAAgBhe,wKClC9B,MAAAjE,EAAAtD,EAAAtC,EAAA,IACAyI,EAAAzI,EAAA,GAGAuI,EAAAjG,EAAAtC,EAAA,IAEaE,EAAA6nB,WAAa,cAEbrf,EAEZtF,iBAAiBsH,GAChB,OAECsd,SAAQtd,EAAMQ,iBAAoBd,EAClC6d,SAAQvd,EAAMG,iBAAoBT,EAClC8d,QAAOxd,EAAMD,gBAAmBL,EAChCiG,UAAS3F,EAAMO,kBAAqBb,GAWtChH,gBAAgB2G,GACf,OACCF,GAAIE,EAAKF,GACToD,QAASlD,EAAKkD,QACdtM,KAAMoJ,EAAKpJ,KACXsJ,MAAOF,EAAKE,MACZS,MAAOhC,EAAOyf,UAAUpe,EAAKW,QAI/BtH,gBAAgBwG,EAAqBwe,GACpC,OACCve,GAAID,EAAKC,GACTlJ,KAAMiJ,EAAKjJ,KACXsM,QAASrD,EAAKqD,QACdZ,KAAMzC,EAAKyC,KACXxD,OAAQuf,GAIVhlB,qBAAqB4E,GACpB,IAAIqgB,GACH5b,SAAUzE,EAAOsE,IAAIyP,WACrB3M,QAASpH,EAAOsE,IAAI0P,WAKrB,OAHKlb,OAAOma,KAAKoN,GAAKrK,KAAKrc,KAAS0mB,EAAI1mB,MACvC0mB,OAAMje,IAGNnF,OAAQ+C,EAAOsE,IAAIrH,OACnBE,MAAO6C,EAAOsE,IAAInH,MAClB6H,MAAOhF,EAAOsE,IAAIU,MAClBD,KAAM/E,EAAOsE,IAAIS,KACjBub,YAAaD,GAIfjlB,oBAAoBkJ,GACnB,IAAI+b,GACHE,YAAajc,EAAIkc,cACjBC,eAAgBnc,EAAIoc,iBACpBjE,QAASnY,EAAI8Y,UACb3Y,SAAUH,EAAIyP,WACd3M,QAAS9C,EAAI0P,WAKd,OAHKlb,OAAOma,KAAKoN,GAAKrK,KAAKrc,KAAe0mB,EAAK1mB,MAC9C0mB,OAAMje,IAGNue,QAASrc,EAAI+B,MACbtB,KAAMT,EAAIS,KACVR,MAAOD,EAAIC,MACXtH,OAAQqH,EAAIrH,OACZE,MAAOmH,EAAInH,MACX6H,MAAOV,EAAIU,MACXsb,YAAaD,GAIfjlB,kBAAkB4E,EAAyB4gB,GAE1C,OADAA,EAAWA,OAEV/e,GAAI7B,EAAO6B,GACXsC,SAAUnE,EAAOmE,SACjBxL,KAAMiF,EAAArD,QAAK6J,SAASpE,EAAOqE,MAC3BY,QAASjF,EAAO7B,KAAK8G,QACrBoC,KAAuBrH,EAAOsE,UAA4BlC,IAApBpC,EAAOsE,IAAI+C,MAAuB5G,EAAAzE,WAAWgE,EAAOsE,IAAI+C,OAAsB,UACpH/C,IAAKsc,EAASC,UAAYxlB,KAAKylB,cAAc9gB,QAAUoC,GAIzDhH,iBAAiBmI,GAChB,OACCgE,OAAQhE,GAASA,EAAMgE,OAAS,EAAIhE,EAAMgE,YAASnF,EACnDia,WAAY9Y,GAASA,EAAM8Y,WAAa,EAAI9Y,EAAM8Y,gBAAaja,EAC/DqB,MAAOF,EAAQA,EAAME,WAAQrB,EAC7BuB,MAAOJ,QAAyBnB,IAAhBmB,EAAMI,OAAuBJ,EAAMI,MAAQ,EAAIJ,EAAMI,WAAQvB,GAI/EhH,kBAAkByI,GACjB,MAAM0C,KAIN,OAHAzN,OAAOma,KAAKpP,GAAQsQ,QAAQxa,IAC3B4M,EAAO5M,GAAO+G,EAAOqgB,UAAUld,EAAOlK,MAEhC4M,EAGRnL,kBAAkB6B,EAAyB2jB,GAC1C,IAAIP,GACH5b,SAAUxH,EAAO8W,YAKlB,OAHKjb,OAAOma,KAAKoN,GAAKrK,KAAKrc,KAAS0mB,EAAI1mB,MACvC0mB,OAAMje,IAGNP,GAAI5E,EAAO4E,GACXlJ,KAAMsE,EAAOtE,KACbuM,WAAYjI,EAAOkI,SAASN,OAC5BM,SAAUyb,EAASI,eAAiB/jB,EAAOkI,cAAW/C,EACtDwC,SAAUgc,EAASK,gBAAkBhkB,EAAO2H,cAAWxC,EACvDkI,WAAYrN,EAAO2H,SAASC,OAC5BI,QAAShI,EAAOgI,QAChBqb,YAAaD,GAIfjlB,iBAAiB+B,EAAuByjB,GACvC,IAAIP,GACH5b,SAAUtH,EAAM4W,WAChB3M,QAASjK,EAAM6W,WAKhB,OAHKlb,OAAOma,KAAKoN,GAAKrK,KAAKrc,KAAS0mB,EAAI1mB,MACvC0mB,OAAMje,IAGNP,GAAI1E,EAAM0E,GACVlJ,KAAMwE,EAAMxE,KACZsM,QAAS9H,EAAM8H,QACfhI,OAAQE,EAAMF,OACdwH,SAAUtH,EAAMsH,SAChB6F,WAAYnN,EAAMyH,SAASC,OAC3BP,KACCU,MAAO7H,EAAM6H,MACbD,KAAM5H,EAAM4H,KACZD,SAAU3H,EAAM2H,SAChBG,QAAS9H,EAAM8H,QACfqb,YAAaD,GAEdzb,SAAUgc,EAASM,cAAgB/jB,EAAMyH,cAAWxC,GAItDhH,4BAA4BgK,GAC3B,OACCE,YAAaF,EAAKnI,OAAOqI,YACzBG,UAAWL,EAAKjI,MAAMuI,IACtBC,cAAeP,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMC,MAAQT,EAAKjI,MAAMyI,MAAMC,WAAQzD,EACrF0D,eAAgBV,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMG,OAASX,EAAKjI,MAAMyI,MAAMG,YAAS3D,EACxF4D,cAAeZ,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMK,MAAQb,EAAKjI,MAAMyI,MAAMK,WAAQ7D,GAIvFhH,sBAAsBgK,GACrB,OACCE,YAAaF,EAAKnI,OAAOqI,YACzBG,UAAWL,EAAKjI,MAAMuI,IACtBC,cAAeP,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMC,MAAQT,EAAKjI,MAAMyI,MAAMC,WAAQzD,EACrF0D,eAAgBV,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMG,OAASX,EAAKjI,MAAMyI,MAAMG,YAAS3D,EACxF4D,cAAeZ,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMK,MAAQb,EAAKjI,MAAMyI,MAAMK,WAAQ7D,GAIvFhH,2BAA2BgK,GAC1B,OACCE,YAAaF,EAAKjI,MAAMmI,YACxBG,UAAWL,EAAKjI,MAAMuI,IACtByb,SAAU/b,EAAKjI,MAAMgkB,SACrBxb,cAAeP,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMC,MAAQT,EAAKjI,MAAMyI,MAAMC,WAAQzD,EACrF0D,eAAgBV,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMG,OAASX,EAAKjI,MAAMyI,MAAMG,YAAS3D,EACxF4D,cAAeZ,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMK,MAAQb,EAAKjI,MAAMyI,MAAMK,WAAQ7D,GAIvFhH,qBAAqBgK,GACpB,OACCE,YAAaF,EAAKjI,MAAMmI,YACxBG,UAAWL,EAAKjI,MAAMuI,IACtByb,SAAU/b,EAAKjI,MAAMgkB,SACrBxb,cAAeP,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMC,MAAQT,EAAKjI,MAAMyI,MAAMC,WAAQzD,EACrF0D,eAAgBV,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMG,OAASX,EAAKjI,MAAMyI,MAAMG,YAAS3D,EACxF4D,cAAeZ,EAAKjI,MAAMyI,OAASR,EAAKjI,MAAMyI,MAAMK,MAAQb,EAAKjI,MAAMyI,MAAMK,WAAQ7D,GAIvFhH,iBAAiB4J,GAChB,OACCrM,KAAMqM,EAAMrM,KACZ2R,WAAYtF,EAAMsF,WAClBpF,WAAYF,EAAME,WAClBqF,YAAavF,EAAMuF,aAIrBnP,oBAAoBoO,GACnB,OACCiT,QAASjT,EAASuS,OAClBhT,QAASS,EAAST,QAClB9D,QAASuE,EAASvE,QAClBiE,QAASM,EAASN,QAClBQ,SAAUF,EAASE,UAIrBtO,mBAAmBiN,EAA2BxH,GAC7C,OACCgB,GAAIwG,EAAQxG,GACZ6D,IAAK2C,EAAQ3C,IACbT,QAASoD,EAAQpD,QACjBmc,UAAW/Y,EAAQ+Y,UAAY,EAAI/Y,EAAQ+Y,eAAYhf,EACvDvB,OAAQA,EACRyH,aAAcD,EAAQC,aACtB3P,KAAM0P,EAAQ/D,IAAM+D,EAAQ/D,IAAIC,MAAQ8D,EAAQ3C,IAChDJ,YAAa+C,EAAQ/D,IAAM+D,EAAQ/D,IAAIgB,iBAAclD,GAIvDhH,iBAAiBiL,EAAuBua,GAEvC,OADAA,EAAWA,OAEV/e,GAAIwE,EAAMxE,GACVsC,SAAUkC,EAAMlC,SAChBM,SAAU4B,EAAM5B,SAChB2C,QAASf,EAAMe,QACfzO,KAAM0N,EAAM1N,KACZsM,QAASoB,EAAMlI,KAAK8G,QACpBH,SAAUuB,EAAMI,MAAM3B,WAAa,EACnC2B,MAAOma,EAASS,YACfxa,QAASR,EAAMI,MAAMI,UAAY,EACjC9L,OAAQsL,EAAMI,MAAM1L,QAAU,GAC9BumB,SAAUjb,EAAMI,MAAM6a,WAAa,EACnCC,WAAYlb,EAAMI,MAAM8a,aAAe,QACpCnf,EACJkC,IAAKsc,EAASY,SAAW9gB,EAAO+gB,aAAapb,EAAM/B,UAAOlC,GAI5DhH,0BAA0ByM,EAA2B+Y,EAAuC/f,GAC3F,OACCgB,GAAIgG,EAAQhG,GACZsC,SAAU,GACVc,QAAS4C,EAAQ1J,KAAO0J,EAAQ1J,KAAK8G,QAAU,EAC/CyD,UAAWb,EAAQa,UACnB7H,OAAQA,EACRyH,aAAcT,EAAQ9G,MACtBpI,KAAMkP,EAAQtD,MACdO,SAAU+C,EAAQpB,OAASoB,EAAQpB,MAAM3B,WAAmB,EAC5DpD,KAAMmG,EAAQnG,KACd6C,MAAOsD,EAAQtD,MACfoE,QAASd,EAAQc,QACjBgJ,KAAM9J,EAAQ8J,KACd9I,OAAQhB,EAAQgB,OAChBsI,KAAMtJ,EAAQsJ,KACd1K,MAAOma,EAASS,YAAcxZ,EAAQpB,OACrCI,QAASgB,EAAQpB,MAAMI,UAAY,EACnC9L,OAAQ8M,EAAQpB,MAAM1L,QAAU,GAChCumB,SAAUzZ,EAAQpB,MAAM6a,WAAa,EACrCC,WAAY1Z,EAAQpB,MAAM8a,aAAe,QACtCnf,EACJkC,IAAKsc,EAASY,UAAY3Z,EAAQvD,IAAM5D,EAAO+gB,aAAa5Z,EAAQvD,UAAOlC,GAI7EhH,sBAAsBkI,GACrB,MAAMoe,GACL1f,SAAUsB,EAAMvB,KAAKpJ,KACrBqP,WAAYrB,KAAKC,MAAMrG,EAAAhG,QAAOuK,SAASvE,EAAAhG,UAAS0N,KAAK1H,EAAAhG,QAAO+I,EAAM4E,QAAQC,cAE3E,OAAQ7E,EAAMqE,IAAIN,MACjB,KAAK5G,EAAAxE,aAAaoK,MACjBqb,EAAQrb,MAAQ3F,EAAOkH,UAA0BtE,EAAMqE,QACvD,MACD,KAAKlH,EAAAxE,aAAa4L,QACjB,MAAMA,EAA4BvE,EAAMqE,IACxC+Z,EAAQrb,MAAQ3F,EAAOoH,mBAAmBD,KAAaA,EAAQhH,QAGjE,OAAO6gB,EAGRtmB,oBAAoB0N,EAA6B8X,GAChD,OACC/e,GAAIiH,EAASjH,GACblJ,KAAMmQ,EAASnQ,KACf0Q,OAAQP,EAASO,OACjBN,QAASD,EAASC,QAClBE,SAAUH,EAASG,SACnBnE,SAAUgE,EAAShE,SACnBG,QAAS6D,EAAS7D,QAClBiE,QAASJ,EAASI,QAClBoB,WAAYxB,EAASlE,SAASC,OAC9BD,SAAUgc,EAASe,kBAAoB7Y,EAASlE,cAAWxC,GAI7DhH,uBAAuBwI,GACtB,OACCge,aAAche,EAAMge,aACpB9d,OAAQF,EAAME,OAAOvB,IAAInK,KACxBO,KAAMP,EAAEO,KACRoL,QAAS3L,EAAE2L,QAAQxB,IAAI9D,KAErB9F,KAAM8F,EAAE9F,KACR2R,WAAY7L,EAAE6L,WACduX,SAAUpjB,EAAEuB,OAAO6B,UAOxBzG,uBAAuBwI,GACtB,OACCge,aAAche,EAAMge,aACpB9d,OAAQF,EAAME,OAAOvB,IAAInK,KACxBO,KAAMP,EAAEO,KACRoL,QAAS3L,EAAE2L,QAAQxB,IAAI9D,KAErB9F,KAAM8F,EAAExB,OAAOtE,KACf2R,WAAY7L,EAAExB,OAAO2H,SAASC,OAC9BK,WAAYzG,EAAExB,OAAOkI,SAASN,OAC9BJ,SAAUhG,EAAExB,OAAO4E,UAOxBzG,uBAAuB4F,GACtB,OACCgB,SAAUhB,EAAQgB,SAClBqH,OAAQrI,EAAQqI,OAChBnB,KAAMlH,EAAQkH,KACdlH,QAASA,EAAQA,SAIZ5F,qBAAqB0mB,EAA+BlB,GAC1D,OACC1X,QAAS4Y,EAAU5Y,QACnBc,UAAW8X,EAAU9X,UACrBD,UAAW+X,EAAU/X,UACrBL,SAAUoY,EAAUpY,SACpB9E,SAAUgc,EAASmB,kBAAoBD,EAAUld,cAAWxC,IAhW/DlK,EAAAwI,wFCTAxI,EAAA8pB,SAAA,SAA4BzU,EAAgBQ,EAA4BqN,GACvE,YAAehZ,IAAX2L,GAAwBA,EAAS,EAC7BR,EAEDA,EAAK1N,MAAOub,GAAU,GAAKA,GAAU,IAAMrN,GAAU,qBCJ7D5V,EAAAD,QAAAkC,QAAA,uBCAAjC,EAAAD,QAAAkC,QAAA,kGCEA,MAAA6nB,EAAAjqB,EAAA,IACAkqB,EAAAlqB,EAAA,IAEMmqB,EAAyBnqB,EAAQ,KACjCoqB,EAAepqB,EAAQ,KAE7BE,EAAAmqB,SAAA,SAAyB1pB,GAQxB,OAPA,SAAmCwS,EAAsBC,EAAuBkX,GAC/EL,EAAAM,uBAAuB5pB,EAAMwS,EAAKgX,EAASC,GAAcI,KAAK,KAC7DF,MACEG,MAAOhkB,IACTyjB,EAAAhX,aAAanK,MAAMqK,EAAK3M,qcCX3B,MAAA4X,EAAA/b,EAAAtC,EAAA,IAEA0qB,EAAA1qB,EAAA,IAEM4C,EAAMyb,EAAA9b,QAAO,sBAEnB,SAASooB,EAAiB5I,EAAY9K,GACrC,IAAK8K,EACJ,MAAO,gCAAkC9K,EAAMtW,KAEhD,MAAMiqB,EAAwB3T,EAAM2T,OACpC,IAAIvpB,EAAQ0gB,EAAM9K,EAAMtW,MASxB,QAPcyJ,IAAV/I,GACCupB,QAA6BxgB,IAAnBwgB,EAAOroB,UACpBwf,EAAM9K,EAAMtW,MAAQiqB,EAAOroB,QAC3BlB,EAAQupB,EAAOroB,cAIH6H,IAAV/I,EACH,OAAI4V,EAAM4T,SACF,8BAAgC5T,EAAMtW,KAEvC,KAGR,GAAoB,YAAhBiqB,EAAOvb,KAAoB,CAC9B,IAAK,OAAQ,MAAO,KAAK4G,QAAQ5U,EAAMwC,aAAe,EACrDke,EAAM9K,EAAMtW,OAAQ,EACpBU,GAAQ,MACF,OAAK,QAAS,KAAM,KAAK4U,QAAQ5U,EAAMwC,aAAe,GAI5D,MAAO,6BAA+BoT,EAAMtW,KAH5CohB,EAAM9K,EAAMtW,OAAQ,EACpBU,GAAQ,EAIT0gB,EAAM9K,EAAMtW,MAAQU,OACd,IAAK,QAAS,OAAQ,SAAU,SAAU,WAAW4U,QAAQ2U,EAAOvb,MAAQ,KAAO,EAAG,CAC5F,IAAIyb,EAAMC,OAAO1pB,EAAMwC,YACvB,GAAI6K,MAAMoc,GACT,MAAO,4BAA8B7T,EAAMtW,KAK5C,GAHoB,YAAhBiqB,EAAOvb,OACVyb,EAAMnc,KAAK8G,MAAMqV,SAEK1gB,IAAnBwgB,EAAOI,SAAyBJ,EAAOI,QAAUF,EACpD,MAAO,4BAA8B7T,EAAMtW,KAAO,gBAAkBiqB,EAAOI,QAE5E,QAAuB5gB,IAAnBwgB,EAAOK,SAAyBL,EAAOK,QAAUH,EACpD,MAAO,4BAA8B7T,EAAMtW,KAAO,gBAAkBiqB,EAAOK,QAE5ElJ,EAAM9K,EAAMtW,MAAQmqB,OACd,GAAoB,WAAhBF,EAAOvb,KAAmB,CACpC,MAAMlN,EAAId,EAAMwC,WAAWuT,OAI3B,GAAIwT,EAAOM,MACNN,EAAOM,KAAKjV,QAAQ9T,GAAK,EAC5B,MAAO,iCAAmC8U,EAAMtW,KAAO,KAAOwB,EAGhE4f,EAAM9K,EAAMtW,MAAQwB,OACd,GAAoB,UAAhByoB,EAAOvb,KAAkB,CACnC,MAAMwS,EAAuB+I,EAAO/I,QAAUxS,KAAM,WACpD,GAAmB,WAAfwS,EAAMxS,KAAmB,CAC5B,MAAMkG,IAAS4V,MAAMC,QAAQ/pB,GAASA,GAASA,SAAekJ,IAAIpI,GAAKA,EAAE0B,WAAWuT,QACpF,GAAIyK,EAAMqJ,KACT,IAAK,IAAI9qB,EAAI,EAAGA,EAAImV,EAAK1I,OAAQzM,IAAK,CACrC,MAAM+B,EAAIoT,EAAKnV,GACf,GAAIyhB,EAAMqJ,KAAKjV,QAAQ9T,GAAK,EAC3B,MAAO,iCAAmC8U,EAAMtW,KAAO,KAAOwB,EAIjE4f,EAAM9K,EAAMtW,MAAQ4U,OACd,IAAK,QAAS,OAAQ,SAAU,SAAU,WAAWU,QAAQ4L,EAAMxS,MAAQ,KAAO,EAAG,CAC3F,MAAMkG,IAAS4V,MAAMC,QAAQ/pB,GAASA,GAASA,SAAekJ,IAAIV,IACjE,IAAIihB,EAAMC,OAAOlhB,EAAGhG,YAIpB,MAHmB,YAAfge,EAAMxS,OACTyb,EAAMnc,KAAK8G,MAAMqV,IAEXA,IAER,IAAK,IAAI1qB,EAAI,EAAGA,EAAImV,EAAK1I,OAAQzM,IAAK,CACrC,MAAM0qB,EAAMvV,EAAKnV,GACjB,GAAIsO,MAAMoc,GACT,MAAO,kCAAoC7T,EAAMtW,KAElD,QAAsByJ,IAAlByX,EAAMmJ,SAAyBnJ,EAAMmJ,QAAUF,EAClD,MAAO,kCAAoC7T,EAAMtW,KAAO,gBAAkBkhB,EAAMmJ,QAEjF,QAAuB5gB,IAAnBwgB,EAAOK,SAAyBL,EAAOK,QAAUH,EACpD,MAAO,kCAAoCjJ,EAAMlhB,KAAO,gBAAkBkhB,EAAMoJ,QAGlFlJ,EAAM9K,EAAMtW,MAAQ4U,OAEpB8V,QAAQzoB,IAAI,mCAAoCgoB,EAAQvpB,GAG1D,OAAO,KAkDRnB,EAAAqqB,uBAAA,SAA6C5pB,EAAcwS,EAAsBgX,EAAwBS,EAAoBU,2CAC5H,MAAMC,EAAUpB,EAAQqB,MAAM7qB,GAC9B,IAAK4qB,EAEJ,YADA3oB,EAAIwK,KAAK,4BAA6BzM,GAGvC,MAAM8qB,EAASH,GAAenY,EAAIsY,OAAO3jB,cACnC4jB,EAAMH,EAAQE,GACfC,EAIU,QAAXD,QArCL,SAAiCC,EAAsBd,EAAoBzX,2CAC1E,IAAKuY,EAAInY,WACR,OAED,IAAIxK,EAAuB,KAgB3B,OAfA2iB,EAAInY,WAAWyK,KAAK/G,IAEF,WADjBA,EAAyBA,GACf0U,GACT5iB,EAAQ4hB,EAAiBxX,EAAI4O,MAAO9K,GACb,SAAbA,EAAM0U,GAChB5iB,EAAQ4hB,EAAiBxX,EAAI7P,OAAQ2T,GACd,WAAbA,EAAM0U,GAChB5iB,EAAQ4hB,EAAiBxX,EAAI2B,QAASmC,GACf,WAAbA,EAAM0U,GAChB5iB,EAAQ4hB,EAAiBxX,EAAIyY,QAAS3U,GAEtCrU,EAAIwK,KAAK,iCAAkC6J,KAEnClO,IAENA,EACI/C,QAAQE,OAAO0S,MAAM7P,SAD7B,IAkBO8iB,CAAkBH,EAAKd,EAAQzX,SA5DvC,SAAkCuY,EAAsBI,EAAgB1W,2CACvE,IAAKsW,EAAIK,cAAoCL,EAAIK,YAAa1Z,UAAgCqZ,EAAIK,YAAa1Z,QAAQ,oBACtH,OAED,IAAK+C,EACJ,OAAOpP,QAAQE,OAAO0S,MAAM,yBAE7B,MAAMgS,EAA6Bc,EAAIK,YAAa1Z,QAAQ,oBAAoBuY,OAChF,IAAKA,IAAWA,EAAOoB,KACtB,OAAOhmB,QAAQE,OAAO0S,MAAM,8BAE7B,MAAMqT,EAAMH,EAAUI,YAAYtB,EAAOoB,KAAKlV,MAAM,KAAK,IACzD,IAAKmV,EACJ,OAAOjmB,QAAQE,OAAO0S,MAAM,sBAAwBgS,EAAOoB,OAE5D,MAAMzd,QAAemc,EAAAyB,SAAS/W,EAAM6W,GACpC,OAAI1d,EAAO6d,OAAOvf,OAAS,GAC1Bwe,QAAQtiB,MAAMkjB,EAAK7W,EAAM7G,EAAO6d,QACzBpmB,QAAQE,OAAO0S,MAAMnF,KAAKC,UAAUnF,EAAO6d,gBAFnD,IA8COC,CAAmBX,EAAKd,EAAQzX,EAAIiC,MAN1CxS,EAAIwK,KAAK,cAAgB+F,EAAIsY,OAAS,yBAA0BtY,EAAI9G,uXCnKtE,MAAAigB,EAAAtsB,EAAA,IACAqe,EAAAre,EAAA,GACAusB,EAAAvsB,EAAA,IACAwsB,EAAAxsB,EAAA,KACAysB,EAAAzsB,EAAA,IAEMyC,EAAS+pB,EAAAE,aAEfrO,EAAA7b,gBAAgBC,GAChB,MAAMkqB,EAAS,IAAIL,EAAAM,OAAOnqB,GACpBoqB,EAAS,IAAIN,EAAAO,OAAOH,GAmCtBI,QAAQC,KAAK/W,QAAQ,aAAe,EAPxC,mDACC,MAAMyI,EAAQ,IAAI+N,EAAAxG,MAAMxjB,SAClBic,EAAM8H,aACN9H,EAAM4H,cACN5H,EAAM+H,UAIZwG,GAAazC,KAAK,KACjBa,QAAQzoB,IAAI,WACV6nB,MAAMhkB,IACR4kB,QAAQtiB,MAAMtC,MAIfsmB,QAAQtV,GAAG,UAAW,MA1BvB,4CACC,UACOoV,EAAOK,aACPP,EAAOO,OACbH,QAAQI,OACP,MAAO1mB,GACR4kB,QAAQtiB,MAAM,qBAAsBtC,GACpCsmB,QAAQI,KAAK,MAoBbD,KA1CF,4CACC,UACOP,EAAOS,cACPP,EAAOO,QACZ,MAAO3mB,GAER,YADA4kB,QAAQtiB,MAAM,mBAAoBtC,GAGnC,UACOkmB,EAAOU,UACZ,MAAO5mB,GACR4kB,QAAQtiB,MAAM,2BAA4BtC,MAkC3C6mB,kcCzDD,MAAA1nB,EAAAtD,EAAAtC,EAAA,IAEAutB,EAAAvtB,EAAA,IACAysB,EAAAzsB,EAAA,IACAwtB,EAAAxtB,EAAA,IACAytB,EAAAztB,EAAA,IACAyI,EAAAzI,EAAA,GACAqe,EAAA/b,EAAAtC,EAAA,IACAwI,EAAAxI,EAAA,GACA0tB,EAAA1tB,EAAA,IACA2tB,EAAA3tB,EAAA,IACA4tB,EAAA5tB,EAAA,IACA6tB,EAAA7tB,EAAA,IACA8tB,EAAA9tB,EAAA,IACA+tB,EAAA/tB,EAAA,IACAguB,EAAAhuB,EAAA,IAEAiuB,EAAAjuB,EAAA,IACAkuB,EAAAluB,EAAA,IACAmuB,EAAAnuB,EAAA,IACAse,EAAAte,EAAA,IACAouB,EAAApuB,EAAA,IAIAquB,EAAAruB,EAAA,IACAsuB,EAAAtuB,EAAA,IAGYqe,EAAA9b,QAAO,UAEnBrC,EAAA0sB,aAkBCxpB,YAAYX,GACXY,KAAKZ,OAASA,EACdY,KAAKqb,MAAQ,IAAI+N,EAAAxG,MAAMxjB,GACvBY,KAAKkrB,MAAQ,IAAIf,EAAAgB,MAAM/rB,GACvBY,KAAKmc,UAAY,IAAI6O,EAAAI,UAAUhsB,GAC/BY,KAAK4Y,OAAS,IAAIwR,EAAAiB,OAAOjsB,GACzBY,KAAKsrB,KAAO,IAAId,EAAAe,KAAKnsB,GACrBY,KAAKsZ,OAAS,IAAImR,EAAAe,OAAOxrB,KAAKqb,OAC9Brb,KAAKqM,WAAa,IAAIse,EAAAc,WAAWzrB,KAAKqb,OACtCrb,KAAKsc,UAAY,IAAIrB,EAAA2C,UAAU5d,KAAKqb,OACpCrb,KAAK0rB,WAAa,IAAIX,EAAAY,WAAW3rB,KAAKqb,OACtCrb,KAAK4rB,SAAW,IAAIlB,EAAAmB,SAAS7rB,KAAKZ,OAAQY,KAAKqb,MAAOrb,KAAKkrB,OAC3DlrB,KAAKuI,MAAQ,IAAI8hB,EAAAyB,UAAU1sB,EAAQY,KAAKqb,OACxCrb,KAAK+rB,MAAQ,IAAIxB,EAAAyB,MAAMhsB,KAAKZ,OAAQY,KAAKqb,MAAOrb,KAAK4Y,QACrD5Y,KAAKkV,KAAO,IAAIoV,EAAA2B,SAASjsB,KAAKqb,MAAOrb,KAAKkrB,OAC1ClrB,KAAKksB,GAAK,IAAIhC,EAAAiC,GAAGnsB,KAAKqb,MAAOrb,KAAKkrB,MAAOlrB,KAAK4Y,OAAQ5Y,KAAKmc,WAC3Dnc,KAAKqd,MAAQ,IAAIyN,EAAAsB,MAAMpsB,KAAKqb,MAAOrb,KAAKksB,IAGnCnsB,wDACCC,KAAKksB,GAAGlC,gBACRhqB,KAAKqsB,mBAGNtsB,+DACCC,KAAKsZ,OAAOgT,oBACZtsB,KAAKuI,MAAMgkB,iBAGZxsB,YAAYwG,iDACXvG,KAAKksB,GAAGM,WAAWjmB,SACnBvG,KAAKqsB,mBAGNtsB,kBAAkBiM,2CACvB,MACMygB,KAaN,aAdqBzsB,KAAKqb,MAAMnT,MAAMqT,QAAQvP,UAEvC8M,QAAQ5Q,SACMnB,IAAhBmB,EAAMI,QACTmkB,EAAQvkB,EAAMwY,QAAU+L,EAAQvkB,EAAMwY,YACtC+L,EAAQvkB,EAAMwY,QAAQ7N,KAAK3K,EAAMI,UAGtB7K,OAAOma,KAAK6U,GAASvlB,IAAI5I,KAEpCkI,GAAIlI,EACJouB,IAAKD,EAAQnuB,GAAKoV,OAAO,CAACuE,EAAG7a,IAAO6a,EAAI7a,EAAI,GAAKqvB,EAAQnuB,GAAKkL,UAE7DuO,KAAK,CAACC,EAAGC,IAAOA,EAAEyU,IAAM1U,EAAE0U,KACjBxlB,IAAI8Q,GAAKA,EAAExR,MAGlBzG,0BAA0DiM,EAAoB0S,EAAUhY,EAAqB2U,2CAClH,MAAMW,QAAYhc,KAAK2sB,kBAAkB3gB,GACzC,aAAahM,KAAK4sB,eAAe5Q,EAAK0C,EAAOrD,KAGxCtb,oBAAoBiM,EAAoBtF,2CAG7C,aAFqB1G,KAAKqb,MAAMnT,MAAMqT,QAAQvN,OAAQtH,EAAKF,GAAIwF,OAAM6U,UAAW,KACzDxI,OAAOnQ,QAAyBnB,IAAhBmB,EAAMI,OAAqByP,KAAK,CAACC,EAAGC,IAAcA,EAAE3P,MAAgB0P,EAAE1P,OAC9FpB,IAAI8Q,GAAKA,EAAE0I,UAGrB3gB,4BAA4DiM,EAAoB0S,EAAUhY,EAAqB2U,2CACpH,MAAMW,QAAYhc,KAAK6sB,oBAAoB7gB,EAAMtF,GACjD,aAAa1G,KAAK4sB,eAAe5Q,EAAK0C,EAAOrD,KAGxCtb,wBAAwBiM,EAAoBtF,2CACjD,MAAM8B,QAAexI,KAAKqb,MAAMnT,MAAMqT,QAAQvN,OAAQtH,EAAKF,GAAIwF,OAAM8U,UAAU,IAE/E,OADAtY,EAAOuP,KAAK,CAACC,EAAGC,IAAMA,EAAE/L,OAAS8L,EAAE9L,QAC5B1D,EAAOtB,IAAI8Q,GAAKA,EAAE0I,UAGpB3gB,gCAAgEiM,EAAoB0S,EAAUhY,EAAqB2U,2CACxH,MAAMW,QAAYhc,KAAK8sB,wBAAwB9gB,EAAMtF,GACrD,aAAa1G,KAAK4sB,eAAe5Q,EAAK0C,EAAOrD,KAGxCtb,aAAaiM,EAAoBtF,2CACtC,MAAM8B,QAAexI,KAAKqb,MAAMnT,MAAMqT,QAAQvN,OAAQtH,EAAKF,GAAIwF,OAAM2U,SAAS,IAE9E,OADAnY,EAAOuP,KAAK,CAACC,EAAGC,IAAMA,EAAE+I,WAAahJ,EAAEgJ,YAChCxY,EAAOtB,IAAI8Q,GAAKA,EAAE0I,UAGpB3gB,qBAAqDiM,EAAoB0S,EAAUhY,EAAqB2U,2CAC7G,MAAMW,QAAYhc,KAAK+sB,aAAa/gB,EAAMtF,GAC1C,aAAa1G,KAAK4sB,eAAe5Q,EAAK0C,EAAOrD,KAGxCtb,sBAAsBiM,EAAoBtF,2CAC/C,MAAM8B,QAAexI,KAAKqb,MAAMnT,MAAMqT,QAAQvN,OAAQtH,EAAKF,GAAIwF,OAAM8U,UAAU,IAE/E,OADAtY,EAAOuP,KAAK,CAACC,EAAGC,IAAMA,EAAE+I,WAAahJ,EAAEgJ,YAChCxY,EAAOtB,IAAI8Q,GAAKA,EAAE0I,UAGpB3gB,8BAA8DiM,EAAoB0S,EAAUhY,EAAqB2U,2CACtH,MAAMW,QAAYhc,KAAKgtB,sBAAsBhhB,EAAMtF,GACnD,aAAa1G,KAAK4sB,eAAe5Q,EAAK0C,EAAOrD,KAGxCtb,eAAmCic,EAAoB0C,EAA6BrD,2CAEzF,aADmBA,EAAM4R,UAAUxvB,OAAO2I,OAAOsY,GAAQ1C,MAAKtJ,QAAS,EAAGqN,OAAQ,MACtEhI,KAAK,CAACC,EAAGC,IACb+D,EAAIpJ,QAAQoF,GAAKgE,EAAIpJ,QAAQqF,MAIhClY,iBAAiB4E,2CAEtB,aADqB3E,KAAKktB,kBAAkBvoB,EAAOmE,WACrC5B,IAAI2B,KAEhBrC,GAAIqC,EAAOrC,GACXlJ,KAAMiF,EAAArD,QAAK6J,SAASF,EAAOG,WAKxBjJ,oBAAoBqhB,EAAiB1a,2CAC1C,MAAMyH,QAAiBnO,KAAKqb,MAAMlN,SAAS8S,WAAWP,OAAQU,EAASpT,OAAQtH,EAAKF,KAChF2H,UACGnO,KAAKqb,MAAMlN,SAASuN,OAAOvN,EAAS3H,OAItCzG,oBAAoBiL,EAAuBtE,EAAqB2H,EAAkBX,2CACvF,IAAIS,QAAiBnO,KAAKqb,MAAMlN,SAAS8S,WAAWP,OAAQ1V,EAAMxE,GAAIwH,OAAQtH,EAAKF,KAmBnF,OAlBK2H,GAaJA,EAAST,QAAUA,EACnBS,EAASE,SAAWA,EACpBF,EAASN,QAAU1N,KAAK0d,YAClB7d,KAAKqb,MAAMlN,SAAStJ,QAAQsJ,KAflCA,GACC3H,GAAI,GACJwF,KAAM5G,EAAAxE,aAAauN,SACnBuS,OAAQ1V,EAAMxE,GACdwH,OAAQtH,EAAKF,GACb6H,WACAX,UACA9D,QAASzJ,KAAK0d,MACdhQ,QAAS1N,KAAK0d,QAENrX,SAAWxG,KAAKqb,MAAMlN,SAAS2P,IAAI3P,GAOtCA,IAGFpO,kBAAkBotB,2CACvB,MAAMjiB,KACAmQ,EAAQrb,KAAKqb,MAAM1W,OAczB,aAZA,SAAeyoB,EAAQ5mB,2CACtB,IAAKA,EACJ,OAED,MAAM7B,QAAe0W,EAAMoD,KAAKjY,GAC5B7B,IACHuG,EAAOmiB,QAAQ1oB,SACTyoB,EAAQzoB,EAAOmE,aAIjBskB,CAAQD,GACPjiB,IAGFnL,oBAAoB4E,EAAyB2oB,2CAClD3oB,EAAOsE,IAAIsB,YAAcvK,KAAK4Y,OAAO2U,WAAW5oB,EAAOqE,KAAM5D,EAAA1D,oBAAoBiD,EAAOsE,IAAI+C,MAAOshB,SAC7FttB,KAAKqb,MAAM1W,OAAOE,QAAQF,KAG3B5E,eAAe4E,EAAyBL,2CAC7C,MAAMkpB,EAAepoB,EAAA1D,oBAAoBiD,EAAOsE,IAAI+C,MAAQzJ,EAAArD,QAAKqF,QAAQD,GACnEmpB,EAAWlrB,EAAArD,QAAKoB,KAAKqE,EAAOqE,KAAMwkB,SAClCroB,EAAAf,mBAAmBqpB,SACnBtoB,EAAAnB,SAASM,EAAUmpB,GACzB9oB,EAAOsE,IAAIsB,MAAQijB,QACbxtB,KAAKqb,MAAM1W,OAAOE,QAAQF,KAG3B5E,aAAa4E,EAAyBrH,2CAE3C,GAAoB,KADpBA,EAAO6H,EAAAP,uBAAuBtH,EAAM,IAAIyW,QAC/BvK,OACR,OAAO7G,QAAQE,OAAO0S,MAAM,iBAE7B,MAAM1W,EAAI0D,EAAArD,QAAKwuB,QAAQ/oB,EAAOqE,MACxBtF,EAAOnB,EAAArD,QAAKoB,KAAKzB,EAAGvB,GAE1B,SADqB6H,EAAA7B,SAASI,GAE7B,OAAOf,QAAQE,OAAO0S,MAAM,mCAEvBpQ,EAAAvB,UAAUe,EAAOqE,KAAMtF,SACvB1D,KAAKksB,GAAGyB,gBAAgBhpB,EAAQjB,KAGjC3D,qBAAqB4E,2CACtBA,EAAOsE,IAAIsB,QAGX5F,EAAOoF,MAAQpF,EAAOoF,KAAKjI,MAAMyI,OAAS5F,EAAOoF,KAAKjI,MAAMyI,MAAMK,YAC/D5K,KAAK4tB,oBAAoBjpB,EAAQA,EAAOoF,KAAKjI,MAAMyI,MAAMK,OACrDjG,EAAOoF,MAAQpF,EAAOoF,KAAKnI,OAAO2I,OAAS5F,EAAOoF,KAAKnI,OAAO2I,MAAMK,cACxE5K,KAAK4tB,oBAAoBjpB,EAAQA,EAAOoF,KAAKnI,OAAO2I,MAAMK,WAI5D7K,eAAe4E,EAAyB8G,EAAe/L,2CAE5D,SADMM,KAAK6tB,qBAAqBlpB,GAC3BA,EAAOsE,IAAIsB,MAGhB,aAAavK,KAAK4Y,OAAOhb,IAAI+G,EAAO6B,GAAIjE,EAAArD,QAAKoB,KAAKqE,EAAOqE,KAAMrE,EAAOsE,IAAIsB,OAAQkB,EAAM/L,KAGnFK,cAAc+B,EAAuB2J,EAAe/L,2CACzD,GAA8B,IAA1BoC,EAAMyH,SAASC,OAClB,OAED,MAAMwB,QAAchL,KAAKqb,MAAMrQ,MAAMyT,KAAK3c,EAAMyH,SAAS,IACzD,IAAKyB,EACJ,OAED,MAAMrG,QAAe3E,KAAKqb,MAAM1W,OAAO8Z,KAAKzT,EAAMlC,UAClD,OAAKnE,EAGE3E,KAAK8tB,eAAenpB,EAAQ8G,EAAM/L,QAHzC,IAMKK,eAAe6B,EAAyB6J,EAAe/L,2CAC5D,GAA+B,IAA3BkC,EAAO2H,SAASC,OACnB,OAED,MAAMwB,QAAchL,KAAKqb,MAAMrQ,MAAMyT,KAAK7c,EAAO2H,SAAS,IAC1D,IAAKyB,EACJ,OAED,MAAMwS,QAAgBxd,KAAKktB,kBAAkBliB,EAAMlC,UACnD,GAAuB,IAAnB0U,EAAQhU,OACX,OAED,IAAI7E,EAAS6Y,EAAQ7C,KAAKJ,GAAKA,EAAEtR,IAAI+C,OAAS5G,EAAAzE,WAAWiB,QAIzD,OAHK+C,IACJA,EAAS6Y,EAAQA,EAAQhU,OAAS,IAE9B7E,EAGE3E,KAAK8tB,eAAenpB,EAAQ8G,EAAM/L,QAHzC,IAMKK,cAAciL,EAAuBS,EAAe/L,2CACzD,MAAMiF,QAAe3E,KAAKqb,MAAM1W,OAAO8Z,KAAKzT,EAAMlC,UAClD,GAAKnE,EAGL,OAAO3E,KAAK8tB,eAAenpB,EAAQ8G,EAAM/L,KAGpCK,aAAa2G,EAAqB+E,EAAe/L,2CACtD,GAAIgH,EAAKqnB,OACR,OAAO/tB,KAAK4Y,OAAOhb,IAAI8I,EAAKF,GAAIjE,EAAArD,QAAKoB,KAAKN,KAAKZ,OAAO4uB,aAAa,WAAYtnB,EAAKqnB,QAAStiB,EAAM/L,KAI/FK,YAAYvC,EAAaiO,EAAe/L,2CAC7C,IAAIwL,EACJ,OAAQ1N,EAAEwO,MACT,KAAK5G,EAAAxE,aAAaoK,MACjB,MAAMA,EAAwBxN,EAC9B0N,QAAelL,KAAKiuB,cAAcjjB,EAAOS,EAAM/L,GAC/C,MACD,KAAK0F,EAAAxE,aAAa+D,OACjB,MAAMA,EAA0BnH,EAChC0N,QAAelL,KAAK8tB,eAAenpB,EAAQ8G,EAAM/L,GACjD,MACD,KAAK0F,EAAAxE,aAAagB,OACjB,MAAMA,EAA0BpE,EAChC0N,QAAelL,KAAKkuB,eAAetsB,EAAQ6J,EAAM/L,GACjD,MACD,KAAK0F,EAAAxE,aAAakB,MACjB,MAAMA,EAAwBtE,EAC9B0N,QAAelL,KAAKmuB,cAAcrsB,EAAO2J,EAAM/L,GAC/C,MACD,KAAK0F,EAAAxE,aAAa8F,KACjB,MAAMA,EAAsBlJ,EAC5B0N,QAAelL,KAAKouB,aAAa1nB,EAAM+E,EAAM/L,GAK/C,OAAKwL,GACGlL,KAAKquB,WAAW7wB,EAAGiO,EAAM/L,KAM5BK,WAAWuM,EAAeb,EAAe/L,2CAC9C,MAgDMZ,EAhDkB,CAACtB,IACxB,OAAQA,EAAEwO,MACT,KAAK5G,EAAAxE,aAAaoK,MACjB,MAAMA,EAAwBxN,EAC9B,OAAOwN,EAAM/B,KAAO+B,EAAM/B,IAAIC,MAAQ8B,EAAM/B,IAAIC,MAAQ3G,EAAArD,QAAK6J,SAASiC,EAAMhC,MAC7E,KAAK5D,EAAAxE,aAAa+D,OACjB,MAAMA,EAA0BnH,EAChC,IAAI0N,EAWJ,OAVIvG,EAAOsE,MACNtE,EAAOsE,IAAI+C,OAAS5G,EAAAzE,WAAWiB,OAClCsJ,EAASvG,EAAOsE,IAAIrH,QACTwD,EAAAzE,WAAWoB,WAAYqD,EAAAzE,WAAWmB,OAAO8Q,QAAQjO,EAAOsE,IAAI+C,OAAS,IAChFd,EAASvG,EAAOsE,IAAInH,QAGjBoJ,GAA4B,IAAlBA,EAAO1B,SACrB0B,EAAS3I,EAAArD,QAAK6J,SAASpE,EAAOqE,OAExBkC,EACR,KAAK9F,EAAAxE,aAAa4L,QACjB,MAAMA,EAA8ChP,EACpD,IAAIoT,EAA2BpE,EAAQvD,IAAMuD,EAAQvD,IAAIC,WAAQnC,EAOjE,OANK6J,GAAQpE,EAAQxD,OACpB4H,EAAOrO,EAAArD,QAAK6J,SAASyD,EAAQxD,OAEzB4H,IACJA,EAAO,WAEDA,EACR,KAAKxL,EAAAxE,aAAa6M,SAEjB,OADuDjQ,EACvCF,KACjB,KAAK8H,EAAAxE,aAAaoM,QACjB,MAAMA,EAA8CxP,EACpD,OAAOwP,EAAQ/D,IAAM+D,EAAQ/D,IAAIC,MAAQ8D,EAAQ3C,IAClD,KAAKjF,EAAAxE,aAAakB,MAGlB,KAAKsD,EAAAxE,aAAagB,OAGlB,KAAKwD,EAAAxE,aAAa8F,KAEjB,OAD2ClJ,EAC/BF,KACb,QACC,OAAO8H,EAAAxE,aAAapD,EAAEwO,QAGfsiB,CAAgBhiB,GAC1B,OAAOtM,KAAK4Y,OAAO2V,MAAMzvB,EAAG2M,GAAQ,IAAK/L,KAGpCK,gBAAgBvC,EAAakJ,2CAClC,OAAQlJ,EAAEwO,MACT,KAAK5G,EAAAxE,aAAaoK,MACjB,MAAMA,EAAwCxN,EAC9C,aAAawC,KAAKmc,UAAUve,IAAIJ,EAAEgJ,GAAIjE,EAAArD,QAAKoB,KAAK0K,EAAMhC,KAAMgC,EAAM1N,MAAO0N,EAAMI,OAChF,KAAKhG,EAAAxE,aAAa4L,QACjB,MAAMA,EAA8ChP,EACpD,GAAIgP,EAAQxD,MAAQwD,EAAQpB,MAC3B,aAAapL,KAAKmc,UAAUve,IAAIJ,EAAEgJ,GAAIjE,EAAArD,QAAKoB,KAAKkM,EAAQxD,MAAOwD,EAAQpB,OAI1E,OAAOzI,QAAQE,OAAO0S,MAAM,6CAGvBxV,aAAavC,EAAakC,EAA4BmH,EAAgCH,2CAE3F,SAAeie,EAAOrgB,EAAkB8G,2CACvC,IAAImP,EAAI7a,GAAU,MACL,MAAT6a,EAAE,KACLA,EAAIA,EAAE/V,MAAM,IAEb,MAAMgH,EAAU3E,GAAc,EAC9B,MAAU,QAAN0T,GAAesQ,EAAA2D,WAAWC,iBAAiBrjB,EAAM1L,QAAUyF,EAAAd,WAAWC,GAAWiW,EAAG/O,GAClFqf,EAAA2D,WAAWE,iBAAiBtjB,EAAOmP,IAGhC1J,KAAM,IAAIga,EAAA8D,cAAcrqB,EAAUiW,EAAG/O,IAFrC7I,QAAQE,OAAO0S,MAAM,oCAKrBxQ,MAAOT,WAAUhH,KAAME,EAAEgJ,GAAK,IAAM+T,MAI9C,OAAQ/c,EAAEwO,MACT,KAAK5G,EAAAxE,aAAaoK,MACjB,MAAMA,EAAwCxN,EAE9C,OADAwC,KAAKqM,WAAWuiB,YAAY5jB,EAAOtE,GAC5Bie,EAAOpiB,EAAArD,QAAKoB,KAAK0K,EAAMhC,KAAMgC,EAAM1N,MAAO0N,EAAMI,OACxD,KAAKhG,EAAAxE,aAAa4L,QACjB,MAAMA,EAA8ChP,EACpD,OAAIgP,EAAQxD,MAAQwD,EAAQpB,OAC3BpL,KAAKqM,WAAWwiB,cAAcriB,EAAS9F,GAChCie,EAAOnY,EAAQxD,KAAMwD,EAAQpB,QAE7BzI,QAAQE,OAAOooB,EAAA/T,aAAa,8BAGtC,OAAOvU,QAAQE,OAAO0S,MAAM,wCAGvBxV,eAAevC,EAAakC,EAA4BgH,2CAE7D,MAAMooB,EAAgB,CAACxxB,EAAc2Q,KACpC,MAAM8gB,EAAW9gB,EAAO/G,IAAIjJ,GAAKsE,EAAArD,QAAKoB,KAAKrC,EAAE+K,KAAM/K,EAAEX,OACrD,OAAQuT,KAAM,IAAI+Z,EAAAoE,mBAAmBD,EAAU5pB,EAAAP,uBAAuBtH,EAAM,QAG7E,OAAQE,EAAEwO,MACT,KAAK5G,EAAAxE,aAAaoK,MACjB,MAAMA,EAAwBxN,EAC9B,OAAQqT,KAAM,IAAI+Z,EAAAoE,oBAAoBzsB,EAAArD,QAAKoB,KAAK0K,EAAMhC,KAAMgC,EAAM1N,OAAQiF,EAAArD,QAAK6J,SAASiC,EAAM1N,QAC/F,KAAK8H,EAAAxE,aAAa+D,OACjB,MAAMA,EAA0BnH,EAChC,OAAQqT,KAAM,IAAI+Z,EAAAqE,eAAetqB,EAAOqE,KAAMzG,EAAArD,QAAK6J,SAASpE,EAAOqE,QACpE,KAAK5D,EAAAxE,aAAagB,OACjB,MAAMA,EAA0BpE,EAChC,OAAOsxB,EAAcltB,EAAOtE,MAAQ,eAAgB0C,KAAKqb,MAAMrQ,MAAM2S,MAAM/b,EAAO2H,WACnF,KAAKnE,EAAAxE,aAAakB,MACjB,MAAMA,EAAwBtE,EAC9B,OAAOsxB,EAAchtB,EAAMxE,MAAQ,cAAe0C,KAAKqb,MAAMrQ,MAAM2S,MAAM7b,EAAMyH,WAChF,KAAKnE,EAAAxE,aAAa6M,SACjB,MAAMA,EAA8BjQ,EACpC,OAAIiQ,EAASO,SAAWtH,EAAKF,GACrB7D,QAAQE,OAAO0S,MAAM,iBAGtBuZ,EAAcrhB,EAASnQ,MAAQ,iBAAkB0C,KAAKqb,MAAMrQ,MAAM2S,MAAMlQ,EAASlE,WAE1F,OAAO5G,QAAQE,OAAO0S,MAAM,uCAGfxV,0DACb,GAAKC,KAAKZ,OAAO8vB,WAAjB,CAGA,GAAIlvB,KAAKZ,OAAO8vB,WAAWC,WAEZ,WADMnvB,KAAKqb,MAAM3U,KAAKmR,SACnB,CAChB,MAAMsX,EAAYnvB,KAAKZ,OAAO8vB,WAAWC,UACnCzoB,GACLF,GAAI,GACJlJ,KAAM6xB,EAAU7xB,KAChB6iB,KAAMgP,EAAUhP,MAAQ,GACxBvZ,MAAOuoB,EAAUC,MAAQ,GACzBpjB,KAAM5G,EAAAxE,aAAa8F,KACnB2oB,mBAAmB,EACnBloB,mBAAmB,EACnByC,QAASzJ,KAAK0d,MACdxW,OACCQ,YAAY,EACZL,YAAY,EACZJ,WAAW,EACXQ,aAAa,UAWT5H,KAAKqb,MAAM3U,KAAKoX,IAAIpX,GAG5B,GAAI1G,KAAKZ,OAAO8vB,WAAW7R,OAEZ,WADMrd,KAAKqb,MAAM9U,KAAKsR,SACnB,CAChB,MAAMyX,EAAkBtvB,KAAKZ,OAAO8vB,WAAW7R,MAC/C,IAAK,MAAMkS,KAASD,EAAiB,CACpC,MAAM/oB,GACLC,GAAI,GACJoD,QAASzJ,KAAK0d,MACd7R,KAAM5G,EAAAxE,aAAa2F,KACnBjJ,KAAMiyB,EAAMjyB,KACZ0L,KAAMumB,EAAMvmB,YAEPhJ,KAAKqb,MAAM9U,KAAKuX,IAAIvX,QAMhBxG,+DACPoF,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,aACxCoB,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,KAAM,QAAS,oBACvDoB,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,KAAM,QAAS,kBACvDoB,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,KAAM,QAAS,iBACvDoB,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,KAAM,iBAC9CoB,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,KAAM,kBAC9CoB,EAAAT,SAASnC,EAAArD,QAAK0D,QAAQ5C,KAAKZ,OAAO+oB,MAAMpkB,KAAM,eAG/ChE,sDAECC,KAAKwvB,uBAELxvB,KAAKqb,MAAM8H,aAEXnjB,KAAKyvB,oBAGN1vB,qDACCC,KAAKqb,MAAM+H,UAGZrjB,IAAIyG,EAAYwF,EAAoBgC,EAAgB0N,2CACzD,MAAMxT,QAAclI,KAAKqb,MAAMnT,MAAMwnB,aAAalpB,EAAIwH,EAAQhC,GAC9D,GAAI0P,EAAQ,CACX,QAAoB3U,IAAhBmB,EAAME,MACT,OAAOF,EAERA,EAAME,WAAQrB,MACR,CACN,QAAoBA,IAAhBmB,EAAME,MACT,OAAOF,EAERA,EAAME,MAAQjI,KAAK0d,MAOpB,OALwB,IAApB3V,EAAM1B,GAAGgD,aACNxJ,KAAKqb,MAAMnT,MAAM4V,IAAI5V,SAErBlI,KAAKqb,MAAMnT,MAAMrD,QAAQqD,GAEzBA,IAGFnI,KAAKyG,EAAYwF,EAAoBgC,EAAgB2hB,2CAC1D,MAAMznB,QAAclI,KAAKqb,MAAMnT,MAAMwnB,aAAalpB,EAAIwH,EAAQhC,GAW9D,OATC9D,EAAMI,MADQ,IAAXqnB,OACW5oB,EAEA4oB,EAES,IAApBznB,EAAM1B,GAAGgD,aACNxJ,KAAKqb,MAAMnT,MAAM4V,IAAI5V,SAErBlI,KAAKqb,MAAMnT,MAAMrD,QAAQqD,GAEzBA,IAGFnI,aAAa2e,2CAClB,MAAMxT,KACN,QAAoBnE,IAAhB2X,EAAM1T,OAAuB0T,EAAM1T,MAAQ,EAAG,CACjD,MAAMkH,QAAalS,KAAKqb,MAAMrQ,MAAMuQ,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAM1T,QAC9EE,EAAO+C,OAASiE,EAAKhL,IAAI1J,KAChBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAEyL,IAAIC,OAAS,MAGzC,QAAoBnC,IAAhB2X,EAAM5c,OAAuB4c,EAAM5c,MAAQ,EAAG,CACjD,MAAMoQ,QAAalS,KAAKqb,MAAMvZ,MAAMyZ,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAM5c,QAC9EoJ,EAAOmO,OAASnH,EAAKhL,IAAI1J,KAChBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAEF,QAG5B,QAAqByJ,IAAjB2X,EAAM9c,QAAwB8c,EAAM9c,OAAS,EAAG,CACnD,MAAMsQ,QAAalS,KAAKqb,MAAMzZ,OAAO2Z,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAM9c,SAC/EsJ,EAAOiO,QAAUjH,EAAKhL,IAAI1J,KACjBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAEF,QAG5B,QAAqByJ,IAAjB2X,EAAM/Z,QAAwB+Z,EAAM/Z,OAAS,EAAG,CACnD,MAAMuN,QAAalS,KAAKqb,MAAMzZ,OAAO2Z,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAM/Z,SAC/EuG,EAAOsS,QAAUtL,EAAKhL,IAAI1J,KACjBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAEF,QAG5B,QAAuByJ,IAAnB2X,EAAMjR,UAA0BiR,EAAMjR,SAAW,EAAG,CACvD,MAAMyE,QAAalS,KAAKqb,MAAM5N,SAAS8N,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAMjR,WACjFvC,EAAOoR,UAAYpK,EAAKhL,IAAI1J,KACnBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAEF,QAG5B,QAAsByJ,IAAlB2X,EAAM1R,SAAyB0R,EAAM1R,QAAU,EAAG,CACrD,MAAMkF,QAAalS,KAAKqb,MAAMrO,QAAQuO,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAM1R,UAChF9B,EAAO0gB,SAAW1Z,EAAKhL,IAAI1J,KAClBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAEyL,IAAMzL,EAAEyL,IAAIC,MAAQ,MAGhD,QAAsBnC,IAAlB2X,EAAMlS,SAAyBkS,EAAMlS,QAAU,EAAG,CACrD,MAAM0F,QAAalS,KAAKqb,MAAM7O,QAAQ+O,QAAQmD,MAAOA,EAAMA,MAAOhM,OAAQgM,EAAMlS,UAChFtB,EAAO+K,SAAW/D,EAAKhL,IAAI1J,KAClBgJ,GAAIhJ,EAAEgJ,GAAIlJ,KAAME,EAAE0L,SAG5B,OAAOgC,ocC5nBT,MAAA8P,EAAA/b,EAAAtC,EAAA,IACAizB,EAAAjzB,EAAA,IACAkzB,EAAAlzB,EAAA,IACAmzB,EAAAnzB,EAAA,IACAozB,EAAApzB,EAAA,IACAqzB,EAAArzB,EAAA,IAKM4C,EAAMyb,EAAA9b,QAAO,MAgBnBrC,EAAAsvB,SASCpsB,YAAYsb,EAAc6P,EAActS,EAAgBuD,GARjDnc,KAAAiwB,UAAW,EAMVjwB,KAAAkwB,cAGPlwB,KAAKqb,MAAQA,EACbrb,KAAKkrB,MAAQA,EACblrB,KAAK4Y,OAASA,EACd5Y,KAAKmc,UAAYA,EAGJpc,QAAQwY,EAAa1P,EAAqCvJ,EAAewiB,EAAgBpF,2CACtG,MAAMyT,QAAsBP,EAAAQ,QAAQ7X,GAC9BrE,QAAwB2b,EAAAQ,SAASF,EAAMnwB,KAAKqb,MAAOyG,GAQzD,OAPIjZ,IACHqL,EAAMrL,QAAUvL,KAAMuL,EAAOG,KAAMrE,OAAQkE,EAAQvJ,QAAOwiB,OAAQA,EAAQjJ,SAAWG,aAAc9E,GAAQ0I,kBAAoBD,iBAAmB7Z,MAAOwtB,MAAO,EAAGC,MAAO,iBAE5J,IAAIT,EAAAU,OAAO1O,EAAQ9hB,KAAKqb,MAAOrb,KAAKkrB,MAAQrT,IAC1D7X,KAAKywB,cAAgB5Y,IAEH6Y,MAAMxc,EAAOwI,GACzBxI,EAAMvP,SAGd5E,gBACC,OAAQkwB,SAAUjwB,KAAKiwB,SAAUpY,MAAO7X,KAAKywB,eAG9C1wB,cAAcyG,GACb,OAAOxG,KAAKkwB,WAAW1pB,GAGhBzG,gBAGP,OAFAC,KAAKywB,cAAgB,EACrBzwB,KAAKiwB,UAAW,GAEfnT,aACAE,mBACAI,oBACAT,iBACAI,gBACAG,cACAN,kBACAO,kBAIYpd,aAAa2c,2CAC1B1c,KAAKiwB,UAAW,EAChBjwB,KAAKywB,mBAAgB1pB,QACf/G,KAAK2wB,eAAejU,KAGrB3c,2DAWCC,KAAK2wB,gBATV7T,aACAE,mBACAL,iBACAI,gBACAG,cACAE,oBACAR,kBACAO,qBAKYpd,eAAe2c,iDACtBsT,EAAAvT,eAAezc,KAAKqb,MAAOrb,KAAK4Y,OAAQ5Y,KAAKmc,UAAWO,SACjD,IAAIqT,EAAAa,UAAU5wB,KAAKqb,MAAOrb,KAAK4Y,QACjCiY,KAAKnU,GAChBnd,EAAIwK,KAAK,aAAc2S,EAAQI,UAAUtT,QACzCjK,EAAIwK,KAAK,cAAe2S,EAAQQ,WAAW1T,QAC3CjK,EAAIwK,KAAK,gBAAiB2S,EAAQK,aAAavT,QAC/CjK,EAAIwK,KAAK,iBAAkB2S,EAAQS,cAAc3T,QACjDjK,EAAIwK,KAAK,gBAAiB2S,EAAQC,cAAcnT,QAChDjK,EAAIwK,KAAK,iBAAkB2S,EAAQE,eAAepT,UAG7CzJ,aAAa4E,2CAClB,GAAI3E,KAAKiwB,SACR,OAED,MAAMvT,EAAU1c,KAAK8wB,gBAErB,GADAvxB,EAAIwK,KAAK,wBAAyBpF,EAAOqE,MACpCrE,EAAOmE,UAAuC,IAA3BnE,EAAOmE,SAASU,OAEjC,CACN,MAAMX,QAAe7I,KAAKqb,MAAM1W,OAAO8Z,KAAK9Z,EAAOmE,UAC/CD,UACG7I,KAAKowB,QAAQzrB,EAAOqE,KAAMH,EAAQA,EAAOI,IAAI3J,MAAOqF,EAAOmd,OAAQpF,eAJpE1c,KAAKowB,QAAQzrB,EAAOqE,UAAMjC,EAAW,EAAGpC,EAAOmd,OAAQpF,SAQxD1c,KAAK+wB,aAAarU,GACxBnd,EAAIwK,KAAK,uBAAwBpF,EAAOqE,QAG3BjJ,SAASwG,EAAqBmW,2CAC3Cnd,EAAIwK,KAAK,gBAAiBxD,EAAKyC,MAC/BhJ,KAAKkwB,WAAW3pB,EAAKC,KAAOwqB,SAAU7wB,KAAK0d,MAAOoS,UAAU,GAC5D,UACOjwB,KAAKowB,QAAQ7pB,EAAKyC,UAAMjC,EAAW,EAAGR,EAAKC,GAAIkW,GACrD1c,KAAKkwB,WAAW3pB,EAAKC,KAAOwqB,SAAU7wB,KAAK0d,OAC1C,MAAOza,GACR7D,EAAImG,MAAM,iBAAkBa,EAAKyC,KAAM5F,EAAE5C,aACpC,SAAU,UAAUoS,QAAcxP,EAAGC,OAAS,EAClDrD,KAAKkwB,WAAW3pB,EAAKC,KAAOwqB,SAAU7wB,KAAK0d,MAAOnY,MAAO,qDAEzD1F,KAAKkwB,WAAW3pB,EAAKC,KAAOwqB,SAAU7wB,KAAK0d,MAAOnY,MAAOtC,EAAE5C,eAKxDT,WAAWwG,2CAChB,GAAIvG,KAAKiwB,SACR,OAED1wB,EAAIwK,KAAK,sBAAuBxD,EAAKjJ,MACrC,MAAMof,EAAU1c,KAAK8wB,sBACf9wB,KAAKixB,SAAS1qB,EAAMmW,GAC1Bnd,EAAIwK,KAAK,qBAAsBxD,EAAKjJ,YAC9B0C,KAAK+wB,aAAarU,KAGnB3c,kDACL,GAAIC,KAAKiwB,SACR,OAED1wB,EAAIwK,KAAK,kBACT,MAAM2S,EAAU1c,KAAK8wB,gBACfzT,QAAcrd,KAAKqb,MAAM9U,KAAK+W,MACpC,IAAK,MAAM/W,KAAQ8W,QACZrd,KAAKixB,SAAS1qB,EAAMmW,GAE3Bnd,EAAIwK,KAAK,uBACH/J,KAAK+wB,aAAarU,KAGnB3c,aAAakO,iDAEZjO,KAAKgqB,YAGNjqB,gBAAgB4E,EAAyBusB,2CAC9C,MAAM1T,QAAgBxd,KAAKqb,MAAM1W,OAAO4W,QAAQ0G,OAAQtd,EAAOqE,OAC/D,IAAK,MAAMuR,KAAKiD,EACfjD,EAAEvR,KAAOuR,EAAEvR,KAAKnE,QAAQF,EAAOqE,KAAMkoB,SAC/BlxB,KAAKqb,MAAM1W,OAAOE,QAAQ0V,GAEjC,MAAMtM,QAAejO,KAAKqb,MAAMrQ,MAAMuQ,QAAQ0G,OAAQtd,EAAOqE,OAC7D,IAAK,MAAM/K,KAAKgQ,EACfhQ,EAAE+K,KAAO/K,EAAE+K,KAAKnE,QAAQF,EAAOqE,KAAMkoB,SAC/BlxB,KAAKqb,MAAMrQ,MAAMnG,QAAQ5G,GAEhC,MAAMsI,QAAavG,KAAKqb,MAAM9U,KAAKkY,KAAK9Z,EAAOmd,QAC3Cvb,UACGvG,KAAKwsB,WAAWjmB,uBC/LzBzJ,EAAAD,QAAAkC,QAAA,0BCAAjC,EAAAD,QAAAkC,QAAA,+cCCA,MAAAwD,EAAAtD,EAAAtC,EAAA,IAEAw0B,EAAAx0B,EAAA,IACAqe,EAAA/b,EAAAtC,EAAA,IACAwI,EAAAxI,EAAA,GAEM4C,EAAMyb,EAAA9b,QAAO,WA8DnBrC,EAAAuzB,QAAA,SAA8B7X,2CAC7B,MAAMzV,QAAaqC,EAAA1C,OAAO8V,GAC1B,OA1CD,SAAe6Y,EAAS7Y,EAAazV,2CACpCvD,EAAI0a,MAAM,qBAAsB1B,GAChC,MAAMrN,GACL5N,KAAMib,EACNzV,MACCytB,MAAOztB,EAAKytB,MAAM/Z,UAClB8Z,MAAOxtB,EAAKwtB,MAAM9Z,WAEnBwC,eACAH,UAEK2E,KACAtL,QAAa/M,EAAAtB,QAAQ0U,GAC3B,IAAK,MAAMjU,KAAY4N,EACtB,GAAoB,MAAhB5N,EAAS,GAAY,CACxB,MAAM2U,EAAM1W,EAAArD,QAAKoB,KAAKiY,EAAKjU,GACrB+sB,QAAgBlsB,EAAA1C,OAAOwW,GAC7B,GAAIoY,EAAQ9tB,cACXia,EAAQ3K,MAAM0F,IAAKU,EAAKnW,KAAMuuB,QACxB,CACN,MAAMtsB,GACLzH,KAAM2b,EACNjN,KAAMmlB,EAAA9Z,YAAY4B,GAClBnW,MACCytB,MAAOc,EAAQd,MAAM/Z,UACrB8Z,MAAOe,EAAQf,MAAM9Z,UACrB/K,KAAM4lB,EAAQ5lB,OAGhBP,EAAO2N,MAAMhG,KAAK9N,IAIrB,IAAK,MAAMJ,KAAU6Y,EAAS,CAC7B,MAAMvE,QAAYmY,EAASzsB,EAAO4T,IAAK5T,EAAO7B,MAC9CoI,EAAO8N,YAAYnG,KAAKoG,GAEzB,OAAO/N,IAKAkmB,CAAS7Y,EAAKzV,qBCvEtBhG,EAAAD,QAAAkC,QAAA,wcCGA,MAAAwD,EAAAtD,EAAAtC,EAAA,IAGM4C,EAFNN,EAAAtC,EAAA,IAEYuC,QAAO,YAkBnBrC,EAAAwzB,SAAA,SAA+B9X,EAAc8C,EAAcyG,2CAC1D,MAAM5W,EAMP,SAASomB,EAAM/Y,EAAc1P,EAA8BvJ,EAAewiB,GACzE,MAAM5W,GACL4W,SACAjZ,SACAvJ,QACAhC,KAAMib,EAAIjb,KACVwF,KAAMyV,EAAIzV,KACV6B,YAAQoC,EACR8R,MAAON,EAAIM,MAAM3R,IAAInC,KACZzH,KAAMyH,EAAKzH,KAAM0O,KAAMjH,EAAKiH,KAAMlJ,KAAMiC,EAAKjC,QAEtDkW,eACA2D,iBACAC,mBAGD,OADA1R,EAAO8N,YAAcT,EAAIS,YAAY9R,IAAI+R,GAAOqY,EAAMrY,EAAK/N,EAAQ5L,EAAQ,EAAGwiB,IACvE5W,EAtBkBomB,CAAM/Y,OAAKxR,EAAW,EAAG+a,GAGlD,OAFA5W,EAAOvG,aAAe0W,EAAM1W,OAAOsc,WAAWjY,KAAMuP,EAAIjb,aAwBzD,SAAei0B,EAAUhZ,EAAe8C,2CACvC9b,EAAI0a,MAAM,qBAAsB1B,EAAIjb,MACpC,MAAM2Q,QAAeoN,EAAMrQ,MAAMuQ,QAAQvS,KAAMuP,EAAIjb,OAUnD,GATA2Q,EAAO6K,QAAQ9N,IACd,MAAM1G,EAAW/B,EAAArD,QAAKoB,KAAK0K,EAAMhC,KAAMgC,EAAM1N,MACvCyH,EAAOwT,EAAIM,MAAM8B,KAAKJ,GAAKA,EAAEjd,OAASgH,GACxCS,EACHA,EAAKiG,MAAQA,EAEbuN,EAAIoE,cAAc9J,KAAK7H,KAGrBuN,EAAI5T,OAAQ,CACf,MAAM6Y,QAAgBnC,EAAM1W,OAAO4W,QAAQzS,SAAUyP,EAAI5T,OAAO6B,KAChE,IAAK,MAAMgrB,KAAahU,EAAS,CAChC,MAAMiU,EAASlZ,EAAIS,YAAY2B,KAAK+W,GAAMA,EAAGp0B,OAASk0B,EAAUxoB,MAC3DyoB,GAGJA,EAAO9sB,OAAS6sB,QACVD,EAAUE,EAAQpW,IAHxB9C,EAAIqE,eAAe/J,KAAK2e,OAxCrBD,CAAUrmB,EAAQmQ,GACjBnQ,mcCzBR,MAAA9F,EAAAzI,EAAA,GACA4F,EAAAtD,EAAAtC,EAAA,IAEAg1B,EAAAh1B,EAAA,IACAqe,EAAA/b,EAAAtC,EAAA,IACAi1B,EAAAj1B,EAAA,IAEM4C,EAAMyb,EAAA9b,QAAO,kBAkBNsxB,EAOZzwB,YAAY+hB,EAAgBzG,EAAc6P,EAAc2G,GAJxD7xB,KAAAywB,cAAgB,EAKfzwB,KAAKqb,MAAQA,EACbrb,KAAKkrB,MAAQA,EACblrB,KAAK6xB,WAAaA,EAClB7xB,KAAK8hB,OAASA,EAGP/hB,wBAAwBwY,GAC/B,OAASA,EAAI5T,QACX4T,EAAIzV,KAAKwtB,QAAU/X,EAAI5T,OAAO7B,KAAKgvB,UACnCvZ,EAAIzV,KAAKytB,QAAUhY,EAAI5T,OAAO7B,KAAK8G,UAClC+nB,EAAAI,YAAYxZ,EAAI5T,OAAOsE,IAAKsP,EAAItP,KAG5BlJ,uBAAuBgF,GAC9B,OAASA,EAAKiG,OACZjG,EAAKjC,KAAKwtB,QAAUvrB,EAAKiG,MAAMlI,KAAKgvB,UACpC/sB,EAAKjC,KAAKytB,QAAUxrB,EAAKiG,MAAMlI,KAAK8G,SACpC7E,EAAKjC,KAAK2I,OAAS1G,EAAKiG,MAAMlI,KAAK2I,KAGxB1L,UAAUwY,2CACvBhZ,EAAIwK,KAAK,aAAcwO,EAAIjb,MAC3B,MAAMqH,GACL6B,GAAI,GACJsb,OAAQvJ,EAAIuJ,OACZ9Y,KAAMuP,EAAIjb,KACVwL,SAAWyP,EAAI1P,QAAU0P,EAAI1P,OAAOlE,OAAS4T,EAAI1P,OAAOlE,OAAO6B,QAAKO,EACpEjE,MACC8G,QAAS2O,EAAIzV,KAAKytB,MAClBuB,SAAUvZ,EAAIzV,KAAKwtB,OAEpBrnB,IAAKsP,EAAItP,MAAQgF,OAAQ,EAAG3O,OAAQ,EAAG0M,KAAM5G,EAAAzE,WAAWgB,SACxDqK,KAAM5G,EAAAxE,aAAa+D,QAIpB,OAFAA,EAAO6B,SAAWxG,KAAKqb,MAAM1W,OAAOmZ,IAAInZ,GACxC4T,EAAI5T,OAASA,EACNA,IAGM5E,aAAawY,2CAC1B,MAAMyZ,EAAMzZ,EAAI5T,OAChB,IAAKqtB,EACJ,OAEDzyB,EAAIwK,KAAK,gBAAiBwO,EAAIjb,MAC9B,MAAMqH,GACL6B,GAAIwrB,EAAIxrB,GACRsb,OAAQvJ,EAAIuJ,OACZ9Y,KAAMuP,EAAIjb,KACVwL,SAAWyP,EAAI1P,QAAU0P,EAAI1P,OAAOlE,OAAS4T,EAAI1P,OAAOlE,OAAO6B,QAAKO,EACpEjE,MACC8G,QAAS2O,EAAIzV,KAAKytB,MAClBuB,SAAUvZ,EAAIzV,KAAKwtB,OAEpBrnB,IAAKsP,EAAItP,MAAQgF,OAAQ,EAAG3O,MAAOiZ,EAAIjZ,MAAO0M,KAAM5G,EAAAzE,WAAWgB,SAC/DqK,KAAM5G,EAAAxE,aAAa+D,OACnBoF,KAAMioB,EAAIjoB,MAGX,aADM/J,KAAKqb,MAAM1W,OAAOE,QAAQF,GACzBA,IAGM5E,WAAWgF,EAAiB8D,2CACzC7I,KAAKywB,gBACLzwB,KAAK6xB,WAAW7xB,KAAKywB,eACrB,MAAM1sB,QAAa/D,KAAKkrB,MAAM9V,KAAKrQ,EAAKzH,MACxC,OACCkJ,GAAI,GACJsb,OAAQ9hB,KAAK8hB,OACb/V,QAAS,GACT3C,SAAU,GACVN,SAAWD,EAASA,EAAOrC,GAAK,GAChClJ,KAAMiF,EAAArD,QAAK6J,SAAShE,EAAKzH,MACzB0L,KAAMzG,EAAArD,QAAKwuB,QAAQ3oB,EAAKzH,MACxBwF,MACC8G,QAAS7E,EAAKjC,KAAKytB,MACnBuB,SAAU/sB,EAAKjC,KAAKwtB,MACpB7kB,KAAM1G,EAAKjC,KAAK2I,MAEjBL,MAAOrH,EAAKqH,UACZnC,IAAKlF,EAAKkF,QACV+C,KAAM5G,EAAAxE,aAAaoK,SAIPjL,SAASgF,EAAiB8D,2CACvCtJ,EAAIwK,KAAK,YAAahF,EAAKzH,MAC3B,MAAM0N,QAAchL,KAAKiyB,WAAWltB,EAAM8D,GAE1C,OADAmC,EAAMxE,SAAWxG,KAAKqb,MAAMrQ,MAAM8S,IAAI9S,GAC/BA,IAGMjL,YAAYgF,EAAiB8D,2CAC1CtJ,EAAIwK,KAAK,eAAgBhF,EAAKzH,MAC9B,MAAM00B,EAAMjtB,EAAKiG,MACjB,IAAKgnB,EACJ,OAED,MAAMhnB,QAAchL,KAAKiyB,WAAWltB,EAAM8D,GAI1C,OAHAmC,EAAMxE,GAAKwrB,EAAIxrB,GACfwE,EAAMjB,KAAOioB,EAAIjoB,WACX/J,KAAKqb,MAAMrQ,MAAMnG,QAAQmG,GACxBA,IAGMjL,YAAYgF,EAAiBwT,EAAemE,EAAuB7T,2CAChF,GAAI9D,EAAKiH,OAAS5G,EAAAhD,QAAQmV,OAAU1O,EAGpC,GAAK9D,EAAKiG,MAIH,GAAIwlB,EAAO0B,gBAAgBntB,GAAO,CACxC,MAAMiG,QAAchL,KAAKmyB,YAAYptB,EAAM8D,GACvCmC,IACHjG,EAAKiG,MAAQA,EACb0R,EAAQK,aAAalK,MAAM7H,QAAOuN,cAGnCmE,EAAQM,gBAAgBnK,MAAM7H,MAAOjG,EAAKiG,MAAOuN,YAXjC,CAChB,MAAMvN,QAAchL,KAAKoyB,SAASrtB,EAAM8D,GACxC9D,EAAKiG,MAAQA,EACb0R,EAAQI,UAAUjK,MAAM7H,QAAOuN,WAYnBxY,YAAYwY,EAAemE,2CACxC,IAAK,MAAMzD,KAAOV,EAAIS,kBACfhZ,KAAKqyB,cAAcpZ,EAAKyD,GAE/B,IAAK,MAAM3X,KAAQwT,EAAIM,YAChB7Y,KAAKsyB,YAAYvtB,EAAMwT,EAAKmE,EAASnE,EAAI5T,UAInC5E,cAAcwY,EAAemE,2CAQ1C,GAPAnd,EAAI0a,MAAM,oBAAqB1B,EAAIjb,MACnCib,EAAIqE,eAAe9D,QAAQnU,IAC1B+X,EAAQE,eAAe/J,KAAKlO,KAE7B4T,EAAIoE,cAAc7D,QAAQ9N,IACzB0R,EAAQC,cAAc9J,KAAK7H,MAEvBuN,EAAI5T,OAAQ,CAChB,MAAMA,QAAe3E,KAAKuyB,UAAUha,GACpCmE,EAAQQ,WAAWrK,KAAKlO,SAEnB3E,KAAKwyB,YAAYja,EAAKmE,KAGf3c,gBAAgBwY,EAAemE,2CAC5C,IAAInE,EAAI5T,OAcP,OAAOhC,QAAQE,OAAO0S,MAAM,mCAAqCgD,EAAIjb,OAbrE,GAAIkzB,EAAOiC,iBAAiBla,GAAM,CACjC,MAAMxU,QAAa/D,KAAK0yB,aAAana,GACjCxU,IACH2Y,EAAQS,cAActK,KAAK9O,GAC3BwU,EAAI5T,OAASZ,QAGd2Y,EAAQU,iBAAiBvK,KAAK0F,EAAI5T,QAEnC,IAAK,MAAMtH,KAAKkb,EAAIS,kBACbhZ,KAAK2yB,gBAAgBt1B,EAAGqf,KAO3B3c,MAAMwY,EAAemE,iDACpB1c,KAAKqyB,cAAc9Z,EAAKmE,GAC9BkV,EAAA7W,cAAcxC,SACRvY,KAAK2yB,gBAAgBpa,EAAKmE,MAlLlC7f,EAAA2zB,wFC5BA3zB,EAAAk1B,YAAA,SAAgBA,EAAY/Z,EAAQC,EAAQ2a,GAC3C,MAAMC,EAA4BD,MAC5BE,EAAU,CAACC,EAASC,KACzB,QAAUjsB,IAANiR,EACH,OAAO,EAER,QAAUjR,IAANkR,EACH,OAAO,EAER,GAAkB,iBAAP8a,GACV,IAAKhB,EAAYgB,EAAIC,EAAIJ,GACxB,OAAO,OAEF,GAAIG,IAAOC,EACjB,OAAO,EAER,OAAO,GAER,QAAUjsB,IAANiR,EACH,OAAO,EAER,QAAUjR,IAANkR,EACH,OAAO,EAER,IAAI3Z,EACJ,IAAKA,KAAO0Z,EACX,GAAIA,EAAEpZ,eAAeN,IAAQu0B,EAAWjgB,QAAQtU,GAAO,IACjDw0B,EAAQ9a,EAAE1Z,GAAM2Z,EAAE3Z,IACtB,OAAO,EAIV,IAAKA,KAAO2Z,EACX,GAAIA,EAAErZ,eAAeN,IAAQu0B,EAAWjgB,QAAQtU,GAAO,IACjDw0B,EAAQ9a,EAAE1Z,GAAM2Z,EAAE3Z,IACtB,OAAO,EAIV,OAAO,icCtCR,MAAA8G,EAAAzI,EAAA,GAEAqe,EAAA/b,EAAAtC,EAAA,IAEAqzB,EAAArzB,EAAA,IACAi1B,EAAAj1B,EAAA,IAGM4C,EAAMyb,EAAA9b,QAAO,iBAEN0xB,EAIZ7wB,YAAYsb,EAAczC,GACzB5Y,KAAKqb,MAAQA,EACbrb,KAAK4Y,OAASA,EAGP7Y,2BAA2BkzB,GAClC,OAAIA,EAAU1a,IAAI5T,QAAUsuB,EAAU1a,IAAI5T,OAAOsE,IAAIuR,YAAcpV,EAAAjD,UAAUsY,SAC5E,EAEOwY,EAAUjoB,MAAM/B,IAAIiqB,iBAAmBD,EAAUjoB,MAAM/B,IAAIyP,WAI5D3Y,yBAAyBkzB,GAChC,OAAIA,EAAU1a,IAAI5T,QAAUsuB,EAAU1a,IAAI5T,OAAOsE,IAAIuR,YAAcpV,EAAAjD,UAAUsY,SAC5E,EAEOwY,EAAUjoB,MAAM/B,IAAIwP,WAIrB1Y,qBAAqBkzB,GAC5B,OAAIA,EAAU1a,IAAI5T,QAAUsuB,EAAU1a,IAAI5T,OAAOsE,IAAIuR,YAAcpV,EAAAjD,UAAUsY,IACrEwY,EAAU1a,IAAI5T,OAAOsE,IAAIrH,QAAUgwB,EAAA/W,eAEnCoY,EAAUjoB,MAAM/B,IAAIkqB,aAAeF,EAAUjoB,MAAM/B,IAAIrH,QAAUgwB,EAAA/W,eAIlE9a,oBAAoBkzB,GAC3B,OAAIA,EAAU1a,IAAI5T,QAAUsuB,EAAU1a,IAAI5T,OAAOsE,IAAIuR,YAAcpV,EAAAjD,UAAUsY,IACrEwY,EAAU1a,IAAI5T,OAAOsE,IAAInH,OAAS8vB,EAAA9W,cAElCmY,EAAUjoB,MAAM/B,IAAInH,OAAS8vB,EAAA9W,cAIxB/a,WAAWkzB,2CACxB,MAAM31B,EAAOszB,EAAUwC,cAAcH,GAC/Bva,EAAaua,EAAUjoB,MAAM/B,IAAIiqB,iBAAmBD,EAAUjoB,MAAM/B,IAAIyP,WAC9E,GAAIA,EAAY,CACf,MAAM9W,QAAe5B,KAAKqb,MAAMzZ,OAAOqf,WAAWvI,eAClD,GAAI9W,EACH,OAAOA,EAGT,OAAO5B,KAAKqb,MAAMzZ,OAAOqf,WAAW3jB,WAGvByC,UAAUkzB,2CACvB,MAAM31B,EAAOszB,EAAUwC,cAAcH,GAC/BrxB,QAAe5B,KAAKqzB,WAAWJ,GACrC,GAAIrxB,EAMH,OALAA,EAAO2H,SAASsJ,KAAKogB,EAAUjoB,MAAMxE,IACjC5E,EAAO0xB,QAAQ1gB,QAAQqgB,EAAUjoB,MAAM8W,QAAU,GACpDlgB,EAAO0xB,QAAQzgB,KAAKogB,EAAUjoB,MAAM8W,cAE/B9hB,KAAKqb,MAAMzZ,OAAOiD,QAAQjD,GACzBA,EAAO4E,GACR,CACN,MAAMwR,GACLxR,GAAI,GACJwF,KAAM5G,EAAAxE,aAAagB,OACnB0xB,SAAUL,EAAUjoB,MAAM8W,QAC1BxkB,KAAMA,EACNi2B,SAAU3C,EAAU4C,kBAAkBP,GACtCnpB,YACA4O,WAAYkY,EAAU6C,oBAAoBR,GAC1C1pB,UAAW0pB,EAAUjoB,MAAMxE,IAC3BoD,QAASzJ,KAAK0d,OAIf,OAFAte,EAAI0a,MAAM,aAAcjC,EAAE1a,MAC1B0a,EAAExR,SAAWxG,KAAKqb,MAAMzZ,OAAOkc,IAAI9F,GAC5BA,EAAExR,MAIGzG,gBAAgBiL,2CAC7B,MAAMpJ,QAAe5B,KAAKqb,MAAMzZ,OAAOqf,WAAWG,QAASpW,EAAMxE,KAC7D5E,IACHA,EAAO2H,SAAW3H,EAAO2H,SAAS8O,OAAO7R,GAAMA,IAAOwE,EAAMxE,IAC7B,IAA3B5E,EAAO2H,SAASC,cACbxJ,KAAKqb,MAAMzZ,OAAO8Z,OAAO9Z,EAAO4E,UAChCxG,KAAKqb,MAAMnT,MAAMyT,eAAe+E,OAAQ9e,EAAO4E,GAAIwF,KAAM5G,EAAAxE,aAAagB,gBAEtE5B,KAAKqb,MAAMzZ,OAAOiD,QAAQjD,MAKrB7B,cAAckzB,2CAC3B,MAAMrxB,QAAe5B,KAAKqzB,WAAWJ,GACrC,OAAIrxB,GAAWA,EAAO2H,SAASqJ,QAAQqgB,EAAUjoB,MAAMxE,KAAO,EAEtD5E,EAAO4E,UAETxG,KAAK0zB,gBAAgBT,EAAUjoB,OAC9BhL,KAAK2zB,UAAUV,MAGTlzB,UAAUkzB,EAA2B7pB,2CAClD,MAAM9L,EAAOszB,EAAUgD,aAAaX,GACpC,GAAIA,EAAUjoB,MAAM/B,IAAI0P,UAAW,CAClC,MAAM7W,QAAc9B,KAAKqb,MAAMvZ,MAAMmf,WAAWtI,UAAWsa,EAAUjoB,MAAM/B,IAAI0P,YAC/E,GAAI7W,EACH,OAAOA,EAGT,OAAO9B,KAAKqb,MAAMvZ,MAAMmf,WAAW3jB,OAAM8L,eAG5BrJ,YAAYkzB,EAA2B7pB,2CACpD,MAAM9L,EAAOszB,EAAUgD,aAAaX,GAC9BnxB,QAAc9B,KAAK6zB,UAAUZ,EAAW7pB,GAC9C,GAAItH,EAOH,OANAA,EAAMyH,SAASsJ,KAAKogB,EAAUjoB,MAAMxE,IAChC1E,EAAMwxB,QAAQ1gB,QAAQqgB,EAAUjoB,MAAM8W,QAAU,GACnDhgB,EAAMwxB,QAAQzgB,KAAKogB,EAAUjoB,MAAM8W,QAEpChgB,EAAM2H,UAAawpB,EAAUjoB,MAAMI,MAAM3B,UAAY,QAC/CzJ,KAAKqb,MAAMvZ,MAAM+C,QAAQ/C,GACxBA,EAAM0E,GACP,CACN,MAAMwR,GACLxR,GAAI,GACJwF,KAAM5G,EAAAxE,aAAakB,MACnBxE,KAAMA,EACNsE,OAAQgvB,EAAUwC,cAAcH,GAChC7pB,SAAUA,EACVsP,WAAYkY,EAAU6C,oBAAoBR,GAC1Cta,UAAWsa,EAAUjoB,MAAM/B,IAAI0P,UAC/BhP,MAAOspB,EAAUjoB,MAAM/B,IAAIU,MAC3BJ,UAAW0pB,EAAUjoB,MAAMxE,IAC3B8sB,SAAUL,EAAUjoB,MAAM8W,QAC1BpY,KAAMupB,EAAUjoB,MAAM/B,IAAIS,KAC1BD,SAAUwpB,EAAUjoB,MAAMI,MAAM3B,UAAY,EAC5CG,QAASzJ,KAAK0d,OAEfte,EAAI0a,MAAM,YAAajC,EAAE1a,MACzB0a,EAAExR,SAAWxG,KAAKqb,MAAMvZ,MAAMgc,IAAI9F,GAClC,MAAMpW,QAAe5B,KAAKqb,MAAMzZ,OAAO6c,KAAKrV,GAK5C,OAJIxH,IACHA,EAAOkI,SAAS+I,KAAKmF,EAAExR,UACjBxG,KAAKqb,MAAMzZ,OAAOiD,QAAQjD,IAE1BoW,EAAExR,MAIGzG,eAAeiL,2CAC5B,MAAMlJ,QAAc9B,KAAKqb,MAAMvZ,MAAMmf,WAAWG,QAASpW,EAAMxE,KAC/D,GAAI1E,EAGH,GAFAA,EAAMyH,SAAWzH,EAAMyH,SAAS8O,OAAO7R,GAAMA,IAAOwE,EAAMxE,IAC1D1E,EAAM2H,UAAauB,EAAMI,MAAM3B,UAAY,EACb,IAA1B3H,EAAMyH,SAASC,OAAc,CAChC,MAAM5H,QAAe5B,KAAKqb,MAAMzZ,OAAO6c,KAAK3c,EAAMsH,UAC9CxH,IACHA,EAAOkI,SAAWlI,EAAOkI,SAASuO,OAAO7R,GAAMA,IAAO1E,EAAM0E,UACtDxG,KAAKqb,MAAMzZ,OAAOiD,QAAQjD,SAC1B5B,KAAKqb,MAAMvZ,MAAM4Z,OAAO5Z,EAAM0E,UAC9BxG,KAAKqb,MAAMnT,MAAMyT,eAAe+E,OAAQ5e,EAAM0E,GAAIwF,KAAM5G,EAAAxE,aAAakB,oBAGtE9B,KAAKqb,MAAMvZ,MAAM+C,QAAQ/C,KAKpB/B,UAAUkzB,EAA2B7pB,2CAClD,MAAMtH,QAAc9B,KAAK6zB,UAAUZ,EAAW7pB,GAC1CtH,GAAUA,EAAMyH,SAASqJ,QAAQqgB,EAAUjoB,MAAMxE,KAAO,UAItDxG,KAAK8zB,eAAeb,EAAUjoB,aAC9BhL,KAAK+zB,YAAYd,EAAW7pB,MAGrBrJ,QAAQi0B,2CACrB,MAAMC,KACAC,KAENF,EAAWlb,QAAQma,IAClB,MAAM31B,EAAOszB,EAAUwC,cAAcH,GACjC31B,GAAQA,EAAKkM,OAAS,IACzByqB,EAAmB32B,GAAQ22B,EAAmB32B,OAC9C22B,EAAmB32B,GAAMuV,KAAKogB,MAIhC,IAAK,MAAM31B,KAAQG,OAAOma,KAAKqc,GAAqB,CACnD,MAAMryB,QAAe5B,KAAKqb,MAAMzZ,OAAOqf,WAAW3jB,SAC5C62B,EAAWF,EAAmB32B,GACpC,GAAIsE,EACHuyB,EAASrb,QAAQ7a,IAChBA,EAAE+M,MAAM5B,SAAWxH,EAAO4E,KAE3B0tB,EAAatyB,EAAO4E,IAAO0tB,EAAatyB,EAAO4E,MAAQ5E,SAAQqM,UAAYmmB,YAAY,GACvFF,EAAatyB,EAAO4E,IAAIyH,OAASimB,EAAatyB,EAAO4E,IAAIyH,OAAO5N,OAAO8zB,GACvED,EAAatyB,EAAO4E,IAAI4tB,YAAa,EACrCxyB,EAAO2H,SAAW3H,EAAO2H,SAASlJ,OAAO8zB,EAASjtB,IAAIjJ,GAAKA,EAAE+M,MAAMxE,KACnE2tB,EAASrb,QAAQ7a,IACZ2D,EAAO0xB,QAAQ1gB,QAAQ3U,EAAE+M,MAAM8W,QAAU,GAC5ClgB,EAAO0xB,QAAQzgB,KAAK5U,EAAE+M,MAAM8W,cAIxB,CACN,MAAM9J,GACLxR,GAAI,GACJwF,KAAM5G,EAAAxE,aAAagB,OACnBtE,KAAMszB,EAAUwC,cAAce,EAAS,IACvCZ,SAAU3C,EAAU4C,kBAAkBW,EAAS,IAC/Cb,WACAxpB,YACA4O,WAAYkY,EAAU6C,oBAAoBU,EAAS,IACnD5qB,SAAU4qB,EAASjtB,IAAIjJ,GAAKA,EAAE+M,MAAMxE,IACpCoD,QAASzJ,KAAK0d,OAEfsW,EAASrb,QAAQ7a,IACZ+Z,EAAEsb,QAAQ1gB,QAAQ3U,EAAE+M,MAAM8W,QAAU,GACvC9J,EAAEsb,QAAQzgB,KAAK5U,EAAE+M,MAAM8W,UAGzBviB,EAAI0a,MAAM,aAAcjC,EAAE1a,MAC1B0a,EAAExR,SAAWxG,KAAKqb,MAAMzZ,OAAOkc,IAAI9F,GACnCkc,EAAalc,EAAExR,KAAO5E,OAAQoW,EAAG/J,OAAQkmB,EAAUC,YAAY,GAC/DD,EAASrb,QAAQ7a,IAChBA,EAAE+M,MAAM5B,SAAW4O,EAAExR,MAKxB,IAAK,MAAM4C,KAAa3L,OAAOma,KAAKsc,GAAe,CAClD,MAAMG,EAAiBH,EAAa9qB,GAC9BkrB,KACND,EAAepmB,OAAO6K,QAAQma,IAC7B,MAAM31B,EAAOszB,EAAUgD,aAAaX,GACpCqB,EAAYh3B,GAAQg3B,EAAYh3B,OAChCg3B,EAAYh3B,GAAMuV,KAAKogB,KAExB,IAAK,MAAM31B,KAAQG,OAAOma,KAAK0c,GAAc,CAC5C,MAAMC,EAAUD,EAAYh3B,GACtBwE,QAAc9B,KAAKqb,MAAMvZ,MAAMmf,WAAW3jB,OAAM8L,aACtD,GAAItH,EACHA,EAAMyH,SAAWzH,EAAMyH,SAASlJ,OAAOk0B,EAAQrtB,IAAIjJ,GAAKA,EAAE+M,MAAMxE,KAChE+tB,EAAQzb,QAAQ7a,IACfA,EAAE+M,MAAMe,QAAUjK,EAAM0E,GACxB1E,EAAM2H,UAAaxL,GAAKA,EAAE+M,OAAS/M,EAAE+M,MAAMI,OAASnN,EAAE+M,MAAMI,MAAM3B,SAAWxL,EAAE+M,MAAMI,MAAM3B,SAAW,EAClG3H,EAAMwxB,QAAQ1gB,QAAQ3U,EAAE+M,MAAM8W,QAAU,GAC3ChgB,EAAMwxB,QAAQzgB,KAAK5U,EAAE+M,MAAM8W,UAG7BviB,EAAI0a,MAAM,eAAgBnY,EAAMxE,MAChC+2B,EAAezyB,OAAOkI,SAAS+I,KAAK/Q,EAAM0E,IAC1C6tB,EAAeD,YAAa,EAC5BC,EAAepmB,OAAO6K,QAAQ7a,IAC7BA,EAAE+M,MAAMe,QAAUjK,EAAM0E,GACpB1E,EAAMwxB,QAAQ1gB,QAAQ3U,EAAE+M,MAAM8W,QAAU,GAC3ChgB,EAAMwxB,QAAQzgB,KAAK5U,EAAE+M,MAAM8W,gBAGvB9hB,KAAKqb,MAAMvZ,MAAM+C,QAAQ/C,OACzB,CACN,MAAMkW,GACLxR,GAAI,GACJwF,KAAM5G,EAAAxE,aAAakB,MACnBxE,KAAMA,EACNg2B,WACA1xB,OAAQgvB,EAAUwC,cAAcmB,EAAQ,IACxCnrB,SAAUA,EACVsP,WAAYkY,EAAU6C,oBAAoBc,EAAQ,IAClD5b,UAAW4b,EAAQ,GAAGvpB,MAAM/B,IAAI0P,UAChChP,MAAO4qB,EAAQ,GAAGvpB,MAAM/B,IAAIU,MAC5BJ,SAAUgrB,EAAQrtB,IAAIjJ,GAAKA,EAAE+M,MAAMxE,IACnCkD,KAAM6qB,EAAQ,GAAGvpB,MAAM/B,IAAIS,KAC3BD,SAAU8qB,EAAQ7gB,OAAO,CAACuE,EAAG7a,IAAO6a,GAAK7a,GAAKA,EAAE4N,OAAS5N,EAAE4N,MAAMI,OAAShO,EAAE4N,MAAMI,MAAM3B,SAAWrM,EAAE4N,MAAMI,MAAM3B,SAAW,GAAK,GACjIG,QAASzJ,KAAK0d,OAEf0W,EAAQzb,QAAQ7a,IACX+Z,EAAEsb,QAAQ1gB,QAAQ3U,EAAE+M,MAAM8W,QAAU,GACvC9J,EAAEsb,QAAQzgB,KAAK5U,EAAE+M,MAAM8W,UAGzBviB,EAAI0a,MAAM,YAAajC,EAAE1a,MACzB0a,EAAExR,SAAWxG,KAAKqb,MAAMvZ,MAAMgc,IAAI9F,GAClCqc,EAAezyB,OAAOkI,SAAS+I,KAAKmF,EAAExR,IACtC6tB,EAAepmB,OAAO6K,QAAQ7a,IAC7BA,EAAE+M,MAAMe,QAAUiM,EAAExR,KAErB6tB,EAAeD,YAAa,IAK/B,IAAK,MAAMhrB,KAAY3L,OAAOma,KAAKsc,GAAe,CACjD,MAAMG,EAAiBH,EAAa9qB,GAChCirB,EAAeD,aAClB70B,EAAI0a,MAAM,gBAAiBoa,EAAezyB,OAAOtE,YAC3C0C,KAAKqb,MAAMzZ,OAAOiD,QAAQwvB,EAAezyB,SAIjD,IAAK,MAAMqxB,KAAae,GACnBf,EAAUjoB,MAAMe,SAAWknB,EAAUjoB,MAAM5B,YAC9C7J,EAAI0a,MAAM,eAAgBgZ,EAAUjoB,MAAM1N,YACpC0C,KAAKqb,MAAMrQ,MAAMnG,QAAQouB,EAAUjoB,UAK9BjL,QAAQkzB,2CACrB,MAAMzsB,QAAWxG,KAAKw0B,cAAcvB,SAC9BjzB,KAAKy0B,UAAUxB,EAAWzsB,KAG3BzG,KAAK2c,2CAEV,MAAMsX,EAAatX,EAAQI,UAAUzc,OAAOqc,EAAQM,gBAAgB3E,OAAOpa,IAAOA,EAAE+M,MAAMe,UAAY9N,EAAE+M,MAAM5B,iBACxGpJ,KAAK00B,QAAQV,GACnB,IAAK,MAAMf,KAAavW,EAAQK,mBACzB/c,KAAK20B,QAAQ1B,SAEdjD,EAAA5U,SAASpb,KAAKqb,MAAOrb,KAAK4Y,OAAQ8D,EAAQC,kBAvUlD9f,EAAA+zB,0cCVA,MAAAgE,EAAA31B,EAAAtC,EAAA,KACAyI,EAAAzI,EAAA,GACAk4B,EAAAl4B,EAAA,IACAqe,EAAA/b,EAAAtC,EAAA,IACAm4B,EAAAn4B,EAAA,IAEAo4B,EAAAp4B,EAAA,IAEM4C,EAAMyb,EAAA9b,QAAO,cAEnBrC,EAAAkmB,gBAMChjB,YAAYX,GACXY,KAAKg1B,OAAS,IAAIJ,EAAA11B,QAAc+1B,QAAQC,KAAM91B,EAAOyjB,SAASrR,QAAQ2jB,cAAcD,KAAM31B,IAAKH,EAAOyjB,SAASrR,QAAQ2jB,cAAc51B,MACrIS,KAAKo1B,SAAW,IAAIP,EAAAQ,WAAWr1B,KAAKg1B,QACpCh1B,KAAKs1B,YAAcl2B,EAAOyjB,SAASrR,QAAQ2jB,cAAcG,YACzDt1B,KAAKu1B,aAAen2B,EAAOyjB,SAASrR,QAAQ2jB,cAAcI,aAGrDx1B,gDACLC,KAAKg1B,OAAO5R,UAGPrjB,+CACL,UACOC,KAAKg1B,OAAOQ,MAAgCC,eAAgB,MACjE,MAAOryB,GAER,OADA7D,EAAImG,MAAM,uCAAwCtC,GAC3CT,QAAQE,OAAOO,MAIlBrD,+CACLR,EAAIwK,KAAK,0CACH/J,KAAKo1B,SAAS5U,KAAKxgB,KAAKg1B,cACxBh1B,KAAKw1B,aACLx1B,KAAKkjB,UAGNnjB,mDAEL,aADyBC,KAAKo1B,SAASx3B,IAAIoC,KAAK01B,UAAU,QAChDl1B,aAGXT,UAAUzC,GACT,OAAO0C,KAAKs1B,YAAc,IAAMh4B,EAGzByC,WACP,OAAOtC,OAAOma,KAAKxS,EAAAxE,cACjByX,OAAO/Z,IAAQ+M,MAAMqc,OAAOppB,KAC5B4I,IAAI5I,GAAOmI,SAASnI,EAAK,KAGdyB,WAAWiM,2CACxB,MAAMzD,EAAQvI,KAAK01B,UAAUtwB,EAAAxE,aAAaoL,WACrBhM,KAAKg1B,OAAOW,QAAQC,QAAQrtB,mBAE1CvI,KAAKg1B,OAAOW,QAAQE,QAAQttB,aAI9BxI,gDACL,IAAK,MAAMiM,KAAQhM,KAAK81B,iBACjB91B,KAAK+1B,WAAW/pB,KAIVjM,YAAYiM,2CACzB,MAAM1O,EAAO8H,EAAAxE,aAAaoL,GAC1B,IAAK8oB,EAAAkB,QAAQ14B,GACZ,OAAOqF,QAAQE,OAAOF,QAAQE,OAAO,0CAA4CvF,IAElF,MAAMiL,EAAQvI,KAAK01B,UAAUp4B,GACvBH,GACN84B,WAAkBA,WAAcC,gBAAkB,KAClD/4B,EAAEG,GAAQw3B,EAAAkB,QAAQ14B,SACZ0C,KAAKg1B,OAAOW,QAAQt3B,QAAQkK,QAAOwJ,MAAOokB,SAAYh5B,OAG/C4C,WAAWiM,2CACxB,MAAM1O,EAAO8H,EAAAxE,aAAaoL,GACpBzD,EAAQvI,KAAK01B,UAAUp4B,GAE7B,cADqB0C,KAAKg1B,OAAOW,QAAQC,QAAQrtB,mBAE1CvI,KAAKo2B,YAAYpqB,IAChB,KAKHjM,gDACL,IAAIs2B,GAAY,EAChB,IAAK,MAAMrqB,KAAQhM,KAAK81B,WACvBO,SAAkBr2B,KAAKs2B,WAAWtqB,KAASqqB,EAExCA,UACGtB,EAAAwB,KAAK,QAINx2B,WAAwCiM,GAC9C,OAAO,IAAIwqB,EAAkBxqB,EAAMhM,cAIxBw2B,EAMZz2B,YAAYiM,EAAoBoS,GAC/Bpe,KAAKgM,KAAOA,OACCjF,IAATiF,GACHhM,KAAKy2B,OAASrY,EAAGsX,UAAU,KAC3B11B,KAAK02B,MAAQ,KAEb12B,KAAK02B,MAAQtxB,EAAAxE,aAAaoL,GAC1BhM,KAAKy2B,OAASrY,EAAGsX,UAAUtwB,EAAAxE,aAAaoL,KAEzChM,KAAKoe,GAAKA,EAGHre,QAAQ42B,GAGf,OAFAA,EAAIC,QAAQpwB,GAAKmwB,EAAIC,QAAQpwB,GAAGhG,WAChCm2B,EAAIC,QAAQ5qB,KAAO5G,EAAAxE,aAAa+1B,EAAID,OAC1BC,EAAIC,QAGP72B,iBAAiBvC,GACxB,MAAM0N,EAAczN,OAAO2I,UAAW5I,GAEtC,OADA0N,EAAOc,UAAOjF,EACPmE,EAGAnL,sBAAsB2e,GAC7B,GAAIA,EAAMpB,IACT,OAAQuZ,cAET,IAAIC,KACJ,GAAIpY,EAAMS,KAAM,CACf,MAAM3hB,EAAIkhB,EAAMS,KAChB2X,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,GAAOd,EAAEc,IACN6gB,KAAQA,MAInB,GAAIT,EAAMxK,MAAO,CAChB,MAAM1W,EAAIkhB,EAAMxK,MAChB4iB,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,GAAOd,EAAEc,IACN4V,MAASiL,MAIpB,GAAIT,EAAMY,MAAO,CAChB,MAAM9hB,EAAIkhB,EAAMY,MAChBwX,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,GAAOd,EAAEc,IACNghB,MAASH,MAIpB,GAAIT,EAAMU,WAAY,CACrB,MAAM5hB,EAAIkhB,EAAMU,WAChB0X,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,IAAQogB,MAASlhB,EAAEc,GAAMy4B,eAAkB,MACxCC,oBAAuB7X,MAIlC,GAAIT,EAAMW,YAAa,CACtB,MAAM7hB,EAAIkhB,EAAMW,YAChByX,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,IAAQogB,MAASlhB,EAAEc,GAAMy4B,eAAkB,MACxCC,oBAAuB7X,MAIlC,GAAIT,EAAMgB,MAAO,CAChB,MAAMliB,EAAIkhB,EAAMgB,MAChBoX,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM24B,EAAOz5B,EAAEc,GACT6gB,KAEN,OADAA,EAAK7gB,IAAQmhB,IAAOwX,EAAKxX,IAAKD,IAAOyX,EAAKzX,MAClCE,MAASP,MAIpB,GAAIT,EAAMa,QAAS,CAClB,MAAM/hB,EAAIkhB,EAAMa,QAChBuX,EAAOA,EAAKz2B,OAAO7C,EAAE0J,IAAI5I,KAChBs3B,QAAW1W,MAAS5gB,OAG9B,OACC44B,MACCJ,KAAMA,IAKK/2B,OAAO+R,EAA2CqlB,2CAC/D,IAAItf,EAAQ,EACZ,MAAMmd,EAASh1B,KAAKoe,GAAG4W,aAEvB,SAAeoC,EAAiBrnB,2CAC/B8H,GAAS9H,EAAIsnB,KAAKA,KAAK7tB,aACjB2tB,EAAOpnB,EAAIsnB,KAAKA,MAClBtnB,EAAIsnB,KAAKC,QAAUzf,GAAS9H,EAAIwnB,mBAG7BH,QADapC,EAAOwC,QAAWC,SAAU1nB,EAAIwnB,WAAYC,OAAQ,YAKnEJ,CAAiBtlB,KAGlB/R,IAAIgS,2CACT,MAAMvL,QAAWxG,KAAKoe,GAAGsZ,WASzB,OARA3lB,EAAKvL,GAAKA,QACJxG,KAAKoe,GAAG4W,OAAOzsB,OACpBA,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,KAAM/R,KAAK23B,iBAAiB5lB,GAC5BvL,KACAwjB,QAAgChqB,KAAKoe,GAAGmX,eAElC/uB,IAGFzG,QAAQyG,EAAYuL,iDACnB/R,KAAKoe,GAAG4W,OAAOzsB,OACpBA,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,KAAM/R,KAAK23B,iBAAiB5lB,GAC5BvL,KACAwjB,QAAgChqB,KAAKoe,GAAGmX,iBAIpCx1B,OAAOyG,EAAYuL,2CACnBvL,GAAoB,IAAdA,EAAGgD,aAIRxJ,KAAKoe,GAAG4W,OAAOzsB,OACpBA,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,KAAM/R,KAAK23B,iBAAiB5lB,GAC5BvL,KACAwjB,QAAgChqB,KAAKoe,GAAGmX,qBARlCv1B,KAAK8d,IAAI/L,KAYXhS,cAAc2e,2CASnB,aARuB1e,KAAKoe,GAAG4W,OAAO4C,eACrCrvB,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,IAEnCsL,QAAgChqB,KAAKoe,GAAGmX,gBAEzBliB,UAGXtT,OAAOyG,2CACZ,GAAkB,IAAdA,EAAGgD,OACN,OAAO7G,QAAQC,UAEZklB,MAAMC,QAAQvhB,SACXxG,KAAKoe,GAAG4W,OAAO4C,eACpBrvB,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,MACC2M,OACCY,OACCwY,IAAOtxB,KAIVwjB,QAAgChqB,KAAKoe,GAAGmX,qBAGnCv1B,KAAKoe,GAAG4W,OAAOa,QACpBttB,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACXlwB,GAAYA,EACZwjB,QAAgChqB,KAAKoe,GAAGmX,iBAKrCx1B,KAAKyG,2CACV,QAAkBO,IAAd/G,KAAKgM,KACR,aAAahM,KAAK+e,UAAUI,MAAO3Y,GAAIA,KAEvC,IACC,MAAMsL,QAAiB9R,KAAKoe,GAAG4W,OAAOp3B,KACrC2K,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACXlwB,GAAIA,IAEL,OAAKsL,EAASimB,MAGN/3B,KAAKg4B,QAAQlmB,QAFpB,EAIA,MAAO1O,GACa,MAAjBA,EAAEiS,YACL1S,QAAQE,OAAOO,MAMbrD,MAAMic,2CACX,GAAmB,IAAfA,EAAIxS,OACP,SAED,MAAMsI,QAAiB9R,KAAKoe,GAAG4W,OAAOiD,MACrC1vB,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,MAAOiK,IAAOA,KAEf,OAAKlK,EAASomB,KAGPpmB,EAASomB,KAAK7f,OAAQ8f,GACrBA,EAAIJ,OACT7wB,IAAKixB,GACAn4B,KAAKg4B,QAAQG,SAIhBp4B,MAAM2e,2CACX,IAAIxM,KACJ,MAAMJ,QAAiB9R,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACXc,OAAQ,MACR/rB,KAAM,IACNsG,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,MAMpC,aAHM1e,KAAKw3B,OAAO1lB,EAAiBulB,GAAQ5Z,EAAAzd,UAAA,qBAC1CkS,EAAOA,EAAK7R,OAAOg3B,EAAKnwB,IAAIlH,KAAKg4B,aAE3B9lB,IAGFnS,SAAS2e,2CACd,MAAM5M,QAAiB9R,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,MAGpC,GAAI5M,EAASulB,KAAKC,MAAQ,EACzB,OAAOt3B,KAAKg4B,QAAQlmB,EAASulB,KAAKA,KAAK,MAKnCt3B,QAAQ2e,EAA+B0Z,2CAC5C,MAAMtmB,QAAiB9R,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACXc,OAAQ,MACR/rB,KAAM,IACNsG,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,YAG9B1e,KAAKw3B,OAAO1lB,EAAiBulB,GAAQ5Z,EAAAzd,UAAA,2BACpCo4B,EAAOf,EAAKnwB,IAAIlH,KAAKg4B,eAIvBj4B,SAAS2e,2CACd,IAAIxM,KACJ,MAAMJ,QAAiB9R,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACXc,OAAQ,MACRzlB,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,GAClC2Z,oBAMF,aAHMr4B,KAAKw3B,OAAO1lB,EAAiBulB,GAAQ5Z,EAAAzd,UAAA,qBAC1CkS,EAAOA,EAAK7R,OAAOg3B,EAAKnwB,IAAIyvB,GAAOA,EAAImB,IAAIt3B,gBAErC0R,IAGFnS,UAAU2e,EAA+BQ,2CAe9C,aAduBlf,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,GAClC4Z,MACCC,QACCC,aACCtZ,MAASA,SAMEuZ,aAAaF,OAAOv6B,QAG/B+B,MAAM2e,2CASX,aARuB1e,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACXjrB,KAAM,EACNsG,MACC2M,MAAO1e,KAAK63B,sBAAsBnZ,OAGpB2Y,KAAKC,QAGhBv3B,SAAS24B,2CAMd,aALuB14B,KAAKoe,GAAG4W,OAAOzZ,QACrChT,MAAOvI,KAAKy2B,OACZzqB,KAAMhM,KAAK02B,MACX3kB,MAAOumB,MAAShW,UAAahD,OAAUJ,MAASwZ,SAEjCD,aAAanW,SAASqW,QAAQzxB,IAAKyvB,GAAaA,EAAIr4B,QAvVtEzB,EAAA25B,gCC/GA15B,EAAAD,QAAAkC,QAAA,gGCEA,MAAM65B,GACLhC,SAAUiC,SAAS,GACnBC,MAAOD,SAAS,GAEhBA,SAAS,GA2JV,SAASE,EAASjhB,GACjB,MAAsB,iBAARA,EAGf,SAASkhB,EAAWlhB,GACnB,MAAsB,mBAARA,EAGf,SAASmhB,EAAsBjE,GAC9B,UAAW+D,EAAS/D,IAAYgE,EAAWhE,MACxC+D,EAAS/D,EAAOW,UAAaqD,EAAWhE,EAAOW,WAChDqD,EAAWhE,EAAOW,QAAQt3B,SAC1B26B,EAAWhE,EAAOW,QAAQC,SAC1BoD,EAAWhE,EAAOW,QAAQuD,aAC1BF,EAAWhE,EAAOmE,OAtKrBt8B,EAAAw4B,iBASCt1B,YAAYi1B,GAEX,GATOh1B,KAAAo5B,YAAmC,KACnCp5B,KAAAq5B,UAAiC,KACjCr5B,KAAAs5B,iBAAwC,KACxCt5B,KAAAu5B,SACAv5B,KAAAw5B,UAAY,IACZx5B,KAAAwR,SAAWioB,QAAS,YAAaC,OAAQ,YAGhD15B,KAAKg1B,OAASA,GACTiE,EAAsBjE,GAC1B,MAAM,IAAIzf,MAAM,2DAIlBxV,KAAKyR,EAAegoB,GAInB,OAAKP,EAAsBj5B,KAAKg1B,QAGP,OAArBh1B,KAAKo5B,YACDz2B,QAAQE,OAAO,IAAI0S,MAAM,sDAEH,OAA1BvV,KAAKs5B,iBACD32B,QAAQE,OAAO,IAAI0S,MAAM,oDA8InC,SAAkCikB,GACjC,YAAuBzyB,IAAdyyB,GAAkD,iBAAdA,GAA0BG,SAASH,IAAcluB,KAAK8G,MAAMonB,KAAeA,EA7IlHI,CAAyBJ,IAG9Bx5B,KAAKo5B,YAAc,IAAIz2B,QAASC,IAC/B5C,KAAKu5B,SACLv5B,KAAKw5B,UAAY,IACjBx5B,KAAKq5B,UAAY,UACCtyB,IAAdyyB,IACHx5B,KAAKw5B,UAAYA,GAEdT,EAASvnB,KACZxR,KAAKwR,QAAU/T,OAAO2I,OAAOpG,KAAKwR,QAASA,IAE5C5O,EAAQ5C,KAAK65B,yBACXzS,MAAOhkB,IAET,MADApD,KAAKq5B,UAAYj2B,EACXA,IACJ+jB,KAAK,KACPnnB,KAAKo5B,YAAc,OAEbp5B,KAAKo5B,aAnBJz2B,QAAQE,OAAO,IAAI0S,MAAM,+DATzB5S,QAAQE,OAAO,IAAI0S,MAAM,4DA+BlCxV,+BACC,MAAMi2B,KAEN,OADAA,EAAQh2B,KAAKwR,QAAQkoB,QAAUd,EACxB54B,KAAKg1B,OAAOW,QAAQuD,YAC1B3wB,MAAOvI,KAAKwR,QAAQioB,QACpBztB,KAAMhM,KAAKwR,QAAQkoB,OAEnB3nB,KAAMikB,IAIRj2B,sBACC,OAAOC,KAAKg1B,OAAOW,QAAQC,QAAQrtB,MAAOvI,KAAKwR,QAAQioB,UAAUtS,KAAKrV,IACrE,GAAIA,EACH,OAAO9R,KAAK85B,+BAEb,MAAM16B,GACL26B,UACCC,iBAAkB,EAClBC,qBAAsB,SAEvB9D,aAGD,OADA/2B,EAAO+2B,SAASn2B,KAAKwR,QAAQkoB,QAAUd,EAChC54B,KAAKg1B,OAAOW,QAAQt3B,QAC1BkK,MAAOvI,KAAKwR,QAAQioB,QACpB1nB,KAAM3S,MAKTW,UAAUm6B,GAuBT,OAtBAl6B,KAAKs5B,iBAAmB,IAAI32B,QAAQC,IAC9B5C,KAAKu5B,MAAMW,KACfl6B,KAAKu5B,MAAMW,OAEZ,MAAMC,GAAsDpoB,SAC5D,IAAK,IAAIhV,EAAI,EAAGA,EAAIiD,KAAKw5B,UAAWz8B,GAAK,EAExCo9B,EAAWpoB,KAAKc,MAAMtK,OAAQkuB,OAAQz2B,KAAKwR,QAAQioB,QAAS/C,MAAO12B,KAAKwR,QAAQkoB,OAAQ5B,IAAKoC,KAE7FC,EAAWpoB,KAAKc,SAEjBjQ,EACC5C,KAAKg1B,OAAOmE,KAAKgB,GAAYhT,KAAKrV,IACjC,IAAK,IAAIsoB,EAAI,EAAGA,EAAItoB,EAAS0M,MAAMhV,OAAQ4wB,GAAK,EAE/Cp6B,KAAKu5B,MAAMW,GAAcrnB,KAAKf,EAAS0M,MAAM4b,GAAG7xB,MAAM8xB,eAIvDlT,KAAK,KACPnnB,KAAKs5B,iBAAmB,OAElBt5B,KAAKs5B,iBAGLv5B,YAAYm6B,GACnB,GAAuB,OAAnBl6B,KAAKq5B,UACR,OAAO12B,QAAQE,OAAO7C,KAAKq5B,WAE5B,GAAIr5B,KAAKu5B,MAAMW,IAAiBl6B,KAAKu5B,MAAMW,GAAc1wB,OAAS,EACjE,OAAO7G,QAAQC,QAAQ5C,KAAKu5B,MAAMW,GAAc7f,SAGjD,MAAMigB,EAAc,IACZt6B,KAAKu6B,YAAYL,GAGzB,OAA8B,OAA1Bl6B,KAAKs5B,iBACDt5B,KAAKs5B,iBAAiBnS,KAAKmT,GAE3Bt6B,KAAKw6B,UAAUN,GAAc/S,KAAKmT,GAIpCv6B,IAAIm6B,GACV,IAAKl6B,KAAKg1B,OACT,MAAM,IAAIzf,MAAM,kEAEjB,GAA6B,iBAAjB2kB,GAAsD,IAAxBA,EAAa1wB,OACtD,MAAM,IAAI+L,MAAM,oDAEjB,OAAyB,OAArBvV,KAAKo5B,YAEDp5B,KAAKo5B,YAAYjS,KAAK,IAAMnnB,KAAKu6B,YAAYL,IAE9Cl6B,KAAKu6B,YAAYL,GAGlBn6B,aAAam6B,GACnB,OAAKl6B,KAAKu5B,MAAMW,GAGRl6B,KAAKu5B,MAAMW,GAAc1wB,OAFzB,mFCzJV,MAAMixB,GAAazuB,KAAM,WAEnB0uB,GAAY1uB,KAAM,QAIlB2uB,GAAY3uB,KAAM,WAElB4uB,GACLC,YACCv9B,KAAMq9B,EACN3xB,KAAM2xB,EACN/wB,QAAS8wB,EACTl0B,GAAIm0B,EACJ3uB,KAAM0uB,IAaFI,GACLD,YACCv9B,KAAMq9B,EACNxa,KAAMwa,EACN/zB,MAAO+zB,EACP/wB,QAAS8wB,EACTrL,kBAAmBoL,EACnBtzB,kBAAmBszB,EACnB3zB,kBAAmB4zB,EACnB3M,OAAQ4M,EACR9zB,WAAY6zB,EACZzzB,cAAe0zB,EACftzB,OApBDwzB,YACChzB,WAAY4yB,EACZjzB,WAAYizB,EACZrzB,UAAWqzB,EACX7yB,YAAa6yB,IAiBbj0B,GAAIm0B,EACJ3uB,KAAM0uB,IAsBFK,GACLF,YACCG,WAAYN,EACZ18B,MAAO08B,IAIHO,GACLJ,YACCv9B,KAAMq9B,EACNO,SAAUP,EACVQ,OAAQR,EACR3uB,KAAM2uB,EACNS,OAAQT,EACRU,QAASV,EACTW,UAAWX,EACXY,QAASZ,EACTa,MAAOf,IAIHgB,GACLZ,YACCv9B,KAAMq9B,EACNe,WAAYf,EACZ/4B,QACCi5B,YACCr0B,GAAIm0B,EACJr9B,KAAMq9B,EACNO,SAAUP,EACVgB,eAAgBhB,EAChBiB,QAASX,MAmLPY,GACLhB,YACCrwB,MAAOmwB,EACPjwB,OAAQiwB,EACR/vB,MAAO+vB,IA+CHmB,GACLjB,YACC/4B,OA5ED+4B,YACCv9B,KAAMq9B,EACN/4B,OAAQ+4B,EACRxwB,KAAMwwB,EACNtwB,IAAKswB,EACLpwB,OACCswB,YACCrwB,MAAOmwB,EACPjwB,OAAQiwB,EACR/vB,MAAO+vB,IAGToB,MACClB,YACCv9B,KAAMq9B,EACNtwB,IAAKswB,IAGP1wB,YAAa0wB,EACb7U,UAnED+U,YACCzvB,OAnEDyvB,YACCn7B,OAAQi7B,EACRqB,SAAUrB,EACVzxB,MAAOyxB,EACPsB,UAAWvB,EACXzrB,WAAYyrB,EACZrsB,SAAUqsB,EACVwB,YAAaxB,EACbzsB,QA7BD4sB,YACCr0B,GAAIm0B,EACJzxB,MAAOyxB,EACPtsB,SAAUqsB,EACVlxB,OAAQkxB,EACRyB,OAAQxB,EACRyB,WApBDvB,YACCr0B,GAAIm0B,EACJzxB,MAAOyxB,EACPgB,eAAgBhB,EAChBnxB,OAAQkxB,EACR2B,MAAO5B,EACP9K,OAAQoL,EACRa,QAASX,EACTqB,aAAcb,EACdc,MAAO5B,IAYP2B,aAAcb,IAuBde,OAlBD3B,YACCr0B,GAAIm0B,EACJ8B,QAAS/B,EACTgC,YAAahC,EACbiC,QAASjC,MAyETkC,MAAOlC,EACP7iB,MAAO6iB,EACPl0B,GAAIm0B,EACJzxB,MAAOyxB,EACPO,SAAUP,EACVn1B,OAAQm1B,EACRkC,SAAUlC,EACVt0B,KAAMs0B,EACNmC,QAASnC,EACToC,UAAWpC,EACXqC,YAAarC,EACbgB,eAAgBhB,EAChBsC,WAAYtC,EACZuC,QAASvC,EACTwC,QAASxC,EACTyC,KAAMzC,EACN0C,oBACCxC,YACCyC,SAAU3C,EACV4C,OAAQ5C,IAGV1rB,WAAYyrB,EACZ4B,aAAcb,EACd+B,cA9ED3C,YACCr0B,GAAIm0B,EACJzxB,MAAOyxB,EACPgB,eAAgBhB,EAChB8C,iBAAkB9C,EAClB+C,YAAa/C,EACbgD,cAAehD,EACfiD,eAAgBjD,EAChBkD,iBAAkBlD,EAClBhL,OAAQoL,EACRuB,aAAcb,IAqEdqC,WAhEDjD,YACCkD,cAAepD,EACfqD,OACCnD,YACCr0B,GAAIm0B,EACJr9B,KAAMq9B,EACNgB,eAAgBhB,EAChBsD,UAAWtD,EACXO,SAAUP,IAGZiB,SACCf,YACCv9B,KAAMq9B,EACNO,SAAUP,EACVa,MAAOf,MAkDTsB,MACClB,YACChjB,MAAO6iB,EACPp9B,KAAMq9B,IAGRuD,eAjDDrD,YACCx0B,KAAMs0B,EACNwD,MACCtD,YACCr0B,GAAIm0B,EACJr9B,KAAMq9B,EACNO,SAAUP,EACVgB,eAAgBhB,EAChByD,cAAezD,MA0CjB0D,iBACCxD,YACCyD,MAAO7D,EACP8D,KAAM9D,EACN+D,SAAU/D,EACVgE,QAAShE,EACT5iB,MAAO6iB,QAoFT94B,QApCDi5B,YACCv9B,KAAMq9B,EACNxwB,KAAMwwB,EACNtwB,IAAKswB,EACLpwB,MAAOsxB,EACPE,MACClB,YACCv9B,KAAMq9B,EACNtwB,IAAKswB,IAGP1wB,YAAa0wB,EACb9vB,SArBDgwB,YACCv9B,KAAMq9B,EACNtwB,IAAKswB,EACLxwB,KAAMwwB,EACNpwB,MAAOsxB,MA0CP6C,UApBD7D,YACCv9B,KAAMq9B,EACN/4B,QACCi5B,YACCv9B,KAAMq9B,EACNxwB,KAAMwwB,EACNtwB,IAAKswB,IAGPxwB,KAAMwwB,EACNtwB,IAAKswB,EACLgE,KAAMhE,EACNpwB,MAAOsxB,MAYH+C,GACL/D,YACC/Y,OAAQ6Y,EACR3xB,KAAM2xB,EACN7xB,SAAU6xB,EACV73B,MACC+3B,YACCjxB,QAAS8wB,EACT5I,SAAU4I,IAGZzxB,KAzSD4xB,YACC5sB,OAAQysB,EACRp7B,MAAOo7B,EACP1uB,KAAM2uB,EACNhxB,MAAOgxB,EACP74B,MAAO64B,EACP/4B,OAAQ+4B,EACRliB,WAAYkiB,EACZngB,UAAWmgB,EACXzxB,MAAOyxB,EACPpwB,MAAOowB,EACPjxB,KAAMgxB,EACN/hB,UAAWgiB,EACXjiB,WAAYiiB,IA6RZ5wB,KAAM+xB,EACNt1B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFmE,GACLhE,YACC7sB,OAAQ2sB,EACRpxB,SAAUoxB,EACVjsB,UAAWisB,EACXtsB,SAAUqsB,EACV7sB,QAAS6sB,EACT/rB,UAAWgsB,EACXn0B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFoE,GACLjE,YACC/4B,MAAO64B,EACPoE,UAAWpE,EACXxH,YAAawH,EACbqE,gBAAiBrE,EACjB/4B,OAAQ+4B,EACRliB,WAAYkiB,EACZhxB,MAAOgxB,EACP9uB,KAAM6uB,EACNxxB,MAAOyxB,EACPsE,UAAWtE,EACX3vB,MAAO0vB,EACPhxB,KAAMgxB,EACN3Y,UAAW4Y,EACXuE,YAAavE,EACbzH,gBAAiByH,EACjBjiB,WAAYiiB,EACZhiB,UAAWgiB,EACXtV,iBAAkBsV,EAClBwE,iBAAkBxE,EAClBxV,cAAewV,EACfyE,cAAezE,EACf0E,iBAAkB1E,IAId2E,GACLzE,YACCpxB,SAAUixB,EACVlvB,QAASkvB,EACTh7B,OAAQi7B,EACRzU,WAAYwU,EACZzU,SAAUyU,EACV6E,QAAS5E,EACTz8B,KAAMy8B,EACNx0B,QAASw0B,IA2BL6E,GACL3E,YACC/Y,OAAQ6Y,EACR7xB,SAAU6xB,EACVr9B,KAAMq9B,EACN3xB,KAAM2xB,EACN73B,MACC+3B,YACCjxB,QAAS8wB,EACT5I,SAAU4I,EACVjvB,KAAMivB,IAGR3uB,QAAS4uB,EACTvxB,SAAUuxB,EACV1xB,IAAK61B,EACL1zB,MAAOk0B,EACPv1B,MAtBD8wB,YACChwB,SAlBDgwB,YACCv9B,KAAMq9B,EACNxwB,KAAMwwB,EACNtwB,IAAKswB,EACLlxB,SAAUixB,EACV94B,QACCi5B,YACCv9B,KAAMq9B,EACNxwB,KAAMwwB,EACNtwB,IAAKswB,IAGPpwB,MAAOsxB,MA4BPr1B,GAAIm0B,EACJ3uB,KAAM0uB,IAIF+E,GACL5E,YACCv9B,KAAMq9B,EACNrH,QAASqH,EACTpxB,SAAUoxB,EACVvxB,SAAUuxB,EACV/4B,OAAQ+4B,EACRhxB,MAAOgxB,EACPjxB,KAAMgxB,EACNjxB,SAAUixB,EACV9wB,QAAS8wB,EACThiB,WAAYiiB,EACZhiB,UAAWgiB,EACX5wB,KAAM+xB,EACNt1B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFgF,GACL7E,YACCv9B,KAAMq9B,EACNpH,SAAUoH,EACVrH,QAASqH,EACTpxB,SAAUoxB,EACV7wB,SAAU6wB,EACVjiB,WAAYiiB,EACZ5wB,KAAM+xB,EACNlyB,QAAS8wB,EACTl0B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFiF,GACL9E,YACCv9B,KAAMq9B,EACNtwB,IAAKswB,EACL5rB,SAAU4rB,EACViF,SAAUnF,EACVj0B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFmF,GACLhF,YACC7sB,OAAQ2sB,EACRja,OAAQia,EACR5Z,SAAU2Z,EACVxuB,OAAQwuB,EACR1Z,WAAY0Z,EACZtyB,MAAOsyB,EACPpyB,MAAOoyB,EACPl0B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFoF,GACLjF,YACCv9B,KAAMq9B,EACN3sB,OAAQ2sB,EACRjtB,QAASitB,EACTtxB,SAAUsxB,EACV9sB,QAAS6sB,EACT9wB,QAAS8wB,EACT5sB,YAAa6sB,EACb/sB,SAAU6sB,EACVhxB,SAAUixB,EACVnxB,SAAUoxB,EACVn0B,GAAIm0B,EACJ3uB,KAAM0uB,IAiBFqF,GACLlF,YACCxwB,IAAKswB,EACL/wB,QAAS8wB,EACT3U,UAAW2U,EACXl1B,OAAQm1B,EACR1tB,aAAc0tB,EACd1xB,KAnBD4xB,YACC3xB,MAAOyxB,EACPn1B,OAAQm1B,EACR7kB,KAAM6kB,EACNntB,OAAQmtB,EACR1wB,YAAa0wB,EACb5kB,UAAW4kB,EACXpwB,MAAOowB,EACP3kB,WAAY2kB,IAYZn0B,GAAIm0B,EACJ3uB,KAAM0uB,IAmBFsF,GACLnF,YACCxtB,UAAWstB,EACXn1B,OAAQm1B,EACRj1B,MAAOi1B,EACP3xB,KAAM2xB,EACN7kB,KAAM6kB,EACNrtB,QAASqtB,EACTt0B,KAAMq0B,EACNxxB,MAAOyxB,EACPrkB,KAAMqkB,EACNntB,OAAQmtB,EACRxkB,UA1BD0kB,YACC9Q,MAAO2Q,EACPxxB,MAAOyxB,IAyBPpkB,YApBDskB,YACCxwB,IAAKswB,EACL3uB,KAAM2uB,EACNnxB,OAAQkxB,IAkBR53B,MACC+3B,YACCjxB,QAAS8wB,EACT5I,SAAU4I,EACVjvB,KAAMivB,IAGRzxB,IAAK61B,EACL1zB,MAAOk0B,EACP94B,GAAIm0B,EACJ3uB,KAAM0uB,IAIFuF,GACLpF,YACCna,OAAQia,EACR3sB,OAAQ2sB,EACRjtB,QAASitB,EACT/wB,QAAS8wB,EACT7sB,QAAS6sB,EACTrsB,SAAUqsB,EACVl0B,GAAIm0B,EACJ3uB,KAAM0uB,IAIK79B,EAAAm5B,SACZzvB,KAAMq0B,EACNl0B,KAAMo0B,EACNn2B,OAAQi6B,EACRpwB,UAAWqwB,EACX7zB,MAAOw0B,EACP19B,MAAO29B,EACP79B,OAAQ89B,EACR9wB,MAAO+wB,EACPz3B,MAAO23B,EACPpyB,SAAUqyB,EACV9yB,QAAS+yB,EACTvzB,QAASwzB,EACT7xB,SAAU8xB,iXC5mBXpjC,EAAA05B,KAAA,SAA2B2J,2CAC1B,OAAO,IAAIv9B,QAAcoN,GAAOowB,WAAWpwB,EAAKmwB,qcCAjD,MAAA96B,EAAAzI,EAAA,GACA4F,EAAAtD,EAAAtC,EAAA,IACAyjC,EAAAnhC,EAAAtC,EAAA,KAGAE,EAAAmmB,aAKCjjB,YAAYX,GAJZY,KAAAqgC,WAKC,MAAMC,EAAUlhC,EAAO4uB,aAAa,SACpChuB,KAAK81B,WAAWhd,QAAQ9M,IACvBhM,KAAKqgC,QAAQj7B,EAAAxE,aAAaoL,IAAS,IAAIo0B,EAAAlhC,SAAMoF,SAAU/B,EAAArD,QAAK0D,QAAQ09B,EAASl7B,EAAAxE,aAAaoL,GAAQ,WAItFjM,aAAaqe,2CAC1B,OAAO,IAAIzb,QAAQ,CAACC,EAASC,KAC5Bub,EAAGmiB,aAAcx9B,IAChB,GAAIA,EACH,OAAOF,EAAOE,GAEfH,UAKG7C,+CACL,IAAK,MAAMiM,KAAQhM,KAAK81B,WAAY,CACnC,MAAM1X,EAAKpe,KAAKqgC,QAAQj7B,EAAAxE,aAAaoL,UAC/BhM,KAAKugC,aAAaniB,SAEnBpe,KAAKkjB,UAGNnjB,mDAIEA,WACP,OAAOtC,OAAOma,KAAKxS,EAAAxE,cACjByX,OAAO/Z,IAAQ+M,MAAMqc,OAAOppB,KAC5B4I,IAAI5I,GAAOmI,SAASnI,EAAK,KAGdyB,WAAWqe,2CACxB,OAAO,IAAIzb,QAAc,CAACC,EAASC,KAClCub,EAAG1C,WAAYvD,OAAO,GAAQpV,IAC7B,GAAIA,EACH,OAAOF,EAAOE,GAEfqb,EAAGmiB,aAAcC,IACZA,GACH39B,EAAO29B,GAER59B,YAME7C,gDACL,IAAK,MAAMiM,KAAQhM,KAAK81B,WAAY,CACnC,MAAM1X,EAAKpe,KAAKqgC,QAAQj7B,EAAAxE,aAAaoL,UAC/BhM,KAAK+1B,WAAW3X,MAIVre,WAAWqe,8CAInBre,gDACL,IAAK,MAAMiM,KAAQhM,KAAK81B,WAAY,CACnC,MAAM1X,EAAKpe,KAAKqgC,QAAQj7B,EAAAxE,aAAaoL,UAC/BhM,KAAKs2B,WAAWlY,MAIxBre,WAAwCiM,GACvC,OAAO,IAAIy0B,EAAez0B,EAAMhM,KAAKqgC,QAAQj7B,EAAAxE,aAAaoL,OAI5D,IAAI00B,GAAe,IAAKvgC,MAAQqW,gBAMnBiqB,EAiBZ1gC,YAAYiM,EAAoBgpB,GAC/Bh1B,KAAKgM,KAAOA,OACCjF,IAATiF,GACHhM,KAAKy2B,OAAS,QACdz2B,KAAK02B,MAAQ,KAEb12B,KAAK02B,MAAQtxB,EAAAxE,aAAaoL,GAC1BhM,KAAKy2B,OAAS,OAASrxB,EAAAxE,aAAaoL,IAErChM,KAAKg1B,OAASA,EApBPj1B,QAAQ42B,GAEf,cADaA,EAAKmB,IACXnB,EAGA52B,UAAUs3B,GACjB,OAAOA,EAAKnwB,IAAIyvB,GACR32B,KAAKg4B,QAAQrB,IAgBR52B,mDAGb,SADA2gC,GACoBlgC,aAGbT,mBAAmB2e,GAC1B,GAAIA,EAAM3G,KAAM,CACf,MAAM7M,KACA6M,EAAO2G,EAAM3G,KAInB,OAHAta,OAAOma,KAAKG,GAAMe,QAAQxa,IACzB4M,EAAO5M,GAAOyZ,EAAKzZ,KAAS8G,EAAAlD,sBAAsB4d,UAAY,GAAK,IAE7D5U,GAKDnL,eAAe2e,GACtB,GAAIA,EAAMpB,IACT,SAED,IAAIwZ,KACJ,GAAIpY,EAAMS,KAAM,CACf,MAAM3hB,EAAIkhB,EAAMS,KAChB2X,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,GAAOd,EAAEc,GACP6gB,KAIV,GAAIT,EAAMxK,MAAO,CAChB,MAAM1W,EAAIkhB,EAAMxK,MAChB4iB,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,GAAO,IAAIqiC,OAvErB,SAAsBC,GACrB,OAAOA,EAAe/7B,QAAQ,iCAAkC,QAsErCg8B,CAAarjC,EAAEc,GAAKkC,YAAa,MACjD2e,KAKV,GAAIT,EAAMY,MAAO,CAChB,MAAM9hB,EAAIkhB,EAAMY,MAChBwX,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAI5I,IAClB,MAAM6gB,KAEN,OADAA,EAAK7gB,IAAQwiC,IAAKtjC,EAAEc,IACb6gB,KAIV,GAAIT,EAAMU,WAAY,CACrB,MAAM5hB,EAAIkhB,EAAMU,WAChB0X,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAK5I,KAElByiC,OAAQ,WACP,OAAqC,IAA9B/gC,KAAK1B,GAAKsU,QAAQpV,EAAEc,SAMhC,GAAIogB,EAAMW,YAAa,CACtB,MAAM7hB,EAAIkhB,EAAMW,YAChByX,EAAOA,EAAKz2B,OACX5C,OAAOma,KAAKpa,GAAG0J,IAAK5I,KAElByiC,OAAQ,WACP,QAASvjC,EAAEc,GAAKqc,KAAK1S,GAAsC,IAA7BjI,KAAK1B,GAAKsU,QAAQ3K,SAMrD,GAAIyW,EAAMgB,MAAO,CAChB,MAAMliB,EAAIkhB,EAAMgB,MAChBjiB,OAAOma,KAAKpa,GAAGsb,QAAQxa,IACtB,MAAM24B,EAAOz5B,EAAEc,GACf,GAAI24B,EAAKr4B,eAAe,aAAuBmI,IAAbkwB,EAAKxX,IAAmB,CACzD,MAAMN,KACNA,EAAK7gB,IAAQ0iC,KAAM/J,EAAKxX,KACxBqX,EAAKjkB,KAAKsM,GAEX,GAAI8X,EAAKr4B,eAAe,aAAuBmI,IAAbkwB,EAAKzX,IAAmB,CACzD,MAAML,KACNA,EAAK7gB,IAAQ2iC,KAAMhK,EAAKzX,KACxBsX,EAAKjkB,KAAKsM,MAIb,GAAIT,EAAMa,QAAS,CAClB,MAAM/hB,EAAIkhB,EAAMa,QAChBuX,EAAOA,EAAKz2B,OAAO7C,EAAE0J,IAAI5I,IACxB,MAAM6gB,KAEN,OADAA,EAAK7gB,IAAQ4iC,SAAS,GACf/hB,KAGT,OAAQgiB,KAAMrK,GAGT/2B,IAAIgS,2CACT,MAAMvL,QAAWxG,KAAK03B,WAEtB,OADA3lB,EAAKvL,GAAKA,EACH,IAAI7D,QAAgB,CAACC,EAASC,KACpC7C,KAAKg1B,OAAOoM,OAAOrvB,EAAOhP,IACrBA,EACHF,EAAOE,GAEPH,EAAQ4D,SAONzG,QAAQyG,EAAYuL,2CACzB,OAAO,IAAIpP,QAAc,CAACC,EAASC,KAClC7C,KAAKg1B,OAAOqM,QAAQ76B,GAAIA,GAAKuL,KAAU,CAAChP,EAAKu+B,KAC5C,GAAIv+B,EACHF,EAAOE,OACD,IAAoB,IAAhBu+B,EACV,OAAOz+B,EAAO,kBAAoB7C,KAAK02B,MAAQ,gBAAkBlwB,GAEjE5D,WAME7C,OAAOyG,EAAYuL,2CACnBvL,GAAoB,IAAdA,EAAGgD,aAIPxJ,KAAK6E,QAAQ2B,EAAIuL,SAHjB/R,KAAK8d,IAAI/L,KAOXhS,OAAOyG,2CACZ,MAAMwV,EAAM8L,MAAMC,QAAQvhB,GAAMA,GAAMA,GACtC,GAAmB,IAAfwV,EAAIxS,OAGR,OAAO,IAAI7G,QAAc,CAACC,EAASC,KAClC7C,KAAKg1B,OAAOtZ,QAAQlV,IAAKs6B,IAAK9kB,KAAQ7D,OAAO,GAAO,CAACpV,EAAK8U,KACrD9U,EACHF,EAAOE,GACG8U,IAAUmE,EAAIxS,OACxB3G,EAAO,qBAAuBgV,EAAQ,8BAAgCmE,EAAIxS,QAE1E5G,UAME7C,cAAc2e,2CACnB,OAAO,IAAI/b,QAAgB,CAACC,EAASC,KACpC7C,KAAKg1B,OAAOtZ,OAAO1b,KAAKuhC,eAAe7iB,IAASvG,OAAO,GAAO,CAACpV,EAAK8U,KAC/D9U,EACHF,EAAOE,GAEPH,EAAQiV,SAMN9X,KAAKyG,2CACV,YAAkBO,IAAd/G,KAAKgM,WACKhM,KAAK+e,UAAUI,MAAO3Y,GAAIA,KAEhC,IAAI7D,QAAW,CAACC,EAASC,KAC/B7C,KAAKg1B,OAAOra,MAASnU,GAAIA,GAAK,CAACzD,EAAKm1B,KAC/Bn1B,EACHF,EAAOE,GACmB,IAAhBm1B,EAAK1uB,OACf5G,IAEAA,EAAQ5C,KAAKg4B,QAAQE,EAAK,WAOzBn4B,MAAMic,2CACX,OAAO,IAAIrZ,QAAkB,CAACC,EAASC,KACtC7C,KAAKg1B,OAAOra,MAASnU,IAAKs6B,IAAK9kB,IAAO,CAACjZ,EAAKm1B,KACvCn1B,EACHF,EAAOE,GAEPH,EAAQ5C,KAAKwhC,UAAUtJ,UAMrBn4B,MAAM2e,2CACX,IAAI+iB,EAAUzhC,KAAKg1B,OAAOra,KAAQ3a,KAAKuhC,eAAe7iB,IACtD,MAAM3G,EAAO/X,KAAK0hC,mBAAmBhjB,GAUrC,OATI3G,IACH0pB,EAAUA,EAAQ1pB,KAAKA,IAEpB2G,EAAMqB,SACT0hB,EAAUA,EAAQE,KAAKjjB,EAAMqB,SAE1BrB,EAAMhM,SACT+uB,EAAUA,EAAQG,MAAMljB,EAAMhM,SAExB,IAAI/P,QAAkB,CAACC,EAASC,KACtC4+B,EAAQI,KAAK,CAAC9+B,EAAKm1B,KACdn1B,EACHF,EAAOE,GAEPH,EAAQ5C,KAAKwhC,UAAUtJ,UAMrBn4B,SAAS2e,2CACd,OAAO,IAAI/b,QAAW,CAACC,EAASC,KAC/B7C,KAAKg1B,OAAOra,KAAQ3a,KAAKuhC,eAAe7iB,IAAQkjB,MAAM,GAAGC,KAAK,CAAC9+B,EAAKm1B,KAC/Dn1B,EACHF,EAAOE,GACmB,IAAhBm1B,EAAK1uB,OACf5G,IAEAA,EAAQ5C,KAAKg4B,QAAQE,EAAK,WAMxBn4B,QAAQ2e,EAA+BE,2CAC5C,IAAI6iB,EAAUzhC,KAAKg1B,OAAOra,KAAQ3a,KAAKuhC,eAAe7iB,IACtD,MAAM3G,EAAO/X,KAAK0hC,mBAAmBhjB,GAUrC,OATI3G,IACH0pB,EAAUA,EAAQ1pB,KAAKA,IAEpB2G,EAAMqB,SACT0hB,EAAUA,EAAQE,KAAKjjB,EAAMqB,SAE1BrB,EAAMhM,SACT+uB,EAAUA,EAAQG,MAAMljB,EAAMhM,SAExB,IAAI/P,QAAc,CAACC,EAASC,KAClC4+B,EAAQI,KAAK,CAAC9+B,EAAKm1B,KACdn1B,EACHF,EAAOE,GAEP6b,EAAQ5e,KAAKwhC,UAAUtJ,IAAO/Q,KAAKvkB,GAASwkB,MAAMvkB,SAMhD9C,SAAS2e,2CACd,IAAI+iB,EAAUzhC,KAAKg1B,OAAOra,KAAQ3a,KAAKuhC,eAAe7iB,IACtD,MAAM3G,EAAO/X,KAAK0hC,mBAAmBhjB,GAUrC,OATI3G,IACH0pB,EAAUA,EAAQ1pB,KAAKA,IAEpB2G,EAAMqB,SACT0hB,EAAUA,EAAQE,KAAKjjB,EAAMqB,SAE1BrB,EAAMhM,SACT+uB,EAAUA,EAAQG,MAAMljB,EAAMhM,SAExB,IAAI/P,QAAuB,CAACC,EAASC,KAC3C4+B,EAAQI,KAAK,CAAC9+B,EAAKm1B,KACdn1B,EACHF,EAAOE,GAEPH,EAAQs1B,EAAKhxB,IAAI1J,GAAKA,EAAEgJ,WAMpBzG,kBAAkBmf,EAAe1hB,GACxC,MAAM0N,KAEA42B,EAAiB,CAACC,EAAuBz1B,KAC9C,MAAM2M,EAAM3M,EAAIy1B,EAAO,IACvB,QAAYh7B,IAARkS,EAGJ,GAAI6O,MAAMC,QAAQ9O,GAAM,CACvB,GAAsB,IAAlB8oB,EAAOv4B,OACV,OAEDyP,EAAIH,QAAQ1K,IACX0zB,EAAeC,EAAOv9B,MAAM,GAAI4J,UAGX,IAAlB2zB,EAAOv4B,OACV0B,EAAO2H,KAAKoG,EAAIzY,YACS,iBAARyY,GACjB6oB,EAAeC,EAAOv9B,MAAM,GAAIyU,IAMnC,OADA6oB,EAAe5iB,EAAMzL,MAAM,KAAMjW,GAC1B0N,EAGFnL,UAAU2e,EAA+BQ,2CAC9C,IAAIuiB,EAAUzhC,KAAKg1B,OAAOra,KAAQ3a,KAAKuhC,eAAe7iB,IACtD,MAAM3G,EAAO/X,KAAK0hC,mBAAmBhjB,GAUrC,OATI3G,IACH0pB,EAAUA,EAAQ1pB,KAAKA,IAEpB2G,EAAMqB,SACT0hB,EAAUA,EAAQE,KAAKjjB,EAAMqB,SAE1BrB,EAAMhM,SACT+uB,EAAUA,EAAQG,MAAMljB,EAAMhM,SAExB,IAAI/P,QAAgB,CAACC,EAASC,KACpC4+B,EAAQI,KAAK,CAAC9+B,EAAKm1B,KAClB,GAAIn1B,EACHF,EAAOE,OACD,CACN,MAAMmP,KACNgmB,EAAKpf,QAAQqf,IACCn4B,KAAKgiC,kBAAkB9iB,EAAOiZ,GACtCrf,QAAQhB,IACR5F,EAAKU,QAAQkF,GAAO,GACvB5F,EAAKW,KAAKiF,OAIblV,EAAQsP,EAAK1I,eAMXzJ,MAAM2e,2CACX,OAAO,IAAI/b,QAAgB,CAACC,EAASC,KACpC7C,KAAKg1B,OAAOnd,MAAM7X,KAAKuhC,eAAe7iB,GAAQ,CAAC3b,EAAK8U,KAC/C9U,EACHF,EAAOE,GAEPH,EAAQiV,SAMN9X,SAAS24B,2CACd,OAAO,IAAI/1B,QAAuB,CAACC,EAASC,KAC3C7C,KAAKg1B,OAAOra,QAAY,CAAC5X,EAAKm1B,KAC7B,GAAIn1B,EACHF,EAAOE,OACD,CACN,MAAMmP,KACNgmB,EAAKpf,QAAQqf,IACCn4B,KAAKgiC,kBAAkBtJ,EAAWP,GAC1Crf,QAAQhB,IACR5F,EAAKU,QAAQkF,GAAO,GACvB5F,EAAKW,KAAKiF,OAIblV,EAAQsP,WAlZbrV,EAAA4jC,6BC5FA3jC,EAAAD,QAAAkC,QAAA,uBCAAjC,EAAAD,QAAAkC,QAAA,iGCCAlC,EAAAolC,UAAA,SAA0BzjC,GACzB,MAAMzB,KACAc,KACAqkC,EAAI,mBACV,IAAK,IAAIjkC,EAAI,EAAGA,EAAI,IAAKA,IAExBlB,EAAEkB,GAAKikC,EAAEC,OAAOlkC,GAAK,GAAKikC,EAAEC,OAAW,GAAJlkC,GAGpC,IAAK,IAAIA,EAAI,EAAGA,EAAIO,EAAEgL,OAAQvL,IAC7BJ,EAAEI,GAAKlB,EAAEyB,EAAE4jC,WAAWnkC,IAEvB,OAAOJ,EAAEyC,KAAK,KAGfzD,EAAAujB,UAAA,SAA0BiiB,GACzB,IAAI7uB,EAAM,GACV,IAAK,IAAIzW,EAAI,EAAGA,EAAIslC,EAAI74B,OAAQzM,GAAK,EACpCyW,GAAO8uB,OAAOC,aAAa97B,SAAS47B,EAAIG,OAAOzlC,EAAG,GAAI,KAEvD,OAAOyW,EAAIO,sXCpBZ,MAAA0uB,EAAA9lC,EAAA,IACA+lC,EAAA/lC,EAAA,IACAgmC,EAAAhmC,EAAA,IACAimC,EAAAjmC,EAAA,IACAkmC,EAAAlmC,EAAA,IAKAwI,EAAAxI,EAAA,GACA8tB,EAAA9tB,EAAA,UASa0I,EACZtF,wBAAwBgE,GACvB,OAAKA,GAIJrE,OAAQ,MACR+J,SAAU1F,EAAK++B,iBACft3B,QAASzH,EAAKyH,QACd0a,WAAYniB,EAAKmiB,WACjBD,SAAUliB,EAAKkiB,SACfsZ,QAASx7B,EAAKw7B,QACdrhC,KAAM6F,EAAK7F,KACXiI,QAASpC,EAAKoC,QAAU,IAAMpC,EAAKg/B,UAIrChjC,uBAAuBgE,GACtB,IAAKA,EACJ,OAED,MAAMlE,EAAS4iC,EAAAO,YAAYj/B,GAE3B,IAAI2F,EAA2B7J,EAAO6J,KACtC,GAAI7J,EAAOojC,aAAc,CACxB,MAAM7oB,EAAI3T,SAAS5G,EAAOojC,aAAc,IACnC53B,MAAM+O,KACV1Q,EAAO0Q,GAGT,GAAIva,EAAOqjC,aAAc,CACxB,MAAM9oB,EAAI3T,SAAS5G,EAAOqjC,aAAc,IACnC73B,MAAM+O,KACV1Q,EAAO0Q,GAGT,GAAIva,EAAOsjC,sBAAuB,CACjC,MAAM/oB,EAAI3T,SAAS5G,EAAOsjC,sBAAuB,IAC5C93B,MAAM+O,KACV1Q,EAAO0Q,GAGT,GAAIva,EAAOujC,aAAc,CACxB,MAAMhpB,EAAI3T,SAAS5G,EAAOujC,aAAa5+B,MAAM,EAAG,GAAI,IAC/C6G,MAAM+O,KACV1Q,EAAO0Q,GAGT,OACCtY,MAAOjC,EAAOiC,MACdi9B,UAAWl/B,EAAOwjC,iBAClBlQ,YAAatzB,EAAOyjC,aACpBtE,gBAAiBn/B,EAAO0jC,mBAAqB1jC,EAAO2jC,wBACpD5hC,OAAQ/B,EAAO+B,OACf6W,WAAY5Y,EAAO4jC,YACnB95B,MAAO9J,EAAO8J,MAAQ8gB,EAAAiZ,WAAW7jC,EAAO8J,YAAS5C,EACjD8E,KAAMhM,EAAOgM,KACb3C,MAAOrJ,EAAOqJ,MACd+1B,UAAWp/B,EAAO8jC,iBAClB34B,MAAOnL,EAAOmL,MACdtB,KAAMA,EACNqY,UAAWliB,EAAO+jC,QAClB1E,YAAar/B,EAAOgkC,UACpB3Q,gBAAiBrzB,EAAOikC,cACxBprB,WAAY7Y,EAAOkkC,SACnBprB,UAAW9Y,EAAOmkC,QAClB3e,iBAAkBxlB,EAAOokC,eACzB9E,iBAAkBt/B,EAAOqkC,eACzB/e,cAAetlB,EAAOskC,YACtB/E,cAAev/B,EAAOukC,YACtB/E,iBAAkBx/B,EAAOwkC,gBAI3BtkC,0BAA0B6Y,GACzB,IAAIpO,EACAE,EACAE,EACAL,GAASqO,OAAc+B,KAAKb,GAAoB,UAAbA,EAAIrO,MAY3C,OAXIlB,GAASA,EAAMF,KAAOE,EAAMF,IAAIb,OAAS,IAC5CgB,EAAQD,EAAMF,MAEfE,GAASqO,OAAc+B,KAAKb,GAAoB,WAAbA,EAAIrO,QAC1BlB,EAAMF,KAAOE,EAAMF,IAAIb,OAAS,IAC5CkB,EAASH,EAAMF,MAEhBE,GAASqO,OAAc+B,KAAKb,GAAoB,UAAbA,EAAIrO,QAC1BlB,EAAMF,KAAOE,EAAMF,IAAIb,OAAS,IAC5CoB,EAAQL,EAAMF,MAGdG,MAAOA,EACPE,OAAQA,EACRE,MAAOA,GAIT7K,2BAA2BgE,GAC1B,GAAKA,GAGAA,EAAKoG,KAGV,OACC7M,KAAMyG,EAAKzG,KACX6M,KAAMpG,EAAKoG,KACXE,IAAKtG,EAAKsG,IACVE,MAAOvK,KAAKskC,mBAAmBvgC,EAAKwG,OACpCwxB,KAAMh4B,EAAKg4B,KACX9xB,YAAalG,EAAKwgC,IAAMxgC,EAAKwgC,IAAIv1B,aAAUjI,EAC3C8D,QAAS9G,EAAK8G,SAAW9G,EAAK8G,QAAQjJ,OAASmC,EAAK8G,QAAQjJ,OAAOsF,IAAItF,KAErEtE,KAAMsE,EAAOtE,KACb+M,IAAKzI,EAAOyI,IACZE,MAAOvK,KAAKskC,mBAAmB1iC,EAAO2I,eAEnCxD,GAIPhH,gCAAgCgE,GAC/B,OAAKA,GAASA,EAAKiH,OAA+B,IAAtBjH,EAAKiH,MAAMxB,OAGhCzF,EAAKiH,MAAM9D,IAAIjJ,KAEpBX,KAAMW,EAAEX,KACR6M,KAAMlM,EAAEkM,KACRE,IAAKpM,EAAEoM,IACPZ,SAAU+6B,WAAWvmC,EAAEwL,UACvB7H,QACCtE,KAAMW,EAAE2D,OAAOtE,KACf6M,KAAMlM,EAAE2D,OAAOuI,KACfE,IAAKpM,EAAE2D,OAAOtE,MAEfiN,MAAOvK,KAAKskC,mBAAmBrmC,EAAEsM,aAKpCxK,0BAA0BgE,GACzB,GAAKA,EAGL,OACCzG,KAAMyG,EAAKzG,KACXsE,OAAQmC,EAAKnC,OACbuI,KAAMpG,EAAKoG,KACXE,IAAKtG,EAAKsG,IACVE,MAAOvK,KAAKskC,mBAAmBvgC,EAAKwG,OACpCwxB,KAAMh4B,EAAKg4B,KACX9xB,YAAalG,EAAK0gC,KAAO1gC,EAAK0gC,KAAKz1B,aAAUjI,GAI/ChH,6BAA6BgE,GAC5B,OAAKA,GAASA,EAAKiH,OAA+B,IAAtBjH,EAAKiH,MAAMxB,OAGhCzF,EAAKiH,MAAM9D,IAAIjJ,KAEpBX,KAAMW,EAAEX,KACR6M,KAAMlM,EAAEkM,KACRE,IAAKpM,EAAEoM,IACPs0B,KAAM1gC,EAAE0gC,KACR/8B,QACCtE,KAAMW,EAAE2D,OAAOtE,KACf6M,KAAMlM,EAAE2D,OAAOuI,KACfE,IAAKpM,EAAE2D,OAAOtE,MAEfiN,MAAOvK,KAAKskC,mBAAmBrmC,EAAEsM,cA3KrC1N,EAAAwI,SAiLAxI,EAAAsuB,YAMCprB,YAAYX,GACXY,KAAKilB,YAAc,IAAI4d,EAAA6B,mBAAmBrzB,UAAWjS,EAAOulC,MAAM1f,YAAY5T,UAAWuzB,SAAS,IAClG5kC,KAAK6kC,OAAS,IAAIjC,EAAAkC,cAAcxmC,IAAKc,EAAOulC,MAAMI,OAAOC,OAAQ3zB,UAAWjS,EAAOulC,MAAMI,OAAO1zB,YAChGrR,KAAKilC,SAAW,IAAItC,EAAAuC,gBAAgB5mC,IAAKc,EAAOulC,MAAMM,SAASD,OAAQ3zB,UAAWjS,EAAOulC,MAAMM,SAAS5zB,YACxGrR,KAAKmlC,YAAc,IAAIzC,EAAA0C,kBAAkBhmC,EAAOulC,MAAMU,YAAYh0B,WAG7DtR,KAAKuE,2CAEV,GAAe,QADAa,EAAAd,WAAWC,GACJ,CACrB,MACM4G,QADM,IAAIu3B,EAAA6C,KACSlwB,MAAM9Q,WAAUihC,WAAW,EAAMC,MAAM,EAAMC,OAAO,IAC7E,OAAKv6B,GAGIjC,IAAK5D,EAAOqgC,gBAAgBx6B,EAAOu6B,OAAQr6B,MAAO/F,EAAOsgC,iBAAiBz6B,EAAOs6B,QAFjFv8B,OAASmC,UAOlB,OADA4c,QAAQzoB,IAAI,0CAA2C+E,IAC/C2E,OAASmC,YAIbrL,MAAMuE,EAAkB2E,2CAC7B,OAAOtG,QAAQE,OAAO0S,MAAM,sBAgDvBxV,UAAUuE,EAAkB2E,kDACZ9D,EAAAjC,WAAWoB,EAAW,qBAEpCa,EAAAnB,SAASM,EAAUA,EAAW,aAErC,MAAMshC,KACNnoC,OAAOma,KAAK3O,EAAI28B,QAAQ1+B,IAAIV,KACjByC,EAAI28B,OAAOp/B,QACnBsS,QAAQ9a,IACT4nC,EAAO/yB,MAAMrM,KAAIq/B,MAAOC,eAAiBC,eAAiBt6B,KAAM,GAAIzN,cAItE,MAAMC,GACLuI,GAAI,QACJq/B,MACCG,IAAK/8B,EAAI9C,QACT8/B,IAAK,EACLx6B,KAAM,EACNy6B,OAAO,GAERnc,MAAO,EACPoc,IAAK,EACLP,gBAEa,IAAInD,EAAA2D,OACNC,MAAM/hC,EAAUrG,EAAGgL,EAAI9C,QAAS,KAGvCpG,UAAUuE,2CACf,MACMgiC,QADQ,IAAI7D,EAAA2D,OACWhxB,KAAK9Q,GAClC,IAAKgiC,EACJ,OAAO3jC,QAAQE,OAAO0S,MAAM,uBAE7B,MAAMtM,GACL9C,QAASmgC,EAAST,KAAKG,IACvBJ,WAWD,OATAU,EAASV,OAAO9sB,QAAQytB,IACvB,MAAMhsB,EAAItR,EAAI28B,OAAOW,EAAM//B,QAC3B,GAAI+/B,EAAMvoC,OAASuoC,EAAMvoC,MAAMY,eAAe,OAAQ,CACrD,MAAM4nC,EAAgBD,EAAMvoC,MAC5BwoC,EAAS3iB,IAAM2iB,EAAS3iB,IAAIrjB,SAAS,UAEtC+Z,EAAE1H,KAAK0zB,EAAMvoC,OACbiL,EAAI28B,OAAOW,EAAM//B,IAAM+T,IAEjBtR,IAGFlJ,eAAeuE,EAAkB0H,2CACtC,MACM/C,QADQ,IAAIw5B,EAAA2D,OACMhxB,KAAK9Q,GAC7B,IAAK2E,EACJ,SAED,MAAMs9B,EAAQt9B,EAAI28B,OAAOjrB,KAAKJ,IACxB,OAAQ,OAAO3H,QAAQ2H,EAAE/T,KAAO,GACL+T,EAAEvc,MAAOyoC,cAAgBz6B,GAI1D,OAAKu6B,GAGGz1B,OAAgCy1B,EAAMvoC,MAAO6lB,IAAK6iB,SAAkCH,EAAMvoC,MAAO0oC,eAGpG3mC,oBAAoB4mC,2CACzB,MAAM5iC,QAAa/D,KAAK6kC,OAAOjjC,OAAO+kC,GACtC,OAAOthC,EAAOuhC,oBAAoB7iC,KAG7BhE,8BAA8BqJ,2CACnC,MAAMrF,QAAa/D,KAAK6kC,OAAOz7B,SAASA,GACxC,OAAO/D,EAAOuhC,oBAAoB7iC,KAG7BhE,mBAAmB8mC,EAAmBF,2CAC3C,MAAM5iC,QAAa/D,KAAK6kC,OAAO/iC,MAAM+kC,EAAWF,GAC1Cz7B,EAAS7F,EAAOyhC,mBAAmB/iC,GACzC,GAAImH,GAAUA,EAAOf,KAAM,CAC1B,MAAM48B,QAAW/mC,KAAKilB,YAAY+hB,QAAQxgC,GAAI0E,EAAOf,KAAM6B,KAAM,UAAWi7B,IAAK,WACjF/7B,EAAO4a,SAAWihB,EAAGjhB,SAEtB,OAAO5a,IAGFnL,4BAA4BgM,2CACjC,MAAMhI,QAAa/D,KAAK6kC,OAAO94B,QAAQA,GACjCb,EAAS7F,EAAOyhC,mBAAmB/iC,GACzC,GAAImH,EAAQ,CACX,MAAM67B,QAAW/mC,KAAKilB,YAAY+hB,QAAQxgC,GAAIuF,EAASC,KAAM,UAAWi7B,IAAK,WAC7E/7B,EAAO4a,SAAWihB,EAAGjhB,SAEtB,OAAO5a,IAGFnL,sBAAsBmJ,EAAetH,2CAC1C,MAAMmC,QAAa/D,KAAK6kC,OAAOqC,aAAah+B,EAAOtH,GACnD,OAAOyD,EAAO8hC,yBAAyBpjC,KAGlChE,iCAAiCqhB,2CACtC,MAAMrd,QAAa/D,KAAK6kC,OAAOuC,eAAehmB,GAC9C,OAAO/b,EAAO8hC,yBAAyBpjC,KAGlChE,kBAAkB4mC,2CAEvB,MAAM5iC,QAAa/D,KAAK6kC,OAAOwC,eAAeV,GAC9C,OAAOthC,EAAOiiC,sBAAsBvjC,KAG/BhE,4BAA4BqJ,2CAEjC,MAAMrF,QAAa/D,KAAK6kC,OAAO0C,iBAAiBn+B,GAChD,OAAO/D,EAAOiiC,sBAAsBvjC,KAG/BhE,eAAeuE,EAAkBihB,2CACtC,OAAOvlB,KAAKilC,SAASA,SAAS3gC,EAAUihB,KAGnCxlB,kBAAkBiM,EAAc0S,2CACrC,OAAO1e,KAAKilB,YAAY1J,QAAQvP,KAAMA,EAAM0S,YAGvC3e,kBAAkBiM,EAAcxF,EAAYygC,2CACjD,OAAOjnC,KAAKilB,YAAY+hB,QAAQh7B,KAAMA,EAAMxF,KAAIygC,UAG3ClnC,yBAAyB4E,2CAC9B,MAAM+Z,GACL8oB,KAAM7iC,EAAOsE,IAAIyP,WACjB9W,OAAQ+C,EAAOsE,IAAIrH,OACnB6lC,QAAS9iC,EAAOsE,IAAInH,OAAS6C,EAAOsE,IAAIC,OAEzC,OAAOlJ,KAAKilB,YAAY1J,QAAQvP,KAAM,UAAW0S,YAG5C3e,aAAaiM,EAAcxF,2CAEhC,OAAOxG,KAAK6kC,OAAOmC,OAAOh7B,EAAMxF,KAG3BzG,UAAU6B,EAAgB2M,2CAC/B,OAAOvO,KAAKmlC,YAAY5pB,OAAO3Z,EAAQ2M,sBCxazCzR,EAAAD,QAAAkC,QAAA,uXCAA,MAAA2oC,EAAA/qC,EAAA,IAeAE,EAAAuoC,gCAAuCsC,EAAAC,oBAEtC5nC,YAAYsR,GACXsF,MAAM,EAAG,IAAMtF,GAGVtR,OAAO4mC,EAAoBiB,2CAChC,MAAMC,GACLjmC,OAAQ+kC,EACRp4B,KAAMq5B,GAED7jC,QAAa/D,KAAK8nC,QAAa,0DAA2DD,GAChG,IAAK9jC,IAASA,EAAKgkC,eAClB,OAED,MAAMvqC,EAAIuG,EAAKgkC,eAaf,OAXCvhC,IAAKhJ,EAAIA,EAAEwqC,QAAQ,GAAK,KAAO,GAC/BC,SAAUzqC,EAAIA,EAAE0qC,QAAQ,GAAK,KAAO,GACpCC,UAAW3qC,EAAIA,EAAE4qC,cAAc,GAAK,KAAO,GAC3C75B,MAAO/Q,EAAIA,EAAE6qC,UAAU,GAAK,KAAO,GACnCzmC,QAASpE,EAAIA,EAAE8qC,YAAY,GAAK,KAAO,GACvCj+B,KAAM7M,EAAIA,EAAE+qC,SAAS,GAAK,KAAO,GACjCC,cAAehrC,EAAIA,EAAEirC,kBAAkB,GAAK,KAAO,GACnD9J,MAAOnhC,EAAIA,EAAEkrC,UAAU,GAAK,KAAO,GACnCC,YAAanrC,EAAIA,EAAEorC,gBAAgB,GAAK,KAAO,GAC/CC,OAAQrrC,EAAIA,EAAEsrC,MAAM,GAAK,KAAO,scCzCnC,MAAA93B,EAAA/R,EAAAtC,EAAA,KACAsU,EAAAhS,EAAAtC,EAAA,IACAosC,EAAA9pC,EAAAtC,EAAA,KAEAE,EAAA8qC,0BAIC5nC,YAAYoR,EAA4BC,EAA2BC,GAClErR,KAAKsR,QAAU,IAAIN,EAAA9R,QAAYqS,YAAYJ,EAAoBC,GAC/DpR,KAAKqR,UAAYA,EAGFtR,QAAWsK,EAAa6F,2CACvC,MAAMsB,GACLnH,MACAoH,SAAUC,aAAc1R,KAAKqR,WAC7BM,GAAIzB,GAEL,OAAO,IAAIvN,QAAW,CAACC,EAASC,KAC/B7C,KAAKsR,QAAQO,aAAa,EAAG,KAC5BZ,EAAA/R,QAAQsS,EAAS,CAACzO,EAAK+O,EAAUC,KAChC,GAAIhP,EACH,OAAOF,EAAOE,GAEfgmC,EAAA7pC,QAAO8pC,YAAYj3B,EAAM,CAACyuB,EAAMt1B,KAC/B,GAAIs1B,EACH,OAAO39B,EAAO29B,GAEf59B,EAAWsI,8BC7BjBpO,EAAAD,QAAAkC,QAAA,wcCAA,MAAAkqC,EAAAtsC,EAAA,IACAusC,EAAAvsC,EAAA,GAIM4C,EAFNN,EAAAtC,EAAA,IAEYuC,QAAO,YAIbiqC,EAAe,qEAarBtsC,EAAAqoC,6BAAoCgE,EAAAh4B,iBAGnCnR,YAAYyR,GAEXmF,MAAM,EAAG,IAAMnF,EAAQH,WACvBrR,KAAKwR,QAAUA,EAGFzR,IAAIqpC,EAAkB7jB,2CACnCA,EAAWA,GAAYvlB,KAAKwR,QAAQ0D,MAAQi0B,EAC5C5pC,EAAIwK,KAAK,4BAA6Bwb,GACtC,MAAMxhB,QAAa/D,KAAK8nC,QAA0B,qCACjDpoC,OAAQ,OACRwV,KAAMqQ,EACNyP,OAAQh1B,KAAKwR,QAAQlT,IACrBmL,SAAU2/B,EAAG3/B,SAAS4/B,QAAQ,GAC9BC,YAAaF,EAAGE,cAEjB,MAAoB,OAAhBvlC,EAAKyB,OACD7C,QAAQE,OAAO0S,MAAMxR,EAAKyB,SAE3BzB,EAAKwlC,UAGPxpC,SAASgF,EAAcwgB,2CAC5B,IACC,MAAMra,QAAe+9B,EAAAO,OAAOzkC,EAAM/E,KAAKwR,QAAQg4B,YAC/C,OAAOxpC,KAAKpC,IAAIsN,EAAQqa,GACvB,MAAOniB,GAER,OADA7D,EAAImG,MAAMtC,yXCpDb,MAAAqmC,EAAA9sC,EAAA,IAaAE,EAAA2sC,OAAA,SAA6BllC,EAAkBkN,2CAC9C,MAAMk4B,GAAuB,SAO7B,OANIl4B,EAAQhI,QACXkgC,EAAK72B,KAAK,UAAWrB,EAAQhI,OAAO6/B,QAAQ,IAEzC73B,EAAQm4B,KACXD,EAAK72B,KAAK,cAEE42B,EAAArlB,cAA4B,SAAU,kBAAmBslB,EAAMplC,qcCrB7E,MAAAjC,EAAApD,EAAAtC,EAAA,IACA4F,EAAAtD,EAAAtC,EAAA,IAEAwI,EAAAxI,EAAA,GAEMitC,EAAYlgB,UAAiC,UAArBA,QAAQmgB,UAAwB,kBAAkBt1B,KAAKmV,QAAQogB,IAAIC,QAAU,KAErGxQ,KAEAyQ,EAAQJ,EAAY,IAAM,IAgFhC,SAASK,EAAU3lC,EAAkBkN,EAA+B1O,GACnE,QAAKA,EAAKK,WAGLymC,EA1CN,SAA0BtlC,EAAkBkN,EAA+B1O,GAC1E,IAAKA,EAAKonC,mBAAqBpnC,EAAKK,SACnC,OAAO,EAER,MAAMgnC,OAA8BpjC,IAApByK,EAAQ44B,QAAwB54B,EAAQ44B,QAAU1gB,QAAQogB,IAAIO,QAC9E,IAAKF,EACJ,OAAO,EAER,MAAMG,EAAWH,EAAQ12B,MAAM,KAC/B,IAA8B,IAA1B62B,EAAS13B,QAAQ,IACpB,OAAO,EAER,IAAK,IAAI7V,EAAI,EAAGA,EAAIutC,EAAS9gC,OAAQzM,IAAK,CACzC,MAAM8B,EAAIyrC,EAASvtC,GAAG0H,cACtB,GAAI5F,GAAKyF,EAASk+B,QAAQ3jC,EAAE2K,QAAQ/E,gBAAkB5F,EACrD,OAAO,EAGT,OAAO,EA2BC0rC,CAAiBjmC,EAAUkN,EAAS1O,GAxB7C,SAAmBwB,EAAkBkN,EAA+B1O,GACnE,MAAM0nC,EAAM1nC,EAAK5E,KACXusC,EAAM3nC,EAAK2nC,IACXC,EAAM5nC,EAAK4nC,IACXC,EAAsDjhB,QAAQkhB,QAAUlhB,QAAQkhB,SAChFC,EAAsDnhB,QAAQohB,QAAUphB,QAAQohB,SAChF5I,EAAIz7B,SAAS,MAAO,GACpBskC,EAAItkC,SAAS,MAAO,GAO1B,SAJa+jC,EAFH/jC,SAAS,MAAO,IAGxB+jC,EAAMO,GAAML,IAAQG,GACpBL,EAAMtI,GAAMuI,IAAQE,GACpBH,GAJStI,EAAI6I,IAIU,IAAVJ,GASPK,CAAU1mC,EAAUkN,EAAS1O,IAYtC,SAAgBmoC,EAAO5iB,EAAa5D,GACnC,MAAMymB,KACAnhC,EAjGP,SAAqBse,EAAa6iB,GACjC,MAAMC,EAAQD,EAAIC,OAASnB,EAC3B,IAAIoB,EAAUF,EAAIliC,MAAQ0gB,QAAQogB,IAAIuB,MAAQ,GAC1CjB,GAAW,IAEfgB,EAAUA,EAAQ33B,MAAM03B,GAExB,IAAIG,EAAa,GAoBjB,OAnBI1B,IACHwB,EAAQ/d,QAAQ3D,QAAQ6hB,OAExBnB,GADAkB,EAAcJ,EAAId,SAAW1gB,QAAQogB,IAAIO,SAAW,uBAC/B52B,MAAM03B,IAKD,IAAtB9iB,EAAIzV,QAAQ,MAA8B,KAAfw3B,EAAQ,IACtCA,EAAQ/c,QAAQ,MAMdhF,EAAInU,MAAM,OAAS01B,GAAavhB,EAAInU,MAAM,SAC7Ck3B,GAAW,MAIXtB,IAAKsB,EACLI,IAAKpB,EACLqB,OAAQH,GAmEII,CAAYrjB,EAAK6iB,GACxBE,EAAUrhC,EAAK+/B,IACfM,EAAUrgC,EAAKyhC,IACfF,EAAavhC,EAAK0hC,OAClB1T,MAEN,SAAU4T,EAAE5uC,EAAGC,GACd,GAAID,IAAMC,EACT,OAAIkuC,EAAI5tB,KAAOya,EAAMvuB,OACbib,EAAG,KAAMsT,GAETtT,EA1EX,SAA0B4D,GACzB,MAAMujB,EAAK,IAAIr2B,MAAM,cAAgB8S,GAErC,OADMujB,EAAIvoC,KAAO,SACVuoC,EAuEMC,CAAiBxjB,IAI7B,IAAIyjB,EAAWV,EAAQruC,GACI,MAAvB+uC,EAAS3J,OAAO,IAAqC,MAAvB2J,EAAStnC,OAAO,KACjDsnC,EAAWA,EAAStnC,MAAM,GAAI,IAG/B,IAAI3F,EAAI0D,EAAArD,QAAKoB,KAAKwrC,EAAUzjB,IACvByjB,GAAY,YAAcv3B,KAAK8T,KACnCxpB,EAAIwpB,EAAI7jB,MAAM,EAAG,GAAK3F,GAEvB,SAAUktC,EAAEC,EAAIC,GACf,GAAID,IAAOC,EACV,OAAON,EAAE5uC,EAAI,EAAGC,GAEjB,MAAMwuC,EAAMpB,EAAQ4B,IApCvB,SAAe1nC,EAAkBkN,EAA+BiT,GAC/DpiB,EAAAnD,QAAG4D,KAAKwB,EAAU,CAACvB,EAAKD,KACvB2hB,EAAG1hB,GAAKA,GAAcknC,EAAU3lC,EAAUkN,EAAS1O,MAmClDopC,CAAMrtC,EAAI2sC,GAAMpB,QAASkB,GAAa,CAACvoC,EAAKopC,KAC3C,IAAKppC,GAAOopC,EAAI,CACf,IAAIjB,EAAI5tB,IAGP,OAAOmH,EAAG,MAAO5lB,EAAI2sC,IAFrBzT,EAAMllB,KAAKhU,EAAI2sC,GAKjB,OAAOO,EAAEC,EAAK,EAAGC,KAbnB,CAeG,EAAG7B,EAAQ5gC,QAjCf,CAkCG,EAAG4hC,EAAQ5hC,QA1Cf3M,EAAAouC,SA6EApuC,EAAAinB,WAAA,SAAiCxmB,EAAcqmB,2CAC9C,GAAIrmB,KAAQi8B,EACX,OAAOA,EAAMj8B,GAEd,IAEC,MAAMwB,QAhBR,SAA0B6kB,2CACzB,MAAM7kB,EAAI4qB,QAAQogB,IAAInmB,GACtB,GAAI7kB,GAAKA,EAAE0K,OAAS,UACErE,EAAAjC,WAAWpE,IAE/B,OAAOA,IAWQstC,CAAWzoB,GAC3B,GAAI7kB,GAAKA,EAAE0K,OAAS,EAEnB,OADA+vB,EAAMj8B,GAAQwB,EACPA,EAEP,MAAOsE,IAET,IAEC,MAAMtE,QA/CR,SAAqBxB,2CACpB,OAAO,IAAIqF,QAA4B,CAACC,EAASC,KAChDooC,EAAO3tC,EAAM,CAACyF,EAAKmI,KACdnI,EACHF,EAAOE,GACGmI,GAAUA,EAAO1B,OAAS,EACpC5G,EAAQsI,EAAO,IAEftI,UAuCcypC,CAAM/uC,GACtB,GAAIwB,GAAKA,EAAE0K,OAAS,EAEnB,OADA+vB,EAAMj8B,GAAQwB,EACPA,EAEP,MAAOsE,IAET,IAEC,MAAMtE,QA1CR,SAAwBxB,2CACvB,MAAMwB,EAAIyD,EAAArD,QAAKoB,KAAK,IAAK,MAAO,QAAShD,EAAMosB,QAAQmgB,SAAUngB,QAAQ4iB,KAAMhvC,IAASssC,EAAY,OAAS,IAE7G,SADqBzkC,EAAAjC,WAAWpE,GAE/B,OAAOA,IAsCSytC,CAASjvC,GACzB,GAAIwB,GAAKA,EAAE0K,OAAS,EAEnB,OADA+vB,EAAMj8B,GAAQwB,EACPA,EAEP,MAAOsE,uBCpNVtG,EAAAD,QAAAkC,QAAA,+cCAA,MAAAmqC,EAAAvsC,EAAA,GAKM4C,EAHNN,EAAAtC,EAAA,IAGYuC,QAAO,UAEnBrC,EAAAioC,2BAAkCoE,EAAAh4B,iBAGjCnR,YAAYyR,GAEXmF,MAAM,EAAG,IAAMnF,EAAQH,WACvBrR,KAAKwR,QAAUA,EAGRzR,SAASuM,GAEhB,MAAMkgC,EAAO,CAAChvC,EAAQqL,KACrB,GAAU,OAANrL,QAGMuJ,IAANvJ,EAAJ,CAGA,GAAIsqB,MAAMC,QAAQvqB,GACjB,OAAOA,EAAE0J,IAAK+R,GAAauzB,EAAKvzB,EAAKpQ,IAASwP,OAAQY,QAAqBlS,IAARkS,GAEpE,GAAiB,iBAANzb,EAAgB,CAC1B,MAAM0N,KA0CN,OAzCAzN,OAAOma,KAAKpa,GAAGsb,QAAQxa,IACtB,MAAM2a,EAAMuzB,EAAKhvC,EAAEc,GAAMd,QACbuJ,IAARkS,IACS,UAAR3a,EACH4M,EAAY,IAAI+N,EACE,UAAR3a,EACVb,OAAOma,KAAKqB,GAAKH,QAAQ2zB,IACxBvhC,EAAOuhC,GAAUxzB,EAAIwzB,KAEJ,SAARnuC,EACN2a,EAAIhQ,KACF6e,MAAMC,QAAQ9O,EAAIhQ,OACtBgQ,EAAIhQ,KAAOgQ,EAAIhQ,MAEhBiC,EAAO5M,GAAO2a,EAAIhQ,KAElBiC,EAAO5M,GAAO2a,EAEG,WAAR3a,EACN2a,EAAIjO,OACF8c,MAAMC,QAAQ9O,EAAIjO,SACtBiO,EAAIjO,OAASiO,EAAIjO,QAElBE,EAAO5M,GAAO2a,EAAIjO,OAElBE,EAAO5M,GAAO2a,EAEG,UAAR3a,GACN2a,EAAInD,MACFgS,MAAMC,QAAQ9O,EAAInD,QACtBmD,EAAInD,MAAQmD,EAAInD,OAEjB5K,EAAO5M,GAAO2a,EAAInD,MAKnB5K,EAAO5M,GAAO2a,KAIV/N,EAER,OAAO1N,IAER,OAAOgvC,EAAKlgC,MAGCvM,IAAI2sC,EAAazsC,2CAC9BV,EAAIwK,KAAK,aAAc2iC,EAAKt8B,KAAKC,UAAUpQ,IAC3CA,EAAe,OAAIysC,EACnB,MAAMC,GAA8CvkB,OAAUskB,GAC9DjvC,OAAOma,KAAK3X,GAAQ6Y,QAAQxa,IAC3BquC,EAAcruC,GAAO2B,EAAO3B,KAE7BquC,EAAuB,QAAI3sC,KAAKwR,QAAQlT,IACxCquC,EAAsB,OAAI,OAC1B,MAAM5oC,QAAa/D,KAAK8nC,QAAQ,oCAAqC6E,GACrE,OAAsB3sC,KAAK4sC,SAAS7oC,KAG/BhE,OAAO6B,2CAGZ,aADmB5B,KAAKpC,IAAI,kBAAmBgE,YACnCA,SAGP7B,QAAQoK,2CAGb,aADmBnK,KAAKpC,IAAI,kBAAmBuM,UACnCa,QAGPjL,SAASoK,2CAGd,aADmBnK,KAAKpC,IAAI,kBAAmBuM,UACnCvI,SAGP7B,MAAM+B,EAAeF,2CAG1B,aADmB5B,KAAKpC,IAAI,iBAAkBgE,SAAQE,WAC1CA,QAGP/B,QAAQoK,2CAGb,aADmBnK,KAAKpC,IAAI,iBAAkBuM,UAClCrI,QAGP/B,eAAeoK,2CAGpB,aADmBnK,KAAKpC,IAAI,oBAAqBuM,UACrC0iC,YAGP9sC,aAAaiL,EAAepJ,2CAGjC,aADmB5B,KAAKpC,IAAI,oBAAqBoN,QAAOpJ,YAC5CkrC,gBAGP/sC,eAAeoK,2CAGpB,aADmBnK,KAAKpC,IAAI,oBAAqBuM,UACrC2iC,gBAGP/sC,eAAe6B,2CAGpB,aADmB5B,KAAKpC,IAAI,uBAAwBgE,YACxCirC,YAGP9sC,iBAAiBoK,2CAGtB,aADmBnK,KAAKpC,IAAI,uBAAwBuM,UACxC0iC,YAGP9sC,OAAOiM,EAAcxF,2CAC1B,MAAa,UAATwF,GAEKlK,YADY9B,KAAK+L,QAAQvF,IAEd,oBAATwF,GAEF6gC,gBADgB7sC,KAAK+sC,eAAevmC,IAEzB,WAATwF,GAEFpK,aADa5B,KAAKoJ,SAAS5C,IAEhB,UAATwF,GAEFhB,YADYhL,KAAKohB,QAAQ5a,IAEd,kBAATwF,GAEF8gC,oBADoB9sC,KAAKonC,eAAe5gC,IAE7B,qBAATwF,GAEF6gC,gBADgB7sC,KAAKunC,iBAAiB/gC,IAGvC7D,QAAQE,OAAO0S,MAAM,2eC3K/B,MAAA2zB,EAAAvsC,EAAA,GACAqwC,EAAArwC,EAAA,IAKM4C,EAHNN,EAAAtC,EAAA,IAGYuC,QAAO,eAEnBrC,EAAA6nC,gCAAuCwE,EAAAh4B,iBAYtCnR,YAAYyR,GAEXmF,MAAM,EAAG,IAAMnF,EAAQH,WAbxBrR,KAAAwR,SACC0jB,KAAM,yBACN+X,KAAM,GACNC,SAAU,SACV77B,UAAW,GACXuwB,MAAO,GACPgD,SAAS,EACTuI,WAAY,IACZC,WAAY,GAMZptC,KAAKwR,QAAU/T,OAAO2I,UAAWpG,KAAKwR,QAASA,GAGxCzR,SAASuM,GAChB,MASMkgC,EAAQhvC,IACb,GAAU,OAANA,QAGMuJ,IAANvJ,EAAJ,CAGA,GAAIsqB,MAAMC,QAAQvqB,GACjB,OAAOA,EAAE0J,IAAK+R,GAAauzB,EAAKvzB,IAAMZ,OAAQY,QAAqBlS,IAARkS,GAE5D,GAAiB,iBAANzb,EAAgB,CAC1B,MAAM0N,KAON,OANAzN,OAAOma,KAAKpa,GAAGsb,QAAQxa,IACtB,MAAM2a,EAAMuzB,EAAKhvC,EAAEc,SACPyI,IAARkS,IACH/N,EAxBc,CAAC5M,GACXA,EAAImV,MAAM,KAAKvM,IAAI,CAAClJ,EAAOuK,IACnB,IAAVA,EACIvK,EAEDA,EAAM,GAAGqvC,cAAgBrvC,EAAMwG,MAAM,IAC1ClE,KAAK,IAkBEgtC,CAAUhvC,IAAQ2a,KAGpB/N,EAER,OAAO1N,IAER,OAAOgvC,EAAKlgC,GAGLvM,kBAAkB2e,GACzB,OAAOjhB,OAAOma,KAAK8G,GACjBrG,OAAO/Z,QAA8ByI,IAAhB2X,EAAOpgB,IAA4C,OAAhBogB,EAAOpgB,IAC/D4I,IAAI5I,GAAOA,EAAM,KAAOivC,mBAAyB7uB,EAAOpgB,IAAQ,KAChEgC,KAAK,aAGMP,IAAI+P,2CACjB,MAAMmP,EAAIxhB,OAAOma,KAAK9H,EAAI4O,OACxBrG,OAAO/Z,QAA2ByI,IAAnB+I,EAAI4O,MAAMpgB,IAAyC,OAAnBwR,EAAI4O,MAAMpgB,IACzD4I,IAAI5I,GAAOA,EAAM,IAAMwR,EAAI4O,MAAMpgB,IACnC2gB,EAAEpM,KAAK,UAAY/C,EAAI8xB,OAAS5hC,KAAKwR,QAAQowB,OAAS,KACtD3iB,EAAEpM,KAAK,WAAa/C,EAAIiQ,QAAU,IAClCd,EAAEpM,KAAK,YACP,MAAMxI,EAAMrK,KAAKwR,QAAQ0jB,MAA8B,KAAtBl1B,KAAKwR,QAAQy7B,KAAc,IAAMjtC,KAAKwR,QAAQy7B,KAAO,IAAMn9B,EAAI9G,KAAO,IAAMiW,EAAE3e,KAAK,KAM9GkR,EAAUxR,KAAKwR,QACf5T,EAAMoC,KAAKpC,IAEjB,SAAe4vC,EAAM9nC,2CACpB,OAAI8L,EAAQozB,SAAW90B,EAAI09B,MAAQh8B,EAAQ47B,YAC1Ct9B,EAAI09B,QACJjuC,EAAIwK,KAAK,+BAAiCyH,EAAQ27B,WAAa,MACxD,IAAIxqC,QAAa,CAACC,EAASC,KACjCs9B,WAAW,KACVviC,EAAIkS,GAAKqX,KAAKvkB,GAASwkB,MAAMvkB,IAC3B2O,EAAQ27B,eAGLxqC,QAAQE,OAAO6C,KAIxBnG,EAAIwK,KAAK,aAAcqG,KAAKC,UAAUP,IACtC,IACC,MAAM/L,QAAa/D,KAAK8nC,QAAaz9B,OAAKtD,GAC1C,MAxBwB,CAACgL,GACjBA,GAAQA,EAAKrM,OAASqM,EAAKrM,MAAMkN,QAAQ,yBAA2B,EAuBxE66B,CAAiB1pC,GACbypC,EAAMj4B,MAAMxR,EAAK2B,QAElB3B,EACN,MAAOX,GACR,MAAMiS,EAAajS,EAAEiS,WACrB,OAAmB,MAAfA,GAAqC,MAAfA,EAClBm4B,EAAMpqC,GAENT,QAAQE,OAAOO,MAKnBrD,OAAOE,2CACZ,MAAM8D,QAAa/D,KAAKpC,KACvBoL,KAAMhJ,KAAKwR,QAAQ07B,SAAWjtC,EAAO+L,KAAO,IAC5C0S,OAAQA,MAAO1e,KAAK0tC,kBAAkBztC,EAAOye,YAC7C8uB,MAAO,EACP5L,MAAO3hC,EAAO2hC,MACd7hB,OAAQ9f,EAAO8f,SAEhB,OAAO/f,KAAK4sC,SAAS7oC,KAGhBhE,aAAaE,2CAElB,IAAKA,EAAOye,OAAiC,IAAxBze,EAAOye,MAAMlV,OACjC,OAAO7G,QAAQE,OAAO0S,MAAM,0BAA4BtV,EAAO+L,OAEhE,MAAMjI,QAAa/D,KAAKpC,KACvBoL,KAAMhJ,KAAKwR,QAAQ07B,SAAWjtC,EAAO+L,KAAO,IAC5C0S,OACCA,MAAO6uB,mBAAmBttC,EAAOye,OAAS,KAE3C8uB,MAAO,EACP5L,MAAO3hC,EAAO2hC,MACd7hB,OAAQ9f,EAAO8f,SAEV7U,KAEN,OADAA,EAAOjL,EAAO+L,MAAQjI,MACf/D,KAAK4sC,SAAS1hC,KAGhBnL,OAAOE,2CACZ,IAAKA,EAAOuG,IAA2B,IAArBvG,EAAOuG,GAAGgD,OAC3B,OAAO7G,QAAQE,OAAO0S,MAAM,8BAAgCtV,EAAO+L,OAEpE,MAAMg7B,EAASgG,EAAAW,eAAe1tC,EAAO+L,MAC/Bi7B,EAAMhnC,EAAOgnC,KAAO+F,EAAAW,eAAe1tC,EAAO+L,MAAM1L,KAAK,KAC3D,IAAK0mC,EACJ,OAAOrkC,QAAQE,OAAO0S,MAAM,mBAE7B,MAAMxR,QAAa/D,KAAKpC,KACvBoL,KAAMhJ,KAAKwR,QAAQ07B,SAAWjtC,EAAO+L,KAAO,IAAM/L,EAAOuG,GACzDkY,OACCvU,KAAMlK,EAAOuG,GACbygC,IAAKA,GAENuG,MAAO,EACP5L,MAAO3hC,EAAO2hC,MACd7hB,OAAQ9f,EAAO8f,SAEV7U,KAEN,OADAA,EAAOjL,EAAO+L,MAAQjI,MACf/D,KAAK4sC,SAAS1hC,KAGhBnL,OAAOE,2CACZ,MAAM2tC,EAAanwC,OAAOma,KAAK3X,EAAO4tC,WAAWlzB,KAAKrc,IAAQ0uC,EAAAc,kBAAkB7tC,EAAO+L,OAASghC,EAAAc,kBAAkB7tC,EAAO+L,MAAM4G,QAAQtU,GAAO,GAC9I,GAAIsvC,EACH,OAAOjrC,QAAQE,OAAO0S,MAAM,sCAAwCtV,EAAO+L,KAAO,KAAO4hC,IAE1F,MAAMlvB,EAAQjhB,OAAO2I,QAAQ6gC,IAAKhnC,EAAOgnC,KAAMhnC,EAAO4tC,WAChD9pC,QAAa/D,KAAKpC,KACvBoL,KAAMhJ,KAAKwR,QAAQ07B,SAAWjtC,EAAO+L,KACrC0S,QACA8uB,MAAO,EACP5L,MAAO3hC,EAAO2hC,MACd7hB,OAAQ9f,EAAO8f,SAEV7U,KAEN,OADAA,EAAOjL,EAAO+L,MAAQjI,MACf/D,KAAK4sC,SAAS1hC,sFCxLVrO,EAAAixC,mBACZ3P,MAAO,cACPv8B,QAAS,OAAQ,aAAc,YAAa,UAAW,gBAAiB,QACxEmsC,YAAa,OAAQ,SAAU,SAAU,QAAS,QAAS,QAAS,YAAa,UAAW,gBAAiB,QAC7GC,OAAQ,OAAQ,SAAU,aAAc,SACxCC,YAAa,cACbjQ,OAAQ,OAAQ,aAAc,WAC9BkQ,OAAQ,OAAQ,cAChB9R,WAAY,SAAU,aAAc,WACpCqL,SAAU,OAAQ,SAAU,aAAc,QAAS,QAAS,eAAgB,YAAa,iBACzF0G,iBAAkB,SAAU,aAAc,WAC1CC,QAAS,cACTC,MAAO,SAAU,cACjBhkC,KAAM,aAGMxN,EAAA8wC,gBACZxP,QACAv8B,QAAS,aAAc,WAAY,iBAAkB,QAAS,WAC9DmsC,YAAa,oBACbC,SACAC,cACAjQ,OAAQ,YACRkQ,SACA9R,WAAY,UAAW,WAAY,iBAAkB,UAAW,OAAQ,UAAW,cACnFqL,SAAU,UAAW,cAAe,SAAU,aAAc,iBAAkB,UAAW,QAAS,QAAS,iBAAkB,UAAW,OAAQ,cAChJ0G,iBAAkB,UAAW,WAAY,QAAS,iBAAkB,UAAW,OAAQ,UAAW,cAClGC,UACAC,QACAhkC,sCC7BD,IAAIikC,mDAEJ,MAAMC,GACL,QACA,eACA,UACA,QACA,QACA,OACA,SACA,UACA,OACA,QACA,UACA,SACA,QACA,MACA,MACA,MACA,SACA,OACA,SACA,aACA,cACA,MACA,cACA,SACA,aACA,cACA,UACA,WACA,QACA,YACA,SACA,SACA,YACA,eACA,OACA,QACA,OACA,aACA,SACA,QACA,mBACA,OACA,OACA,OACA,QACA,aACA,mBACA,oBACA,SACA,SACA,WACA,oBACA,aACA,WACA,YACA,QACA,gBACA,SACA,OACA,cACA,SACA,gBACA,WACA,SACA,kBACA,UACA,WACA,cACA,OACA,YACA,UACA,QACA,SACA,YACA,YACA,QACA,QACA,UACA,cACA,YACA,OACA,YACA,gBACA,QACA,cACA,QACA,QACA,UACA,SACA,YACA,aACA,cACA,mBACA,mBACA,iBACA,YACA,WACA,SACA,iBACA,WACA,SACA,SACA,UACA,QACA,gBACA,SACA,WACA,aACA,SACA,cACA,SACA,WACA,OACA,QACA,QACA,WACA,SACA,eACA,gBACA,YACA,OACA,YACA,YACA,aACA,aACA,aACA,MACA,cACA,aACA,WACA,SACA,QACA,UACA,YACA,aACA,OACA,wBACA,cACA,cACA,YACA,yBACA,iBACA,WACA,QACA,eACA,QACA,OACA,WACA,WACA,WACA,UACA,UACA,WACA,YACA,WACA,YACA,MACA,MACA,WACA,UACA,eACA,MACA,eACA,SACA,SACA,MACA,WACA,gBACA,WACA,YACA,YACA,SACA,YACA,eACA,YACA,YACA,YACA,YACA,WACA,aACA,YACA,cACA,eACA,YACA,gBACA,sBACA,UACA,aACA,SACA,UACA,cACA,YAi3BD,SAASC,EAAQ7kC,GAChB,OAAOA,EAAM9E,QAAQ,YAAa,IAAIJ,cAh3B1B5H,EAAA2uB,QACZ,SACA,gBACA,SACA,aACA,WACA,OACA,cACA,aACA,YACA,YACA,YACA,cACA,cACA,mBACA,WACA,qBACA,UACA,gBACA,sBACA,kBACA,sBACA,kBACA,WACA,YACA,cACA,sBACA,oBACA,sBACA,oBACA,mBACA,UACA,cACA,gBACA,wBACA,YACA,eACA,QACA,YACA,QACA,WACA,WACA,WACA,QACA,sBACA,oBACA,kBACA,gBACA,YACA,2BACA,qBACA,YACA,cACA,mBACA,oBACA,aACA,MACA,UACA,mBACA,QACA,eACA,oBACA,gBACA,kBACA,SACA,iBACA,QACA,UACA,cACA,OACA,WACA,OACA,OACA,aACA,kBACA,QACA,QACA,gBACA,UACA,WACA,WACA,WACA,UACA,SACA,cACA,iBACA,YACA,QACA,gBACA,aACA,gBACA,SACA,cACA,SACA,gBACA,aACA,aACA,eACA,eACA,gBACA,SACA,YACA,iBACA,YACA,qBACA,YACA,YACA,QACA,kBACA,iBACA,gBACA,qBACA,uBACA,kBACA,UACA,cACA,UACA,kBACA,gBACA,cACA,QACA,UACA,gBACA,QACA,qBACA,UACA,iBACA,UACA,mBACA,UACA,YACA,YACA,SACA,eACA,eACA,cACA,cACA,SACA,eACA,gBACA,UACA,WACA,gBACA,kBACA,gBACA,cACA,SACA,YACA,WACA,YACA,YACA,aACA,eACA,WACA,oBACA,QACA,SACA,0BACA,wBACA,oBACA,kBACA,gBACA,iBACA,gBACA,iBACA,UACA,eACA,kBACA,uBACA,eACA,YACA,sBACA,gBACA,OACA,aACA,WACA,SACA,SACA,aACA,kBACA,oBACA,yBACA,oBACA,mBACA,mBACA,YACA,UACA,gBACA,cACA,cACA,eACA,cACA,eACA,gBACA,UACA,UACA,YACA,iBACA,mBACA,QACA,YACA,aACA,aACA,OACA,SACA,aACA,aACA,SACA,QACA,aACA,YACA,aACA,aACA,YACA,kBACA,UACA,iBACA,eACA,eACA,eACA,YACA,WACA,kBACA,WACA,WACA,iBACA,mBACA,cACA,aACA,YACA,YACA,YACA,aACA,cACA,cACA,gBACA,kBACA,iBACA,mBACA,QACA,aACA,aACA,YACA,QACA,aACA,WACA,YACA,QACA,YACA,eACA,QACA,eACA,cACA,cACA,cACA,YACA,WACA,MACA,aACA,UACA,WACA,aACA,OACA,gBACA,cACA,qBACA,iBACA,MACA,WACA,iBACA,UACA,gBACA,gBACA,gBACA,qBACA,kBACA,wBACA,eACA,aACA,wBACA,kBACA,cACA,gBACA,aACA,cACA,iBACA,MACA,gBACA,SACA,qBACA,aACA,aACA,aACA,cACA,WACA,YACA,qBACA,UACA,eACA,uBACA,qBACA,oBACA,OACA,kBACA,cACA,eACA,SACA,aACA,QACA,WACA,iBACA,OACA,aACA,WACA,YACA,YACA,YACA,WACA,cACA,QACA,iBACA,aACA,YACA,YACA,qBACA,YACA,aACA,YACA,kBACA,gBACA,eACA,aACA,QACA,aACA,UACA,OACA,eACA,aACA,WACA,cACA,cACA,kBACA,SACA,gBACA,eACA,YACA,SACA,QACA,OACA,iBACA,UACA,cACA,SACA,eACA,cACA,cACA,QACA,eACA,aACA,aACA,YACA,SACA,aACA,SACA,QACA,MACA,aACA,qBACA,YACA,SACA,eACA,SACA,eACA,cACA,QACA,YACA,UACA,eACA,SACA,UACA,UACA,aACA,aACA,iBACA,WACA,aACA,WACA,YACA,cACA,UACA,WACA,eACA,mBACA,gBACA,WACA,YACA,cACA,kBACA,SACA,WACA,qBACA,UACA,eACA,YACA,UACA,UACA,UACA,QACA,cACA,aACA,cACA,aACA,QACA,cACA,kBACA,SACA,SACA,QACA,MACA,gBACA,WACA,WACA,aACA,QACA,aACA,YACA,aACA,eACA,aACA,kBACA,qBACA,mBACA,mBACA,kBACA,gBACA,eACA,uBACA,uBACA,mBACA,oBACA,cACA,eACA,eACA,cACA,cACA,cACA,QACA,WACA,aACA,YACA,OACA,aACA,cACA,aACA,WACA,YACA,YACA,YACA,UACA,cACA,MACA,OACA,OACA,aACA,UACA,YACA,SACA,QACA,eACA,oBACA,mBACA,SACA,YACA,UACA,UACA,YACA,SACA,SACA,gBACA,QACA,QACA,UACA,aACA,QACA,oBACA,eACA,kBACA,cACA,aACA,cACA,YACA,aACA,cACA,SACA,YACA,iBACA,iBACA,cACA,cACA,OACA,QACA,QACA,kBACA,sBACA,SACA,eACA,cACA,UACA,YACA,YACA,YACA,kBACA,SACA,cACA,kBACA,SACA,UACA,SACA,QACA,WACA,eACA,WACA,WACA,aACA,YACA,WACA,SACA,WACA,QACA,iBACA,aACA,mBACA,sBACA,oBACA,gBACA,WACA,WACA,WACA,QACA,YACA,cACA,cACA,aACA,aACA,qBACA,kBACA,iBACA,eACA,aACA,cACA,aACA,SACA,QACA,aACA,WACA,iBACA,4BACA,mBACA,UACA,mBACA,aACA,kBACA,gBACA,kBACA,MACA,WACA,WACA,WACA,eACA,kBACA,YACA,eACA,qBACA,UACA,yBACA,WACA,sBACA,YACA,WACA,UACA,WACA,iBACA,qBACA,WACA,WACA,eACA,kBACA,qBACA,WACA,gBACA,eACA,YACA,UACA,QACA,aACA,aACA,SACA,UACA,gBACA,kBACA,UACA,WACA,kBACA,YACA,WACA,UACA,UACA,SACA,gBACA,qBACA,SACA,QACA,eACA,kBACA,0BACA,QACA,iBACA,iBACA,SACA,cACA,SACA,sBACA,YACA,iBACA,YACA,UACA,oBACA,QACA,aACA,MACA,WACA,UACA,WACA,WACA,YACA,WACA,WACA,cACA,QACA,WACA,aACA,cACA,gBACA,aACA,YACA,oBACA,YACA,eACA,oBACA,cACA,cACA,YACA,gBACA,SACA,SACA,wBACA,sBACA,mBACA,oBACA,oBACA,kBACA,mBACA,qBACA,eACA,WACA,cACA,mBACA,kBACA,mBACA,qBACA,cACA,aACA,YACA,OACA,aACA,YACA,YACA,QACA,aACA,MACA,YACA,QACA,eACA,YACA,SACA,UACA,MACA,WACA,MACA,YACA,YACA,YACA,WACA,UACA,YACA,QACA,OACA,wBACA,WACA,WACA,SACA,iBACA,iBACA,gBACA,aACA,YACA,mBACA,QACA,UACA,iBACA,gBACA,aACA,OACA,cACA,kBACA,qBACA,aACA,aACA,QACA,cACA,UACA,SACA,QACA,kBACA,QACA,aACA,UACA,SACA,OACA,WACA,UACA,OACA,SACA,QACA,YACA,mBACA,cACA,WACA,YACA,oBACA,MACA,WACA,WACA,aACA,UACA,SACA,WACA,YACA,WACA,eACA,cACA,aACA,OACA,YACA,MACA,aACA,SACA,QACA,cACA,eACA,UACA,OACA,aACA,YACA,aACA,aACA,mBACA,gBACA,gBACA,QACA,gBACA,cACA,cACA,aACA,SACA,eACA,cACA,YACA,iBACA,mBACA,cACA,sBACA,cACA,cACA,YACA,aACA,eACA,cACA,WACA,YACA,cACA,QACA,wBACA,kBACA,iBACA,WACA,WACA,WACA,YACA,SACA,QACA,aACA,cACA,YACA,wBACA,SACA,oBACA,WACA,cACA,aACA,WACA,SACA,SACA,cACA,gBACA,WACA,eACA,eACA,aACA,QACA,SACA,YACA,4BACA,wBACA,UACA,SACA,eACA,OACA,WACA,SACA,eACA,WACA,WACA,SACA,YACA,WACA,iBACA,aACA,WACA,wBACA,cACA,cACA,sBACA,YACA,WACA,YACA,cACA,gBACA,sBACA,mBACA,iBACA,QACA,YACA,YACA,mBACA,eACA,SACA,aACA,QACA,aACA,eACA,YACA,YACA,mBACA,qBACA,kBACA,gBACA,cACA,QACA,YACA,eACA,cACA,YACA,UACA,OACA,eACA,UAOD3uB,EAAA4xC,cAAA,SAA8B9kC,GAC7B,MAAM+kC,EAAOF,EAAQ7kC,GAOrB,OANK2kC,IACJA,KACAzxC,EAAA2uB,OAAO1S,QAAQiyB,IACduD,EAAYE,EAAQzD,IAAMA,KAGrBuD,EAAYI,IAG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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 31);\n","module.exports = require(\"path\");","import winston from 'winston';\nimport {Config} from '../config';\n\nrequire('winston-timer')(winston);\n\nexport function configureLogger(config: Config) {\n\twinston.configure({\n\t\tlevel: config.log.level,\n\t\ttransports: [\n\t\t\tnew winston.transports.Console({\n\t\t\t\tformat:\n\t\t\t\t\twinston.format.combine(\n\t\t\t\t\t\t// winston.format.timestamp(),\n\t\t\t\t\t\twinston.format.colorize(),\n\t\t\t\t\t\twinston.format.simple()\n\t\t\t\t\t\t// winston.format.json()\n\t\t\t\t\t)\n\t\t\t})\n\t\t]\n\t});\n}\n\nclass Logger {\n\tprivate name: string;\n\n\tconstructor(name: string) {\n\t\tthis.name = name;\n\t}\n\n\tprivate applyLog(level: string, format: string, ...params: any[]) {\n\t\twinston.log.apply(this, [level, (new Date()).toISOString() + ' ' + this.name + ': ' + [format].concat(params).join(' ')]);\n\t}\n\n\tdebug(format: string, ...params: any[]) {\n\t\tthis.applyLog('debug', format, params);\n\t}\n\n\tinfo(format: string, ...params: any[]) {\n\t\tthis.applyLog('info', format, params);\n\t}\n\n\twarn(format: string, ...params: any[]) {\n\t\tthis.applyLog('warn', format, params);\n\t}\n\n\terror(format: string | Error, ...params: any[]) {\n\t\tthis.applyLog('error', format.toString(), params);\n\t}\n\n\ttime(name: string) {\n\t\t(<any>winston).start_log(name, 'debug');\n\t}\n\n\ttimeEnd(name: string) {\n\t\t(<any>winston).stop_log(name, 'debug');\n\t}\n}\n\nfunction logger(name: string) {\n\treturn new Logger(name);\n}\n\nexport default logger;\n","export enum DBObjectType {\n\troot,\n\tuser,\n\tfolder,\n\ttrack,\n\tstate,\n\tplaylist,\n\tpodcast,\n\tepisode,\n\tbookmark,\n\talbum,\n\tartist,\n\tplayqueue,\n\tradio\n}\n\nexport const AudioMimeTypes: { [ext: string]: string } = {\n\t'mp3': 'audio/mpeg',\n\t'm4a': 'audio/mp4',\n\t'ogg': 'audio/ogg',\n\t'oga': 'audio/ogg',\n\t'webma': 'audio/webm',\n\t'webm': 'audio/webm',\n\t'wav': 'audio/wav'\n};\n\nexport const VideoMimeTypes: { [ext: string]: string } = {\n\t'mp4': 'audio/mp4',\n\t'm4v': 'audio/mp4',\n\t'ogv': 'audio/ogg',\n\t'webmv': 'audio/webm',\n\t'webm': 'audio/webm'\n};\n\nexport enum FolderType {\n\tunknown = 'unknown',\n\tartist = 'artist',\n\tmultiartist = 'multiartist',\n\talbum = 'album',\n\tmultialbum = 'multialbum',\n\textras = 'extras',\n}\n\nexport const FolderTypeImageName: { [foldertype: string]: string } = {\n\tunknown: 'folder',\n\tartist: 'artist',\n\tmultiartist: 'folder',\n\talbum: 'cover',\n\tmultialbum: 'cover',\n\textras: 'folder'\n};\n\nexport const FolderTypesAlbum = [FolderType.album, FolderType.multialbum];\n\nexport enum DatabaseQuerySortType {\n\tascending, descending\n}\n\nexport enum AlbumType {\n\tunknown = 'unknown',\n\talbum = 'album',\n\tmix = 'mix',\n\taudiobook = 'audiobook'\n}\n\nexport enum FileTyp {\n\tUNKNOWN = 'unknown',\n\tAUDIO = 'audio',\n\tIMAGE = 'image',\n\tTAG = 'tag',\n\tBACKUP = 'backup',\n\tOTHER = 'other'\n}\n","import fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\nimport tmp from 'tmp';\n\nexport async function fsStat(pathName: string): Promise<fs.Stats> {\n\treturn new Promise<fs.Stats>((resolve, reject) => {\n\t\tfs.stat(pathName, (err, stat) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(stat);\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function fileRename(source: string, dest: string): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tfs.rename(source, dest, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function dirRename(source: string, dest: string): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tfs.rename(source, dest, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function dirRead(pathName: string): Promise<Array<string>> {\n\treturn new Promise<Array<string>>((resolve, reject) => {\n\t\tfs.readdir(pathName, (err, data) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(data);\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function fileDelete(pathName: string): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tfs.unlink(pathName, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function fileCopy(source: string, dest: string): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tfs.copyFile(source, dest, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function fileWrite(pathName: string, data: string | Buffer): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tfs.writeFile(pathName, data, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport async function fileDeleteIfExists(pathName: string): Promise<void> {\n\tconst exists = await fileExists(pathName);\n\tif (exists) {\n\t\treturn await fileDelete(pathName);\n\t}\n}\n\nexport async function fileExists(pathName: string): Promise<boolean> {\n\ttry {\n\t\tconst stat = await fsStat(pathName);\n\t\treturn stat.isFile();\n\t} catch (e) {\n\t\tif (e && e.code === 'ENOENT') {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\nexport async function dirExist(pathName: string): Promise<boolean> {\n\ttry {\n\t\tconst stat = await fsStat(pathName);\n\t\treturn stat.isDirectory();\n\t} catch (e) {\n\t\tif (e && e.code === 'ENOENT') {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\nexport function fileSuffix(filename: string): string {\n\treturn path.extname(filename).slice(1).toLowerCase();\n}\n\nexport async function makePath(folder: string): Promise<void> {\n\tconst exists = await dirExist(folder);\n\tif (exists) {\n\t\treturn;\n\t}\n\treturn new Promise<void>((resolve, reject) => {\n\t\tmkdirp(folder, (err) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport function replaceFileSystemChars(s: string, replace: string): string {\n\treturn s.toString()\n\t\t.replace(/:/g, ' - ').replace(/  /g, ' ')\n\t\t.replace(/[\\?\\/!\\\\]/g, replace);\n}\n\nexport async function tmpFile(): Promise<{ filename: string; cleanupCallback: () => void; }> {\n\treturn new Promise<{ filename: string; cleanupCallback: () => void; }>((resolve, reject) => {\n\t\ttmp.file((err, filename, fd, cleanupCallback) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve({filename, cleanupCallback});\n\t\t\t}\n\t\t});\n\t});\n}\n","module.exports = require(\"fs\");","import moment from 'moment';\nimport {JamServe} from '../../model/jamserve';\nimport path from 'path';\nimport {fileSuffix} from '../../utils/fs-utils';\nimport {AudioMimeTypes, DBObjectType} from '../../types';\nimport {Subsonic} from '../../model/subsonic-rest-data-1.16.0';\n\n\nexport interface SubsonicExtResponse extends Subsonic.Response {\n\t[name: string]: any;\n\txmlns: string;\n}\n\nexport interface SubsonicAPIResponse {\n\t'subsonic-response': SubsonicExtResponse;\n}\n\nexport class FORMAT {\n\tstatic FAIL = {\n\t\tGENERIC: 0,\n\t\tPARAMETER: 10,\n\t\tCLIENT_OLD: 20,\n\t\tSERVER_OLD: 30,\n\t\tCREDENTIALS: 40,\n\t\tUNAUTH: 50,\n\t\tNOTFOUND: 70\n\t};\n\n\tstatic packFail(code: number, txt?: string): SubsonicAPIResponse {\n\t\t/*\n\t\t <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t\t <subsonic-response xmlns=\"http://subsonic.org/restapi\"\n\t\t status=\"failed\" version=\"1.1.0\">\n\t\t <error code=\"40\" message=\"Wrong username or password\"/>\n\t\t </subsonic-response>\n\n\t\t The following error codes are defined:\n\t\t Code \tDescription\n\t\t 0 \tA generic error.\n\t\t 10 \tRequired parameter is missing.\n\t\t 20 \tIncompatible Subsonic REST protocol version. Client must upgrade.\n\t\t 30 \tIncompatible Subsonic REST protocol version. Server must upgrade.\n\t\t 40 \tWrong username or password.\n\t\t 50 \tuser is not authorized for the given operation.\n\t\t 60 \tThe trial period for the Subsonic server is over. Please upgrade to Subsonic Premium. Visit subsonic.org for details.\n\t\t 70 \tThe requested data was not found.\n\t\t */\n\n\t\tconst codeStrings: { [num: number]: string } = {\n\t\t\t0: 'A generic error.',\n\t\t\t10: 'Required parameter is missing.',\n\t\t\t20: 'Incompatible Subsonic REST protocol version. Client must upgrade.',\n\t\t\t30: 'Incompatible Subsonic REST protocol version. Server must upgrade.',\n\t\t\t40: 'Wrong username or password.',\n\t\t\t50: 'user is not authorized for the given operation.',\n\t\t\t70: 'The requested data was not found.'\n\t\t};\n\n\t\treturn {\n\t\t\t'subsonic-response': {\n\t\t\t\t'status': 'failed',\n\t\t\t\t'xmlns': 'http://subsonic.org/restapi',\n\t\t\t\t'error': {\n\t\t\t\t\tcode: code,\n\t\t\t\t\tmessage: txt || codeStrings[code]\n\t\t\t\t},\n\t\t\t\t'version': '1.16.0'\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic packResponse<T>(o: Subsonic.Response): SubsonicAPIResponse {\n\t\tconst response: SubsonicExtResponse = {\n\t\t\tstatus: 'ok',\n\t\t\txmlns: 'http://subsonic.org/restapi',\n\t\t\tversion: '1.16.0'\n\t\t};\n\t\treturn {\n\t\t\t'subsonic-response': Object.assign(response, o)\n\t\t};\n\t}\n\n\tstatic packOK(): SubsonicAPIResponse {\n\t\treturn {\n\t\t\t'subsonic-response': {\n\t\t\t\tstatus: 'ok',\n\t\t\t\txmlns: 'http://subsonic.org/restapi',\n\t\t\t\tversion: '1.16.0'\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic formatSubSonicDate(date: number): string {\n\t\treturn moment(date).utc().format(); // .format('YYYY-MM-DDThh:mm:ss.000Z');\n\t}\n\n\tstatic packRoot(root: JamServe.Root): Subsonic.MusicFolder {\n\t\treturn {id: parseInt(root.id, 10), name: root.name};\n\t}\n\n\tstatic packUser(user: JamServe.User): Subsonic.User {\n\t\treturn {\n\t\t\tusername: user.name,\n\t\t\temail: user.email,\n\t\t\tmaxBitRate: user.maxBitRate,\n\t\t\tavatarLastChanged: user.avatarLastChanged !== undefined ? this.formatSubSonicDate(user.avatarLastChanged) : undefined,\n\t\t\tfolder: user.allowedfolder ? user.allowedfolder.map(s => parseInt(s, 10)) : undefined,\n\t\t\tscrobblingEnabled: user.scrobblingEnabled,\n\t\t\tadminRole: user.roles.adminRole,\n\t\t\tsettingsRole: user.roles.adminRole, // user.roles.settingsRole,\n\t\t\tdownloadRole: user.roles.adminRole, // user.roles.downloadRole,\n\t\t\tuploadRole: user.roles.uploadRole,\n\t\t\tplaylistRole: user.roles.adminRole, // user.roles.playlistRole,\n\t\t\tcoverArtRole: user.roles.adminRole, // user.roles.coverArtRole,\n\t\t\tcommentRole: user.roles.adminRole, // user.roles.commentRole,\n\t\t\tpodcastRole: user.roles.podcastRole,\n\t\t\tstreamRole: user.roles.streamRole,\n\t\t\tjukeboxRole: user.roles.adminRole, // user.roles.jukeboxRole,\n\t\t\tshareRole: user.roles.adminRole, // user.roles.shareRole,\n\t\t\tvideoConversionRole: user.roles.adminRole, // user.roles.videoConversionRole\n\t\t};\n\t}\n\n\tstatic packFolderIndexArtist(entry: JamServe.FolderIndexEntry, state: JamServe.State): Subsonic.Artist {\n\t\t/*\n<xs:complexType name=\"Artist\">\n\t<xs:attribute name=\"id\" type=\"xs:string\" use=\"required\"/>\n\t<xs:attribute name=\"name\" type=\"xs:string\" use=\"required\"/>\n\t<xs:attribute name=\"starred\" type=\"xs:dateTime\" use=\"optional\"/> <!-- Added in 1.10.1 -->\n\t<xs:attribute name=\"userRating\" type=\"sub:UserRating\" use=\"optional\"/>  <!-- Added in 1.13.0 -->\n\t<xs:attribute name=\"averageRating\" type=\"sub:AverageRating\" use=\"optional\"/>  <!-- Added in 1.13.0 -->\n</xs:complexType>\n\t */\n\t\treturn {\n\t\t\tid: entry.folder.id,\n\t\t\tname: entry.name,\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined,\n\t\t\tuserRating: state ? state.rated : undefined\n\t\t\t// TODO: averageRating\n\t\t};\n\t}\n\n\tstatic packFolderIndex(index: JamServe.FolderIndex, states: JamServe.States): Array<Subsonic.Index> {\n\t\tif (!index) {\n\t\t\treturn [];\n\t\t}\n\t\treturn index.groups.map(i => ({\n\t\t\tname: i.name,\n\t\t\tartist: i.entries.map(e => {\n\t\t\t\treturn FORMAT.packFolderIndexArtist(e, states[e.folder.id]);\n\t\t\t})\n\t\t}));\n\t}\n\n\tstatic packArtistIndex(index: JamServe.ArtistIndex, states: JamServe.States): Array<Subsonic.IndexID3> {\n\t\tif (!index) {\n\t\t\treturn [];\n\t\t}\n\t\treturn index.groups.map(i => ({\n\t\t\tname: i.name,\n\t\t\tartist: i.entries.map(e => FORMAT.packArtist(e.artist, states[e.artist.id]))\n\t\t}));\n\t}\n\n\tstatic packDirectory(folder: JamServe.Folder, state: JamServe.State): Subsonic.Directory {\n\t\t/*\n\t\t <xs:complexType name=\"Directory\">\n\t\t <xs:sequence>\n\t\t <xs:element name=\"child\" type=\"sub:Child\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n\t\t </xs:sequence>\n\t\t <xs:attribute name=\"id\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"parent\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"name\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"starred\" type=\"xs:dateTime\" use=\"optional\"/> <!-- Added in 1.10.1 -->\n\t\t </xs:complexType>\n\t\t */\n\t\treturn {\n\t\t\tid: folder.id,\n\t\t\tparent: folder.parentID,\n\t\t\tname: path.basename(folder.path),\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined\n\t\t};\n\t}\n\n\tstatic packFolderArtist(folder: JamServe.Folder, state: JamServe.State): Subsonic.Artist {\n\t\t/*\n    <xs:complexType name=\"Artist\">\n        <xs:attribute name=\"id\" type=\"xs:string\" use=\"required\"/>\n        <xs:attribute name=\"name\" type=\"xs:string\" use=\"required\"/>\n        <xs:attribute name=\"starred\" type=\"xs:dateTime\" use=\"optional\"/> <!-- Added in 1.10.1 -->\n        <xs:attribute name=\"userRating\" type=\"sub:UserRating\" use=\"optional\"/>  <!-- Added in 1.13.0 -->\n        <xs:attribute name=\"averageRating\" type=\"sub:AverageRating\" use=\"optional\"/>  <!-- Added in 1.13.0 -->\n    </xs:complexType>\n\t\t */\n\t\treturn {\n\t\t\tid: folder.id,\n\t\t\tname: folder.tag.title || folder.tag.artist || '',\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined,\n\t\t\tuserRating: state ? state.rated : undefined\n\t\t};\n\t}\n\n\tstatic packAlbum(album: JamServe.Album, state: JamServe.State): Subsonic.AlbumID3 {\n\t\t/*\n\t\t <xs:complexType name=\"AlbumID3\">\n\t\t <xs:attribute name=\"id\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"name\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"artist\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"artistId\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"coverArt\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"songCount\" type=\"xs:int\" use=\"required\"/>\n\t\t <xs:attribute name=\"duration\" type=\"xs:int\" use=\"required\"/>\n\t\t <xs:attribute name=\"created\" type=\"xs:dateTime\" use=\"required\"/>\n\t\t <xs:attribute name=\"starred\" type=\"xs:dateTime\" use=\"optional\"/>\n\t\t <xs:attribute name=\"year\" type=\"xs:int\" use=\"optional\"/> <!-- Added in 1.10.1 -->\n\t\t <xs:attribute name=\"genre\" type=\"xs:string\" use=\"optional\"/> <!-- Added in 1.10.1 -->\n\n\t\t */\n\t\treturn {\n\t\t\tid: album.id,\n\t\t\tname: album.name,\n\t\t\tartist: album.artist,\n\t\t\tartistId: album.artistID,\n\t\t\tcoverArt: album.id,\n\t\t\tsongCount: album.trackIDs.length,\n\t\t\tduration: album.duration,\n\t\t\tyear: album.year,\n\t\t\tgenre: album.genre,\n\t\t\tcreated: FORMAT.formatSubSonicDate(album.created),\n\t\t\tstarred: state && state.faved ? FORMAT.formatSubSonicDate(state.faved) : undefined\n\t\t};\n\t}\n\n\tstatic packArtist(artist: JamServe.Artist, state: JamServe.State): Subsonic.ArtistID3 {\n\t\t/*\n\t\t <xs:complexType name=\"ArtistID3\">\n\t\t <xs:attribute name=\"id\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"name\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"coverArt\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"albumCount\" type=\"xs:int\" use=\"required\"/>\n\t\t <xs:attribute name=\"starred\" type=\"xs:dateTime\" use=\"optional\"/>\n\t\t </xs:complexType>\n\t\t */\n\t\treturn {\n\t\t\tid: artist.id,\n\t\t\tname: artist.name,\n\t\t\tcoverArt: artist.id,\n\t\t\talbumCount: artist.albumIDs.length,\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined\n\t\t};\n\t}\n\n\tstatic packAlbumInfo(info: JamServe.MetaInfo): Subsonic.AlbumInfo {\n\t\treturn {\n\t\t\tnotes: info.album.description,\n\t\t\tmusicBrainzId: info.album.mbid,\n\t\t\tlastFmUrl: info.album.url,\n\t\t\tsmallImageUrl: info.album.image && info.album.image.small ? info.album.image.small : undefined,\n\t\t\tmediumImageUrl: info.album.image && info.album.image.medium ? info.album.image.medium : undefined,\n\t\t\tlargeImageUrl: info.album.image && info.album.image.large ? info.album.image.large : undefined\n\t\t};\n\t}\n\n\tstatic packArtistInfo(info: JamServe.MetaInfo, similar?: Array<Subsonic.Artist>): Subsonic.ArtistInfo {\n\t\treturn {\n\t\t\tbiography: info.artist.description,\n\t\t\tmusicBrainzId: info.artist.mbid,\n\t\t\tlastFmUrl: info.artist.url,\n\t\t\tsmallImageUrl: info.artist.image && info.artist.image.small ? info.artist.image.small : undefined,\n\t\t\tmediumImageUrl: info.artist.image && info.artist.image.medium ? info.artist.image.medium : undefined,\n\t\t\tlargeImageUrl: info.artist.image && info.artist.image.large ? info.artist.image.large : undefined,\n\t\t\tsimilarArtist: similar\n\t\t};\n\t}\n\n\tstatic packArtistInfo2(info: JamServe.MetaInfo, similar?: Array<Subsonic.ArtistID3>): Subsonic.ArtistInfo2 {\n\t\treturn {\n\t\t\tbiography: info.artist.description,\n\t\t\tmusicBrainzId: info.artist.mbid,\n\t\t\tlastFmUrl: info.artist.url,\n\t\t\tsmallImageUrl: info.artist.image && info.artist.image.small ? info.artist.image.small : undefined,\n\t\t\tmediumImageUrl: info.artist.image && info.artist.image.medium ? info.artist.image.medium : undefined,\n\t\t\tlargeImageUrl: info.artist.image && info.artist.image.large ? info.artist.image.large : undefined,\n\t\t\tsimilarArtist: similar\n\t\t};\n\t}\n\n\tstatic packTrack(track: JamServe.Track, state: JamServe.State): Subsonic.Child {\n\t\t/*\n\t\t <xs:complexType name=\"Child\">\n\t\t <xs:attribute name=\"id\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"parent\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"isDir\" type=\"xs:boolean\" use=\"required\"/>\n\t\t <xs:attribute name=\"title\" type=\"xs:string\" use=\"required\"/>\n\t\t <xs:attribute name=\"album\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"artist\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"track\" type=\"xs:int\" use=\"optional\"/>\n\t\t <xs:attribute name=\"year\" type=\"xs:int\" use=\"optional\"/>\n\t\t <xs:attribute name=\"genre\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"coverArt\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"size\" type=\"xs:long\" use=\"optional\"/>\n\t\t <xs:attribute name=\"contentType\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"suffix\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"transcodedContentType\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"transcodedSuffix\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"duration\" type=\"xs:int\" use=\"optional\"/>\n\t\t <xs:attribute name=\"bitRate\" type=\"xs:int\" use=\"optional\"/>\n\t\t <xs:attribute name=\"path\" type=\"xs:string\" use=\"optional\"/>\n\t\t <xs:attribute name=\"isVideo\" type=\"xs:boolean\" use=\"optional\"/> <!-- Added in 1.4.1 -->\n\t\t <xs:attribute name=\"userRating\" type=\"sub:UserRating\" use=\"optional\"/> <!-- Added in 1.6.0 -->\n\t\t <xs:attribute name=\"averageRating\" type=\"sub:AverageRating\" use=\"optional\"/> <!-- Added in 1.6.0 -->\n\t\t <xs:attribute name=\"discNumber\" type=\"xs:int\" use=\"optional\"/> <!-- Added in 1.8.0 -->\n\t\t <xs:attribute name=\"created\" type=\"xs:dateTime\" use=\"optional\"/> <!-- Added in 1.8.0 -->\n\t\t <xs:attribute name=\"starred\" type=\"xs:dateTime\" use=\"optional\"/> <!-- Added in 1.8.0 -->\n\t\t <xs:attribute name=\"albumId\" type=\"xs:string\" use=\"optional\"/> <!-- Added in 1.8.0 -->\n\t\t <xs:attribute name=\"artistId\" type=\"xs:string\" use=\"optional\"/> <!-- Added in 1.8.0 -->\n\t\t <xs:attribute name=\"type\" type=\"sub:MediaType\" use=\"optional\"/> <!-- Added in 1.8.0 -->\n\t\t <xs:attribute name=\"bookmarkPosition\" type=\"xs:long\" use=\"optional\"/> <!-- In millis. Added in 1.10.1 -->\n\t\t </xs:complexType>\n\t\t */\n\n\t\tconst suffix = fileSuffix(track.name);\n\t\tconst result: Subsonic.Child = {\n\t\t\tid: track.id,\n\t\t\tparent: track.parentID || '',\n\t\t\ttitle: track.tag.title || track.name,\n\t\t\talbum: track.tag.album,\n\t\t\tartist: track.tag.artist,\n\t\t\tisDir: false,\n\t\t\tcoverArt: track.id,\n\t\t\tgenre: track.tag.genre,\n\t\t\tyear: track.tag.year,\n\t\t\tcreated: FORMAT.formatSubSonicDate(track.stat.created),\n\t\t\tduration: (track.media.duration !== undefined && !isNaN(track.media.duration)) ? Math.round(track.media.duration) : -1,\n\t\t\tbitRate: (track.media.bitRate !== undefined) ? Math.round(track.media.bitRate / 1000) : -1,\n\t\t\ttrack: track.tag.track,\n\t\t\tsize: track.stat.size,\n\t\t\tsuffix: suffix,\n\t\t\tcontentType: AudioMimeTypes[suffix],\n\t\t\tisVideo: false,\n\t\t\tpath: track.path + '/' + track.name,\n\t\t\tdiscNumber: track.tag.disc,\n\t\t\talbumId: track.albumID,\n\t\t\tartistId: track.artistID,\n\t\t\ttype: 'music',\n\t\t\tuserRating: state ? state.rated : undefined,\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined,\n\t\t\tplayCount: state && state.played ? state.played : 0,\n\t\t\ttranscodedSuffix: undefined,\n\t\t\ttranscodedContentType: undefined\n\t\t\t// \"rank\": 0,\n\t\t\t// \"averageRating\": track.state.avgrated,\n\t\t\t// \"bookmarkPosition\": track.state.bookmark,\n\t\t};\n\t\tif (suffix !== 'mp3') {\n\t\t\tresult.transcodedSuffix = 'mp3';\n\t\t\tresult.transcodedContentType = AudioMimeTypes[result.transcodedSuffix];\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic packNowPlaying(nowPlaying: JamServe.NowPlaying, state: JamServe.State): Subsonic.NowPlayingEntry {\n\t\tlet entry: Subsonic.Child;\n\t\tswitch (nowPlaying.obj.type) {\n\t\t\tcase DBObjectType.track:\n\t\t\t\tentry = FORMAT.packTrack(<JamServe.Track>nowPlaying.obj, state);\n\t\t\t\tbreak;\n\t\t\tcase DBObjectType.episode:\n\t\t\t\tentry = FORMAT.packPodcastEpisode(<JamServe.Episode>nowPlaying.obj, state);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tentry = {\n\t\t\t\t\tid: nowPlaying.obj.id,\n\t\t\t\t\tisDir: false,\n\t\t\t\t\ttitle: 'Unknown'\n\t\t\t\t};\n\t\t}\n\t\tconst nowPlay = <Subsonic.NowPlayingEntry>entry;\n\t\tnowPlay.username = nowPlaying.user.name;\n\t\tnowPlay.minutesAgo = Math.round(moment.duration(moment().diff(moment(nowPlaying.time))).asMinutes());\n\t\tnowPlay.playerId = 0;\n\t\treturn nowPlay;\n\t}\n\n\tstatic packFolder(folder: JamServe.Folder, state: JamServe.State): Subsonic.Child {\n\t\treturn {\n\t\t\tid: folder.id,\n\t\t\tpath: folder.path,\n\t\t\tparent: folder.parentID,\n\t\t\tcreated: FORMAT.formatSubSonicDate(folder.stat.created),\n\t\t\ttitle: folder.tag.title || '',\n\t\t\talbum: folder.tag.album,\n\t\t\tgenre: folder.tag.genre,\n\t\t\tartist: folder.tag.artist,\n\t\t\tyear: folder.tag.year,\n\t\t\tcoverArt: folder.id,\n\t\t\tuserRating: state ? state.rated : undefined,\n\t\t\t// \"albumId\": '',  // TODO: folder albumId if only one?\n\t\t\t// \"artistId\": '',  // TODO: folder artistId if only one?\n\t\t\tisDir: true,\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined\n\t\t};\n\t}\n\n\tstatic packPodcast(podcast: JamServe.Podcast, status?: Subsonic.PodcastStatus): Subsonic.PodcastChannel {\n\t\treturn {\n\t\t\tid: podcast.id,\n\t\t\turl: podcast.url,\n\t\t\terrorMessage: podcast.errorMessage,\n\t\t\ttitle: podcast.tag ? podcast.tag.title : undefined,\n\t\t\tstatus: status ? status : (podcast.tag ? podcast.tag.status : podcast.status),\n\t\t\tdescription: podcast.tag ? podcast.tag.description : undefined,\n\t\t\tcoverArt: podcast.id,\n\t\t\toriginalImageUrl: podcast.tag ? podcast.tag.image : undefined\n\t\t};\n\t}\n\n\tstatic packPodcastEpisode(episode: JamServe.Episode, state: JamServe.State, status?: Subsonic.PodcastStatus): Subsonic.PodcastEpisode {\n\t\tconst result: Subsonic.PodcastEpisode = {\n\t\t\t// albumId:episode.albumId,\n\t\t\t// artistId:episode.artistId,\n\t\t\t// averageRating:episode.averageRating, // TODO: podcast episode state.averageRating\n\t\t\t// bookmarkPosition:episode.bookmarkPosition, // TODO: podcast episode state.bookmarkPosition\n\t\t\tstreamId: episode.id,\n\t\t\tcoverArt: episode.id,\n\t\t\tchannelId: episode.podcastID,\n\t\t\tdescription: episode.summary,\n\t\t\tpublishDate: episode.date !== undefined ? this.formatSubSonicDate(episode.date) : undefined,\n\t\t\ttitle: episode.title,\n\t\t\tstatus: episode.status,\n\t\t\tid: episode.id,\n\t\t\tparent: episode.podcastID,\n\t\t\tartist: episode.tag ? episode.tag.artist : episode.author,\n\t\t\talbum: episode.tag ? episode.tag.album : undefined,\n\t\t\ttrack: episode.tag ? episode.tag.track : undefined,\n\t\t\tyear: episode.tag ? episode.tag.year : undefined,\n\t\t\tgenre: episode.tag ? episode.tag.genre : undefined,\n\t\t\tdiscNumber: episode.tag ? episode.tag.disc : undefined,\n\t\t\ttype: 'podcast',\n\t\t\tplayCount: state && state.played ? state.played : 0,\n\t\t\tstarred: state && state.faved ? this.formatSubSonicDate(state.faved) : undefined,\n\t\t\tuserRating: state ? state.rated : undefined,\n\t\t\tisVideo: false,\n\t\t\tisDir: false,\n\t\t\tsuffix: undefined,\n\t\t\ttranscodedSuffix: undefined,\n\t\t\ttranscodedContentType: undefined,\n\t\t\tpath: undefined,\n\t\t\tsize: undefined,\n\t\t\tcreated: undefined,\n\t\t\tduration: undefined,\n\t\t\tbitRate: undefined\n\t\t};\n\t\tif (episode.path) {\n\t\t\tresult.suffix = fileSuffix(episode.path);\n\t\t\tif (result.suffix !== 'mp3') {\n\t\t\t\tresult.transcodedSuffix = 'mp3';\n\t\t\t\tresult.transcodedContentType = AudioMimeTypes[result.transcodedSuffix];\n\t\t\t}\n\t\t\tresult.contentType = AudioMimeTypes[result.suffix];\n\t\t\tif (episode.stat) {\n\t\t\t\tresult.size = episode.stat.size;\n\t\t\t\tresult.created = FORMAT.formatSubSonicDate(episode.stat.created);\n\t\t\t}\n\t\t\tif (episode.media) {\n\t\t\t\tresult.duration = episode.media.duration;\n\t\t\t\tresult.bitRate = episode.media.bitRate !== undefined ? Math.round(episode.media.bitRate / 1000) : -1;\n\t\t\t}\n\t\t}\n\t\tif (status) {\n\t\t\tresult.status = status;\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic packPlaylist(playlist: JamServe.Playlist): Subsonic.Playlist {\n\t\treturn {\n\t\t\tid: playlist.id,\n\t\t\tname: playlist.name,\n\t\t\tcomment: playlist.comment || '',\n\t\t\t'public': playlist.isPublic,\n\t\t\tduration: playlist.duration,\n\t\t\tcreated: FORMAT.formatSubSonicDate(playlist.created),\n\t\t\tchanged: FORMAT.formatSubSonicDate(playlist.changed),\n\t\t\tcoverArt: playlist.coverArt,\n\t\t\tallowedUser: playlist.allowedUser,\n\t\t\tsongCount: playlist.trackIDs.length,\n\t\t\towner: playlist.userID\n\t\t};\n\t}\n\n\tstatic packPlaylistWithSongs(playlist: JamServe.Playlist, tracks: Array<JamServe.Track>, states: JamServe.States): Subsonic.PlaylistWithSongs {\n\t\tconst result = <Subsonic.PlaylistWithSongs>FORMAT.packPlaylist(playlist);\n\t\tresult.entry = tracks.map(track => FORMAT.packTrack(track, states[track.id]));\n\t\treturn result;\n\t}\n\n\tstatic packBookmark(bookmark: JamServe.Bookmark, username: string, child: Subsonic.Child): Subsonic.Bookmark {\n\t\treturn {\n\t\t\tentry: child,\n\t\t\tusername: username,\n\t\t\tposition: bookmark.position,\n\t\t\tcomment: bookmark.comment,\n\t\t\tcreated: FORMAT.formatSubSonicDate(bookmark.created),\n\t\t\tchanged: FORMAT.formatSubSonicDate(bookmark.changed)\n\t\t};\n\t}\n\n\tstatic packSimilarSongs(childs: Array<Subsonic.Child>): Subsonic.SimilarSongs {\n\t\treturn {\n\t\t\tsong: childs\n\t\t};\n\t}\n\n\tstatic packSimilarSongs2(childs: Array<Subsonic.Child>): Subsonic.SimilarSongs2 {\n\t\treturn {\n\t\t\tsong: childs\n\t\t};\n\t}\n\n\tstatic packPlayQueue(playqueue: JamServe.PlayQueue, user: JamServe.User, childs: Array<Subsonic.Child>): Subsonic.PlayQueue {\n\t\treturn {\n\t\t\tentry: childs,\n\t\t\tcurrent: playqueue.currentID !== undefined ? parseInt(playqueue.currentID, 10) : undefined,\n\t\t\tposition: playqueue.position,\n\t\t\tusername: user.name,\n\t\t\tchanged: playqueue.changed > 0 ? FORMAT.formatSubSonicDate(playqueue.changed) : '',\n\t\t\tchangedBy: playqueue.changedBy || ''\n\t\t};\n\t}\n\n\tstatic packRadio(radio: JamServe.Radio): Subsonic.InternetRadioStation {\n\t\treturn {\n\t\t\tid: radio.id,\n\t\t\tname: radio.name,\n\t\t\tstreamUrl: radio.url,\n\t\t\thomePageUrl: radio.homepage\n\t\t};\n\t}\n\n\tstatic packGenre(genre: JamServe.Genre): Subsonic.Genre {\n\t\treturn {\n\t\t\tcontent: genre.name,\n\t\t\tsongCount: genre.trackCount,\n\t\t\talbumCount: genre.albumCount,\n\t\t\tartistCount: genre.artistCount\n\t\t};\n\t}\n\n\tstatic packChatMessage(message: JamServe.ChatMessage): Subsonic.ChatMessage {\n\t\treturn {\n\t\t\tusername: message.username,\n\t\t\ttime: message.time,\n\t\t\tmessage: message.message\n\t\t};\n\t}\n}\n","module.exports = require(\"request\");","module.exports = require(\"moment\");","import express from 'express';\nimport {IApiBinaryResult, NodeError} from '../../typings';\nimport path from 'path';\nimport {toXML} from '../../utils/to-xml';\nimport {SubsonicParameterRequest} from './parameters';\nimport {FORMAT} from './format';\n\nexport class ApiResponder {\n\n\tpublic static ok(req: express.Request, res: express.Response) {\n\t\tApiResponder.send(req, res, FORMAT.packOK());\n\t}\n\n\tprivate static send(req: express.Request, res: express.Response, data: any) {\n\t\tconst params = (<SubsonicParameterRequest>req).parameters;\n\t\tif ((params.format === 'jsonp') && (params.callback)) {\n\t\t\tres.status(200).send(params.callback + '(' + JSON.stringify(data) + ');');\n\t\t} else if (params.format === 'json') {\n\t\t\tres.status(200).json(data);\n\t\t} else {\n\t\t\tres.set('Content-Type', 'application/xml');\n\t\t\tres.status(200).send(toXML(data));\n\t\t}\n\t}\n\n\tpublic static data(req: express.Request, res: express.Response, data: any) {\n\t\tApiResponder.send(req, res, FORMAT.packResponse(data));\n\t}\n\n\tpublic static error(req: express.Request, res: express.Response, err: NodeError) {\n\t\tif (err.fail) {\n\t\t\tApiResponder.send(req, res, FORMAT.packFail(err.fail, err.text));\n\t\t} else {\n\t\t\tApiResponder.send(req, res, FORMAT.packFail(FORMAT.FAIL.GENERIC, (typeof err === 'string' ? err : (err.message || 'Unknown Error')).toString()));\n\t\t}\n\t}\n\n\tpublic static binary(req: express.Request, res: express.Response, data: IApiBinaryResult) {\n\t\tif (data.pipe) {\n\t\t\tdata.pipe.pipe(res);\n\t\t} else if (data.buffer) {\n\t\t\tres.set('Content-Type', data.buffer.contentType);\n\t\t\tres.set('Content-Length', data.buffer.buffer.length.toString());\n// \t\t\tres.set('Cache-Control', 'public, max-age=' + config.max_age);\n\t\t\tres.status(200).send(data.buffer.buffer);\n\t\t} else if (data.file) {\n\t\t\tres.sendFile(data.file.filename, data.file.name || path.basename(data.file.filename));\n\t\t}\n\t}\n}\n","import rateLimiter from 'limiter';\nimport request from 'request';\n\nexport class WebserviceClient {\n\tprivate limiter: rateLimiter.RateLimiter;\n\tprivate userAgent: string;\n\n\tconstructor(requestPerInterval: number, requestIntervalMS: number, userAgent: string) {\n\t\tthis.limiter = new rateLimiter.RateLimiter(requestPerInterval, requestIntervalMS);\n\t\tthis.userAgent = userAgent;\n\t}\n\n\tprotected async getJson<T>(url: string, parameters: object | undefined): Promise<T> {\n\t\tconst options: request.Options = {\n\t\t\turl,\n\t\t\theaders: {'User-Agent': this.userAgent},\n\t\t\tqs: parameters,\n\t\t\ttimeout: 5000\n\t\t};\n\t\tconst limiter = this.limiter;\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tlimiter.removeTokens(1, () => {\n\t\t\t\trequest(options, (err, response, body) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresolve(<T>JSON.parse(body));\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n}\n","export function shuffle<T>(list: Array<T>): Array<T> {\n\tfor (let i = list.length - 1; i > 0; i--) {\n\t\tconst j = Math.floor(Math.random() * (i + 1));\n\t\t[list[i], list[j]] = [list[j], list[i]];\n\t}\n\treturn list;\n}\n\nexport function randomInt(min: number, max: number) {\n\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n\nexport function randomItems<T>(list: Array<T>, amount?: number): Array<T> {\n\tif (amount === undefined || amount < 0 || list.length <= amount) {\n\t\treturn shuffle<T>(list);\n\t}\n\tconst result: Array<T> = [];\n\tconst done: Array<number> = [];\n\twhile ((result.length < amount)) {\n\t\tconst i = randomInt(0, list.length - 1);\n\t\tif (done.indexOf(i) < 0) {\n\t\t\tresult.push(list[i]);\n\t\t\tdone.push(i);\n\t\t}\n\t}\n\treturn result;\n}\n","import {NodeError, NodeErrorCallback} from '../typings';\nimport zlib from 'zlib';\nimport stream from 'stream';\nimport request from 'request';\nimport FeedParser from 'feedparser';\nimport iconv from 'iconv-lite';\nimport {DBObjectType} from '../types';\nimport {Subsonic} from '../model/subsonic-rest-data-1.16.0';\nimport {JamServe} from '../model/jamserve';\n\nexport const PodcastStatus: { [name: string]: Subsonic.PodcastStatus } = {\n\tfresh: 'new',\n\tdownloading: 'downloading',\n\tcompleted: 'completed',\n\tdeleted: 'deleted',\n\terror: 'error',\n\tskipped: 'skipped'\n};\n\nexport class Feed {\n\n\tconstructor() {\n\n\t}\n\n\tprivate getParams(str: string): { [key: string]: string } {\n\t\treturn str.split(';').reduce(\n\t\t\t(para: { [key: string]: string }, param: string) => {\n\t\t\t\tconst parts = param.split('=').map(function(part) {\n\t\t\t\t\treturn part.trim();\n\t\t\t\t});\n\t\t\t\tif (parts.length === 2) {\n\t\t\t\t\tpara[parts[0]] = parts[1];\n\t\t\t\t}\n\t\t\t\treturn para;\n\t\t\t}, {});\n\t}\n\n\tprivate maybeDecompress(res: stream.Readable, encoding: string, done: NodeErrorCallback): stream.Readable {\n\t\tlet decompress;\n\t\tif (encoding.match(/\\bdeflate\\b/)) {\n\t\t\tdecompress = zlib.createInflate();\n\t\t\tdecompress.on('error', done);\n\t\t} else if (encoding.match(/\\bgzip\\b/)) {\n\t\t\tdecompress = zlib.createGunzip();\n\t\t\tdecompress.on('error', done);\n\t\t}\n\t\treturn decompress ? res.pipe(decompress) : res;\n\t}\n\n\tprivate maybeTranslate(res: stream.Readable, charset: string, done: NodeErrorCallback): stream.Readable {\n\t\t// Use iconv if its not utf8 already.\n\t\tif (charset && !/utf-*8/i.test(charset)) {\n\t\t\ttry {\n\t\t\t\tconst iv = iconv.decodeStream(charset);\n\t\t\t\t// console.log('Converting from charset %s to utf-8', charset);\n\t\t\t\tiv.on('error', done);\n\t\t\t\t// If we're using iconv, stream will be the output of iconv\n\t\t\t\t// otherwise it will remain the output of request\n\t\t\t\tres = <any>res.pipe(iv); // TODO: iconv stream doesn't return a stream.Readable?\n\t\t\t} catch (err) {\n\t\t\t\tres.emit('error', err);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n\n\tprivate async fetch(url: string): Promise<{ feed: FeedParser.Node, posts: Array<FeedParser.Item> }> {\n\t\tconst posts: Array<FeedParser.Item> = [];\n\t\tlet feed: any;\n\t\tlet doneReported = false;\n\t\tconst req = request(url, {timeout: 10000, pool: false});\n\t\treq.setMaxListeners(50);\n\t\t// Some feeds do not respond without user-agent and accept headers.\n\t\treq.setHeader('user-agent', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36');\n\t\treq.setHeader('accept', 'text/html,application/xhtml+xml');\n\n\t\tconst feedparser = new FeedParser({});\n\n\t\tfeedparser.on('readable', function streamResponse() {\n\t\t\tconst response = feedparser; // this;\n\t\t\tfeed = response.meta;\n\t\t\tlet item = response.read();\n\t\t\twhile (item) {\n\t\t\t\tposts.push(item);\n\t\t\t\titem = response.read();\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise<{ feed: FeedParser.Node, posts: Array<FeedParser.Item> }>((resolve, reject) => {\n\t\t\tconst done = (err: NodeError) => {\n\t\t\t\tif (doneReported) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdoneReported = true;\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve({feed, posts})\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treq.on('error', done);\n\t\t\treq.on('response', (res: request.Response) => {\n\t\t\t\tif (res.statusCode !== 200) {\n\t\t\t\t\treq.abort();\n\t\t\t\t\treturn done(new Error('Bad status code ' + res.statusCode + ' ' + res.statusMessage));\n\t\t\t\t}\n\t\t\t\tconst encoding = res.headers['content-encoding'] || 'identity';\n\t\t\t\tconst charset = this.getParams(res.headers['content-type'] || '').charset;\n\t\t\t\tlet pipestream = this.maybeDecompress(res, encoding, done);\n\t\t\t\tpipestream = this.maybeTranslate(pipestream, charset, done);\n\t\t\t\tpipestream.pipe(feedparser);\n\t\t\t});\n\n\t\t\tfeedparser.on('error', done);\n\t\t\tfeedparser.on('end', done);\n\n\t\t});\n\t}\n\n\tpublic async get(podcast: Subsonic.PodcastChannel): Promise<{ tag: JamServe.PodcastTag, episodes: Array<JamServe.Episode> }> {\n\t\tconst data = await this.fetch(podcast.url);\n\t\tconst tag: JamServe.PodcastTag = {\n\t\t\ttitle: data.feed.title,\n\t\t\tstatus: PodcastStatus.completed,\n\t\t\tdescription: data.feed.description,\n\t\t\tlink: data.feed.link,\n\t\t\tauthor: data.feed.author,\n\t\t\tgenerator: data.feed.generator,\n\t\t\timage: data.feed.image && data.feed.image.url ? data.feed.image.url : undefined,\n\t\t\tcategories: data.feed.categories\n\t\t};\n\t\tif (data.feed['itunes:summary'] && data.feed['itunes:summary']['#']) {\n\t\t\ttag.description = data.feed['itunes:summary']['#'];\n\t\t}\n\t\tconst episodes: Array<JamServe.Episode> = data.posts.map(post => {\n\t\t\tlet chapters: Array<JamServe.PodcastEpisodeChapter> = [];\n\n\t\t\tconst pscChaps: any = (<any>post)['psc:chapters'];\n\t\t\tif (pscChaps) {\n\t\t\t\tconst pscChap: Array<any> = pscChaps['psc:chapter'];\n\t\t\t\tif (pscChap) {\n\t\t\t\t\tchapters = pscChap.map(item => item['@']);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tid: '',\n\t\t\t\tpodcastID: podcast.id,\n\t\t\t\tstatus: PodcastStatus.fresh,\n\t\t\t\ttype: DBObjectType.episode,\n\t\t\t\tauthor: post.author,\n\t\t\t\tlink: post.link,\n\t\t\t\tguid: post.guid,\n\t\t\t\tsummary: post.summary,\n\t\t\t\tenclosures: <any>post.enclosures, // TODO: validate podcast enclosures (wrong interface description?)\n\t\t\t\tdate: post.date ? post.date.valueOf() : 0,\n\t\t\t\ttitle: post.title,\n\t\t\t\tchapters: chapters\n\t\t\t};\n\t\t});\n\t\treturn {tag, episodes};\n\t}\n\n}\n","// static FAIL = {\n// \tGENERIC: 500,\n// \tPARAMETER: 400,\n// \tUNAUTH: 401,\n// \tNOTFOUND: 404\n// };\n\n\nclass ApiError extends Error {\n\tfailCode: number;\n\n\tconstructor(message: string, failCode: number) {\n\n\t\t// Calling parent constructor of base Error class.\n\t\tsuper(message);\n\n\t\t// Saving class name in the property of our custom error as a shortcut.\n\t\tthis.name = this.constructor.name;\n\n\t\t// Capturing stack trace, excluding constructor call from it.\n\t\tError.captureStackTrace(this, this.constructor);\n\n\t\t// You can use any additional properties you want.\n\t\t// I'm going to use preferred HTTP status for this error types.\n\t\t// `500` is the default value if not specified.\n\t\tthis.failCode = failCode || 500;\n\t}\n}\n\nexport function InvalidParamError(msg?: string): ApiError {\n\treturn new ApiError(msg || 'Invalid/Missing parameter', 400);\n}\n\nexport function NotFoundError(msg?: string): ApiError {\n\treturn new ApiError(msg || 'Item not found', 404);\n}\n\nexport function UnauthError(msg?: string): ApiError {\n\treturn new ApiError(msg || 'Unauthorized', 401);\n}\n\nexport function GenericError(msg?: string): ApiError {\n\treturn new ApiError(msg || 'Guru Meditation', 500);\n}\n","module.exports = require(\"express\");","import express from 'express';\nimport {IApiBinaryResult, NodeError} from '../../typings';\nimport path from 'path';\n\nexport class ApiResponder {\n\n\tpublic static ok(res: express.Response) {\n\t\tres.status(200).json({});\n\t}\n\n\tpublic static data(res: express.Response, data: any) {\n\t\tres.status(200).json(data);\n\t}\n\n\tpublic static error(res: express.Response, err: NodeError) {\n\t\tconst msg = (typeof err === 'string' ? err : (err.message || 'Guru Meditation')).toString();\n\t\tconst code = (typeof err.failCode === 'number' ? err.failCode : 500);\n\t\tres.status(code || 500).json({error: msg});\n\t}\n\n\tpublic static binary(res: express.Response, data: IApiBinaryResult) {\n\t\tif (data.pipe) {\n\t\t\tdata.pipe.pipe(res);\n\t\t} else if (data.buffer) {\n\t\t\tres.set('Content-Type', data.buffer.contentType);\n\t\t\tres.set('Content-Length', data.buffer.buffer.length.toString());\n// \t\t\tres.set('Cache-Control', 'public, max-age=' + config.max_age);\n\t\t\tres.status(200).send(data.buffer.buffer);\n\t\t} else if (data.file) {\n\t\t\tres.sendFile(data.file.filename, data.file.name || path.basename(data.file.filename));\n\t\t}\n\t}\n}\n","import {FileTyp} from '../types';\nimport {fileSuffix} from './fs-utils';\n\nexport const SupportedImageFormat = ['bmp', 'png', 'jpeg', 'jpg', 'gif'];\n\nexport const SupportedAudioFormat = ['mp3', 'flac', 'm4a', 'ogg', 'oga', 'webma', 'wav'];\n\nexport function getFileType(filename: string): FileTyp {\n\tconst suffix = fileSuffix(filename);\n\tif (SupportedImageFormat.indexOf(suffix) >= 0) {\n\t\treturn FileTyp.IMAGE;\n\t} else if (SupportedAudioFormat.indexOf(suffix) >= 0) {\n\t\treturn FileTyp.AUDIO;\n\t} else if (['tag'].indexOf(suffix) >= 0) {\n\t\treturn FileTyp.TAG;\n\t} else if (['bak'].indexOf(suffix) >= 0) {\n\t\treturn FileTyp.BACKUP;\n\t}\n\treturn FileTyp.OTHER;\n}\n","module.exports = require(\"tmp\");","import {MatchDir} from './match';\nimport {JamServe} from '../../model/jamserve';\nimport {AlbumType, FileTyp, FolderType} from '../../types';\nimport path from 'path';\nimport Logger from '../../utils/logger';\n\nconst log = Logger('IO.tag');\n\nexport const cVariousArtist = '[Various Artists]';\nexport const cUnknownArtist = '[Unknown Artist]';\nexport const cUnknownAlbum = '[Unknown Album]';\n\ninterface MetaStatValue<T> {\n\tcount: number;\n\tval: T;\n}\n\ninterface MetaStatString extends MetaStatValue<string> {\n}\n\ninterface MetaStatNumber extends MetaStatValue<number> {\n}\n\ninterface MetaStat {\n\tartist?: string;\n\tartistSort?: string;\n\talbum?: string;\n\tgenre?: string;\n\tmbArtistID?: string;\n\tmbAlbumID?: string;\n\tyear?: number;\n\timages: Array<string>;\n\timage?: string;\n\tisMultiArtist: boolean;\n\tisMultiAlbum: boolean;\n\ttrackCount: number;\n}\n\nfunction convert2Numlist(o: { [key: string]: number; }): Array<MetaStatNumber> {\n\treturn Object.keys(o).map(key => {\n\t\treturn {count: o[key], val: parseInt(key, 10)};\n\t}).sort((a, b) => {\n\t\treturn a.count - b.count;\n\t});\n}\n\nfunction convert2list(o: { [key: string]: number; }): Array<MetaStatString> {\n\treturn Object.keys(o).map(key => {\n\t\treturn {count: o[key], val: key};\n\t}).sort((a, b) => {\n\t\treturn a.count - b.count;\n\t});\n}\n\nfunction getMostUsedTagValue<T>(list: Array<MetaStatValue<T>>, multi?: T): T | undefined {\n\tif (list.length === 0) {\n\t\treturn undefined;\n\t}\n\tif (list.length === 1) {\n\t\treturn list[0].val;\n\t}\n\tlist = list.sort((a, b) => a.count - b.count);\n\tconst cleaned = list.filter((o) => {\n\t\treturn o.count > 1;\n\t});\n\tif (cleaned.length > 1 && multi !== undefined) {\n\t\treturn multi;\n\t}\n\tif (cleaned.length > 0) {\n\t\treturn cleaned[0].val;\n\t}\n\treturn list[0].val;\n}\n\nfunction getMetaStat(dir: MatchDir): MetaStat {\n\t// combine meta frames from child tracks and folders\n\tconst stats: {\n\t\tartist: { [key: string]: number; };\n\t\tartistSort: { [key: string]: number; };\n\t\talbum: { [key: string]: number; };\n\t\tgenre: { [key: string]: number; };\n\t\tmbArtistID: { [key: string]: number; };\n\t\tmbAlbumID: { [key: string]: number; };\n\t\tyear: { [key: string]: number; };\n\t} = {\n\t\tartist: {},\n\t\tartistSort: {},\n\t\talbum: {},\n\t\tgenre: {},\n\t\tyear: {},\n\t\tmbArtistID: {},\n\t\tmbAlbumID: {},\n\t};\n\tconst images: Array<string> = [];\n\tlet trackCount = 0;\n\tdir.files.forEach((file) => {\n\t\tif (file.type === FileTyp.AUDIO) {\n\t\t\ttrackCount++;\n\t\t}\n\t\tif (file.track && file.track.tag) {\n\t\t\tconst tracktag = file.track.tag;\n\t\t\tif (tracktag.artist) {\n\t\t\t\tstats.artist[tracktag.artist] = (stats.artist[tracktag.artist] || 0) + 1;\n\t\t\t}\n\t\t\tif (tracktag.artistSort) {\n\t\t\t\tstats.artistSort[tracktag.artistSort] = (stats.artistSort[tracktag.artistSort] || 0) + 1;\n\t\t\t}\n\t\t\tif (tracktag.album) {\n\t\t\t\tstats.album[tracktag.album] = (stats.album[tracktag.album] || 0) + 1;\n\t\t\t}\n\t\t\tif (tracktag.genre) {\n\t\t\t\tstats.genre[tracktag.genre] = (stats.genre[tracktag.genre] || 0) + 1;\n\t\t\t}\n\t\t\tif (tracktag.year) {\n\t\t\t\tstats.year[tracktag.year] = (stats.year[tracktag.year] || 0) + 1;\n\t\t\t}\n\t\t\tif (tracktag.mbArtistID) {\n\t\t\t\tconst s = tracktag.mbArtistID.split(' ')[0];\n\t\t\t\tstats.mbArtistID[s] = (stats.mbArtistID[s] || 0) + 1;\n\t\t\t}\n\t\t\tif (tracktag.mbAlbumID) {\n\t\t\t\tconst s = tracktag.mbAlbumID.split(' ')[0];\n\t\t\t\tstats.mbAlbumID[s] = (stats.mbAlbumID[s] || 0) + 1;\n\t\t\t}\n\t\t} else if (file.type === FileTyp.IMAGE) {\n\t\t\timages.push(file.name);\n\t\t}\n\t});\n\tdir.directories.forEach((sub) => {\n\t\tif (sub.folder && sub.tag) {\n\t\t\tconst subtag = sub.tag;\n\t\t\tif (subtag.artist) {\n\t\t\t\tstats.artist[subtag.artist] = (stats.artist[subtag.artist] || 0) + 1;\n\t\t\t}\n\t\t\tif (subtag.artistSort) {\n\t\t\t\tstats.artistSort[subtag.artistSort] = (stats.artistSort[subtag.artistSort] || 0) + 1;\n\t\t\t}\n\t\t\tif (subtag.album) {\n\t\t\t\tstats.album[subtag.album] = (stats.album[subtag.album] || 0) + 1;\n\t\t\t}\n\t\t\tif (subtag.genre) {\n\t\t\t\tstats.genre[subtag.genre] = (stats.genre[subtag.genre] || 0) + 1;\n\t\t\t}\n\t\t\tif (subtag.year) {\n\t\t\t\tstats.year[subtag.year] = (stats.year[subtag.year] || 0) + 1;\n\t\t\t}\n\t\t\tif (subtag.mbArtistID) {\n\t\t\t\tconst s = subtag.mbArtistID.split(' ')[0];\n\t\t\t\tstats.mbArtistID[s] = (stats.mbArtistID[s] || 0) + 1;\n\t\t\t}\n\t\t\tif (subtag.mbAlbumID) {\n\t\t\t\tconst s = subtag.mbAlbumID.split(' ')[0];\n\t\t\t\tstats.mbAlbumID[s] = (stats.mbAlbumID[s] || 0) + 1;\n\t\t\t}\n\t\t}\n\t});\n\tconst artists = convert2list(stats.artist);\n\tconst artistSorts = convert2list(stats.artistSort);\n\tconst albums = convert2list(stats.album);\n\tconst genres = convert2list(stats.genre);\n\tconst years = convert2Numlist(stats.year);\n\tconst mbArtistIDs = convert2list(stats.mbArtistID);\n\tconst mbAlbumIDs = convert2list(stats.mbAlbumID);\n\tconst album = getMostUsedTagValue<string>(albums, path.basename(dir.name));\n\tconst artist = getMostUsedTagValue<string>(artists, cVariousArtist);\n\tconst artistSort = getMostUsedTagValue<string>(artistSorts);\n\tconst genre = getMostUsedTagValue<string>(genres);\n\tconst mbAlbumID = getMostUsedTagValue<string>(mbAlbumIDs);\n\tconst mbArtistID = getMostUsedTagValue<string>(mbArtistIDs);\n\tconst year = getMostUsedTagValue<number>(years);\n\tconst isMultiArtist = artist === cVariousArtist;\n\tconst isMultiAlbum = albums.length > 0;\n\tlet image: string | undefined;\n\t// check folder image\n\tif (images.length > 0) {\n\t\tif (images.length === 1) {\n\t\t\timage = path.basename(images[0]);\n\t\t} else {\n\t\t\timages.forEach((img) => {\n\t\t\t\tconst typ = path.basename(img, path.extname(img)).toLowerCase();\n\t\t\t\tif (['folder', 'cover', 'front'].indexOf(typ) >= 0) {\n\t\t\t\t\timage = path.basename(img);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (image === undefined) {\n\t\t\t\timage = path.basename(images[0]);\n\t\t\t}\n\t\t}\n\t}\n\treturn {\n\t\ttrackCount,\n\t\timages,\n\t\timage,\n\t\tisMultiArtist,\n\t\tisMultiAlbum,\n\t\talbum,\n\t\tartist,\n\t\tartistSort,\n\t\tgenre,\n\t\tmbAlbumID,\n\t\tmbArtistID,\n\t\tyear\n\t};\n}\n\nfunction splitDirectoryName(name: string): { title: string; year?: number; } {\n\tconst result: { title: string; year?: number; } = {title: path.basename(name).trim()};\n\t// year title | year - title | (year) title | [year] title\n\tconst parts = result.title.split(' ');\n\tconst s = parts[0].replace(/[^\\w\\s]/gi, '');\n\tif (s.length === 4) {\n\t\tconst y = parseInt(s, 10);\n\t\tif (!isNaN(y)) {\n\t\t\tresult.year = y;\n\t\t\tparts.shift();\n\t\t\tif (parts[0] === '-') {\n\t\t\t\tparts.shift();\n\t\t\t}\n\t\t\tresult.title = parts.join(' ');\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction applyFolderTagType(dir: MatchDir) {\n\tif (!dir.tag) {\n\t\treturn;\n\t}\n\tconst metaStat = getMetaStat(dir);\n\tconst name = path.basename(dir.name).toLowerCase();\n\tlet result: FolderType = FolderType.unknown;\n\tif (dir.level === 0) {\n\t\tresult = FolderType.multiartist;\n\t} else if (name.match(/\\[(extra|various)\\]/) || name.match(/^(extra|various)$/)) {\n\t\tresult = FolderType.extras;\n\t} else if (metaStat.trackCount > 0) {\n\t\tconst dirCount = dir.directories.filter(d => !!d.tag && d.tag.type !== FolderType.extras).length;\n\t\tif (dirCount === 0) {\n\t\t\tresult = FolderType.album;\n\t\t} else {\n\t\t\tresult = FolderType.multialbum;\n\t\t}\n\t} else {\n\t\tif (metaStat.isMultiArtist) {\n\t\t\tresult = FolderType.multialbum;\n\t\t} else {\n\t\t\tresult = FolderType.artist;\n\t\t\tdir.directories.forEach(d => {\n\t\t\t\tif (d.tag && d.tag.type === FolderType.artist) {\n\t\t\t\t\td.tag.type = FolderType.multialbum;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tif (result === FolderType.multialbum) {\n\t\tconst a = dir.directories.find(d => {\n\t\t\treturn (!!d.tag && d.tag.type === FolderType.artist);\n\t\t});\n\t\tif (a) {\n\t\t\tresult = FolderType.multiartist;\n\t\t}\n\t}\n\tdir.tag.type = result;\n}\n\nfunction createFolderTag(dir: MatchDir): JamServe.FolderTag {\n\tlog.debug('Generating folder tag ', dir.name);\n\tconst metaStat = getMetaStat(dir);\n\tconst nameSplit = splitDirectoryName(dir.name);\n\tconst tag: JamServe.FolderTag = {\n\t\ttracks: dir.files.filter(f => f.type === FileTyp.AUDIO).length,\n\t\tlevel: dir.level,\n\t\ttype: FolderType.unknown,\n\t\talbum: metaStat.album,\n\t\talbumType: metaStat.isMultiArtist ? AlbumType.mix : AlbumType.album,\n\t\tartist: metaStat.artist,\n\t\tartistSort: metaStat.artistSort,\n\t\ttitle: nameSplit.title,\n\t\timage: metaStat.image,\n\t\tgenre: metaStat.genre,\n\t\tmbAlbumID: metaStat.mbAlbumID,\n\t\tmbArtistID: metaStat.mbArtistID,\n\t\tyear: (nameSplit.year !== undefined) ? nameSplit.year : metaStat.year\n\t};\n\treturn tag;\n}\n\nfunction createTagsR(dir: MatchDir) {\n\tdir.directories.forEach(createTagsR);\n\tif (dir.folder) {\n\t\tdir.tag = createFolderTag(dir);\n\t}\n\tapplyFolderTagType(dir);\n}\n\nexport function fillMatchTags(dir: MatchDir) {\n\tcreateTagsR(dir);\n}\n","import {JamServe} from '../../model/jamserve';\nimport {dirExist, fileExists} from '../../utils/fs-utils';\nimport path from 'path';\nimport Logger from '../../utils/logger';\nimport {Store} from '../../store/store';\nimport {MergeChanges} from './merge';\nimport {DBObjectType} from '../../types';\nimport {updatePlayListTracks} from '../../engine/components/playlists';\nimport {Images} from './images';\nimport {Waveforms} from './waveforms';\n\nconst log = Logger('IO.clean');\n\nfunction isInRoot(list: Array<JamServe.Root>, fullpath: string): JamServe.Root | null {\n\tconst result = null;\n\tfor (let i = 0; i < list.length; i++) {\n\t\tif (fullpath.indexOf(list[i].path) === 0) {\n\t\t\treturn list[i];\n\t\t}\n\t}\n\treturn result;\n}\n\nexport async function scanCleanStore(store: Store, images: Images, waveforms: Waveforms, changes: MergeChanges): Promise<void> {\n\n\tconst removeTracks: Array<JamServe.Track> = changes.removedTracks;\n\tconst removeFolders: Array<JamServe.Folder> = changes.removedFolders;\n\tconst doneFileIds: Array<string> = changes.newTracks.map(t => t.track.id)\n\t\t.concat(changes.updateTracks.map(t => t.track.id))\n\t\t.concat(changes.unchangedTracks.map(t => t.track.id))\n\t\t.concat(changes.removedTracks.map(t => t.id));\n\tconst doneFolderIds: Array<string> = changes.newFolders.map(t => t.id)\n\t\t.concat(changes.updateFolders.map(t => t.id))\n\t\t.concat(changes.unchangedFolders.map(t => t.id))\n\t\t.concat(changes.removedFolders.map(t => t.id))\n\t;\n\n\tconst roots = await store.root.all();\n\tlog.debug('Collecting removed folders');\n\tawait store.folder.iterate(async (folders) => {\n\t\tfor (const folder of folders) {\n\t\t\tif (!isInRoot(roots, folder.path)) {\n\t\t\t\tremoveFolders.push(folder);\n\t\t\t} else if (doneFolderIds.indexOf(folder.id) < 0) {\n\t\t\t\tconst exists = await dirExist(folder.path);\n\t\t\t\tif (!exists) {\n\t\t\t\t\tremoveFolders.push(folder);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\tlog.debug('Collecting removed tracks');\n\tawait store.track.iterate(async (tracks) => {\n\t\tfor (const track of tracks) {\n\t\t\tif (!isInRoot(roots, track.path)) {\n\t\t\t\tremoveTracks.push(track);\n\t\t\t} else if (doneFileIds.indexOf(track.id) < 0) {\n\t\t\t\tconst exists = await fileExists(path.join(track.path, track.name));\n\t\t\t\tif (!exists) {\n\t\t\t\t\tremoveTracks.push(track);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\tawait cleanStore(store, images, waveforms, removeTracks, removeFolders);\n}\n\nexport async function clearID3(store: Store, images: Images, removeTracks: Array<JamServe.Track>): Promise<void> {\n\tif (removeTracks.length === 0) {\n\t\treturn;\n\t}\n\tlog.debug('Cleaning ID3');\n\tconst trackIDs = removeTracks.map(track => track.id);\n\tconst albums = await store.album.search({trackIDs});\n\talbums.forEach(album => {\n\t\tlet duration = 0;\n\t\talbum.trackIDs = album.trackIDs.filter(id => {\n\t\t\tconst track = removeTracks.find(t => t.id === id);\n\t\t\tif (track) {\n\t\t\t\tduration += (track.media.duration || 0);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\talbum.duration -= duration;\n\t});\n\tconst removeAlbums = albums.filter(album => album.trackIDs.length === 0).map(album => album.id);\n\tconst updateAlbums = albums.filter(album => album.trackIDs.length !== 0);\n\tif (removeAlbums.length > 0) {\n\t\tawait store.album.remove(removeAlbums);\n\t\tawait store.state.removeByQuery({destIDs: removeAlbums, type: DBObjectType.album});\n\t}\n\tif (updateAlbums.length > 0) {\n\t\tawait store.album.replaceMany(updateAlbums);\n\t}\n\tconst artists = await store.artist.search({trackIDs});\n\tartists.forEach(artist => {\n\t\tartist.trackIDs = artist.trackIDs.filter(id => trackIDs.indexOf(id) < 0);\n\t\tartist.albumIDs = artist.albumIDs.filter(id => removeAlbums.indexOf(id) < 0);\n\t});\n\tconst removeArtists = artists.filter(artist => artist.trackIDs.length === 0).map(artist => artist.id);\n\tconst updateArtists = artists.filter(artist => artist.trackIDs.length !== 0);\n\tif (removeArtists.length > 0) {\n\t\tawait store.artist.remove(removeArtists);\n\t\tawait store.state.removeByQuery({destIDs: removeArtists, type: DBObjectType.artist});\n\t}\n\tif (updateArtists.length > 0) {\n\t\tawait store.artist.replaceMany(updateArtists);\n\t}\n\tconst ids = removeAlbums.concat(removeArtists);\n\tawait images.clearImageCacheByIDs(ids);\n}\n\nexport async function cleanStore(store: Store, images: Images, waveforms: Waveforms, removeTracks: Array<JamServe.Track>, removeFolders: Array<JamServe.Folder>): Promise<void> {\n\tlet ids: Array<string> = [];\n\tif (removeFolders.length > 0) {\n\t\tlog.debug('Cleaning folders', removeFolders.length);\n\t\tconst folderIDs = removeFolders.map(folder => folder.id);\n\t\tawait store.folder.remove(folderIDs);\n\t\tawait store.state.removeByQuery({destIDs: folderIDs, type: DBObjectType.folder});\n\t\tids = folderIDs;\n\t}\n\tif (removeTracks.length > 0) {\n\t\tlog.debug('Cleaning tracks', removeTracks.length);\n\t\tconst trackIDs = removeTracks.map(track => track.id);\n\t\tawait store.track.remove(trackIDs);\n\t\tawait store.state.removeByQuery({destIDs: trackIDs, type: DBObjectType.track});\n\t\tawait store.bookmark.removeByQuery({destIDs: trackIDs});\n\t\tconst playlists = await store.playlist.search({trackIDs: trackIDs});\n\t\tids = ids.concat(trackIDs);\n\t\tif (playlists.length > 0) {\n\t\t\tfor (const playlist of playlists) {\n\t\t\t\tplaylist.trackIDs = playlist.trackIDs.filter(id => trackIDs.indexOf(id) < 0);\n\t\t\t\tif (playlist.trackIDs.length === 0) {\n\t\t\t\t\tawait store.playlist.remove(playlist.id);\n\t\t\t\t} else {\n\t\t\t\t\tawait updatePlayListTracks(store, playlist);\n\t\t\t\t\tawait store.playlist.replace(playlist);\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\tawait images.clearImageCacheByIDs(ids);\n\tawait waveforms.clearWaveformCacheByIDs(ids);\n\tawait clearID3(store, images, removeTracks);\n}\n","import {JamServe} from '../../model/jamserve';\nimport {Store} from '../../store/store';\nimport {DBObjectType} from '../../types';\n\nexport async function updatePlayListTracks(store: Store, playlist: JamServe.Playlist): Promise<void> {\n\tconst tracks = await store.track.byIds(playlist.trackIDs);\n\tconst trackHash: { [id: string]: JamServe.Track } = {};\n\ttracks.forEach(track => {\n\t\ttrackHash[track.id] = track;\n\t});\n\tplaylist.trackIDs = playlist.trackIDs.filter(id => !!trackHash[id]);\n\tplaylist.duration = 0;\n\tplaylist.trackIDs.forEach(id => {\n\t\tconst track = trackHash[id];\n\t\tplaylist.duration += (track.media.duration || 0);\n\t});\n}\n\nexport class Playlists {\n\tprivate readonly store: Store;\n\n\tconstructor(store: Store) {\n\t\tthis.store = store;\n\t}\n\n\tasync createPlaylist(name: string, comment: string | undefined, isPublic: boolean, userID: string, trackIDs: Array<string>): Promise<JamServe.Playlist> {\n\t\tconst now = Date.now();\n\t\tconst playlist: JamServe.Playlist = {\n\t\t\tid: '',\n\t\t\ttype: DBObjectType.playlist,\n\t\t\tname: name,\n\t\t\tcomment: comment,\n\t\t\tisPublic: isPublic,\n\t\t\tuserID: userID,\n\t\t\tcreated: now,\n\t\t\tchanged: now,\n\t\t\ttrackIDs: trackIDs,\n\t\t\tduration: 0\n\t\t};\n\t\tawait updatePlayListTracks(this.store, playlist);\n\t\tplaylist.id = await this.store.playlist.add(playlist);\n\t\treturn playlist;\n\t}\n\n\tasync updatePlaylist(playlist: JamServe.Playlist): Promise<void> {\n\t\tawait updatePlayListTracks(this.store, playlist);\n\t\tawait this.store.playlist.replace(playlist);\n\t}\n\n\tasync removePlaylist(playlist: JamServe.Playlist): Promise<void> {\n\t\treturn this.store.playlist.remove(playlist.id);\n\t}\n}\n","import {JamServe} from '../model/jamserve';\nimport {DatabaseQuerySortType, DBObjectType} from '../types';\nimport {DBElastic} from './elasticsearch/db-elastic';\nimport {DBNedb} from './nedb/db-nedb';\nimport {Md5} from 'md5-typescript';\nimport {hexDecode} from '../utils/hex';\nimport {Config} from '../config';\nimport DatabaseQuery = JamServe.DatabaseQuery;\n\nexport abstract class BaseStore<T extends JamServe.DBObject, X extends JamServe.SearchQuery> {\n\tprotected group: JamServe.DatabaseIndex<T>;\n\ttype: DBObjectType | undefined;\n\n\tprotected constructor(type: DBObjectType | undefined, db: JamServe.Database) {\n\t\tthis.group = db.getDBIndex<T>(type);\n\t\tthis.type = type;\n\t}\n\n\tprotected abstract transformQuery(query: X): JamServe.DatabaseQuery;\n\n\tasync add(item: T): Promise<string> {\n\t\treturn await this.group.add(item);\n\t}\n\n\tasync replace(item: T): Promise<void> {\n\t\treturn await this.group.replace(item.id, item);\n\t}\n\n\tasync remove(idOrIds: string | Array<string>): Promise<void> {\n\t\treturn await this.group.remove(idOrIds);\n\t}\n\n\tasync replaceMany(items: Array<T>): Promise<void> {\n\t\tfor (const item of items) {\n\t\t\tawait this.group.replace(item.id, item);\n\t\t}\n\t}\n\n\tasync byId(id: string): Promise<T | undefined> {\n\t\treturn await this.group.byId(id);\n\t}\n\n\tasync byIds(ids: Array<string>): Promise<Array<T>> {\n\t\treturn await this.group.byIds(ids);\n\t}\n\n\tasync all(): Promise<Array<T>> {\n\t\treturn await this.group.query({all: true});\n\t}\n\n\tasync async(): Promise<Array<string>> {\n\t\treturn await this.group.queryIds({all: true});\n\t}\n\n\tasync count(): Promise<number> {\n\t\treturn await this.group.count({all: true});\n\t}\n\n\tasync iterate(onItems: (items: Array<T>) => Promise<void>): Promise<void> {\n\t\tawait this.group.iterate({all: true}, onItems);\n\t}\n\n\tasync upsert(items: Array<T>): Promise<void> {\n\t\tfor (const item of items) {\n\t\t\tawait this.group.upsert(item.id, item);\n\t\t}\n\t}\n\n\tasync removeByQuery(query: X): Promise<number> {\n\t\treturn await this.group.removeByQuery(this.transformQuery(query));\n\t}\n\n\tasync searchIDs(query: X): Promise<Array<string>> {\n\t\treturn await this.group.queryIds(this.transformQuery(query));\n\t}\n\n\tasync search(query: X): Promise<Array<T>> {\n\t\treturn await this.group.query(this.transformQuery(query));\n\t}\n\n\tasync searchOne(query: X): Promise<T | undefined> {\n\t\treturn await this.group.queryOne(this.transformQuery(query));\n\t}\n\n\tasync searchCount(query: X): Promise<number> {\n\t\treturn await this.group.count(this.transformQuery(query));\n\t}\n\n}\n\nclass QueryHelper {\n\tprivate q: DatabaseQuery = {};\n\n\tterm(field: string, value: string | number | boolean | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.term = this.q.term || {};\n\t\t\tthis.q.term[field] = value;\n\t\t}\n\t}\n\n\tmatch(field: string, value: string | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.match = this.q.match || {};\n\t\t\tthis.q.match[field] = value;\n\t\t}\n\t}\n\n\tstartsWith(field: string, value: string | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.startsWith = this.q.startsWith || {};\n\t\t\tthis.q.startsWith[field] = value;\n\t\t}\n\t}\n\n\tstartsWiths(field: string, value: Array<string> | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.startsWiths = this.q.startsWiths || {};\n\t\t\tthis.q.startsWiths[field] = value;\n\t\t}\n\t}\n\n\tterms(field: string, value: Array<string | number | boolean> | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.terms = this.q.terms || {};\n\t\t\tthis.q.terms[field] = value;\n\t\t}\n\t}\n\n\ttrue(field: string, value: boolean | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.term = this.q.term || {};\n\t\t\tthis.q.term[field] = true;\n\t\t}\n\t}\n\n\tnotNull(field: string, value: boolean | undefined) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tthis.q.notNull = this.q.notNull || [];\n\t\t\tthis.q.notNull.push(field);\n\t\t}\n\t}\n\n\trange(field: string, lte: number | undefined, gte: number | undefined) {\n\t\tif (lte !== undefined || gte !== undefined) {\n\t\t\tthis.q.range = this.q.range || {};\n\t\t\tthis.q.range[field] = {gte, lte};\n\t\t}\n\t}\n\n\tget(query: JamServe.SearchQuery, fieldMap?: { [name: string]: string }): JamServe.DatabaseQuery {\n\t\tif (Object.keys(this.q).length === 0) {\n\t\t\tthis.q.all = true;\n\t\t}\n\t\tif (query.sorts) {\n\t\t\tconst sorts: JamServe.DatabaseQuerySort = {};\n\t\t\tquery.sorts.forEach(sort => {\n\t\t\t\tconst field = fieldMap ? fieldMap[sort.field] : sort.field;\n\t\t\t\tif (field) {\n\t\t\t\t\tsorts[field] = sort.descending ? DatabaseQuerySortType.descending : DatabaseQuerySortType.ascending;\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.q.sort = sorts;\n\t\t}\n\t\tif (query.amount !== undefined && query.amount > 0) {\n\t\t\tthis.q.amount = query.amount;\n\t\t}\n\t\tif (query.offset !== undefined && query.offset > 0) {\n\t\t\tthis.q.offset = query.offset;\n\t\t}\n\t\treturn this.q;\n\t}\n}\n\nclass StoreUser extends BaseStore<JamServe.User, JamServe.SearchQueryUser> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.user, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryUser): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.terms('id', query.ids);\n\t\tq.term('name', query.name);\n\t\tq.true('roles.adminRole', query.isAdmin);\n\t\tq.match('name', query.query);\n\t\treturn q.get(query);\n\t}\n\n\tasync add(user: JamServe.User): Promise<string> {\n\t\tif (user.pass.indexOf('enc:') === 0) {\n\t\t\tuser.pass = hexDecode(user.pass);\n\t\t}\n\t\treturn await this.group.add(user);\n\t}\n\n\tasync replace(user: JamServe.User): Promise<void> {\n\t\tif (user.pass.indexOf('enc:') === 0) {\n\t\t\tuser.pass = hexDecode(user.pass);\n\t\t}\n\t\treturn await this.group.replace(user.id, user);\n\t}\n\n\tasync authToken(name: string, token: string, salt: string): Promise<JamServe.User> {\n\t\tif ((!name) || (!name.length)) {\n\t\t\treturn Promise.reject(Error('Invalid Username'));\n\t\t}\n\t\tif ((!token) || (!token.length)) {\n\t\t\treturn Promise.reject(Error('Invalid Token'));\n\t\t}\n\t\tconst user = await this.group.queryOne({term: {'name': name}});\n\t\tif (!user) {\n\t\t\treturn Promise.reject(Error('Invalid Username'));\n\t\t}\n\t\tconst t = Md5.init(user.pass + salt);\n\t\tif (token !== t) {\n\t\t\treturn Promise.reject(Error('Invalid Token'));\n\t\t}\n\t\treturn user;\n\t}\n\n\tasync auth(name: string, pass: string): Promise<JamServe.User> {\n\t\tif ((!name) || (!name.length)) {\n\t\t\treturn Promise.reject(Error('Invalid Username'));\n\t\t}\n\t\tif ((!pass) || (!pass.length)) {\n\t\t\treturn Promise.reject(Error('Invalid Password'));\n\t\t}\n\t\tconst user = await this.group.queryOne({term: {'name': name}});\n\t\tif (!user) {\n\t\t\treturn Promise.reject(Error('Invalid Username'));\n\t\t}\n\t\tif (pass.indexOf('enc:') === 0) {\n\t\t\tpass = hexDecode(pass.slice(4)).trim();\n\t\t}\n\t\tif (pass !== user.pass) {\n\t\t\treturn Promise.reject(Error('Invalid Password'));\n\t\t}\n\t\treturn user;\n\t}\n\n\tasync get(name: string): Promise<JamServe.User | undefined> {\n\t\treturn await this.group.queryOne({term: {'name': name || ''}});\n\t}\n\n}\n\nclass StoreState extends BaseStore<JamServe.State, JamServe.SearchQueryState> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.state, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryState): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('userID', query.userID);\n\t\tq.term('destID', query.destID);\n\t\tq.terms('destID', query.destIDs);\n\t\tq.term('destType', query.type);\n\t\tq.notNull('faved', query.isFaved);\n\t\tq.range('rating', query.maxRating, query.minRating);\n\t\tq.range('played', undefined, query.isPlayed ? 1 : undefined);\n\t\treturn q.get(query);\n\t}\n\n\tprivate emptyState(destID: string, destType: DBObjectType, userID: string): JamServe.State {\n\t\treturn {\n\t\t\tid: '',\n\t\t\ttype: DBObjectType.state,\n\t\t\tdestID,\n\t\t\tdestType,\n\t\t\tplayed: 0,\n\t\t\tlastplayed: 0,\n\t\t\tfaved: undefined,\n\t\t\trated: 0,\n\t\t\tuserID\n\t\t};\n\t}\n\n\tasync findOrCreate(destID: string, userID: string, type: DBObjectType): Promise<JamServe.State> {\n\t\tconst state = await this.searchOne({userID, destID, type});\n\t\treturn state || this.emptyState(destID, type, userID);\n\t}\n\n\tasync findOrCreateMulti(destIDs: Array<string>, userID: string, type: DBObjectType): Promise<JamServe.States> {\n\t\tif (!destIDs || destIDs.length === 0) {\n\t\t\treturn {};\n\t\t}\n\t\tconst list = await this.search({userID, type, destIDs});\n\t\tconst result: { [id: string]: JamServe.State } = {};\n\t\tlist.forEach((state) => {\n\t\t\tresult[state.destID] = state;\n\t\t});\n\t\tdestIDs.forEach((id) => {\n\t\t\tif (!result[id]) {\n\t\t\t\tresult[id] = this.emptyState(id, type, userID);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n}\n\nclass StorePlaylist extends BaseStore<JamServe.Playlist, JamServe.SearchQueryPlaylist> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.playlist, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryPlaylist): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('trackIDs', query.trackID);\n\t\tq.terms('trackIDs', query.trackIDs);\n\t\tq.term('userID', query.userID);\n\t\tq.term('name', query.name);\n\t\tq.true('isPublic', query.isPublic);\n\t\tq.match('name', query.query);\n\t\treturn q.get(query);\n\t}\n\n}\n\nclass StorePodcasts extends BaseStore<JamServe.Podcast, JamServe.SearchQueryPodcast> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.podcast, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryPodcast): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('url', query.url);\n\t\tq.term('title', query.title);\n\t\tq.term('status', query.status);\n\t\tq.match('title', query.query);\n\t\treturn q.get(query);\n\t}\n\n}\n\nclass StoreEpisodes extends BaseStore<JamServe.Episode, JamServe.SearchQueryPodcastEpisode> {\n\tfieldMap: { [name: string]: string } = {\n\t\t'podcastIDs': 'podcastID',\n\t\t'podcastID': 'podcastID',\n\t\t'status': 'status',\n\t\t'date': 'date',\n\t\t'title': 'tag.title',\n\t\t'created': 'stat.created'\n\t};\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.episode, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryPodcastEpisode): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.terms('podcastID', query.podcastIDs);\n\t\tq.term('podcastID', query.podcastID);\n\t\tq.term('status', query.status);\n\t\tq.term('tag.title', query.title);\n\t\tq.match('tag.title', query.query);\n\t\treturn q.get(query, this.fieldMap);\n\t}\n\n}\n\nclass StoreBookmarks extends BaseStore<JamServe.Bookmark, JamServe.SearchQueryBookmark> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.bookmark, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryBookmark): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('userID', query.userID);\n\t\tq.term('destID', query.destID);\n\t\tq.terms('destID', query.destIDs);\n\t\treturn q.get(query);\n\t}\n\n}\n\nclass StoreRoot extends BaseStore<JamServe.Root, JamServe.SearchQueryRoot> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.root, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryRoot): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('name', query.name);\n\t\tq.term('path', query.path);\n\t\tq.match('name', query.query);\n\t\treturn q.get(query);\n\t}\n\n}\n\nclass StorePlayQueue extends BaseStore<JamServe.PlayQueue, JamServe.SearchQueryPlayQueue> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.playqueue, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryPlayQueue): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('userID', query.userID);\n\t\treturn q.get(query);\n\t}\n\n}\n\nclass StoreRadio extends BaseStore<JamServe.Radio, JamServe.SearchQueryRadio> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.radio, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryRadio): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('url', query.url);\n\t\tq.term('name', query.name);\n\t\tq.match('name', query.query);\n\t\treturn q.get(query);\n\t}\n}\n\nclass StoreTrack extends BaseStore<JamServe.Track, JamServe.SearchQueryTrack> {\n\tfieldMap: { [name: string]: string } = {\n\t\t'path': 'path',\n\t\t'parentID': 'parentID',\n\t\t'parentIDs': 'parentID',\n\t\t'rootID': 'rootID',\n\t\t'artistID': 'artistID',\n\t\t'artist': 'tag.artist',\n\t\t'mbTrackID': 'tag.mbTrackID',\n\t\t'title': 'tag.title',\n\t\t'album': 'tag.album',\n\t\t'year': 'tag.year',\n\t\t'genre': 'tag.genre',\n\t\t'created': 'stat.created'\n\t};\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.track, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryTrack): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.terms('id', query.ids);\n\t\tq.terms('parentID', query.parentIDs);\n\t\tq.term('path', query.path);\n\t\tq.startsWiths('path', query.inPaths);\n\t\tq.startsWith('path', query.inPath);\n\t\tq.term('tag.genre', query.genre);\n\t\tq.term('rootID', query.rootID);\n\t\tq.term('parentID', query.parentID);\n\t\tq.term('tag.mbTrackID', query.mbTrackID);\n\t\tq.terms('tag.mbTrackID', query.mbTrackIDs);\n\t\tq.term('tag.artist', query.artist);\n\t\tq.term('tag.title', query.title);\n\t\tq.match('tag.title', query.query);\n\t\tq.term('tag.album', query.album);\n\t\tq.term('artistID', query.artistID);\n\t\tq.range('tag.year', query.toYear, query.fromYear);\n\t\tq.range('stat.created', undefined, query.newerThan);\n\t\treturn q.get(query, this.fieldMap);\n\t}\n\n\tasync genres(): Promise<Array<string>> {\n\t\treturn await this.group.distinct('tag.genre');\n\t}\n\n}\n\nclass StoreFolder extends BaseStore<JamServe.Folder, JamServe.SearchQueryFolder> {\n\tfieldMap: { [name: string]: string } = {\n\t\t'parentID': 'parent',\n\t\t'rootID': 'rootID',\n\t\t'artist': 'tag.artist',\n\t\t'title': 'tag.title',\n\t\t'type': 'tag.type',\n\t\t'year': 'tag.year',\n\t\t'created': 'stat.created',\n\t\t'album': 'tag.album',\n\t\t'path': 'path',\n\t\t'level': 'tag.level',\n\t\t'genre': 'tag.genre'\n\t};\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.folder, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryFolder): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('path', query.path);\n\t\tq.terms('id', query.ids);\n\t\tq.startsWith('path', query.inPath);\n\t\tq.term('tag.mbAlbumID', query.mbAlbumID);\n\t\tq.term('tag.mbArtistID', query.mbArtistID);\n\t\tq.term('tag.genre', query.genre);\n\t\tq.term('tag.title', query.title);\n\t\tq.term('tag.album', query.album);\n\t\tq.term('rootID', query.rootID);\n\t\tq.term('parentID', query.parentID);\n\t\tq.term('tag.level', query.level);\n\t\tq.term('tag.artist', query.artist);\n\t\tq.terms('tag.artist', query.artists);\n\t\tq.terms('tag.type', query.types);\n\t\tq.range('tag.year', query.toYear, query.fromYear);\n\t\tq.range('stat.created', undefined, query.newerThan);\n\t\tq.match('tag.title', query.query);\n\t\treturn q.get(query, this.fieldMap);\n\t}\n\n}\n\nclass StoreArtist extends BaseStore<JamServe.Artist, JamServe.SearchQueryArtist> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.artist, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryArtist): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.terms('id', query.ids);\n\t\tq.terms('trackIDs', query.trackIDs);\n\t\tq.terms('name', query.names);\n\t\tq.term('rootIDs', query.rootID);\n\t\tq.term('albumIDs', query.albumID);\n\t\tq.term('trackIDs', query.trackID);\n\t\tq.term('name', query.name);\n\t\tq.term('genre', query.genre);\n\t\tq.term('mbArtistID', query.mbArtistID);\n\t\tq.range('year', query.toYear, query.fromYear);\n\t\tq.range('created', undefined, query.newerThan);\n\t\tq.match('name', query.query);\n\t\treturn q.get(query);\n\t}\n\n}\n\nclass StoreAlbum extends BaseStore<JamServe.Album, JamServe.SearchQueryAlbum> {\n\n\tconstructor(db: JamServe.Database) {\n\t\tsuper(DBObjectType.album, db);\n\t}\n\n\tprotected transformQuery(query: JamServe.SearchQueryAlbum): JamServe.DatabaseQuery {\n\t\tconst q = new QueryHelper();\n\t\tq.term('rootIDs', query.rootID);\n\t\tq.term('artistID', query.artistID);\n\t\tq.term('genre', query.genre);\n\t\tq.term('mbAlbumID', query.mbAlbumID);\n\t\tq.term('mbArtistID', query.mbArtistID);\n\t\tq.term('trackIDs', query.trackID);\n\t\tq.terms('trackIDs', query.trackIDs);\n\t\tq.term('artist', query.artist);\n\t\tq.term('name', query.name);\n\t\tq.range('year', query.toYear, query.fromYear);\n\t\tq.range('created', undefined, query.newerThan);\n\t\tq.terms('id', query.ids);\n\t\tq.match('name', query.query);\n\t\treturn q.get(query);\n\t}\n\n}\n\nexport class Store {\n\tpublic config: Config;\n\tpublic db: JamServe.Database;\n\tpublic track: StoreTrack;\n\tpublic folder: StoreFolder;\n\tpublic user: StoreUser;\n\tpublic state: StoreState;\n\tpublic playlist: StorePlaylist;\n\tpublic podcast: StorePodcasts;\n\tpublic episode: StoreEpisodes;\n\tpublic bookmark: StoreBookmarks;\n\tpublic root: StoreRoot;\n\tpublic artist: StoreArtist;\n\tpublic album: StoreAlbum;\n\tpublic playqueue: StorePlayQueue;\n\tpublic radio: StoreRadio;\n\n\tconstructor(config: Config) {\n\t\tthis.config = config;\n\t\tif (this.config.database.use === 'elasticsearch') {\n\t\t\tthis.db = new DBElastic(config);\n\t\t} else {\n\t\t\tthis.db = new DBNedb(config);\n\t\t}\n\t\tthis.track = new StoreTrack(this.db);\n\t\tthis.folder = new StoreFolder(this.db);\n\t\tthis.user = new StoreUser(this.db);\n\t\tthis.state = new StoreState(this.db);\n\t\tthis.playlist = new StorePlaylist(this.db);\n\t\tthis.podcast = new StorePodcasts(this.db);\n\t\tthis.episode = new StoreEpisodes(this.db);\n\t\tthis.bookmark = new StoreBookmarks(this.db);\n\t\tthis.artist = new StoreArtist(this.db);\n\t\tthis.album = new StoreAlbum(this.db);\n\t\tthis.playqueue = new StorePlayQueue(this.db);\n\t\tthis.radio = new StoreRadio(this.db);\n\t\tthis.root = new StoreRoot(this.db);\n\t}\n\n\tasync reset(): Promise<void> {\n\t\tawait this.db.reset();\n\t}\n\n\tasync check(): Promise<void> {\n\t\tawait this.db.check();\n\t}\n\n\tasync open(): Promise<void> {\n\t\tawait this.db.open();\n\t}\n\n\tasync close(): Promise<void> {\n\t\tawait this.db.close();\n\t}\n\n\tasync findInAll(id: string): Promise<JamServe.DBObject | undefined> {\n\t\tconst stores: Array<BaseStore<JamServe.DBObject, JamServe.SearchQuery>> =\n\t\t\t[this.folder, this.track, this.album, this.artist, this.podcast, this.episode, this.playlist, this.artist, this.album, this.radio, this.user];\n\t\tfor (const store of stores) {\n\t\t\tconst obj = await store.byId(id);\n\t\t\tif (obj) {\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t}\n\t}\n\n\tasync findMultiInAll(ids: Array<string>): Promise<Array<JamServe.DBObject>> {\n\t\tlet result: Array<JamServe.DBObject> = [];\n\t\tconst stores: Array<BaseStore<JamServe.DBObject, JamServe.SearchQuery>> =\n\t\t\t[this.folder, this.track, this.album, this.artist, this.podcast, this.episode, this.playlist, this.artist, this.album, this.radio, this.user];\n\t\tfor (const store of stores) {\n\t\t\tconst objs = await store.byIds(ids);\n\t\t\tresult = result.concat(objs);\n\t\t}\n\t\treturn result;\n\t}\n\n}\n","module.exports = require(\"limiter\");","import {getBinPath} from './which';\nimport {spawn} from 'child_process';\n\nexport async function spawnToolStream(binName: string, envName: string, args: Array<string>, onData: (buffer: Buffer) => void): Promise<string> {\n\tconst bin = await getBinPath(binName, envName);\n\tif (!bin || bin.length === 0) {\n\t\treturn Promise.reject(Promise.reject('Tool binary not found ' + binName));\n\t}\n\treturn new Promise<string>((resolve, reject) => {\n\t\tconst child = spawn(bin, args);\n\t\tlet stderr = '';\n\t\tchild.stdout.on('data', (data: Buffer) => {\n\t\t\tonData(data);\n\t\t});\n\t\tchild.stderr.on('data', (data: Buffer) => {\n\t\t\tstderr += data.toString();\n\t\t});\n\t\tchild.on('close', (code: number) => {\n\t\t\tresolve(stderr);\n\t\t});\n\t});\n}\n\nexport async function spawnTool(binName: string, envName: string, args: Array<string>): Promise<string> {\n\tconst bin = await getBinPath(binName, envName);\n\tif (!bin || bin.length === 0) {\n\t\treturn Promise.reject('Tool binary not found ' + binName);\n\t}\n\treturn new Promise<string>((resolve, reject) => {\n\t\tconst child = spawn(bin, args);\n\t\tlet result = '';\n\t\tlet error = '';\n\t\tchild.stdout.on('data', (data: Buffer) => {\n\t\t\tresult += data.toString();\n\t\t});\n\t\tchild.stderr.on('data', (data: Buffer) => {\n\t\t\terror += data.toString();\n\t\t});\n\t\tchild.on('close', (code: number) => {\n\t\t\tresolve(result);\n\t\t});\n\t});\n}\n\nexport async function spawnToolJson<T>(binName: string, envName: string, args: Array<string>): Promise<T> {\n\tconst data = await spawnTool(binName, envName, args);\n\tconst result: T = JSON.parse(data);\n\treturn result;\n}\n","import request from 'request';\nimport fs from 'fs';\n\nexport function downloadFile(url: string, filename: string): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\trequest(url)\n\t\t\t.pipe(fs.createWriteStream(filename))\n\t\t\t.on('close', (err: Error) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t});\n}\n","export class DebouncePromises<T> {\n\tprivate pendingPromises: { [id: string]: Array<any> } = {};\n\n\tappend(id: string): Promise<T> {\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tconst run = (err: Error | null, result: T) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.pendingPromises[id].push(run);\n\t\t});\n\t}\n\n\tsetPending(id: string): void {\n\t\tthis.pendingPromises[id] = [];\n\t}\n\n\tisPending(id: string): boolean {\n\t\treturn !!this.pendingPromises[id];\n\t}\n\n\tresolve(id: string, result: T) {\n\t\tfor (const cb of this.pendingPromises[id]) {\n\t\t\tcb(null, result);\n\t\t}\n\t\tdelete this.pendingPromises[id];\n\t}\n\n\treject(id: string, error: Error) {\n\t\tfor (const cb of this.pendingPromises[id]) {\n\t\t\tcb(error);\n\t\t}\n\t\tdelete this.pendingPromises[id];\n\t}\n\n}\n","import {JamServe} from '../../model/jamserve';\nimport path from 'path';\nimport {DBObjectType, FolderType} from '../../types';\nimport {JamParameters} from '../../model/jam-rest-params-0.1.0';\nimport {Jam} from '../../model/jam-rest-data-0.1.0';\nimport moment from 'moment';\n\nexport const APIVERSION = '0.1.0';\n\nexport class FORMAT {\n\n\tstatic packRoles(roles: JamServe.UserRoles): Jam.Roles {\n\t\treturn {\n\t\t\t// coverArt: roles.coverArtRole ? true : undefined,\n\t\t\tstream: roles.streamRole ? true : undefined,\n\t\t\tupload: roles.uploadRole ? true : undefined,\n\t\t\tadmin: roles.adminRole ? true : undefined,\n\t\t\tpodcast: roles.podcastRole ? true : undefined,\n\t\t\t// settings: roles.settingsRole ? true : undefined,\n\t\t\t// download: roles.downloadRole ? true : undefined,\n\t\t\t// playlist: roles.playlistRole ? true : undefined,\n\t\t\t// comment: roles.commentRole ? true : undefined,\n\t\t\t// jukebox: roles.jukeboxRole ? true : undefined,\n\t\t\t// share: roles.shareRole ? true : undefined,\n\t\t\t// videoConversion: roles.videoConversionRole ? true : undefined\n\t\t};\n\t}\n\n\tstatic packUser(user: JamServe.User): Jam.User {\n\t\treturn {\n\t\t\tid: user.id,\n\t\t\tcreated: user.created,\n\t\t\tname: user.name,\n\t\t\temail: user.email,\n\t\t\troles: FORMAT.packRoles(user.roles)\n\t\t};\n\t}\n\n\tstatic packRoot(root: JamServe.Root, rootState: JamServe.RootStatus): Jam.Root {\n\t\treturn {\n\t\t\tid: root.id,\n\t\t\tname: root.name,\n\t\t\tcreated: root.created,\n\t\t\tpath: root.path,\n\t\t\tstatus: rootState\n\t\t};\n\t}\n\n\tstatic packFolderTag(folder: JamServe.Folder): Jam.FolderTag {\n\t\tlet mbz: any = {\n\t\t\tartistID: folder.tag.mbArtistID,\n\t\t\talbumID: folder.tag.mbAlbumID\n\t\t};\n\t\tif (!Object.keys(mbz).find(key => !!mbz[key])) {\n\t\t\tmbz = undefined;\n\t\t}\n\t\treturn {\n\t\t\tartist: folder.tag.artist,\n\t\t\talbum: folder.tag.album,\n\t\t\tgenre: folder.tag.genre,\n\t\t\tyear: folder.tag.year,\n\t\t\tmusicbrainz: mbz\n\t\t};\n\t}\n\n\tstatic packTrackTag(tag: JamServe.TrackTag): Jam.TrackTag {\n\t\tlet mbz: Jam.TrackMBTag | undefined = {\n\t\t\trecordingID: tag.mbRecordingID,\n\t\t\treleaseTrackID: tag.mbReleaseTrackID,\n\t\t\ttrackID: tag.mbTrackID,\n\t\t\tartistID: tag.mbArtistID,\n\t\t\talbumID: tag.mbAlbumID\n\t\t};\n\t\tif (!Object.keys(mbz).find(key => !!(<any>mbz)[key])) {\n\t\t\tmbz = undefined;\n\t\t}\n\t\treturn {\n\t\t\ttrackNr: tag.track,\n\t\t\tyear: tag.year,\n\t\t\ttitle: tag.title,\n\t\t\tartist: tag.artist,\n\t\t\talbum: tag.album,\n\t\t\tgenre: tag.genre,\n\t\t\tmusicbrainz: mbz\n\t\t};\n\t}\n\n\tstatic packFolder(folder: JamServe.Folder, includes: JamParameters.IncludesFolder): Jam.Folder {\n\t\tincludes = includes || {};\n\t\treturn {\n\t\t\tid: folder.id,\n\t\t\tparentID: folder.parentID,\n\t\t\tname: path.basename(folder.path),\n\t\t\tcreated: folder.stat.created,\n\t\t\ttype: <Jam.FolderType>(folder.tag && (folder.tag.type !== undefined) ? (FolderType[folder.tag.type] || 'unknown') : 'unknown'),\n\t\t\ttag: includes.folderTag ? this.packFolderTag(folder) : undefined\n\t\t};\n\t}\n\n\tstatic packState(state?: JamServe.State): Jam.State {\n\t\treturn {\n\t\t\tplayed: state && state.played > 0 ? state.played : undefined,\n\t\t\tlastplayed: state && state.lastplayed > 0 ? state.lastplayed : undefined,\n\t\t\tfaved: state ? state.faved : undefined,\n\t\t\trated: state && state.rated !== undefined && state.rated > 0 ? state.rated : undefined\n\t\t};\n\t}\n\n\tstatic packStates(states: JamServe.States): Jam.States {\n\t\tconst result: Jam.States = {};\n\t\tObject.keys(states).forEach(key => {\n\t\t\tresult[key] = FORMAT.packState(states[key]);\n\t\t});\n\t\treturn result;\n\t}\n\n\tstatic packArtist(artist: JamServe.Artist, includes: JamParameters.IncludesArtist): Jam.Artist {\n\t\tlet mbz: any = {\n\t\t\tartistID: artist.mbArtistID\n\t\t};\n\t\tif (!Object.keys(mbz).find(key => !!mbz[key])) {\n\t\t\tmbz = undefined;\n\t\t}\n\t\treturn {\n\t\t\tid: artist.id,\n\t\t\tname: artist.name,\n\t\t\talbumCount: artist.albumIDs.length,\n\t\t\talbumIDs: includes.artistAlbumIDs ? artist.albumIDs : undefined,\n\t\t\ttrackIDs: includes.artistTracksIDs ? artist.trackIDs : undefined,\n\t\t\ttrackCount: artist.trackIDs.length,\n\t\t\tcreated: artist.created,\n\t\t\tmusicbrainz: mbz\n\t\t};\n\t}\n\n\tstatic packAlbum(album: JamServe.Album, includes: JamParameters.IncludesAlbum): Jam.Album {\n\t\tlet mbz: any = {\n\t\t\tartistID: album.mbArtistID,\n\t\t\talbumID: album.mbAlbumID\n\t\t};\n\t\tif (!Object.keys(mbz).find(key => !!mbz[key])) {\n\t\t\tmbz = undefined;\n\t\t}\n\t\treturn {\n\t\t\tid: album.id,\n\t\t\tname: album.name,\n\t\t\tcreated: album.created,\n\t\t\tartist: album.artist,\n\t\t\tartistID: album.artistID,\n\t\t\ttrackCount: album.trackIDs.length,\n\t\t\ttag: {\n\t\t\t\tgenre: album.genre,\n\t\t\t\tyear: album.year,\n\t\t\t\tduration: album.duration,\n\t\t\t\tcreated: album.created,\n\t\t\t\tmusicbrainz: mbz\n\t\t\t},\n\t\t\ttrackIDs: includes.albumTrackIDs ? album.trackIDs : undefined,\n\t\t};\n\t}\n\n\tstatic packArtistFolderInfo(info: JamServe.MetaInfo): Jam.ArtistFolderInfo {\n\t\treturn {\n\t\t\tdescription: info.artist.description,\n\t\t\tlastFmUrl: info.album.url,\n\t\t\tsmallImageUrl: info.album.image && info.album.image.small ? info.album.image.small : undefined,\n\t\t\tmediumImageUrl: info.album.image && info.album.image.medium ? info.album.image.medium : undefined,\n\t\t\tlargeImageUrl: info.album.image && info.album.image.large ? info.album.image.large : undefined\n\t\t};\n\t}\n\n\tstatic packArtistInfo(info: JamServe.MetaInfo): Jam.ArtistInfo {\n\t\treturn {\n\t\t\tdescription: info.artist.description,\n\t\t\tlastFmUrl: info.album.url,\n\t\t\tsmallImageUrl: info.album.image && info.album.image.small ? info.album.image.small : undefined,\n\t\t\tmediumImageUrl: info.album.image && info.album.image.medium ? info.album.image.medium : undefined,\n\t\t\tlargeImageUrl: info.album.image && info.album.image.large ? info.album.image.large : undefined\n\t\t};\n\t}\n\n\tstatic packAlbumFolderInfo(info: JamServe.MetaInfo): Jam.AlbumFolderInfo {\n\t\treturn {\n\t\t\tdescription: info.album.description,\n\t\t\tlastFmUrl: info.album.url,\n\t\t\treleases: info.album.releases,\n\t\t\tsmallImageUrl: info.album.image && info.album.image.small ? info.album.image.small : undefined,\n\t\t\tmediumImageUrl: info.album.image && info.album.image.medium ? info.album.image.medium : undefined,\n\t\t\tlargeImageUrl: info.album.image && info.album.image.large ? info.album.image.large : undefined\n\t\t};\n\t}\n\n\tstatic packAlbumInfo(info: JamServe.MetaInfo): Jam.AlbumInfo {\n\t\treturn {\n\t\t\tdescription: info.album.description,\n\t\t\tlastFmUrl: info.album.url,\n\t\t\treleases: info.album.releases,\n\t\t\tsmallImageUrl: info.album.image && info.album.image.small ? info.album.image.small : undefined,\n\t\t\tmediumImageUrl: info.album.image && info.album.image.medium ? info.album.image.medium : undefined,\n\t\t\tlargeImageUrl: info.album.image && info.album.image.large ? info.album.image.large : undefined\n\t\t};\n\t}\n\n\tstatic packGenre(genre: JamServe.Genre): Jam.Genre {\n\t\treturn {\n\t\t\tname: genre.name,\n\t\t\ttrackCount: genre.trackCount,\n\t\t\talbumCount: genre.albumCount,\n\t\t\tartistCount: genre.artistCount\n\t\t};\n\t}\n\n\tstatic packBookmark(bookmark: JamServe.Bookmark): Jam.TrackBookmark {\n\t\treturn {\n\t\t\ttrackID: bookmark.destID,\n\t\t\tcomment: bookmark.comment,\n\t\t\tcreated: bookmark.created,\n\t\t\tchanged: bookmark.changed,\n\t\t\tposition: bookmark.position\n\t\t};\n\t}\n\n\tstatic packPodcast(podcast: JamServe.Podcast, status: string ): Jam.Podcast {\n\t\treturn {\n\t\t\tid: podcast.id,\n\t\t\turl: podcast.url,\n\t\t\tcreated: podcast.created,\n\t\t\tlastCheck: podcast.lastCheck > 0 ? podcast.lastCheck : undefined,\n\t\t\tstatus: status,\n\t\t\terrorMessage: podcast.errorMessage,\n\t\t\tname: podcast.tag ? podcast.tag.title : podcast.url,\n\t\t\tdescription: podcast.tag ? podcast.tag.description : undefined\n\t\t};\n\t}\n\n\tstatic packTrack(track: JamServe.Track, includes: JamParameters.IncludesTrack): Jam.Track {\n\t\tincludes = includes || {};\n\t\treturn {\n\t\t\tid: track.id,\n\t\t\tparentID: track.parentID,\n\t\t\tartistID: track.artistID,\n\t\t\talbumID: track.albumID,\n\t\t\tname: track.name,\n\t\t\tcreated: track.stat.created,\n\t\t\tduration: track.media.duration || -1,\n\t\t\tmedia: includes.trackMedia ? {\n\t\t\t\tbitRate: track.media.bitRate || -1,\n\t\t\t\tformat: track.media.format || '',\n\t\t\t\tchannels: track.media.channels || -1,\n\t\t\t\tsampleRate: track.media.sampleRate || -1\n\t\t\t} : undefined,\n\t\t\ttag: includes.trackTag ? FORMAT.packTrackTag(track.tag) : undefined\n\t\t};\n\t}\n\n\tstatic packPodcastEpisode(episode: JamServe.Episode, includes: JamParameters.IncludesTrack, status: string): Jam.PodcastEpisode {\n\t\treturn {\n\t\t\tid: episode.id,\n\t\t\tparentID: '',\n\t\t\tcreated: episode.stat ? episode.stat.created : 0,\n\t\t\tpodcastID: episode.podcastID,\n\t\t\tstatus: status,\n\t\t\terrorMessage: episode.error,\n\t\t\tname: episode.title,\n\t\t\tduration: episode.media ? (episode.media.duration || -1) : -1,\n\t\t\tdate: episode.date,\n\t\t\ttitle: episode.title,\n\t\t\tsummary: episode.summary,\n\t\t\tguid: episode.guid,\n\t\t\tauthor: episode.author,\n\t\t\tlink: episode.link,\n\t\t\tmedia: includes.trackMedia && episode.media ? {\n\t\t\t\tbitRate: episode.media.bitRate || -1,\n\t\t\t\tformat: episode.media.format || '',\n\t\t\t\tchannels: episode.media.channels || -1,\n\t\t\t\tsampleRate: episode.media.sampleRate || -1\n\t\t\t} : undefined,\n\t\t\ttag: includes.trackTag && episode.tag ? FORMAT.packTrackTag(episode.tag) : undefined\n\t\t};\n\t}\n\n\tstatic packNowPlaying(entry: JamServe.NowPlaying): Jam.NowPlaying {\n\t\tconst playing: Jam.NowPlaying = {\n\t\t\tusername: entry.user.name,\n\t\t\tminutesAgo: Math.round(moment.duration(moment().diff(moment(entry.time))).asMinutes())\n\t\t};\n\t\tswitch (entry.obj.type) {\n\t\t\tcase DBObjectType.track:\n\t\t\t\tplaying.track = FORMAT.packTrack(<JamServe.Track>entry.obj, {});\n\t\t\t\tbreak;\n\t\t\tcase DBObjectType.episode:\n\t\t\t\tconst episode = <JamServe.Episode>entry.obj;\n\t\t\t\tplaying.track = FORMAT.packPodcastEpisode(episode, {}, episode.status);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn playing;\n\t}\n\n\tstatic packPlaylist(playlist: JamServe.Playlist, includes: JamParameters.IncludesPlaylist): Jam.Playlist {\n\t\treturn {\n\t\t\tid: playlist.id,\n\t\t\tname: playlist.name,\n\t\t\tuserID: playlist.userID,\n\t\t\tcomment: playlist.comment,\n\t\t\tisPublic: playlist.isPublic,\n\t\t\tduration: playlist.duration,\n\t\t\tcreated: playlist.created,\n\t\t\tchanged: playlist.changed,\n\t\t\ttrackCount: playlist.trackIDs.length,\n\t\t\ttrackIDs: includes.playlistTracksIDs ? playlist.trackIDs : undefined\n\t\t};\n\t}\n\n\tstatic packFolderIndex(index: JamServe.FolderIndex): Jam.FolderIndex {\n\t\treturn {\n\t\t\tlastModified: index.lastModified,\n\t\t\tgroups: index.groups.map(i => ({\n\t\t\t\tname: i.name,\n\t\t\t\tentries: i.entries.map(e => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\ttrackCount: e.trackCount,\n\t\t\t\t\t\tfolderID: e.folder.id\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t}))\n\t\t};\n\t}\n\n\tstatic packArtistIndex(index: JamServe.ArtistIndex): Jam.ArtistIndex {\n\t\treturn {\n\t\t\tlastModified: index.lastModified,\n\t\t\tgroups: index.groups.map(i => ({\n\t\t\t\tname: i.name,\n\t\t\t\tentries: i.entries.map(e => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: e.artist.name,\n\t\t\t\t\t\ttrackCount: e.artist.trackIDs.length,\n\t\t\t\t\t\talbumCount: e.artist.albumIDs.length,\n\t\t\t\t\t\tartistID: e.artist.id\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t}))\n\t\t};\n\t}\n\n\tstatic packChatMessage(message: JamServe.ChatMessage): Jam.ChatMessage {\n\t\treturn {\n\t\t\tusername: message.username,\n\t\t\tuserID: message.userID,\n\t\t\ttime: message.time,\n\t\t\tmessage: message.message\n\t\t};\n\t}\n\n\tpublic static packPlayQueue(playQueue: JamServe.PlayQueue, includes: JamParameters.IncludesPlayQueue): Jam.PlayQueue {\n\t\treturn {\n\t\t\tchanged: playQueue.changed,\n\t\t\tchangedBy: playQueue.changedBy,\n\t\t\tcurrentID: playQueue.currentID,\n\t\t\tposition: playQueue.position,\n\t\t\ttrackIDs: includes.playQueueTrackIDs ? playQueue.trackIDs : undefined\n\t\t};\n\t}\n}\n","export function paginate<T>(list: Array<T>, amount: number | undefined, offset: number | undefined): Array<T> {\n\tif (amount !== undefined && amount < 0) {\n\t\treturn list;\n\t}\n\treturn list.slice((offset || 0), (offset || 0) + (amount || 20));\n}\n","module.exports = require(\"cors\");","module.exports = require(\"express-session\");","import {OpenAPIObject} from '../../model/openapi';\nimport express from 'express';\nimport {checkOpenApiParameters} from '../../utils/openapi-parameters-check';\nimport {ApiResponder} from './response';\n\nconst openapi: OpenAPIObject = require('../../model/jam-openapi-0.1.0.json');\nconst JamApiSchema = require('../../model/jam-rest-api-0.1.0.schema.json');\n\nexport function apiCheck(name: string): express.RequestHandler {\n\tfunction CheckApiParametersHandler(req: express.Request, res: express.Response, next: express.NextFunction) {\n\t\tcheckOpenApiParameters(name, req, openapi, JamApiSchema).then(() => {\n\t\t\tnext();\n\t\t}).catch((e) => {\n\t\t\tApiResponder.error(res, e);\n\t\t});\n\t}\n\treturn CheckApiParametersHandler;\n}\n","import {OpenAPIObject, OperationObject, ParameterObject, RequestBodyObject, SchemaObject} from '../model/openapi';\nimport express from 'express';\nimport Logger from './logger';\nimport {Definition} from 'typescript-json-schema';\nimport {validate} from './validate-json';\n\nconst log = Logger('CheckApiParameters');\n\nfunction validOAParameter(query: any, param: ParameterObject): string | null {\n\tif (!query) {\n\t\treturn 'Missing parameter collection ' + param.name;\n\t}\n\tconst schema = <SchemaObject> param.schema;\n\tlet value = query[param.name];\n\t// set default values\n\tif (value === undefined) {\n\t\tif (schema && schema.default !== undefined) {\n\t\t\tquery[param.name] = schema.default;\n\t\t\tvalue = schema.default;\n\t\t}\n\t}\n\t// check required\n\tif (value === undefined) {\n\t\tif (param.required) {\n\t\t\treturn 'Missing required parameter ' + param.name;\n\t\t}\n\t\treturn null;\n\t}\n\t// sanitize & check string parameter type\n\tif (schema.type === 'boolean') {\n\t\tif (['true', 'yes', '1'].indexOf(value.toString()) >= 0) {\n\t\t\tquery[param.name] = true;\n\t\t\tvalue = true;\n\t\t} else if (['false', 'no', '0'].indexOf(value.toString()) >= 0) {\n\t\t\tquery[param.name] = false;\n\t\t\tvalue = false;\n\t\t} else {\n\t\t\treturn 'Invalid boolean parameter ' + param.name;\n\t\t}\n\t\tquery[param.name] = value;\n\t} else if (['float', 'long', 'double', 'number', 'integer'].indexOf(schema.type || '') >= 0) {\n\t\tlet num = Number(value.toString());\n\t\tif (isNaN(num)) {\n\t\t\treturn 'Invalid number parameter ' + param.name;\n\t\t}\n\t\tif (schema.type === 'integer') {\n\t\t\tnum = Math.floor(num);\n\t\t}\n\t\tif (schema.minimum !== undefined && schema.minimum > num) {\n\t\t\treturn 'Invalid number parameter ' + param.name + '; minimum is ' + schema.minimum;\n\t\t}\n\t\tif (schema.maximum !== undefined && schema.maximum < num) {\n\t\t\treturn 'Invalid number parameter ' + param.name + '; maximum is ' + schema.maximum;\n\t\t}\n\t\tquery[param.name] = num;\n\t} else if (schema.type === 'string') {\n\t\tconst s = value.toString().trim();\n\t\t// if (s.length === 0) {\n\t\t// \treturn 'Empty string parameter ' + param.name;\n\t\t// }\n\t\tif (schema.enum) {\n\t\t\tif (schema.enum.indexOf(s) < 0) {\n\t\t\t\treturn 'Invalid enum string parameter ' + param.name + ': ' + s;\n\t\t\t}\n\t\t}\n\t\tquery[param.name] = s;\n\t} else if (schema.type === 'array') {\n\t\tconst items = <SchemaObject>(schema.items || {type: 'unknown'});\n\t\tif (items.type === 'string') {\n\t\t\tconst list = ((Array.isArray(value) ? value : [value]) || []).map(s => s.toString().trim());\n\t\t\tif (items.enum) {\n\t\t\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\t\t\tconst s = list[i];\n\t\t\t\t\tif (items.enum.indexOf(s) < 0) {\n\t\t\t\t\t\treturn 'Invalid enum string parameter ' + param.name + ': ' + s;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tquery[param.name] = list;\n\t\t} else if (['float', 'long', 'double', 'number', 'integer'].indexOf(items.type || '') >= 0) {\n\t\t\tconst list = ((Array.isArray(value) ? value : [value]) || []).map(id => {\n\t\t\t\tlet num = Number(id.toString());\n\t\t\t\tif (items.type === 'integer') {\n\t\t\t\t\tnum = Math.floor(num);\n\t\t\t\t}\n\t\t\t\treturn num;\n\t\t\t});\n\t\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\t\tconst num = list[i];\n\t\t\t\tif (isNaN(num)) {\n\t\t\t\t\treturn 'Invalid number array parameter ' + param.name;\n\t\t\t\t}\n\t\t\t\tif (items.minimum !== undefined && items.minimum > num) {\n\t\t\t\t\treturn 'Invalid number array parameter ' + param.name + '; minimum is ' + items.minimum;\n\t\t\t\t}\n\t\t\t\tif (schema.maximum !== undefined && schema.maximum < num) {\n\t\t\t\t\treturn 'Invalid number array parameter ' + items.name + '; maximum is ' + items.maximum;\n\t\t\t\t}\n\t\t\t}\n\t\t\tquery[param.name] = list;\n\t\t} else {\n\t\t\tconsole.log('TODO: validOAParameter list type', schema, value);\n\t\t}\n\t}\n\treturn null;\n}\n\nasync function checkAORequestBody(cmd: OperationObject, apiSchema: any, body: any): Promise<void> {\n\tif (!cmd.requestBody || !(<RequestBodyObject>cmd.requestBody).content || !(<RequestBodyObject>cmd.requestBody).content['application/json']) {\n\t\treturn;\n\t}\n\tif (!body) {\n\t\treturn Promise.reject(Error('Missing Request Body'));\n\t}\n\tconst schema = (<RequestBodyObject>cmd.requestBody).content['application/json'].schema;\n\tif (!schema || !schema.$ref) {\n\t\treturn Promise.reject(Error('Unimplemented POST schema'));\n\t}\n\tconst def = apiSchema.definitions[schema.$ref.split('/')[3]];\n\tif (!def) {\n\t\treturn Promise.reject(Error('Unknown POST schema' + schema.$ref));\n\t}\n\tconst result = await validate(body, def);\n\tif (result.errors.length > 0) {\n\t\tconsole.error(def, body, result.errors);\n\t\treturn Promise.reject(Error(JSON.stringify(result.errors)));\n\t}\n}\n\nasync function checkAOParameters(cmd: OperationObject, schema: Definition, req: express.Request): Promise<void> {\n\tif (!cmd.parameters) {\n\t\treturn;\n\t}\n\tlet error: string | null = null;\n\tcmd.parameters.find(param => {\n\t\tparam = <ParameterObject>param;\n\t\tif (param.in === 'query') {\n\t\t\terror = validOAParameter(req.query, param);\n\t\t} else if (param.in === 'path') {\n\t\t\terror = validOAParameter(req.params, param);\n\t\t} else if (param.in === 'header') {\n\t\t\terror = validOAParameter(req.headers, param);\n\t\t} else if (param.in === 'cookie') {\n\t\t\terror = validOAParameter(req.cookies, param);\n\t\t} else {\n\t\t\tlog.info('Invalid/Unknown parameter spec', param);\n\t\t}\n\t\treturn !!error;\n\t});\n\tif (error) {\n\t\treturn Promise.reject(Error(error));\n\t}\n}\n\nexport async function checkOpenApiParameters(name: string, req: express.Request, openapi: OpenAPIObject, schema: Definition, forceMethod?: string): Promise<void> {\n\tconst cmdPath = openapi.paths[name];\n\tif (!cmdPath) {\n\t\tlog.info('cmd not found to validate', name);\n\t\treturn;\n\t}\n\tconst method = forceMethod || req.method.toLowerCase();\n\tconst cmd = cmdPath[method];\n\tif (!cmd) {\n\t\tlog.info('cmd method ' + req.method + ' not found to validate', req.path);\n\t\treturn;\n\t}\n\tif (method === 'get') {\n\t\tawait checkAOParameters(cmd, schema, req);\n\t} else {\n\t\tawait checkAORequestBody(cmd, schema, req.body);\n\t}\n}\n","import {Engine} from './engine/engine';\nimport {configureLogger} from './utils/logger';\nimport {Server} from './api/server';\nimport {loadConfig} from './config';\nimport {Store} from './store/store';\n\nconst config = loadConfig();\n\nconfigureLogger(config);\nconst engine = new Engine(config);\nconst server = new Server(engine);\n\nasync function run(): Promise<void> {\n\ttry {\n\t\tawait engine.start();\n\t\tawait server.start();\n\t} catch (e) {\n\t\tconsole.error('Error on startup', e);\n\t\treturn;\n\t}\n\ttry {\n\t\tawait engine.refresh();\n\t} catch (e) {\n\t\tconsole.error('Error on startup refresh', e);\n\t}\n}\n\nasync function stop(): Promise<void> {\n\ttry {\n\t\tawait server.stop();\n\t\tawait engine.stop();\n\t\tprocess.exit();\n\t} catch (e) {\n\t\tconsole.error('Error on startdown', e);\n\t\tprocess.exit(1);\n\t}\n}\n\nasync function runClearDB(): Promise<void> {\n\tconst store = new Store(config);\n\tawait store.open();\n\tawait store.reset();\n\tawait store.close();\n}\n\nif (process.argv.indexOf('--cleardb') > 0) {\n\trunClearDB().then(() => {\n\t\tconsole.log('done.');\n\t}).catch(e => {\n\t\tconsole.error(e);\n\t});\n} else {\n\n\tprocess.on('SIGTERM', () => {\n\t\tstop();\n\t});\n\n\trun();\n}\n\n","import path from 'path';\nimport {JamServe} from '../model/jamserve';\nimport {IO} from '../io/io';\nimport {BaseStore, Store} from '../store/store';\nimport {Audio} from '../audio/audio';\nimport {Images} from '../io/components/images';\nimport {DBObjectType, FolderType, FolderTypeImageName} from '../types';\nimport Logger from '../utils/logger';\nimport {dirExist, dirRename, fileCopy, fileDeleteIfExists, fileSuffix, makePath, replaceFileSystemChars} from '../utils/fs-utils';\nimport {IndexTree} from './components/indextree';\nimport {Metainfo} from './components/metainfo';\nimport {Users} from './components/users';\nimport {Chat} from './components/chat';\nimport {Genres} from './components/genres';\nimport {Podcasts} from './components/podcasts';\nimport {NowPlaying} from './components/nowplaying';\nimport {Jam} from '../model/jam-rest-data-0.1.0';\nimport {CompressListStream, CompressStream} from '../utils/compress-stream';\nimport {PreTranscoder, Transcoder} from '../audio/transcoder';\nimport {Roots} from './components/roots';\nimport {Playlists} from './components/playlists';\nimport {PlayQueues} from './components/playqueues';\nimport {IApiBinaryResult} from '../typings';\nimport {Config} from '../config';\nimport DBObject = JamServe.DBObject;\nimport {Waveforms} from '../io/components/waveforms';\nimport {GenericError, InvalidParamError} from '../api/jam/error';\nimport {JamParameters} from '../model/jam-rest-params-0.1.0';\n\nconst log = Logger('Engine');\n\nexport class Engine {\n\tpublic config: Config;\n\tpublic store: Store;\n\tpublic audio: Audio;\n\tpublic images: Images;\n\tpublic waveforms: Waveforms;\n\tpublic io: IO;\n\tpublic meta: Metainfo;\n\tpublic index: IndexTree;\n\tpublic users: Users;\n\tpublic roots: Roots;\n\tpublic chat: Chat;\n\tpublic genres: Genres;\n\tpublic playqueues: PlayQueues;\n\tpublic podcasts: Podcasts;\n\tpublic playlists: Playlists;\n\tpublic nowPlaying: NowPlaying;\n\n\tconstructor(config: Config) {\n\t\tthis.config = config;\n\t\tthis.store = new Store(config);\n\t\tthis.audio = new Audio(config);\n\t\tthis.waveforms = new Waveforms(config);\n\t\tthis.images = new Images(config);\n\t\tthis.chat = new Chat(config);\n\t\tthis.genres = new Genres(this.store);\n\t\tthis.nowPlaying = new NowPlaying(this.store);\n\t\tthis.playlists = new Playlists(this.store);\n\t\tthis.playqueues = new PlayQueues(this.store);\n\t\tthis.podcasts = new Podcasts(this.config, this.store, this.audio);\n\t\tthis.index = new IndexTree(config, this.store);\n\t\tthis.users = new Users(this.config, this.store, this.images);\n\t\tthis.meta = new Metainfo(this.store, this.audio);\n\t\tthis.io = new IO(this.store, this.audio, this.images, this.waveforms);\n\t\tthis.roots = new Roots(this.store, this.io);\n\t}\n\n\tasync refresh(): Promise<void> {\n\t\tawait this.io.refresh();\n\t\tawait this.refreshIndexes();\n\t}\n\n\tasync refreshIndexes(): Promise<void> {\n\t\tawait this.genres.buildGenres();\n\t\tawait this.index.buildIndexes();\n\t}\n\n\tasync refreshRoot(root: JamServe.Root): Promise<void> {\n\t\tawait this.io.rescanRoot(root);\n\t\tawait this.refreshIndexes();\n\t}\n\n\tasync getListAvgHighest(type: DBObjectType): Promise<Array<string>> {\n\t\tconst states = await this.store.state.search({type});\n\t\tconst ratings: { [id: string]: Array<number> } = {};\n\t\tstates.forEach(state => {\n\t\t\tif (state.rated !== undefined) {\n\t\t\t\tratings[state.destID] = ratings[state.destID] || [];\n\t\t\t\tratings[state.destID].push(state.rated);\n\t\t\t}\n\t\t});\n\t\tconst list = Object.keys(ratings).map(key => {\n\t\t\treturn {\n\t\t\t\tid: key,\n\t\t\t\tavg: ratings[key].reduce((b, c) => (b + c), 0) / ratings[key].length\n\t\t\t};\n\t\t}).sort((a, b) => (b.avg - a.avg));\n\t\treturn list.map(a => a.id);\n\t}\n\n\tasync getFilteredListAvgHighest<T extends JamServe.SearchQuery>(type: DBObjectType, query: T, user: JamServe.User, store: BaseStore<DBObject, JamServe.SearchQuery>): Promise<Array<string>> {\n\t\tconst ids = await this.getListAvgHighest(type);\n\t\treturn await this.getFilteredIDs(ids, query, store);\n\t}\n\n\tasync getListHighestRated(type: DBObjectType, user: JamServe.User): Promise<Array<string>> {\n\t\tconst states = await this.store.state.search({userID: user.id, type, minRating: 1});\n\t\tconst ratings = states.filter(state => state.rated !== undefined).sort((a, b) => <number>b.rated - <number>a.rated);\n\t\treturn ratings.map(a => a.destID);\n\t}\n\n\tasync getFilteredListHighestRated<T extends JamServe.SearchQuery>(type: DBObjectType, query: T, user: JamServe.User, store: BaseStore<DBObject, JamServe.SearchQuery>): Promise<Array<string>> {\n\t\tconst ids = await this.getListHighestRated(type, user);\n\t\treturn await this.getFilteredIDs(ids, query, store);\n\t}\n\n\tasync getListFrequentlyPlayed(type: DBObjectType, user: JamServe.User): Promise<Array<string>> {\n\t\tconst states = await this.store.state.search({userID: user.id, type, isPlayed: true});\n\t\tstates.sort((a, b) => b.played - a.played);\n\t\treturn states.map(a => a.destID);\n\t}\n\n\tasync getFilteredListFrequentlyPlayed<T extends JamServe.SearchQuery>(type: DBObjectType, query: T, user: JamServe.User, store: BaseStore<DBObject, JamServe.SearchQuery>): Promise<Array<string>> {\n\t\tconst ids = await this.getListFrequentlyPlayed(type, user);\n\t\treturn await this.getFilteredIDs(ids, query, store);\n\t}\n\n\tasync getListFaved(type: DBObjectType, user: JamServe.User): Promise<Array<string>> {\n\t\tconst states = await this.store.state.search({userID: user.id, type, isFaved: true});\n\t\tstates.sort((a, b) => b.lastplayed - a.lastplayed);\n\t\treturn states.map(a => a.destID);\n\t}\n\n\tasync getFilteredListFaved<T extends JamServe.SearchQuery>(type: DBObjectType, query: T, user: JamServe.User, store: BaseStore<DBObject, JamServe.SearchQuery>): Promise<Array<string>> {\n\t\tconst ids = await this.getListFaved(type, user);\n\t\treturn await this.getFilteredIDs(ids, query, store);\n\t}\n\n\tasync getListRecentlyPlayed(type: DBObjectType, user: JamServe.User): Promise<Array<string>> {\n\t\tconst states = await this.store.state.search({userID: user.id, type, isPlayed: true});\n\t\tstates.sort((a, b) => b.lastplayed - a.lastplayed);\n\t\treturn states.map(a => a.destID);\n\t}\n\n\tasync getFilteredListRecentlyPlayed<T extends JamServe.SearchQuery>(type: DBObjectType, query: T, user: JamServe.User, store: BaseStore<DBObject, JamServe.SearchQuery>): Promise<Array<string>> {\n\t\tconst ids = await this.getListRecentlyPlayed(type, user);\n\t\treturn await this.getFilteredIDs(ids, query, store);\n\t}\n\n\tasync getFilteredIDs<T extends DBObject>(ids: Array<string>, query: JamServe.SearchQuery, store: BaseStore<T, JamServe.SearchQuery>): Promise<Array<string>> {\n\t\tconst list = await store.searchIDs(Object.assign(query, {ids, amount: -1, offset: 0}));\n\t\treturn list.sort((a, b) => {\n\t\t\treturn ids.indexOf(a) - ids.indexOf(b);\n\t\t});\n\t}\n\n\tasync getFolderParents(folder: JamServe.Folder): Promise<Array<Jam.FolderParent>> {\n\t\tconst result = await this.collectFolderPath(folder.parentID);\n\t\treturn result.map(parent => {\n\t\t\treturn {\n\t\t\t\tid: parent.id,\n\t\t\t\tname: path.basename(parent.path)\n\t\t\t};\n\t\t});\n\t}\n\n\tasync trackBookmarkRemove(trackID: string, user: JamServe.User): Promise<void> {\n\t\tconst bookmark = await this.store.bookmark.searchOne({destID: trackID, userID: user.id});\n\t\tif (bookmark) {\n\t\t\tawait this.store.bookmark.remove(bookmark.id);\n\t\t}\n\t}\n\n\tasync trackBookmarkCreate(track: JamServe.Track, user: JamServe.User, position: number, comment: string | undefined): Promise<JamServe.Bookmark> {\n\t\tlet bookmark = await this.store.bookmark.searchOne({destID: track.id, userID: user.id});\n\t\tif (!bookmark) {\n\t\t\tbookmark = {\n\t\t\t\tid: '',\n\t\t\t\ttype: DBObjectType.bookmark,\n\t\t\t\tdestID: track.id,\n\t\t\t\tuserID: user.id,\n\t\t\t\tposition,\n\t\t\t\tcomment,\n\t\t\t\tcreated: Date.now(),\n\t\t\t\tchanged: Date.now()\n\t\t\t};\n\t\t\tbookmark.id = await this.store.bookmark.add(bookmark);\n\t\t} else {\n\t\t\tbookmark.comment = comment;\n\t\t\tbookmark.position = position;\n\t\t\tbookmark.changed = Date.now();\n\t\t\tawait this.store.bookmark.replace(bookmark);\n\t\t}\n\t\treturn bookmark;\n\t}\n\n\tasync collectFolderPath(folderId: string | undefined): Promise<Array<JamServe.Folder>> {\n\t\tconst result: Array<JamServe.Folder> = [];\n\t\tconst store = this.store.folder;\n\n\t\tasync function collect(id?: string): Promise<void> {\n\t\t\tif (!id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst folder = await store.byId(id);\n\t\t\tif (folder) {\n\t\t\t\tresult.unshift(folder);\n\t\t\t\tawait collect(folder.parentID);\n\t\t\t}\n\t\t}\n\n\t\tawait collect(folderId);\n\t\treturn result;\n\t}\n\n\tasync downloadFolderImage(folder: JamServe.Folder, imageUrl: string): Promise<void> {\n\t\tfolder.tag.image = await this.images.storeImage(folder.path, FolderTypeImageName[folder.tag.type], imageUrl);\n\t\tawait this.store.folder.replace(folder);\n\t}\n\n\tasync setFolderImage(folder: JamServe.Folder, filename: string): Promise<void> {\n\t\tconst destFileName = FolderTypeImageName[folder.tag.type] + path.extname(filename);\n\t\tconst destName = path.join(folder.path, destFileName);\n\t\tawait fileDeleteIfExists(destName);\n\t\tawait fileCopy(filename, destName);\n\t\tfolder.tag.image = destFileName;\n\t\tawait this.store.folder.replace(folder);\n\t}\n\n\tasync renameFolder(folder: JamServe.Folder, name: string): Promise<void> {\n\t\tname = replaceFileSystemChars(name, '').trim();\n\t\tif (name.length === 0) {\n\t\t\treturn Promise.reject(Error('Invalid Name'));\n\t\t}\n\t\tconst p = path.dirname(folder.path);\n\t\tconst dest = path.join(p, name);\n\t\tconst exists = await dirExist(dest);\n\t\tif (exists) {\n\t\t\treturn Promise.reject(Error('Directory already exists'));\n\t\t}\n\t\tawait dirRename(folder.path, dest);\n\t\tawait this.io.applyFolderMove(folder, dest);\n\t}\n\n\tasync checkFolderInfoImage(folder: JamServe.Folder): Promise<void> {\n\t\tif (folder.tag.image) {\n\t\t\treturn;\n\t\t}\n\t\tif (folder.info && folder.info.album.image && folder.info.album.image.large) {\n\t\t\tawait this.downloadFolderImage(folder, folder.info.album.image.large);\n\t\t} else if (folder.info && folder.info.artist.image && folder.info.artist.image.large) {\n\t\t\tawait this.downloadFolderImage(folder, folder.info.artist.image.large);\n\t\t}\n\t}\n\n\tasync getFolderImage(folder: JamServe.Folder, size?: number, format?: string): Promise<IApiBinaryResult | undefined> {\n\t\tawait this.checkFolderInfoImage(folder);\n\t\tif (!folder.tag.image) {\n\t\t\treturn;\n\t\t}\n\t\treturn await this.images.get(folder.id, path.join(folder.path, folder.tag.image), size, format);\n\t}\n\n\tasync getAlbumImage(album: JamServe.Album, size?: number, format?: string): Promise<IApiBinaryResult | undefined> {\n\t\tif (album.trackIDs.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst track = await this.store.track.byId(album.trackIDs[0]);\n\t\tif (!track) {\n\t\t\treturn;\n\t\t}\n\t\tconst folder = await this.store.folder.byId(track.parentID);\n\t\tif (!folder) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.getFolderImage(folder, size, format);\n\t}\n\n\tasync getArtistImage(artist: JamServe.Artist, size?: number, format?: string): Promise<IApiBinaryResult | undefined> {\n\t\tif (artist.trackIDs.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst track = await this.store.track.byId(artist.trackIDs[0]);\n\t\tif (!track) {\n\t\t\treturn;\n\t\t}\n\t\tconst folders = await this.collectFolderPath(track.parentID);\n\t\tif (folders.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet folder = folders.find(f => f.tag.type === FolderType.artist);\n\t\tif (!folder) {\n\t\t\tfolder = folders[folders.length - 1];\n\t\t}\n\t\tif (!folder) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.getFolderImage(folder, size, format);\n\t}\n\n\tasync getTrackImage(track: JamServe.Track, size?: number, format?: string): Promise<IApiBinaryResult | undefined> {\n\t\tconst folder = await this.store.folder.byId(track.parentID);\n\t\tif (!folder) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.getFolderImage(folder, size, format);\n\t}\n\n\tasync getUserImage(user: JamServe.User, size?: number, format?: string): Promise<IApiBinaryResult | undefined> {\n\t\tif (user.avatar) {\n\t\t\treturn this.images.get(user.id, path.join(this.config.getDataPath(['images']), user.avatar), size, format);\n\t\t}\n\t}\n\n\tasync getObjImage(o: DBObject, size?: number, format?: string): Promise<IApiBinaryResult> {\n\t\tlet result: IApiBinaryResult | undefined;\n\t\tswitch (o.type) {\n\t\t\tcase DBObjectType.track:\n\t\t\t\tconst track = <JamServe.Track>o;\n\t\t\t\tresult = await this.getTrackImage(track, size, format);\n\t\t\t\tbreak;\n\t\t\tcase DBObjectType.folder:\n\t\t\t\tconst folder = <JamServe.Folder>o;\n\t\t\t\tresult = await this.getFolderImage(folder, size, format);\n\t\t\t\tbreak;\n\t\t\tcase DBObjectType.artist:\n\t\t\t\tconst artist = <JamServe.Artist>o;\n\t\t\t\tresult = await this.getArtistImage(artist, size, format);\n\t\t\t\tbreak;\n\t\t\tcase DBObjectType.album:\n\t\t\t\tconst album = <JamServe.Album>o;\n\t\t\t\tresult = await this.getAlbumImage(album, size, format);\n\t\t\t\tbreak;\n\t\t\tcase DBObjectType.user:\n\t\t\t\tconst user = <JamServe.User>o;\n\t\t\t\tresult = await this.getUserImage(user, size, format);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\tif (!result) {\n\t\t\treturn this.paintImage(o, size, format);\n\t\t} else {\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tasync paintImage(obj: DBObject, size?: number, format?: string): Promise<IApiBinaryResult> {\n\t\tconst getCoverArtText = (o: JamServe.DBObject): string => {\n\t\t\tswitch (o.type) {\n\t\t\t\tcase DBObjectType.track:\n\t\t\t\t\tconst track = <JamServe.Track>o;\n\t\t\t\t\treturn track.tag && track.tag.title ? track.tag.title : path.basename(track.path);\n\t\t\t\tcase DBObjectType.folder:\n\t\t\t\t\tconst folder = <JamServe.Folder>o;\n\t\t\t\t\tlet result: string | undefined;\n\t\t\t\t\tif (folder.tag) {\n\t\t\t\t\t\tif (folder.tag.type === FolderType.artist) {\n\t\t\t\t\t\t\tresult = folder.tag.artist;\n\t\t\t\t\t\t} else if ([FolderType.multialbum, FolderType.album].indexOf(folder.tag.type) >= 0) {\n\t\t\t\t\t\t\tresult = folder.tag.album;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!result || result.length === 0) {\n\t\t\t\t\t\tresult = path.basename(folder.path);\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\tcase DBObjectType.episode:\n\t\t\t\t\tconst episode: JamServe.Episode = <JamServe.Episode>o;\n\t\t\t\t\tlet text: string | undefined = episode.tag ? episode.tag.title : undefined;\n\t\t\t\t\tif (!text && episode.path) {\n\t\t\t\t\t\ttext = path.basename(episode.path);\n\t\t\t\t\t}\n\t\t\t\t\tif (!text) {\n\t\t\t\t\t\ttext = 'podcast';\n\t\t\t\t\t}\n\t\t\t\t\treturn text;\n\t\t\t\tcase DBObjectType.playlist:\n\t\t\t\t\tconst playlist: JamServe.Playlist = <JamServe.Playlist>o;\n\t\t\t\t\treturn playlist.name;\n\t\t\t\tcase DBObjectType.podcast:\n\t\t\t\t\tconst podcast: JamServe.Podcast = <JamServe.Podcast>o;\n\t\t\t\t\treturn podcast.tag ? podcast.tag.title : podcast.url;\n\t\t\t\tcase DBObjectType.album:\n\t\t\t\t\tconst album: JamServe.Album = <JamServe.Album>o;\n\t\t\t\t\treturn album.name;\n\t\t\t\tcase DBObjectType.artist:\n\t\t\t\t\tconst artist: JamServe.Artist = <JamServe.Artist>o;\n\t\t\t\t\treturn artist.name;\n\t\t\t\tcase DBObjectType.user:\n\t\t\t\t\tconst user: JamServe.User = <JamServe.User>o;\n\t\t\t\t\treturn user.name;\n\t\t\t\tdefault:\n\t\t\t\t\treturn DBObjectType[o.type];\n\t\t\t}\n\t\t};\n\t\tconst s = getCoverArtText(obj);\n\t\treturn this.images.paint(s, size || 128, format);\n\t}\n\n\tasync getObjStreamSVG(o: DBObject, user: JamServe.User): Promise<IApiBinaryResult> {\n\t\tswitch (o.type) {\n\t\t\tcase DBObjectType.track:\n\t\t\t\tconst track: JamServe.Track = <JamServe.Track>o;\n\t\t\t\treturn await this.waveforms.get(o.id, path.join(track.path, track.name), track.media);\n\t\t\tcase DBObjectType.episode:\n\t\t\t\tconst episode: JamServe.Episode = <JamServe.Episode>o;\n\t\t\t\tif (episode.path && episode.media) {\n\t\t\t\t\treturn await this.waveforms.get(o.id, path.join(episode.path), episode.media);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\treturn Promise.reject(Error('Invalid Object Type for SVG generation'));\n\t}\n\n\tasync getObjStream(o: DBObject, format: string | undefined, maxBitRate: number | undefined, user: JamServe.User): Promise<IApiBinaryResult> {\n\n\t\tasync function stream(filename: string, media: JamServe.TrackMedia): Promise<IApiBinaryResult> {\n\t\t\tlet f = format || 'mp3';\n\t\t\tif (f[0] === '.') {\n\t\t\t\tf = f.slice(1);\n\t\t\t}\n\t\t\tconst bitRate = maxBitRate || 0;\n\t\t\tif (f !== 'raw' && Transcoder.needsTranscoding(media.format || fileSuffix(filename), f, bitRate)) {\n\t\t\t\tif (!Transcoder.validTranscoding(media, f)) {\n\t\t\t\t\treturn Promise.reject(Error('Unsupported transcoding format'));\n\t\t\t\t}\n\t\t\t\treturn {pipe: new PreTranscoder(filename, f, bitRate)};\n\t\t\t\t// return {pipe: new Transcoder(filename, f, bitRate, media.duration)};\n\t\t\t} else {\n\t\t\t\treturn {file: {filename, name: o.id + '.' + f}};\n\t\t\t}\n\t\t}\n\n\t\tswitch (o.type) {\n\t\t\tcase DBObjectType.track:\n\t\t\t\tconst track: JamServe.Track = <JamServe.Track>o;\n\t\t\t\tthis.nowPlaying.reportTrack(track, user);\n\t\t\t\treturn stream(path.join(track.path, track.name), track.media);\n\t\t\tcase DBObjectType.episode:\n\t\t\t\tconst episode: JamServe.Episode = <JamServe.Episode>o;\n\t\t\t\tif (episode.path && episode.media) {\n\t\t\t\t\tthis.nowPlaying.reportEpisode(episode, user);\n\t\t\t\t\treturn stream(episode.path, episode.media);\n\t\t\t\t} else {\n\t\t\t\t\treturn Promise.reject(GenericError('Podcast episode not ready'));\n\t\t\t\t}\n\t\t}\n\t\treturn Promise.reject(Error('Invalid Object Type for Streaming'));\n\t}\n\n\tasync getObjDownload(o: DBObject, format: string | undefined, user: JamServe.User): Promise<IApiBinaryResult> {\n\n\t\tconst sendTrackList = (name: string, tracks: Array<JamServe.Track>): IApiBinaryResult => {\n\t\t\tconst fileList = tracks.map(t => path.join(t.path, t.name));\n\t\t\treturn {pipe: new CompressListStream(fileList, replaceFileSystemChars(name, '_'))};\n\t\t};\n\n\t\tswitch (o.type) {\n\t\t\tcase DBObjectType.track:\n\t\t\t\tconst track = <JamServe.Track>o;\n\t\t\t\treturn {pipe: new CompressListStream([path.join(track.path, track.name)], path.basename(track.name))};\n\t\t\tcase DBObjectType.folder:\n\t\t\t\tconst folder = <JamServe.Folder>o;\n\t\t\t\treturn {pipe: new CompressStream(folder.path, path.basename(folder.path))};\n\t\t\tcase DBObjectType.artist:\n\t\t\t\tconst artist = <JamServe.Artist>o;\n\t\t\t\treturn sendTrackList(artist.name || 'artist', await this.store.track.byIds(artist.trackIDs));\n\t\t\tcase DBObjectType.album:\n\t\t\t\tconst album = <JamServe.Album>o;\n\t\t\t\treturn sendTrackList(album.name || 'album', await this.store.track.byIds(album.trackIDs));\n\t\t\tcase DBObjectType.playlist:\n\t\t\t\tconst playlist = <JamServe.Playlist>o;\n\t\t\t\tif (playlist.userID !== user.id) {\n\t\t\t\t\treturn Promise.reject(Error('Unauthorized'));\n\t\t\t\t}\n\t\t\t\t// TODO: add playlist index file m3u/pls\n\t\t\t\treturn sendTrackList(playlist.name || 'playlist', await this.store.track.byIds(playlist.trackIDs));\n\t\t}\n\t\treturn Promise.reject(Error('Invalid Object Type for Download'));\n\t}\n\n\tprivate async checkFirstStart(): Promise<void> {\n\t\tif (!this.config.firstStart) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.config.firstStart.adminUser) {\n\t\t\tconst count = await this.store.user.count();\n\t\t\tif (count === 0) {\n\t\t\t\tconst adminUser = this.config.firstStart.adminUser;\n\t\t\t\tconst user: JamServe.User = {\n\t\t\t\t\tid: '',\n\t\t\t\t\tname: adminUser.name,\n\t\t\t\t\tpass: adminUser.pass || '',\n\t\t\t\t\temail: adminUser.mail || '',\n\t\t\t\t\ttype: DBObjectType.user,\n\t\t\t\t\tldapAuthenticated: true,\n\t\t\t\t\tscrobblingEnabled: true,\n\t\t\t\t\tcreated: Date.now(),\n\t\t\t\t\troles: {\n\t\t\t\t\t\tstreamRole: true,\n\t\t\t\t\t\tuploadRole: true,\n\t\t\t\t\t\tadminRole: true,\n\t\t\t\t\t\tpodcastRole: true,\n\t\t\t\t\t\t// coverArtRole: true,\n\t\t\t\t\t\t// settingsRole: true,\n\t\t\t\t\t\t// downloadRole: true,\n\t\t\t\t\t\t// playlistRole: true,\n\t\t\t\t\t\t// commentRole: true,\n\t\t\t\t\t\t// jukeboxRole: true,\n\t\t\t\t\t\t// videoConversionRole: true,\n\t\t\t\t\t\t// shareRole: true\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tawait this.store.user.add(user);\n\t\t\t}\n\t\t}\n\t\tif (this.config.firstStart.roots) {\n\t\t\tconst count = await this.store.root.count();\n\t\t\tif (count === 0) {\n\t\t\t\tconst firstStartRoots = this.config.firstStart.roots;\n\t\t\t\tfor (const first of firstStartRoots) {\n\t\t\t\t\tconst root: JamServe.Root = {\n\t\t\t\t\t\tid: '',\n\t\t\t\t\t\tcreated: Date.now(),\n\t\t\t\t\t\ttype: DBObjectType.root,\n\t\t\t\t\t\tname: first.name,\n\t\t\t\t\t\tpath: first.path\n\t\t\t\t\t};\n\t\t\t\t\tawait this.store.root.add(root);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async checkDataPaths(): Promise<void> {\n\t\tawait makePath(path.resolve(this.config.paths.data));\n\t\tawait makePath(path.resolve(this.config.paths.data, 'cache', 'waveforms'));\n\t\tawait makePath(path.resolve(this.config.paths.data, 'cache', 'uploads'));\n\t\tawait makePath(path.resolve(this.config.paths.data, 'cache', 'images'));\n\t\tawait makePath(path.resolve(this.config.paths.data, 'images'));\n\t\tawait makePath(path.resolve(this.config.paths.data, 'session'));\n\t\tawait makePath(path.resolve(this.config.paths.data, 'podcasts'));\n\t}\n\n\tasync start(): Promise<void> {\n\t\t// check paths\n\t\tawait this.checkDataPaths();\n\t\t// open store\n\t\tawait this.store.open();\n\t\t// first start?\n\t\tawait this.checkFirstStart();\n\t}\n\n\tasync stop(): Promise<void> {\n\t\tawait this.store.close();\n\t}\n\n\tasync fav(id: string, type: DBObjectType, userID: string, remove: boolean): Promise<JamServe.State> {\n\t\tconst state = await this.store.state.findOrCreate(id, userID, type);\n\t\tif (remove) {\n\t\t\tif (state.faved === undefined) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\tstate.faved = undefined;\n\t\t} else {\n\t\t\tif (state.faved !== undefined) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\tstate.faved = Date.now();\n\t\t}\n\t\tif (state.id.length === 0) {\n\t\t\tawait this.store.state.add(state);\n\t\t} else {\n\t\t\tawait this.store.state.replace(state);\n\t\t}\n\t\treturn state;\n\t}\n\n\tasync rate(id: string, type: DBObjectType, userID: string, rating: number): Promise<JamServe.State> {\n\t\tconst state = await this.store.state.findOrCreate(id, userID, type);\n\t\tif (rating === 0) {\n\t\t\tstate.rated = undefined;\n\t\t} else {\n\t\t\tstate.rated = rating;\n\t\t}\n\t\tif (state.id.length === 0) {\n\t\t\tawait this.store.state.add(state);\n\t\t} else {\n\t\t\tawait this.store.state.replace(state);\n\t\t}\n\t\treturn state;\n\t}\n\n\tasync autocomplete(query: JamParameters.AutoComplete): Promise<Jam.AutoComplete> {\n\t\tconst result: Jam.AutoComplete = {};\n\t\tif (query.track !== undefined && query.track > 0) {\n\t\t\tconst list = await this.store.track.search({query: query.query, amount: query.track});\n\t\t\tresult.tracks = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.tag.title || ''};\n\t\t\t});\n\t\t}\n\t\tif (query.album !== undefined && query.album > 0) {\n\t\t\tconst list = await this.store.album.search({query: query.query, amount: query.album});\n\t\t\tresult.albums = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.name};\n\t\t\t});\n\t\t}\n\t\tif (query.artist !== undefined && query.artist > 0) {\n\t\t\tconst list = await this.store.artist.search({query: query.query, amount: query.artist});\n\t\t\tresult.artists = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.name};\n\t\t\t});\n\t\t}\n\t\tif (query.folder !== undefined && query.folder > 0) {\n\t\t\tconst list = await this.store.artist.search({query: query.query, amount: query.folder});\n\t\t\tresult.folders = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.name};\n\t\t\t});\n\t\t}\n\t\tif (query.playlist !== undefined && query.playlist > 0) {\n\t\t\tconst list = await this.store.playlist.search({query: query.query, amount: query.playlist});\n\t\t\tresult.playlists = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.name};\n\t\t\t});\n\t\t}\n\t\tif (query.podcast !== undefined && query.podcast > 0) {\n\t\t\tconst list = await this.store.podcast.search({query: query.query, amount: query.podcast});\n\t\t\tresult.podcasts = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.tag ? o.tag.title : ''};\n\t\t\t});\n\t\t}\n\t\tif (query.episode !== undefined && query.episode > 0) {\n\t\t\tconst list = await this.store.episode.search({query: query.query, amount: query.episode});\n\t\t\tresult.episodes = list.map(o => {\n\t\t\t\treturn {id: o.id, name: o.title};\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n}\n\n","import {JamServe} from '../model/jamserve';\nimport {Store} from '../store/store';\nimport {Audio} from '../audio/audio';\nimport Logger from '../utils/logger';\nimport {ScanDir, scanDir} from './components/scan';\nimport {MatchDir, matchDir} from './components/match';\nimport {MergeChanges, Merger} from './components/merge';\nimport {MetaMerge} from './components/meta';\nimport {scanCleanStore} from './components/clean';\nimport {Subsonic} from '../model/subsonic-rest-data-1.16.0';\nimport {Images} from './components/images';\nimport {Waveforms} from './components/waveforms';\n\nconst log = Logger('IO');\n\n/*\n \tProcessing:\n\n \t* read folders and ile stats into tree\n \t* merge tree into db\n \t* merge Album and Artist meta data\n \t* clean db\n\n */\n\n/**\n * Handles file access/reading/writing\n */\n\nexport class IO {\n\tpublic scanning = false;\n\tprivate store: Store;\n\tprivate audio: Audio;\n\tprivate images: Images;\n\tprivate waveforms: Waveforms;\n\tprivate scanningCount: undefined | number;\n\tprivate rootstatus: { [id: string]: JamServe.RootStatus } = {};\n\n\tconstructor(store: Store, audio: Audio, images: Images, waveforms: Waveforms) {\n\t\tthis.store = store;\n\t\tthis.audio = audio;\n\t\tthis.images = images;\n\t\tthis.waveforms = waveforms;\n\t}\n\n\tprivate async scanDir(dir: string, parent: JamServe.Folder | undefined, level: number, rootID: string, changes: MergeChanges): Promise<JamServe.Folder | undefined> {\n\t\tconst scan: ScanDir = await scanDir(dir);\n\t\tconst match: MatchDir = await matchDir(scan, this.store, rootID);\n\t\tif (parent) {\n\t\t\tmatch.parent = {name: parent.path, folder: parent, level, rootID: rootID, files: [], directories: [match], removedFolders: [], removedTracks: [], stat: {mtime: 0, ctime: 0}};\n\t\t}\n\t\tconst merger = new Merger(rootID, this.store, this.audio, (count: number) => {\n\t\t\tthis.scanningCount = count;\n\t\t});\n\t\tawait await merger.merge(match, changes);\n\t\treturn match.folder;\n\t}\n\n\tgetScanStatus(): Subsonic.ScanStatus {\n\t\treturn {scanning: this.scanning, count: this.scanningCount};\n\t}\n\n\tgetRootStatus(id: string): JamServe.RootStatus {\n\t\treturn this.rootstatus[id];\n\t}\n\n\tprivate startScanning(): MergeChanges {\n\t\tthis.scanningCount = 0;\n\t\tthis.scanning = true;\n\t\treturn {\n\t\t\tnewTracks: [],\n\t\t\tunchangedTracks: [],\n\t\t\tunchangedFolders: [],\n\t\t\tremovedTracks: [],\n\t\t\tupdateTracks: [],\n\t\t\tnewFolders: [],\n\t\t\tremovedFolders: [],\n\t\t\tupdateFolders: []\n\t\t};\n\t}\n\n\tprivate async stopScanning(changes: MergeChanges): Promise<void> {\n\t\tthis.scanning = false;\n\t\tthis.scanningCount = undefined;\n\t\tawait this.cleanScanStore(changes);\n\t}\n\n\tasync cleanStore(): Promise<void> {\n\t\tconst changes: MergeChanges = {\n\t\t\tnewTracks: [],\n\t\t\tunchangedTracks: [],\n\t\t\tremovedTracks: [],\n\t\t\tupdateTracks: [],\n\t\t\tnewFolders: [],\n\t\t\tunchangedFolders: [],\n\t\t\tremovedFolders: [],\n\t\t\tupdateFolders: []\n\t\t};\n\t\tawait this.cleanScanStore(changes);\n\t}\n\n\tprivate async cleanScanStore(changes: MergeChanges): Promise<void> {\n\t\tawait scanCleanStore(this.store, this.images, this.waveforms, changes);\n\t\tconst meta = new MetaMerge(this.store, this.images);\n\t\tawait meta.sync(changes);\n\t\tlog.info('New Tracks', changes.newTracks.length);\n\t\tlog.info('New Folders', changes.newFolders.length);\n\t\tlog.info('Update Tracks', changes.updateTracks.length);\n\t\tlog.info('Update Folders', changes.updateFolders.length);\n\t\tlog.info('Remove Tracks', changes.removedTracks.length);\n\t\tlog.info('Remove Folders', changes.removedFolders.length);\n\t}\n\n\tasync rescanFolder(folder: JamServe.Folder): Promise<void> {\n\t\tif (this.scanning) {\n\t\t\treturn;\n\t\t}\n\t\tconst changes = this.startScanning();\n\t\tlog.info('Start Scanning Folder', folder.path);\n\t\tif (!folder.parentID || folder.parentID.length === 0) {\n\t\t\tawait this.scanDir(folder.path, undefined, 0, folder.rootID, changes);\n\t\t} else {\n\t\t\tconst parent = await this.store.folder.byId(folder.parentID);\n\t\t\tif (parent) {\n\t\t\t\tawait this.scanDir(folder.path, parent, parent.tag.level, folder.rootID, changes);\n\t\t\t}\n\t\t\t// TODO update all parent folder tags until root\n\t\t}\n\t\tawait this.stopScanning(changes);\n\t\tlog.info('Stop Scanning Folder', folder.path);\n\t}\n\n\tprivate async scanRoot(root: JamServe.Root, changes: MergeChanges): Promise<void> {\n\t\tlog.info('Scanning Root', root.path);\n\t\tthis.rootstatus[root.id] = {lastScan: Date.now(), scanning: true};\n\t\ttry {\n\t\t\tawait this.scanDir(root.path, undefined, 0, root.id, changes);\n\t\t\tthis.rootstatus[root.id] = {lastScan: Date.now()};\n\t\t} catch (e) {\n\t\t\tlog.error('Scanning Error', root.path, e.toString());\n\t\t\tif (['EACCES', 'ENOENT'].indexOf((<any>e).code) >= 0) {\n\t\t\t\tthis.rootstatus[root.id] = {lastScan: Date.now(), error: 'Directory not found/no access/error in filesystem'};\n\t\t\t} else {\n\t\t\t\tthis.rootstatus[root.id] = {lastScan: Date.now(), error: e.toString()};\n\t\t\t}\n\t\t}\n\t}\n\n\tasync rescanRoot(root: JamServe.Root): Promise<void> {\n\t\tif (this.scanning) {\n\t\t\treturn;\n\t\t}\n\t\tlog.info('Start Scanning Root', root.name);\n\t\tconst changes = this.startScanning();\n\t\tawait this.scanRoot(root, changes);\n\t\tlog.info('Stop Scanning Root', root.name);\n\t\tawait this.stopScanning(changes);\n\t}\n\n\tasync refresh(): Promise<void> {\n\t\tif (this.scanning) {\n\t\t\treturn;\n\t\t}\n\t\tlog.info('Start Scanning');\n\t\tconst changes = this.startScanning();\n\t\tconst roots = await this.store.root.all();\n\t\tfor (const root of roots) {\n\t\t\tawait this.scanRoot(root, changes);\n\t\t}\n\t\tlog.info('Stop Scanning');\n\t\tawait this.stopScanning(changes);\n\t}\n\n\tasync rescanTracks(tracks: Array<JamServe.Track>): Promise<void> {\n\t\t// TODO: rescan tracks only, not the whole thing\n\t\tawait this.refresh();\n\t}\n\n\tasync applyFolderMove(folder: JamServe.Folder, newPath: string): Promise<void> {\n\t\tconst folders = await this.store.folder.search({inPath: folder.path});\n\t\tfor (const f of folders) {\n\t\t\tf.path = f.path.replace(folder.path, newPath);\n\t\t\tawait this.store.folder.replace(f);\n\t\t}\n\t\tconst tracks = await this.store.track.search({inPath: folder.path});\n\t\tfor (const t of tracks) {\n\t\t\tt.path = t.path.replace(folder.path, newPath);\n\t\t\tawait this.store.track.replace(t);\n\t\t}\n\t\tconst root = await this.store.root.byId(folder.rootID);\n\t\tif (root) {\n\t\t\tawait this.rescanRoot(root);\n\t\t}\n\t}\n\n}\n","module.exports = require(\"winston\");","module.exports = require(\"winston-timer\");","import {FileTyp} from '../../types';\nimport path from 'path';\nimport fs from 'fs';\nimport {getFileType} from '../../utils/filetype';\nimport Logger from '../../utils/logger';\nimport {dirRead, fsStat} from '../../utils/fs-utils';\n\nconst log = Logger('IO.scan');\n\nexport interface ScanDir {\n\tname: string;\n\tstat: {\n\t\tctime: number,\n\t\tmtime: number,\n\t};\n\tdirectories: Array<ScanDir>;\n\tfiles: Array<ScanFile>;\n}\n\nexport interface ScanFile {\n\tname: string;\n\ttype: FileTyp;\n\tstat: {\n\t\tctime: number,\n\t\tmtime: number,\n\t\tsize: number\n\t};\n}\n\nasync function scanDirR(dir: string, stat: fs.Stats): Promise<ScanDir> {\n\tlog.debug('Scanning Directory', dir);\n\tconst result: ScanDir = {\n\t\tname: dir,\n\t\tstat: {\n\t\t\tctime: stat.ctime.valueOf(),\n\t\t\tmtime: stat.mtime.valueOf()\n\t\t},\n\t\tdirectories: [],\n\t\tfiles: []\n\t};\n\tconst folders: Array<{ dir: string, stat: fs.Stats }> = [];\n\tconst list = await dirRead(dir);\n\tfor (const filename of list) {\n\t\tif (filename[0] !== '.') {\n\t\t\tconst sub = path.join(dir, filename);\n\t\t\tconst substat = await fsStat(sub);\n\t\t\tif (substat.isDirectory()) {\n\t\t\t\tfolders.push({dir: sub, stat: substat});\n\t\t\t} else {\n\t\t\t\tconst file: ScanFile = {\n\t\t\t\t\tname: sub,\n\t\t\t\t\ttype: getFileType(sub),\n\t\t\t\t\tstat: {\n\t\t\t\t\t\tctime: substat.ctime.valueOf(),\n\t\t\t\t\t\tmtime: substat.mtime.valueOf(),\n\t\t\t\t\t\tsize: substat.size\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tresult.files.push(file);\n\t\t\t}\n\t\t}\n\t}\n\tfor (const folder of folders) {\n\t\tconst sub = await scanDirR(folder.dir, folder.stat);\n\t\tresult.directories.push(sub);\n\t}\n\treturn result;\n}\n\nexport async function scanDir(dir: string): Promise<ScanDir> {\n\tconst stat = await fsStat(dir);\n\treturn scanDirR(dir, stat);\n}\n","module.exports = require(\"mkdirp\");","import {Store} from '../../store/store';\nimport {ScanDir, ScanFile} from './scan';\nimport {JamServe} from '../../model/jamserve';\nimport path from 'path';\nimport Logger from '../../utils/logger';\n\nconst log = Logger('IO.match');\n\nexport interface MatchDir extends ScanDir {\n\tlevel: number;\n\trootID: string;\n\ttag?: JamServe.FolderTag;\n\tparent?: MatchDir;\n\tfolder?: JamServe.Folder;\n\tfiles: Array<MatchFile>;\n\tdirectories: Array<MatchDir>;\n\tremovedTracks: Array<JamServe.Track>;\n\tremovedFolders: Array<JamServe.Folder>;\n}\n\nexport interface MatchFile extends ScanFile {\n\ttrack?: JamServe.Track;\n}\n\nexport async function matchDir(dir: ScanDir, store: Store, rootID: string): Promise<MatchDir> {\n\tconst result: MatchDir = clone(dir, undefined, 0, rootID);\n\tresult.folder = await store.folder.searchOne({path: dir.name});\n\tawait matchDirR(result, store);\n\treturn result;\n}\n\nfunction clone(dir: ScanDir, parent: MatchDir | undefined, level: number, rootID: string): MatchDir {\n\tconst result: MatchDir = {\n\t\trootID,\n\t\tparent,\n\t\tlevel,\n\t\tname: dir.name,\n\t\tstat: dir.stat,\n\t\tfolder: undefined,\n\t\tfiles: dir.files.map(file => {\n\t\t\treturn {name: file.name, type: file.type, stat: file.stat};\n\t\t}),\n\t\tdirectories: [],\n\t\tremovedTracks: [],\n\t\tremovedFolders: []\n\t};\n\tresult.directories = dir.directories.map(sub => clone(sub, result, level + 1, rootID));\n\treturn result;\n}\n\nasync function matchDirR(dir: MatchDir, store: Store): Promise<void> {\n\tlog.debug('Matching Directory', dir.name);\n\tconst tracks = await store.track.search({path: dir.name});\n\ttracks.forEach(track => {\n\t\tconst filename = path.join(track.path, track.name);\n\t\tconst file = dir.files.find(f => f.name === filename);\n\t\tif (file) {\n\t\t\tfile.track = track;\n\t\t} else {\n\t\t\tdir.removedTracks.push(track);\n\t\t}\n\t});\n\tif (dir.folder) {\n\t\tconst folders = await store.folder.search({parentID: dir.folder.id});\n\t\tfor (const subFolder of folders) {\n\t\t\tconst subDir = dir.directories.find(sd => sd.name === subFolder.path);\n\t\t\tif (!subDir) {\n\t\t\t\tdir.removedFolders.push(subFolder);\n\t\t\t} else {\n\t\t\t\tsubDir.folder = subFolder;\n\t\t\t\tawait matchDirR(subDir, store);\n\t\t\t}\n\t\t}\n\t}\n}\n","import {Store} from '../../store/store';\nimport {JamServe} from '../../model/jamserve';\nimport {MatchDir, MatchFile} from './match';\nimport {DBObjectType, FileTyp, FolderType} from '../../types';\nimport path from 'path';\nimport {Audio} from '../../audio/audio';\nimport {deepCompare} from '../../utils/deep-compare';\nimport Logger from '../../utils/logger';\nimport {fillMatchTags} from './tag';\n\nconst log = Logger('IO.merge');\n\nexport interface MergeTrackInfo {\n\ttrack: JamServe.Track;\n\tdir: MatchDir;\n}\n\nexport interface MergeChanges {\n\tnewTracks: Array<MergeTrackInfo>;\n\tunchangedTracks: Array<MergeTrackInfo>;\n\tremovedTracks: Array<JamServe.Track>;\n\tupdateTracks: Array<MergeTrackInfo>;\n\tnewFolders: Array<JamServe.Folder>;\n\tunchangedFolders: Array<JamServe.Folder>;\n\tremovedFolders: Array<JamServe.Folder>;\n\tupdateFolders: Array<JamServe.Folder>;\n}\n\nexport class Merger {\n\tstore: Store;\n\taudio: Audio;\n\tscanningCount = 0;\n\trootID: string;\n\tonProgress: (count: number) => void;\n\n\tconstructor(rootID: string, store: Store, audio: Audio, onProgress: (count: number) => void) {\n\t\tthis.store = store;\n\t\tthis.audio = audio;\n\t\tthis.onProgress = onProgress;\n\t\tthis.rootID = rootID;\n\t}\n\n\tprivate static folderHasChanged(dir: MatchDir): boolean {\n\t\treturn (!dir.folder) ||\n\t\t\t(dir.stat.mtime !== dir.folder.stat.modified) ||\n\t\t\t(dir.stat.ctime !== dir.folder.stat.created) ||\n\t\t\t(!deepCompare(dir.folder.tag, dir.tag));\n\t}\n\n\tprivate static trackHasChanged(file: MatchFile): boolean {\n\t\treturn (!file.track) ||\n\t\t\t(file.stat.mtime !== file.track.stat.modified) ||\n\t\t\t(file.stat.ctime !== file.track.stat.created) ||\n\t\t\t(file.stat.size !== file.track.stat.size);\n\t}\n\n\tprivate async newFolder(dir: MatchDir): Promise<JamServe.Folder> {\n\t\tlog.info('New Folder', dir.name);\n\t\tconst folder: JamServe.Folder = {\n\t\t\tid: '',\n\t\t\trootID: dir.rootID,\n\t\t\tpath: dir.name,\n\t\t\tparentID: (dir.parent && dir.parent.folder ? dir.parent.folder.id : undefined),\n\t\t\tstat: {\n\t\t\t\tcreated: dir.stat.ctime,\n\t\t\t\tmodified: dir.stat.mtime\n\t\t\t},\n\t\t\ttag: dir.tag || {tracks: 0, level: -1, type: FolderType.unknown},\n\t\t\ttype: DBObjectType.folder\n\t\t};\n\t\tfolder.id = await this.store.folder.add(folder);\n\t\tdir.folder = folder;\n\t\treturn folder;\n\t}\n\n\tprivate async updateFolder(dir: MatchDir): Promise<JamServe.Folder | undefined> {\n\t\tconst old = dir.folder;\n\t\tif (!old) {\n\t\t\treturn;\n\t\t}\n\t\tlog.info('Update Folder', dir.name);\n\t\tconst folder: JamServe.Folder = {\n\t\t\tid: old.id,\n\t\t\trootID: dir.rootID,\n\t\t\tpath: dir.name,\n\t\t\tparentID: (dir.parent && dir.parent.folder ? dir.parent.folder.id : undefined),\n\t\t\tstat: {\n\t\t\t\tcreated: dir.stat.ctime,\n\t\t\t\tmodified: dir.stat.mtime\n\t\t\t},\n\t\t\ttag: dir.tag || {tracks: 0, level: dir.level, type: FolderType.unknown},\n\t\t\ttype: DBObjectType.folder,\n\t\t\tinfo: old.info\n\t\t};\n\t\tawait this.store.folder.replace(folder);\n\t\treturn folder;\n\t}\n\n\tprivate async buildTrack(file: MatchFile, parent: JamServe.Folder): Promise<JamServe.Track> {\n\t\tthis.scanningCount++;\n\t\tthis.onProgress(this.scanningCount);\n\t\tconst data = await this.audio.read(file.name);\n\t\treturn {\n\t\t\tid: '',\n\t\t\trootID: this.rootID,\n\t\t\talbumID: '',\n\t\t\tartistID: '',\n\t\t\tparentID: (parent ? parent.id : ''),\n\t\t\tname: path.basename(file.name),\n\t\t\tpath: path.dirname(file.name),\n\t\t\tstat: {\n\t\t\t\tcreated: file.stat.ctime,\n\t\t\t\tmodified: file.stat.mtime,\n\t\t\t\tsize: file.stat.size\n\t\t\t},\n\t\t\tmedia: data.media || {},\n\t\t\ttag: data.tag || {},\n\t\t\ttype: DBObjectType.track\n\t\t};\n\t}\n\n\tprivate async newTrack(file: MatchFile, parent: JamServe.Folder): Promise<JamServe.Track> {\n\t\tlog.info('New Track', file.name);\n\t\tconst track = await this.buildTrack(file, parent);\n\t\ttrack.id = await this.store.track.add(track);\n\t\treturn track;\n\t}\n\n\tprivate async updateTrack(file: MatchFile, parent: JamServe.Folder): Promise<JamServe.Track | undefined> {\n\t\tlog.info('Update Track', file.name);\n\t\tconst old = file.track;\n\t\tif (!old) {\n\t\t\treturn;\n\t\t}\n\t\tconst track = await this.buildTrack(file, parent);\n\t\ttrack.id = old.id;\n\t\ttrack.info = old.info;\n\t\tawait this.store.track.replace(track);\n\t\treturn track;\n\t}\n\n\tprivate async compareFile(file: MatchFile, dir: MatchDir, changes: MergeChanges, parent: JamServe.Folder | undefined): Promise<void> {\n\t\tif (file.type !== FileTyp.AUDIO || !parent) {\n\t\t\treturn;\n\t\t}\n\t\tif (!file.track) {\n\t\t\tconst track = await this.newTrack(file, parent);\n\t\t\tfile.track = track;\n\t\t\tchanges.newTracks.push({track, dir});\n\t\t} else if (Merger.trackHasChanged(file)) {\n\t\t\tconst track = await this.updateTrack(file, parent);\n\t\t\tif (track) {\n\t\t\t\tfile.track = track;\n\t\t\t\tchanges.updateTracks.push({track, dir});\n\t\t\t}\n\t\t} else {\n\t\t\tchanges.unchangedTracks.push({track: file.track, dir});\n\t\t}\n\t}\n\n\tprivate async compareSubs(dir: MatchDir, changes: MergeChanges): Promise<void> {\n\t\tfor (const sub of dir.directories) {\n\t\t\tawait this.compareFilesR(sub, changes);\n\t\t}\n\t\tfor (const file of dir.files) {\n\t\t\tawait this.compareFile(file, dir, changes, dir.folder);\n\t\t}\n\t}\n\n\tprivate async compareFilesR(dir: MatchDir, changes: MergeChanges): Promise<void> {\n\t\tlog.debug('Compare Directory', dir.name);\n\t\tdir.removedFolders.forEach(folder => {\n\t\t\tchanges.removedFolders.push(folder);\n\t\t});\n\t\tdir.removedTracks.forEach(track => {\n\t\t\tchanges.removedTracks.push(track);\n\t\t});\n\t\tif (!dir.folder) {\n\t\t\tconst folder = await this.newFolder(dir);\n\t\t\tchanges.newFolders.push(folder);\n\t\t}\n\t\tawait this.compareSubs(dir, changes);\n\t}\n\n\tprivate async compareFoldersR(dir: MatchDir, changes: MergeChanges): Promise<void> {\n\t\tif (dir.folder) {\n\t\t\tif (Merger.folderHasChanged(dir)) {\n\t\t\t\tconst data = await this.updateFolder(dir);\n\t\t\t\tif (data) {\n\t\t\t\t\tchanges.updateFolders.push(data);\n\t\t\t\t\tdir.folder = data;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tchanges.unchangedFolders.push(dir.folder);\n\t\t\t}\n\t\t\tfor (const d of dir.directories) {\n\t\t\t\tawait this.compareFoldersR(d, changes);\n\t\t\t}\n\t\t} else {\n\t\t\treturn Promise.reject(Error('db entry must exists to compare ' + dir.name));\n\t\t}\n\t}\n\n\tasync merge(dir: MatchDir, changes: MergeChanges): Promise<void> {\n\t\tawait this.compareFilesR(dir, changes);\n\t\tfillMatchTags(dir);\n\t\tawait this.compareFoldersR(dir, changes);\n\t}\n}\n","export function deepCompare(a: any, b: any, ignore?: Array<string>): boolean {\n\tconst ignoreList: Array<string> = ignore || [];\n\tconst compare = (oa: any, ob: any) => {\n\t\tif (a === undefined) {\n\t\t\treturn false;\n\t\t}\n\t\tif (b === undefined) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof oa === 'object') {\n\t\t\tif (!deepCompare(oa, ob, ignore)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if (oa !== ob) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t};\n\tif (a === undefined) {\n\t\treturn false;\n\t}\n\tif (b === undefined) {\n\t\treturn false;\n\t}\n\tlet key;\n\tfor (key in a) {\n\t\tif (a.hasOwnProperty(key) && ignoreList.indexOf(key) < 0) {\n\t\t\tif (!compare(a[key], b[key])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\tfor (key in b) {\n\t\tif (b.hasOwnProperty(key) && ignoreList.indexOf(key) < 0) {\n\t\t\tif (!compare(a[key], b[key])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn true;\n}\n","import {JamServe} from '../../model/jamserve';\nimport {AlbumType, DBObjectType} from '../../types';\nimport {Store} from '../../store/store';\nimport Logger from '../../utils/logger';\nimport {MergeChanges, MergeTrackInfo} from './merge';\nimport {clearID3} from './clean';\nimport {cUnknownAlbum, cUnknownArtist} from './tag';\nimport {Images} from './images';\n\nconst log = Logger('IO.meta');\n\nexport class MetaMerge {\n\tprivate readonly store: Store;\n\tprivate readonly images: Images;\n\n\tconstructor(store: Store, images: Images) {\n\t\tthis.store = store;\n\t\tthis.images = images;\n\t}\n\n\tprivate static getArtistMBArtistID(trackInfo: MergeTrackInfo): string | undefined {\n\t\tif (trackInfo.dir.folder && trackInfo.dir.folder.tag.albumType === AlbumType.mix) {\n\t\t\treturn;\n\t\t} else {\n\t\t\treturn trackInfo.track.tag.mbAlbumArtistID || trackInfo.track.tag.mbArtistID;\n\t\t}\n\t}\n\n\tprivate static getArtistNameSort(trackInfo: MergeTrackInfo): string | undefined {\n\t\tif (trackInfo.dir.folder && trackInfo.dir.folder.tag.albumType === AlbumType.mix) {\n\t\t\treturn;\n\t\t} else {\n\t\t\treturn trackInfo.track.tag.artistSort;\n\t\t}\n\t}\n\n\tprivate static getArtistName(trackInfo: MergeTrackInfo): string {\n\t\tif (trackInfo.dir.folder && trackInfo.dir.folder.tag.albumType === AlbumType.mix) {\n\t\t\treturn trackInfo.dir.folder.tag.artist || cUnknownArtist;\n\t\t} else {\n\t\t\treturn trackInfo.track.tag.albumArtist || trackInfo.track.tag.artist || cUnknownArtist;\n\t\t}\n\t}\n\n\tprivate static getAlbumName(trackInfo: MergeTrackInfo): string {\n\t\tif (trackInfo.dir.folder && trackInfo.dir.folder.tag.albumType === AlbumType.mix) {\n\t\t\treturn trackInfo.dir.folder.tag.album || cUnknownAlbum;\n\t\t} else {\n\t\t\treturn trackInfo.track.tag.album || cUnknownAlbum;\n\t\t}\n\t}\n\n\tprivate async findArtist(trackInfo: MergeTrackInfo): Promise<JamServe.Artist | undefined> {\n\t\tconst name = MetaMerge.getArtistName(trackInfo);\n\t\tconst mbArtistID = trackInfo.track.tag.mbAlbumArtistID || trackInfo.track.tag.mbArtistID;\n\t\tif (mbArtistID) {\n\t\t\tconst artist = await this.store.artist.searchOne({mbArtistID});\n\t\t\tif (artist) {\n\t\t\t\treturn artist;\n\t\t\t}\n\t\t}\n\t\treturn this.store.artist.searchOne({name});\n\t}\n\n\tprivate async addArtist(trackInfo: MergeTrackInfo): Promise<string> {\n\t\tconst name = MetaMerge.getArtistName(trackInfo);\n\t\tconst artist = await this.findArtist(trackInfo);\n\t\tif (artist) {\n\t\t\tartist.trackIDs.push(trackInfo.track.id);\n\t\t\tif (artist.rootIDs.indexOf(trackInfo.track.rootID) < 0) {\n\t\t\t\tartist.rootIDs.push(trackInfo.track.rootID);\n\t\t\t}\n\t\t\tawait this.store.artist.replace(artist);\n\t\t\treturn artist.id;\n\t\t} else {\n\t\t\tconst a: JamServe.Artist = {\n\t\t\t\tid: '',\n\t\t\t\ttype: DBObjectType.artist,\n\t\t\t\trootIDs: [trackInfo.track.rootID],\n\t\t\t\tname: name,\n\t\t\t\tnameSort: MetaMerge.getArtistNameSort(trackInfo),\n\t\t\t\talbumIDs: [],\n\t\t\t\tmbArtistID: MetaMerge.getArtistMBArtistID(trackInfo),\n\t\t\t\ttrackIDs: [trackInfo.track.id],\n\t\t\t\tcreated: Date.now()\n\t\t\t};\n\t\t\tlog.debug('Add Artist', a.name);\n\t\t\ta.id = await this.store.artist.add(a);\n\t\t\treturn a.id;\n\t\t}\n\t}\n\n\tprivate async removeID3Artist(track: JamServe.Track): Promise<void> {\n\t\tconst artist = await this.store.artist.searchOne({trackID: track.id});\n\t\tif (artist) {\n\t\t\tartist.trackIDs = artist.trackIDs.filter(id => id !== track.id);\n\t\t\tif (artist.trackIDs.length === 0) {\n\t\t\t\tawait this.store.artist.remove(artist.id);\n\t\t\t\tawait this.store.state.removeByQuery({destID: artist.id, type: DBObjectType.artist});\n\t\t\t} else {\n\t\t\t\tawait this.store.artist.replace(artist);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async syncID3Artist(trackInfo: MergeTrackInfo): Promise<string> {\n\t\tconst artist = await this.findArtist(trackInfo);\n\t\tif (artist && (artist.trackIDs.indexOf(trackInfo.track.id) >= 0)) {\n\t\t\t// TODO: upsert artist name changes with same mbArtistID\n\t\t\treturn artist.id;\n\t\t}\n\t\tawait this.removeID3Artist(trackInfo.track);\n\t\treturn this.addArtist(trackInfo);\n\t}\n\n\tprivate async findAlbum(trackInfo: MergeTrackInfo, artistID: string): Promise<JamServe.Album | undefined> {\n\t\tconst name = MetaMerge.getAlbumName(trackInfo);\n\t\tif (trackInfo.track.tag.mbAlbumID) {\n\t\t\tconst album = await this.store.album.searchOne({mbAlbumID: trackInfo.track.tag.mbAlbumID});\n\t\t\tif (album) {\n\t\t\t\treturn album;\n\t\t\t}\n\t\t}\n\t\treturn this.store.album.searchOne({name, artistID});\n\t}\n\n\tprivate async addID3Album(trackInfo: MergeTrackInfo, artistID: string): Promise<string> {\n\t\tconst name = MetaMerge.getAlbumName(trackInfo);\n\t\tconst album = await this.findAlbum(trackInfo, artistID);\n\t\tif (album) {\n\t\t\talbum.trackIDs.push(trackInfo.track.id);\n\t\t\tif (album.rootIDs.indexOf(trackInfo.track.rootID) < 0) {\n\t\t\t\talbum.rootIDs.push(trackInfo.track.rootID);\n\t\t\t}\n\t\t\talbum.duration += (trackInfo.track.media.duration || 0);\n\t\t\tawait this.store.album.replace(album);\n\t\t\treturn album.id;\n\t\t} else {\n\t\t\tconst a: JamServe.Album = {\n\t\t\t\tid: '',\n\t\t\t\ttype: DBObjectType.album,\n\t\t\t\tname: name,\n\t\t\t\tartist: MetaMerge.getArtistName(trackInfo),\n\t\t\t\tartistID: artistID,\n\t\t\t\tmbArtistID: MetaMerge.getArtistMBArtistID(trackInfo),\n\t\t\t\tmbAlbumID: trackInfo.track.tag.mbAlbumID,\n\t\t\t\tgenre: trackInfo.track.tag.genre,\n\t\t\t\ttrackIDs: [trackInfo.track.id],\n\t\t\t\trootIDs: [trackInfo.track.rootID],\n\t\t\t\tyear: trackInfo.track.tag.year,\n\t\t\t\tduration: trackInfo.track.media.duration || 0,\n\t\t\t\tcreated: Date.now()\n\t\t\t};\n\t\t\tlog.debug('Add Album', a.name);\n\t\t\ta.id = await this.store.album.add(a);\n\t\t\tconst artist = await this.store.artist.byId(artistID);\n\t\t\tif (artist) {\n\t\t\t\tartist.albumIDs.push(a.id);\n\t\t\t\tawait this.store.artist.replace(artist);\n\t\t\t}\n\t\t\treturn a.id;\n\t\t}\n\t}\n\n\tprivate async removeID3Album(track: JamServe.Track): Promise<void> {\n\t\tconst album = await this.store.album.searchOne({trackID: track.id});\n\t\tif (album) {\n\t\t\talbum.trackIDs = album.trackIDs.filter(id => id !== track.id);\n\t\t\talbum.duration -= (track.media.duration || 0);\n\t\t\tif (album.trackIDs.length === 0) {\n\t\t\t\tconst artist = await this.store.artist.byId(album.artistID);\n\t\t\t\tif (artist) {\n\t\t\t\t\tartist.albumIDs = artist.albumIDs.filter(id => id !== album.id);\n\t\t\t\t\tawait this.store.artist.replace(artist);\n\t\t\t\t\tawait this.store.album.remove(album.id);\n\t\t\t\t\tawait this.store.state.removeByQuery({destID: album.id, type: DBObjectType.album});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tawait this.store.album.replace(album);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async syncAlbum(trackInfo: MergeTrackInfo, artistID: string): Promise<void> {\n\t\tconst album = await this.findAlbum(trackInfo, artistID);\n\t\tif (album && (album.trackIDs.indexOf(trackInfo.track.id) >= 0)) {\n\t\t\t// TODO: upsert artist name changes with same mbArtistID\n\t\t\treturn;\n\t\t}\n\t\tawait this.removeID3Album(trackInfo.track);\n\t\tawait this.addID3Album(trackInfo, artistID);\n\t}\n\n\tprivate async addID3s(trackInfos: Array<MergeTrackInfo>): Promise<void> {\n\t\tconst artistSearchesName: { [name: string]: Array<MergeTrackInfo> } = {};\n\t\tconst artistTracks: { [id: string]: { artist: JamServe.Artist, tracks: Array<MergeTrackInfo>, hasChanged: boolean } } = {};\n\t\t// collect artists searches\n\t\ttrackInfos.forEach(trackInfo => {\n\t\t\tconst name = MetaMerge.getArtistName(trackInfo);\n\t\t\tif (name && name.length > 0) {\n\t\t\t\tartistSearchesName[name] = artistSearchesName[name] || [];\n\t\t\t\tartistSearchesName[name].push(trackInfo);\n\t\t\t}\n\t\t});\n\t\t// search artists\n\t\tfor (const name of Object.keys(artistSearchesName)) {\n\t\t\tconst artist = await this.store.artist.searchOne({name});\n\t\t\tconst idtracks = artistSearchesName[name];\n\t\t\tif (artist) {\n\t\t\t\tidtracks.forEach(t => {\n\t\t\t\t\tt.track.artistID = artist.id;\n\t\t\t\t});\n\t\t\t\tartistTracks[artist.id] = (artistTracks[artist.id] || {artist, tracks: [], hasChanged: true});\n\t\t\t\tartistTracks[artist.id].tracks = artistTracks[artist.id].tracks.concat(idtracks);\n\t\t\t\tartistTracks[artist.id].hasChanged = true;\n\t\t\t\tartist.trackIDs = artist.trackIDs.concat(idtracks.map(t => t.track.id));\n\t\t\t\tidtracks.forEach(t => {\n\t\t\t\t\tif (artist.rootIDs.indexOf(t.track.rootID) < 0) {\n\t\t\t\t\t\tartist.rootIDs.push(t.track.rootID);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// gets saved later\n\t\t\t} else {\n\t\t\t\tconst a: JamServe.Artist = {\n\t\t\t\t\tid: '',\n\t\t\t\t\ttype: DBObjectType.artist,\n\t\t\t\t\tname: MetaMerge.getArtistName(idtracks[0]),\n\t\t\t\t\tnameSort: MetaMerge.getArtistNameSort(idtracks[0]),\n\t\t\t\t\trootIDs: [],\n\t\t\t\t\talbumIDs: [],\n\t\t\t\t\tmbArtistID: MetaMerge.getArtistMBArtistID(idtracks[0]),\n\t\t\t\t\ttrackIDs: idtracks.map(t => t.track.id),\n\t\t\t\t\tcreated: Date.now()\n\t\t\t\t};\n\t\t\t\tidtracks.forEach(t => {\n\t\t\t\t\tif (a.rootIDs.indexOf(t.track.rootID) < 0) {\n\t\t\t\t\t\ta.rootIDs.push(t.track.rootID);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlog.debug('Add Artist', a.name);\n\t\t\t\ta.id = await this.store.artist.add(a);\n\t\t\t\tartistTracks[a.id] = {artist: a, tracks: idtracks, hasChanged: false};\n\t\t\t\tidtracks.forEach(t => {\n\t\t\t\t\tt.track.artistID = a.id;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// search albums\n\t\tfor (const artistID of  Object.keys(artistTracks)) {\n\t\t\tconst artistidtracks = artistTracks[artistID];\n\t\t\tconst albumtracks: { [name: string]: Array<MergeTrackInfo> } = {};\n\t\t\tartistidtracks.tracks.forEach(trackInfo => {\n\t\t\t\tconst name = MetaMerge.getAlbumName(trackInfo);\n\t\t\t\talbumtracks[name] = albumtracks[name] || [];\n\t\t\t\talbumtracks[name].push(trackInfo);\n\t\t\t});\n\t\t\tfor (const name of Object.keys(albumtracks)) {\n\t\t\t\tconst atracks = albumtracks[name];\n\t\t\t\tconst album = await this.store.album.searchOne({name, artistID});\n\t\t\t\tif (album) {\n\t\t\t\t\talbum.trackIDs = album.trackIDs.concat(atracks.map(t => t.track.id));\n\t\t\t\t\tatracks.forEach(t => {\n\t\t\t\t\t\tt.track.albumID = album.id;\n\t\t\t\t\t\talbum.duration += (t && t.track && t.track.media && t.track.media.duration ? t.track.media.duration : 0);\n\t\t\t\t\t\tif (album.rootIDs.indexOf(t.track.rootID) < 0) {\n\t\t\t\t\t\t\talbum.rootIDs.push(t.track.rootID);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tlog.debug('Update Album', album.name);\n\t\t\t\t\tartistidtracks.artist.albumIDs.push(album.id);\n\t\t\t\t\tartistidtracks.hasChanged = true;\n\t\t\t\t\tartistidtracks.tracks.forEach(t => {\n\t\t\t\t\t\tt.track.albumID = album.id;\n\t\t\t\t\t\tif (album.rootIDs.indexOf(t.track.rootID) < 0) {\n\t\t\t\t\t\t\talbum.rootIDs.push(t.track.rootID);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tawait this.store.album.replace(album);\n\t\t\t\t} else {\n\t\t\t\t\tconst a: JamServe.Album = {\n\t\t\t\t\t\tid: '',\n\t\t\t\t\t\ttype: DBObjectType.album,\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\trootIDs: [],\n\t\t\t\t\t\tartist: MetaMerge.getArtistName(atracks[0]),\n\t\t\t\t\t\tartistID: artistID,\n\t\t\t\t\t\tmbArtistID: MetaMerge.getArtistMBArtistID(atracks[0]),\n\t\t\t\t\t\tmbAlbumID: atracks[0].track.tag.mbAlbumID,\n\t\t\t\t\t\tgenre: atracks[0].track.tag.genre,\n\t\t\t\t\t\ttrackIDs: atracks.map(t => t.track.id),\n\t\t\t\t\t\tyear: atracks[0].track.tag.year,\n\t\t\t\t\t\tduration: atracks.reduce((b, c) => (b + (c && c.track && c.track.media && c.track.media.duration ? c.track.media.duration : 0)), 0),\n\t\t\t\t\t\tcreated: Date.now()\n\t\t\t\t\t};\n\t\t\t\t\tatracks.forEach(t => {\n\t\t\t\t\t\tif (a.rootIDs.indexOf(t.track.rootID) < 0) {\n\t\t\t\t\t\t\ta.rootIDs.push(t.track.rootID);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tlog.debug('Add Album', a.name);\n\t\t\t\t\ta.id = await this.store.album.add(a);\n\t\t\t\t\tartistidtracks.artist.albumIDs.push(a.id);\n\t\t\t\t\tartistidtracks.tracks.forEach(t => {\n\t\t\t\t\t\tt.track.albumID = a.id;\n\t\t\t\t\t});\n\t\t\t\t\tartistidtracks.hasChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// save artists\n\t\tfor (const artistID of Object.keys(artistTracks)) {\n\t\t\tconst artistidtracks = artistTracks[artistID];\n\t\t\tif (artistidtracks.hasChanged) {\n\t\t\t\tlog.debug('Update Artist', artistidtracks.artist.name);\n\t\t\t\tawait this.store.artist.replace(artistidtracks.artist);\n\t\t\t}\n\t\t}\n\t\t// save tracks\n\t\tfor (const trackInfo of trackInfos) {\n\t\t\tif (trackInfo.track.albumID || trackInfo.track.artistID) {\n\t\t\t\tlog.debug('Update Track', trackInfo.track.name);\n\t\t\t\tawait this.store.track.replace(trackInfo.track);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async syncID3(trackInfo: MergeTrackInfo): Promise<void> {\n\t\tconst id = await this.syncID3Artist(trackInfo);\n\t\tawait this.syncAlbum(trackInfo, id);\n\t}\n\n\tasync sync(changes: MergeChanges): Promise<void> {\n\t\t// new tracks && leftovers from last unfinished scan\n\t\tconst trackInfos = changes.newTracks.concat(changes.unchangedTracks.filter(t => (!t.track.albumID && !t.track.artistID)));\n\t\tawait this.addID3s(trackInfos);\n\t\tfor (const trackInfo of changes.updateTracks) {\n\t\t\tawait this.syncID3(trackInfo);\n\t\t}\n\t\tawait clearID3(this.store, this.images, changes.removedTracks);\n\t}\n}\n","import {JamServe} from '../../model/jamserve';\nimport elasticsearch from 'elasticsearch';\nimport {DBObjectType} from '../../types';\nimport {ESSequence} from './es-sequence';\nimport Logger from '../../utils/logger';\nimport {mapping} from './mapping';\nimport {Config} from '../../config';\nimport {wait} from '../../utils/wait';\n\nconst log = Logger('DB.elastic');\n\nexport class DBElastic implements JamServe.Database {\n\tclient: elasticsearch.Client;\n\tsequence: ESSequence;\n\tindexPrefix: string;\n\tindexRefresh: string | undefined;\n\n\tconstructor(config: Config) {\n\t\tthis.client = new elasticsearch.Client({host: config.database.options.elasticsearch.host, log: config.database.options.elasticsearch.log});\n\t\tthis.sequence = new ESSequence(this.client);\n\t\tthis.indexPrefix = config.database.options.elasticsearch.indexPrefix;\n\t\tthis.indexRefresh = config.database.options.elasticsearch.indexRefresh;\n\t}\n\n\tasync close(): Promise<void> {\n\t\tthis.client.close();\n\t}\n\n\tasync ping(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.client.ping(<elasticsearch.PingParams>{requestTimeout: 10000});\n\t\t} catch (e) {\n\t\t\tlog.error('elasticsearch could not be contacted', e);\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n\n\tasync open(): Promise<void> {\n\t\tlog.info('Open connection to elasticsearch');\n\t\tawait this.sequence.init(this.client);\n\t\tawait this.ping();\n\t\tawait this.check();\n\t}\n\n\tasync getNewId(): Promise<string> {\n\t\tconst id: number = await this.sequence.get(this.indexName('id'));\n\t\treturn id.toString();\n\t}\n\n\tindexName(name: string): string {\n\t\treturn this.indexPrefix + '_' + name;\n\t}\n\n\tprivate getTypes(): Array<DBObjectType> {\n\t\treturn Object.keys(DBObjectType)\n\t\t\t.filter(key => !isNaN(Number(key)))\n\t\t\t.map(key => parseInt(key, 10));\n\t}\n\n\tprivate async resetIndex(type: DBObjectType): Promise<void> {\n\t\tconst index = this.indexName(DBObjectType[type]);\n\t\tconst exists = await this.client.indices.exists({index});\n\t\tif (exists) {\n\t\t\tawait this.client.indices.delete({index});\n\t\t}\n\t}\n\n\tasync reset(): Promise<void> {\n\t\tfor (const type of this.getTypes()) {\n\t\t\tawait this.resetIndex(type);\n\t\t}\n\t}\n\n\tprivate async createIndex(type: DBObjectType): Promise<void> {\n\t\tconst name = DBObjectType[type];\n\t\tif (!mapping[name]) {\n\t\t\treturn Promise.reject(Promise.reject('Missing Elasticsearch Mapping for type ' + name));\n\t\t}\n\t\tconst index = this.indexName(name);\n\t\tconst m: any = {};\n\t\tm['_default_'] = {'_default_': {'date_detection': false}};\n\t\tm[name] = mapping[name];\n\t\tawait this.client.indices.create({index, body: {'mappings': m}});\n\t}\n\n\tprivate async checkIndex(type: DBObjectType): Promise<boolean> {\n\t\tconst name = DBObjectType[type];\n\t\tconst index = this.indexName(name);\n\t\tconst exists = await this.client.indices.exists({index});\n\t\tif (!exists) {\n\t\t\tawait this.createIndex(type);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync check(): Promise<void> {\n\t\tlet waitAfter = false;\n\t\tfor (const type of this.getTypes()) {\n\t\t\twaitAfter = await this.checkIndex(type) || waitAfter;\n\t\t}\n\t\tif (waitAfter) {\n\t\t\tawait wait(1000);\n\t\t}\n\t}\n\n\tpublic getDBIndex<T extends JamServe.DBObject>(type: DBObjectType) {\n\t\treturn new DBIndexElastic<T>(type, this);\n\t}\n}\n\nexport class DBIndexElastic<T extends JamServe.DBObject> implements JamServe.DatabaseIndex<T> {\n\tprotected _index: string;\n\tprotected _type: string;\n\tpublic type: DBObjectType;\n\tpublic db: DBElastic;\n\n\tconstructor(type: DBObjectType, db: DBElastic) {\n\t\tthis.type = type;\n\t\tif (type === undefined) {\n\t\t\tthis._index = db.indexName('*'); // 'all';\n\t\t\tthis._type = '';\n\t\t} else {\n\t\t\tthis._type = DBObjectType[type];\n\t\t\tthis._index = db.indexName(DBObjectType[type]);\n\t\t}\n\t\tthis.db = db;\n\t}\n\n\tprivate hit2Obj(hit: any): T {\n\t\thit._source.id = hit._source.id.toString();\n\t\thit._source.type = DBObjectType[hit._type];\n\t\treturn <T>hit._source;\n\t}\n\n\tprivate filterProperties(o: T): any {\n\t\tconst result: any = Object.assign({}, o);\n\t\tresult.type = undefined;\n\t\treturn result;\n\t}\n\n\tprivate translateElasticQuery(query: JamServe.DatabaseQuery) {\n\t\tif (query.all) {\n\t\t\treturn {match_all: {}};\n\t\t}\n\t\tlet must: Array<any> = [];\n\t\tif (query.term) {\n\t\t\tconst o = query.term;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = o[key];\n\t\t\t\t\treturn {'term': term};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.match) {\n\t\t\tconst o = query.match;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = o[key];\n\t\t\t\t\treturn {'match': term};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.terms) {\n\t\t\tconst o = query.terms;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = o[key];\n\t\t\t\t\treturn {'terms': term};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.startsWith) {\n\t\t\tconst o = query.startsWith;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = {'query': o[key], 'max_expansions': 50000};\n\t\t\t\t\treturn {'match_phrase_prefix': term};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.startsWiths) {\n\t\t\tconst o = query.startsWiths;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = {'query': o[key], 'max_expansions': 50000};\n\t\t\t\t\treturn {'match_phrase_prefix': term};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.range) {\n\t\t\tconst o = query.range;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst vals = o[key];\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = {'gte': vals.gte, 'lte': vals.lte};\n\t\t\t\t\treturn {'range': term};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.notNull) {\n\t\t\tconst o = query.notNull;\n\t\t\tmust = must.concat(o.map(key => {\n\t\t\t\treturn {'exists': {'field': key}};\n\t\t\t}));\n\t\t}\n\t\treturn {\n\t\t\tbool: {\n\t\t\t\tmust: must\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate async scroll(response: elasticsearch.SearchResponse<T>, onHits: (hits: Array<any>) => Promise<void>): Promise<void> {\n\t\tlet count = 0;\n\t\tconst client = this.db.client;\n\n\t\tasync function getMoreUntilDone(res: elasticsearch.SearchResponse<T>) {\n\t\t\tcount += res.hits.hits.length;\n\t\t\tawait onHits(res.hits.hits);\n\t\t\tif (res.hits.total !== count && res._scroll_id) {\n\t\t\t\t// now we can call scroll over and over\n\t\t\t\tconst next = await client.scroll<T>({scrollId: res._scroll_id, scroll: '30s'});\n\t\t\t\tawait getMoreUntilDone(next);\n\t\t\t}\n\t\t}\n\n\t\tawait getMoreUntilDone(response);\n\t}\n\n\tasync add(body: T): Promise<string> {\n\t\tconst id = await this.db.getNewId();\n\t\tbody.id = id;\n\t\tawait this.db.client.index({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: this.filterProperties(body),\n\t\t\tid,\n\t\t\trefresh: <elasticsearch.Refresh>this.db.indexRefresh\n\t\t});\n\t\treturn id;\n\t}\n\n\tasync replace(id: string, body: T): Promise<void> {\n\t\tawait this.db.client.index({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: this.filterProperties(body),\n\t\t\tid,\n\t\t\trefresh: <elasticsearch.Refresh>this.db.indexRefresh\n\t\t});\n\t}\n\n\tasync upsert(id: string, body: T): Promise<void> {\n\t\tif (!id || id.length === 0) {\n\t\t\tawait this.add(body);\n\t\t\treturn;\n\t\t}\n\t\tawait this.db.client.index({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: this.filterProperties(body),\n\t\t\tid,\n\t\t\trefresh: <elasticsearch.Refresh>this.db.indexRefresh\n\t\t});\n\t}\n\n\tasync removeByQuery(query: JamServe.DatabaseQuery): Promise<number> {\n\t\tconst response = await this.db.client.deleteByQuery({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query)\n\t\t\t},\n\t\t\trefresh: <elasticsearch.Refresh>this.db.indexRefresh\n\t\t});\n\t\treturn response.deleted;\n\t}\n\n\tasync remove(id: string | Array<string>): Promise<void> {\n\t\tif (id.length === 0) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tif (Array.isArray(id)) {\n\t\t\tawait this.db.client.deleteByQuery({\n\t\t\t\tindex: this._index,\n\t\t\t\ttype: this._type,\n\t\t\t\tbody: {\n\t\t\t\t\tquery: {\n\t\t\t\t\t\t'terms': {\n\t\t\t\t\t\t\t'_id': id\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trefresh: <elasticsearch.Refresh>this.db.indexRefresh\n\t\t\t});\n\t\t} else {\n\t\t\tawait this.db.client.delete({\n\t\t\t\tindex: this._index,\n\t\t\t\ttype: this._type,\n\t\t\t\tid: <string>id,\n\t\t\t\trefresh: <elasticsearch.Refresh>this.db.indexRefresh\n\t\t\t});\n\t\t}\n\t}\n\n\tasync byId(id: string): Promise<T | undefined> {\n\t\tif (this.type === undefined) {\n\t\t\treturn await this.queryOne({term: {id: id}});\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tconst response = await this.db.client.get({\n\t\t\t\t\tindex: this._index,\n\t\t\t\t\ttype: this._type,\n\t\t\t\t\tid: id\n\t\t\t\t});\n\t\t\t\tif (!response.found) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\treturn this.hit2Obj(response);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tif (e.statusCode !== 404) {\n\t\t\t\t\tPromise.reject(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync byIds(ids: Array<string>): Promise<Array<T>> {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconst response = await this.db.client.mget({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: {'ids': ids}\n\t\t});\n\t\tif (!response.docs) {\n\t\t\treturn [];\n\t\t}\n\t\treturn response.docs.filter((doc) => {\n\t\t\treturn doc.found;\n\t\t}).map((doc) => {\n\t\t\treturn this.hit2Obj(doc);\n\t\t});\n\t}\n\n\tasync query(query: JamServe.DatabaseQuery): Promise<Array<T>> {\n\t\tlet list: Array<T> = [];\n\t\tconst response = await this.db.client.search<T>({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tscroll: '30s',\n\t\t\tsize: 100,\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query)\n\t\t\t}\n\t\t});\n\t\tawait this.scroll(response, async (hits) => {\n\t\t\tlist = list.concat(hits.map(this.hit2Obj));\n\t\t});\n\t\treturn list;\n\t}\n\n\tasync queryOne(query: JamServe.DatabaseQuery): Promise<T | undefined> {\n\t\tconst response = await this.db.client.search({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query)\n\t\t\t}\n\t\t});\n\t\tif (response.hits.total > 0) {\n\t\t\treturn this.hit2Obj(response.hits.hits[0]);\n\t\t}\n\t\treturn;\n\t}\n\n\tasync iterate(query: JamServe.DatabaseQuery, onItem: (items: Array<T>) => Promise<void>): Promise<void> {\n\t\tconst response = await this.db.client.search<T>({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tscroll: '30s',\n\t\t\tsize: 100,\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query)\n\t\t\t}\n\t\t});\n\t\tawait this.scroll(response, async (hits) => {\n\t\t\tawait onItem(hits.map(this.hit2Obj));\n\t\t});\n\t}\n\n\tasync queryIds(query: JamServe.DatabaseQuery): Promise<Array<string>> {\n\t\tlet list: Array<string> = [];\n\t\tconst response = await this.db.client.search<T>({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tscroll: '30s',\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query),\n\t\t\t\tstored_fields: []\n\t\t\t}\n\t\t});\n\t\tawait this.scroll(response, async (hits) => {\n\t\t\tlist = list.concat(hits.map(hit => hit._id.toString()));\n\t\t});\n\t\treturn list;\n\t}\n\n\tasync aggregate(query: JamServe.DatabaseQuery, field: string): Promise<number> {\n\t\tconst response = await this.db.client.search({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query),\n\t\t\t\t'aggs': {\n\t\t\t\t\t'_count': {\n\t\t\t\t\t\t'cardinality': {\n\t\t\t\t\t\t\t'field': field\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn response.aggregations._count.value;\n\t}\n\n\tasync count(query: JamServe.DatabaseQuery): Promise<number> {\n\t\tconst response = await this.db.client.search({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tsize: 0,\n\t\t\tbody: {\n\t\t\t\tquery: this.translateElasticQuery(query),\n\t\t\t}\n\t\t});\n\t\treturn response.hits.total;\n\t}\n\n\tasync distinct(fieldname: string): Promise<Array<string>> {\n\t\tconst response = await this.db.client.search({\n\t\t\tindex: this._index,\n\t\t\ttype: this._type,\n\t\t\tbody: {'aggs': {'distinct': {'terms': {'field': fieldname}}}}\n\t\t});\n\t\treturn response.aggregations.distinct.buckets.map((hit: any) => hit.key);\n\t}\n\n}\n","module.exports = require(\"elasticsearch\");","import elasticsearch from 'elasticsearch';\n\nconst esTypeMapping = {\n\t_source: {enabled: false},\n\t_all: {enabled: false},\n\t// _type: {index: 'no'},\n\tenabled: false\n};\n\nexport class ESSequence {\n\tclient: elasticsearch.Client;\n\tprivate initPromise: Promise<any> | null = null;\n\tprivate initError: Promise<any> | null = null;\n\tprivate cacheFillPromise: Promise<any> | null = null;\n\tprivate cache: { [sequenceName: string]: Array<string> } = {};\n\tprivate cacheSize = 100;\n\tprivate options = {esIndex: 'sequences', esType: 'sequence'};\n\n\tconstructor(client: elasticsearch.Client) {\n\t\tthis.client = client;\n\t\tif (!isInjectedClientValid(client)) {\n\t\t\tthrow new Error('Init was called with an invalid client parameter value.');\n\t\t}\n\t}\n\n\tinit(options?: any, cacheSize?: number): Promise<any> {\n\t\t// The following checks are done before the init promise is created\n\t\t// because errors thrown in the init promise are stored in _initError.\n\t\t// If a check fails it should look as if init was not called.\n\t\tif (!isInjectedClientValid(this.client)) {\n\t\t\treturn Promise.reject(new Error('Init was called with an invalid client parameter value.'));\n\t\t}\n\t\tif (this.initPromise !== null) {\n\t\t\treturn Promise.reject(new Error('Init was called while a previous init is pending.'));\n\t\t}\n\t\tif (this.cacheFillPromise !== null) {\n\t\t\treturn Promise.reject(new Error('Init was called while get requests are pending.'));\n\t\t}\n\t\tif (!isInjectedCacheSizeValid(cacheSize)) {\n\t\t\treturn Promise.reject(new Error('Init was called with an invalid cacheSize parameter value.'));\n\t\t}\n\t\tthis.initPromise = new Promise((resolve) => {\n\t\t\tthis.cache = {}; // In case init is called multiple times.\n\t\t\tthis.cacheSize = 100;\n\t\t\tthis.initError = null;\n\t\t\tif (cacheSize !== undefined) {\n\t\t\t\tthis.cacheSize = cacheSize;\n\t\t\t}\n\t\t\tif (isObject(options)) {\n\t\t\t\tthis.options = Object.assign(this.options, options);\n\t\t\t}\n\t\t\tresolve(this.initEsIndexIfNeeded());\n\t\t}).catch((e) => {\n\t\t\tthis.initError = e;\n\t\t\tthrow e;\n\t\t}).then(() => {\n\t\t\tthis.initPromise = null;\n\t\t});\n\t\treturn this.initPromise;\n\t}\n\n\taddMappingToEsIndexIfMissing(): Promise<any> {\n\t\tconst mapping: any = {};\n\t\tmapping[this.options.esType] = esTypeMapping;\n\t\treturn this.client.indices.putMapping({\n\t\t\tindex: this.options.esIndex,\n\t\t\ttype: this.options.esType,\n\t\t\t// ignore_conflicts: true,\n\t\t\tbody: mapping\n\t\t});\n\t}\n\n\tinitEsIndexIfNeeded(): Promise<any> {\n\t\treturn this.client.indices.exists({index: this.options.esIndex}).then(response => {\n\t\t\tif (response) {\n\t\t\t\treturn this.addMappingToEsIndexIfMissing();\n\t\t\t}\n\t\t\tconst config: any = {\n\t\t\t\tsettings: {\n\t\t\t\t\tnumber_of_shards: 1,\n\t\t\t\t\tauto_expand_replicas: '0-all'\n\t\t\t\t},\n\t\t\t\tmappings: {}\n\t\t\t};\n\t\t\tconfig.mappings[this.options.esType] = esTypeMapping;\n\t\t\treturn this.client.indices.create({\n\t\t\t\tindex: this.options.esIndex,\n\t\t\t\tbody: config\n\t\t\t});\n\t\t});\n\t}\n\n\tfillCache(sequenceName: string): Promise<any> {\n\t\tthis.cacheFillPromise = new Promise(resolve => {\n\t\t\tif (!this.cache[sequenceName]) {\n\t\t\t\tthis.cache[sequenceName] = [];\n\t\t\t}\n\t\t\tconst bulkParams: elasticsearch.BulkIndexDocumentsParams = {body: []};\n\t\t\tfor (let i = 0; i < this.cacheSize; i += 1) {\n\t\t\t\t// Action\n\t\t\t\tbulkParams.body.push({index: {_index: this.options.esIndex, _type: this.options.esType, _id: sequenceName}});\n\t\t\t\t// Empty document\n\t\t\t\tbulkParams.body.push({});\n\t\t\t}\n\t\t\tresolve(\n\t\t\t\tthis.client.bulk(bulkParams).then(response => {\n\t\t\t\t\tfor (let k = 0; k < response.items.length; k += 1) {\n\t\t\t\t\t\t// This is the core trick: The document's version is an auto-incrementing integer.\n\t\t\t\t\t\tthis.cache[sequenceName].push(response.items[k].index._version);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}).then(() => {\n\t\t\tthis.cacheFillPromise = null;\n\t\t});\n\t\treturn this.cacheFillPromise;\n\t}\n\n\tprivate interal_get(sequenceName: string): Promise<any> {\n\t\tif (this.initError !== null) {\n\t\t\treturn Promise.reject(this.initError);\n\t\t}\n\t\tif (this.cache[sequenceName] && this.cache[sequenceName].length > 0) {\n\t\t\treturn Promise.resolve(this.cache[sequenceName].shift());\n\t\t}\n\n\t\tconst returnValue = (): Promise<any> => {\n\t\t\treturn this.interal_get(sequenceName);\n\t\t};\n\n\t\tif (this.cacheFillPromise !== null) {\n\t\t\treturn this.cacheFillPromise.then(returnValue);\n\t\t} else {\n\t\t\treturn this.fillCache(sequenceName).then(returnValue);\n\t\t}\n\t}\n\n\tpublic get(sequenceName: string): Promise<any> {\n\t\tif (!this.client) {\n\t\t\tthrow new Error('Please run init(...) first to provide an elasticsearch client.');\n\t\t}\n\t\tif ((typeof sequenceName !== 'string') || sequenceName.length === 0) {\n\t\t\tthrow new Error('The parameter value for sequenceName is invalid.');\n\t\t}\n\t\tif (this.initPromise !== null) {\n\t\t\t// Defer until init is done\n\t\t\treturn this.initPromise.then(() => this.interal_get(sequenceName));\n\t\t}\n\t\treturn this.interal_get(sequenceName);\n\t}\n\n\tpublic getCacheSize(sequenceName: string): number {\n\t\tif (!this.cache[sequenceName]) {\n\t\t\treturn 0;\n\t\t} else {\n\t\t\treturn this.cache[sequenceName].length;\n\t\t}\n\t}\n\n}\n\nfunction isObject(val: any): boolean {\n\treturn typeof val === 'object';\n}\n\nfunction isFunction(val: any): boolean {\n\treturn typeof val === 'function';\n}\n\nfunction isInjectedClientValid(client: elasticsearch.Client) {\n\treturn !((!isObject(client) && !isFunction(client)) ||\n\t\t(!isObject(client.indices) && !isFunction(client.indices)) ||\n\t\t!isFunction(client.indices.create) ||\n\t\t!isFunction(client.indices.exists) ||\n\t\t!isFunction(client.indices.putMapping) ||\n\t\t!isFunction(client.bulk));\n}\n\nfunction isInjectedCacheSizeValid(cacheSize: number | any): boolean {\n\treturn ((cacheSize === undefined) || (typeof cacheSize === 'number' && isFinite(cacheSize) && Math.floor(cacheSize) === cacheSize));\n}\n","const type_bool = {type: 'boolean'};\n\nconst type_int = {type: 'long'};\n\nconst type_string = {type: 'text'};\n\nconst type_key = {type: 'keyword'};\n\nconst type_JamServe_Root = {\n\tproperties: {\n\t\tname: type_key,\n\t\tpath: type_key,\n\t\tcreated: type_int,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_UserRoles = {\n\tproperties: {\n\t\tstreamRole: type_bool,\n\t\tuploadRole: type_bool,\n\t\tadminRole: type_bool,\n\t\tpodcastRole: type_bool\n\t}\n};\n\nconst type_JamServe_User = {\n\tproperties: {\n\t\tname: type_key,\n\t\tpass: type_key,\n\t\temail: type_key,\n\t\tcreated: type_int,\n\t\tldapAuthenticated: type_bool,\n\t\tscrobblingEnabled: type_bool,\n\t\tavatarLastChanged: type_int,\n\t\tavatar: type_key,\n\t\tmaxBitRate: type_int,\n\t\tallowedfolder: type_key,\n\t\troles: type_JamServe_UserRoles,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_FolderTag = {\n\tproperties: {\n\t\ttracks: type_int,\n\t\tlevel: type_int,\n\t\ttype: type_key,\n\t\tgenre: type_key,\n\t\talbum: type_key,\n\t\tartist: type_key,\n\t\tartistSort: type_key,\n\t\talbumType: type_key,\n\t\ttitle: type_key,\n\t\timage: type_key,\n\t\tyear: type_int,\n\t\tmbAlbumID: type_key,\n\t\tmbArtistID: type_key\n\t}\n};\n\nconst type_MusicBrainz_Rating = {\n\tproperties: {\n\t\tvotesCount: type_int,\n\t\tvalue: type_int\n\t}\n};\n\nconst type_MusicBrainz_Alias = {\n\tproperties: {\n\t\tname: type_key,\n\t\tsortName: type_key,\n\t\tlocale: type_key,\n\t\ttype: type_key,\n\t\ttypeId: type_key,\n\t\tprimary: type_key,\n\t\tbeginDate: type_key,\n\t\tendDate: type_key,\n\t\tended: type_bool\n\t}\n};\n\nconst type_MusicBrainz_ArtistCredit = {\n\tproperties: {\n\t\tname: type_key,\n\t\tjoinphrase: type_key,\n\t\tartist: {\n\t\t\tproperties: {\n\t\t\t\tid: type_key,\n\t\t\t\tname: type_key,\n\t\t\t\tsortName: type_key,\n\t\t\t\tdisambiguation: type_key,\n\t\t\t\taliases: type_MusicBrainz_Alias\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst type_MusicBrainz_RecordingBase = {\n\tproperties: {\n\t\tid: type_key,\n\t\ttitle: type_key,\n\t\tdisambiguation: type_key,\n\t\tlength: type_int,\n\t\tvideo: type_bool,\n\t\trating: type_MusicBrainz_Rating,\n\t\taliases: type_MusicBrainz_Alias,\n\t\tartistCredit: type_MusicBrainz_ArtistCredit,\n\t\tisrcs: type_key\n\t}\n};\n\nconst type_MusicBrainz_ReleaseTrack = {\n\tproperties: {\n\t\tid: type_key,\n\t\ttitle: type_key,\n\t\tposition: type_int,\n\t\tlength: type_int,\n\t\tnumber: type_key,\n\t\trecording: type_MusicBrainz_RecordingBase,\n\t\tartistCredit: type_MusicBrainz_ArtistCredit\n\t}\n};\n\nconst type_MusicBrainz_Disc = {\n\tproperties: {\n\t\tid: type_key,\n\t\tsectors: type_int,\n\t\toffsetCount: type_int,\n\t\toffsets: type_int\n\t}\n};\n\nconst type_MusicBrainz_ReleaseMedia = {\n\tproperties: {\n\t\tformat: type_key,\n\t\tformatId: type_key,\n\t\ttitle: type_key,\n\t\tdiscCount: type_int,\n\t\ttrackCount: type_int,\n\t\tposition: type_int,\n\t\ttrackOffset: type_int,\n\t\ttracks: type_MusicBrainz_ReleaseTrack,\n\t\tdiscs: type_MusicBrainz_Disc\n\t}\n};\n\nconst type_MusicBrainz_ReleaseGroupBase = {\n\tproperties: {\n\t\tid: type_key,\n\t\ttitle: type_key,\n\t\tdisambiguation: type_key,\n\t\tfirstReleaseDate: type_key,\n\t\tprimaryType: type_key,\n\t\tprimaryTypeId: type_key,\n\t\tsecondaryTypes: type_key,\n\t\tsecondaryTypeIds: type_key,\n\t\trating: type_MusicBrainz_Rating,\n\t\tartistCredit: type_MusicBrainz_ArtistCredit\n\t}\n};\n\nconst type_MusicBrainz_Label = {\n\tproperties: {\n\t\tcatalogNumber: type_key,\n\t\tlabel: {\n\t\t\tproperties: {\n\t\t\t\tid: type_key,\n\t\t\t\tname: type_key,\n\t\t\t\tdisambiguation: type_key,\n\t\t\t\tlabelCode: type_key,\n\t\t\t\tsortName: type_key\n\t\t\t}\n\t\t},\n\t\taliases: {\n\t\t\tproperties: {\n\t\t\t\tname: type_key,\n\t\t\t\tsortName: type_key,\n\t\t\t\tended: type_bool\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst type_MusicBrainz_ReleaseEvent = {\n\tproperties: {\n\t\tdate: type_key,\n\t\tarea: {\n\t\t\tproperties: {\n\t\t\t\tid: type_key,\n\t\t\t\tname: type_key,\n\t\t\t\tsortName: type_key,\n\t\t\t\tdisambiguation: type_key,\n\t\t\t\tiso31661Codes: type_key\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst type_MusicBrainz_Release = {\n\tproperties: {\n\t\tmedia: type_MusicBrainz_ReleaseMedia,\n\t\tscore: type_int,\n\t\tcount: type_int,\n\t\tid: type_key,\n\t\ttitle: type_key,\n\t\tsortName: type_key,\n\t\tstatus: type_key,\n\t\tstatusId: type_key,\n\t\tdate: type_key,\n\t\tcountry: type_key,\n\t\tpackaging: type_key,\n\t\tpackagingId: type_key,\n\t\tdisambiguation: type_key,\n\t\tannotation: type_key,\n\t\tquality: type_key,\n\t\tbarcode: type_key,\n\t\tasin: type_key,\n\t\ttextRepresentation: {\n\t\t\tproperties: {\n\t\t\t\tlanguage: type_key,\n\t\t\t\tscript: type_key\n\t\t\t}\n\t\t},\n\t\ttrackCount: type_int,\n\t\tartistCredit: type_MusicBrainz_ArtistCredit,\n\t\treleaseGroup: type_MusicBrainz_ReleaseGroupBase,\n\t\tlabelInfo: type_MusicBrainz_Label,\n\t\ttags: {\n\t\t\tproperties: {\n\t\t\t\tcount: type_int,\n\t\t\t\tname: type_key\n\t\t\t}\n\t\t},\n\t\treleaseEvents: type_MusicBrainz_ReleaseEvent,\n\t\tcoverArtArchive: {\n\t\t\tproperties: {\n\t\t\t\tfront: type_bool,\n\t\t\t\tback: type_bool,\n\t\t\t\tdarkened: type_bool,\n\t\t\t\tartwork: type_bool,\n\t\t\t\tcount: type_int\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst type_JamServe_MetaInfoAlbum = {\n\tproperties: {\n\t\tname: type_key,\n\t\tartist: type_key,\n\t\tmbid: type_key,\n\t\turl: type_key,\n\t\timage: {\n\t\t\tproperties: {\n\t\t\t\tsmall: type_key,\n\t\t\t\tmedium: type_key,\n\t\t\t\tlarge: type_key\n\t\t\t}\n\t\t},\n\t\ttags: {\n\t\t\tproperties: {\n\t\t\t\tname: type_key,\n\t\t\t\turl: type_key\n\t\t\t}\n\t\t},\n\t\tdescription: type_key,\n\t\treleases: type_MusicBrainz_Release\n\t}\n};\n\nconst type_JamServe_MetaInfoImage = {\n\tproperties: {\n\t\tsmall: type_key,\n\t\tmedium: type_key,\n\t\tlarge: type_key\n\t}\n};\n\nconst type_JamServe_MetaInfoSimilarArtist = {\n\tproperties: {\n\t\tname: type_key,\n\t\turl: type_key,\n\t\tmbid: type_key,\n\t\timage: type_JamServe_MetaInfoImage\n\t}\n};\n\nconst type_JamServe_MetaInfoArtist = {\n\tproperties: {\n\t\tname: type_key,\n\t\tmbid: type_key,\n\t\turl: type_key,\n\t\timage: type_JamServe_MetaInfoImage,\n\t\ttags: {\n\t\t\tproperties: {\n\t\t\t\tname: type_key,\n\t\t\t\turl: type_key\n\t\t\t}\n\t\t},\n\t\tdescription: type_key,\n\t\tsimilar: type_JamServe_MetaInfoSimilarArtist\n\t}\n};\n\nconst type_JamServe_MetaInfoTopSong = {\n\tproperties: {\n\t\tname: type_key,\n\t\tartist: {\n\t\t\tproperties: {\n\t\t\t\tname: type_key,\n\t\t\t\tmbid: type_key,\n\t\t\t\turl: type_key\n\t\t\t}\n\t\t},\n\t\tmbid: type_key,\n\t\turl: type_key,\n\t\trank: type_key,\n\t\timage: type_JamServe_MetaInfoImage\n\t}\n};\n\nconst type_JamServe_MetaInfo = {\n\tproperties: {\n\t\talbum: type_JamServe_MetaInfoAlbum,\n\t\tartist: type_JamServe_MetaInfoArtist,\n\t\ttopSongs: type_JamServe_MetaInfoTopSong\n\t}\n};\n\nconst type_JamServe_Folder = {\n\tproperties: {\n\t\trootID: type_key,\n\t\tpath: type_key,\n\t\tparentID: type_key,\n\t\tstat: {\n\t\t\tproperties: {\n\t\t\t\tcreated: type_int,\n\t\t\t\tmodified: type_int\n\t\t\t}\n\t\t},\n\t\ttag: type_JamServe_FolderTag,\n\t\tinfo: type_JamServe_MetaInfo,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_PlayQueue = {\n\tproperties: {\n\t\tuserID: type_key,\n\t\ttrackIDs: type_key,\n\t\tcurrentID: type_key,\n\t\tposition: type_int,\n\t\tchanged: type_int,\n\t\tchangedBy: type_key,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_TrackTag = {\n\tproperties: {\n\t\talbum: type_key,\n\t\talbumSort: type_key,\n\t\talbumArtist: type_key,\n\t\talbumArtistSort: type_key,\n\t\tartist: type_key,\n\t\tartistSort: type_key,\n\t\tgenre: type_key,\n\t\tdisc: type_int,\n\t\ttitle: type_key,\n\t\ttitleSort: type_key,\n\t\ttrack: type_int,\n\t\tyear: type_int,\n\t\tmbTrackID: type_key,\n\t\tmbAlbumType: type_key,\n\t\tmbAlbumArtistID: type_key,\n\t\tmbArtistID: type_key,\n\t\tmbAlbumID: type_key,\n\t\tmbReleaseTrackID: type_key,\n\t\tmbReleaseGroupID: type_key,\n\t\tmbRecordingID: type_key,\n\t\tmbAlbumStatus: type_key,\n\t\tmbReleaseCountry: type_key\n\t}\n};\n\nconst type_JamServe_TrackMedia = {\n\tproperties: {\n\t\tduration: type_int,\n\t\tbitRate: type_int,\n\t\tformat: type_key,\n\t\tsampleRate: type_int,\n\t\tchannels: type_int,\n\t\tencoded: type_key,\n\t\tmode: type_key,\n\t\tversion: type_key\n\t}\n};\n\nconst type_JamServe_MetaInfoTrackSimilarSong = {\n\tproperties: {\n\t\tname: type_key,\n\t\tmbid: type_key,\n\t\turl: type_key,\n\t\tduration: type_int,\n\t\tartist: {\n\t\t\tproperties: {\n\t\t\t\tname: type_key,\n\t\t\t\tmbid: type_key,\n\t\t\t\turl: type_key\n\t\t\t}\n\t\t},\n\t\timage: type_JamServe_MetaInfoImage\n\t}\n};\n\nconst type_JamServe_MetaInfoTrack = {\n\tproperties: {\n\t\tsimilar: type_JamServe_MetaInfoTrackSimilarSong\n\t}\n};\n\nconst type_JamServe_Track = {\n\tproperties: {\n\t\trootID: type_key,\n\t\tparentID: type_key,\n\t\tname: type_key,\n\t\tpath: type_key,\n\t\tstat: {\n\t\t\tproperties: {\n\t\t\t\tcreated: type_int,\n\t\t\t\tmodified: type_int,\n\t\t\t\tsize: type_int\n\t\t\t}\n\t\t},\n\t\talbumID: type_key,\n\t\tartistID: type_key,\n\t\ttag: type_JamServe_TrackTag,\n\t\tmedia: type_JamServe_TrackMedia,\n\t\tinfo: type_JamServe_MetaInfoTrack,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_Album = {\n\tproperties: {\n\t\tname: type_key,\n\t\trootIDs: type_key,\n\t\ttrackIDs: type_key,\n\t\tartistID: type_key,\n\t\tartist: type_key,\n\t\tgenre: type_key,\n\t\tyear: type_int,\n\t\tduration: type_int,\n\t\tcreated: type_int,\n\t\tmbArtistID: type_key,\n\t\tmbAlbumID: type_key,\n\t\tinfo: type_JamServe_MetaInfo,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_Artist = {\n\tproperties: {\n\t\tname: type_key,\n\t\tnameSort: type_key,\n\t\trootIDs: type_key,\n\t\ttrackIDs: type_key,\n\t\talbumIDs: type_key,\n\t\tmbArtistID: type_key,\n\t\tinfo: type_JamServe_MetaInfo,\n\t\tcreated: type_int,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_Radio = {\n\tproperties: {\n\t\tname: type_key,\n\t\turl: type_key,\n\t\thomepage: type_key,\n\t\tdisabled: type_bool,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_State = {\n\tproperties: {\n\t\tuserID: type_key,\n\t\tdestID: type_key,\n\t\tdestType: type_int,\n\t\tplayed: type_int,\n\t\tlastplayed: type_int,\n\t\tfaved: type_int,\n\t\trated: type_int,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_Playlist = {\n\tproperties: {\n\t\tname: type_key,\n\t\tuserID: type_key,\n\t\tcomment: type_key,\n\t\tcoverArt: type_key,\n\t\tchanged: type_int,\n\t\tcreated: type_int,\n\t\tallowedUser: type_key,\n\t\tisPublic: type_bool,\n\t\tduration: type_int,\n\t\ttrackIDs: type_key,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_PodcastTag = {\n\tproperties: {\n\t\ttitle: type_key,\n\t\tstatus: type_key,\n\t\tlink: type_key,\n\t\tauthor: type_key,\n\t\tdescription: type_key,\n\t\tgenerator: type_key,\n\t\timage: type_key,\n\t\tcategories: type_key\n\t}\n};\n\nconst type_JamServe_Podcast = {\n\tproperties: {\n\t\turl: type_key,\n\t\tcreated: type_int,\n\t\tlastCheck: type_int,\n\t\tstatus: type_key,\n\t\terrorMessage: type_key,\n\t\ttag: type_JamServe_PodcastTag,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_PodcastEpisodeChapter = {\n\tproperties: {\n\t\tstart: type_int,\n\t\ttitle: type_key\n\t}\n};\n\nconst type_JamServe_PodcastEpisodeEnclosure = {\n\tproperties: {\n\t\turl: type_key,\n\t\ttype: type_key,\n\t\tlength: type_int\n\t}\n};\n\nconst type_JamServe_Episode = {\n\tproperties: {\n\t\tpodcastID: type_key,\n\t\tstatus: type_key,\n\t\terror: type_key,\n\t\tpath: type_key,\n\t\tlink: type_key,\n\t\tsummary: type_key,\n\t\tdate: type_int,\n\t\ttitle: type_key,\n\t\tguid: type_key,\n\t\tauthor: type_key,\n\t\tchapters: type_JamServe_PodcastEpisodeChapter,\n\t\tenclosures: type_JamServe_PodcastEpisodeEnclosure,\n\t\tstat: {\n\t\t\tproperties: {\n\t\t\t\tcreated: type_int,\n\t\t\t\tmodified: type_int,\n\t\t\t\tsize: type_int\n\t\t\t}\n\t\t},\n\t\ttag: type_JamServe_TrackTag,\n\t\tmedia: type_JamServe_TrackMedia,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nconst type_JamServe_Bookmark = {\n\tproperties: {\n\t\tdestID: type_key,\n\t\tuserID: type_key,\n\t\tcomment: type_key,\n\t\tcreated: type_int,\n\t\tchanged: type_int,\n\t\tposition: type_int,\n\t\tid: type_key,\n\t\ttype: type_int\n\t}\n};\n\nexport const mapping: any = {\n\troot: type_JamServe_Root,\n\tuser: type_JamServe_User,\n\tfolder: type_JamServe_Folder,\n\tplayqueue: type_JamServe_PlayQueue,\n\ttrack: type_JamServe_Track,\n\talbum: type_JamServe_Album,\n\tartist: type_JamServe_Artist,\n\tradio: type_JamServe_Radio,\n\tstate: type_JamServe_State,\n\tplaylist: type_JamServe_Playlist,\n\tpodcast: type_JamServe_Podcast,\n\tepisode: type_JamServe_Episode,\n\tbookmark: type_JamServe_Bookmark\n};\n","export async function wait(ms: number) {\n\treturn new Promise<void>(res => setTimeout(res, ms));\n}\n","import {JamServe} from '../../model/jamserve';\nimport {DatabaseQuerySortType, DBObjectType} from '../../types';\nimport path from 'path';\nimport Nedb from 'nedb';\nimport {Config} from '../../config';\n\nexport class DBNedb implements JamServe.Database {\n\tclients: {\n\t\t[type: string]: Nedb;\n\t} = {};\n\n\tconstructor(config: Config) {\n\t\tconst db_path = config.getDataPath(['nedb']);\n\t\tthis.getTypes().forEach(type => {\n\t\t\tthis.clients[DBObjectType[type]] = new Nedb({filename: path.resolve(db_path, DBObjectType[type] + '.db')});\n\t\t});\n\t}\n\n\tprivate async loadDatabase(db: Nedb) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tdb.loadDatabase((err) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tasync open(): Promise<void> {\n\t\tfor (const type of this.getTypes()) {\n\t\t\tconst db = this.clients[DBObjectType[type]];\n\t\t\tawait this.loadDatabase(db);\n\t\t}\n\t\tawait this.check();\n\t}\n\n\tasync close(): Promise<void> {\n\t\treturn;\n\t}\n\n\tprivate getTypes(): Array<DBObjectType> {\n\t\treturn Object.keys(DBObjectType)\n\t\t\t.filter(key => !isNaN(Number(key)))\n\t\t\t.map(key => parseInt(key, 10));\n\t}\n\n\tprivate async resetIndex(db: Nedb): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tdb.remove({}, {multi: true}, (err) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t\tdb.loadDatabase((err2) => {\n\t\t\t\t\tif (err2) {\n\t\t\t\t\t\treject(err2);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tasync reset(): Promise<void> {\n\t\tfor (const type of this.getTypes()) {\n\t\t\tconst db = this.clients[DBObjectType[type]];\n\t\t\tawait this.resetIndex(db);\n\t\t}\n\t}\n\n\tprivate async checkIndex(db: Nedb): Promise<void> {\n\t\treturn;\n\t}\n\n\tasync check(): Promise<void> {\n\t\tfor (const type of this.getTypes()) {\n\t\t\tconst db = this.clients[DBObjectType[type]];\n\t\t\tawait this.checkIndex(db);\n\t\t}\n\t}\n\n\tgetDBIndex<T extends JamServe.DBObject>(type: DBObjectType) {\n\t\treturn new DBIndexNedb<T>(type, this.clients[DBObjectType[type]]);\n\t}\n}\n\nlet globaltempid = (new Date()).valueOf();\n\nfunction regExpEscape(literal_string: string): string {\n\treturn literal_string.replace(/[-[\\]{}()*+!<=:?.\\/\\\\^$|#\\s,]/g, '\\\\$&');\n}\n\nexport class DBIndexNedb<T extends JamServe.DBObject> implements JamServe.DatabaseIndex<T> {\n\tprotected _index: string;\n\tprotected _type: string;\n\ttype: DBObjectType;\n\tclient: Nedb;\n\n\tprivate hit2Obj(hit: T): T {\n\t\tdelete (<any>hit)._id;\n\t\treturn hit;\n\t}\n\n\tprivate hits2Objs(hits: Array<T>): Array<T> {\n\t\treturn hits.map(hit => {\n\t\t\treturn this.hit2Obj(hit);\n\t\t});\n\t}\n\n\tconstructor(type: DBObjectType, client: Nedb) {\n\t\tthis.type = type;\n\t\tif (type === undefined) {\n\t\t\tthis._index = 'jam_*'; // '_all';\n\t\t\tthis._type = '';\n\t\t} else {\n\t\t\tthis._type = DBObjectType[type];\n\t\t\tthis._index = 'jam_' + DBObjectType[type];\n\t\t}\n\t\tthis.client = client;\n\t}\n\n\tprivate async getNewId(): Promise<string> {\n\t\t// TODO: implement real sequence id in nedb\n\t\tglobaltempid++;\n\t\treturn globaltempid.toString();\n\t}\n\n\tprivate translateSortQuery(query: JamServe.DatabaseQuery): { [name: string]: number } | undefined {\n\t\tif (query.sort) {\n\t\t\tconst result: { [name: string]: number } = {};\n\t\t\tconst sort = query.sort;\n\t\t\tObject.keys(sort).forEach(key => {\n\t\t\t\tresult[key] = sort[key] === DatabaseQuerySortType.ascending ? 1 : -1;\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn;\n\t}\n\n\tprivate translateQuery(query: JamServe.DatabaseQuery) {\n\t\tif (query.all) {\n\t\t\treturn {};\n\t\t}\n\t\tlet must: Array<any> = [];\n\t\tif (query.term) {\n\t\t\tconst o = query.term;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = o[key];\n\t\t\t\t\treturn term;\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.match) {\n\t\t\tconst o = query.match;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = new RegExp(regExpEscape(o[key].toString()), 'ig');\n\t\t\t\t\treturn term;\n\t\t\t\t})\n\t\t\t);\n\n\t\t}\n\t\tif (query.terms) {\n\t\t\tconst o = query.terms;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map(key => {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = {$in: o[key]};\n\t\t\t\t\treturn term;\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.startsWith) {\n\t\t\tconst o = query.startsWith;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map((key: string): any => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t$where: function() {\n\t\t\t\t\t\t\treturn this[key].indexOf(o[key]) === 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.startsWiths) {\n\t\t\tconst o = query.startsWiths;\n\t\t\tmust = must.concat(\n\t\t\t\tObject.keys(o).map((key: string): any => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t$where: function() {\n\t\t\t\t\t\t\treturn !!o[key].find(entry => this[key].indexOf(entry) === 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\tif (query.range) {\n\t\t\tconst o = query.range;\n\t\t\tObject.keys(o).forEach(key => {\n\t\t\t\tconst vals = o[key];\n\t\t\t\tif (vals.hasOwnProperty('gte') && vals.gte !== undefined) {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = {$gte: vals.gte};\n\t\t\t\t\tmust.push(term);\n\t\t\t\t}\n\t\t\t\tif (vals.hasOwnProperty('lte') && vals.lte !== undefined) {\n\t\t\t\t\tconst term: any = {};\n\t\t\t\t\tterm[key] = {$lte: vals.lte};\n\t\t\t\t\tmust.push(term);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (query.notNull) {\n\t\t\tconst o = query.notNull;\n\t\t\tmust = must.concat(o.map(key => {\n\t\t\t\tconst term: any = {};\n\t\t\t\tterm[key] = {$exists: true};\n\t\t\t\treturn term;\n\t\t\t}));\n\t\t}\n\t\treturn {$and: must};\n\t}\n\n\tasync add(body: T): Promise<string> {\n\t\tconst id = await this.getNewId();\n\t\tbody.id = id;\n\t\treturn new Promise<string>((resolve, reject) => {\n\t\t\tthis.client.insert(body, (err) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(id);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t}\n\n\tasync replace(id: string, body: T): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tthis.client.update({id: id}, body, {}, (err, numReplaced) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else if (numReplaced !== 1) {\n\t\t\t\t\treturn reject('Could not find ' + this._type + ' doc with id ' + id);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync upsert(id: string, body: T): Promise<void> {\n\t\tif (!id || id.length === 0) {\n\t\t\tawait this.add(body);\n\t\t\treturn;\n\t\t} else {\n\t\t\tawait this.replace(id, body);\n\t\t}\n\t}\n\n\tasync remove(id: string | Array<string>): Promise<void> {\n\t\tconst ids = Array.isArray(id) ? id : [id];\n\t\tif (ids.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tthis.client.remove({id: {$in: ids}}, {multi: true}, (err, count) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else if (count !== ids.length) {\n\t\t\t\t\treject('Found nr of items ' + count + ' does not match nr. of ids ' + ids.length);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync removeByQuery(query: JamServe.DatabaseQuery): Promise<number> {\n\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\tthis.client.remove(this.translateQuery(query), {multi: true}, (err, count) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(count);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync byId(id: string): Promise<T | undefined> {\n\t\tif (this.type === undefined) {\n\t\t\treturn await this.queryOne({term: {id: id}});\n\t\t} else {\n\t\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\t\tthis.client.find<T>({id: id}, (err, docs) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t} else if (docs.length === 0) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(this.hit2Obj(docs[0]));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tasync byIds(ids: Array<string>): Promise<Array<T>> {\n\t\treturn new Promise<Array<T>>((resolve, reject) => {\n\t\t\tthis.client.find<T>({id: {$in: ids}}, (err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(this.hits2Objs(docs));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync query(query: JamServe.DatabaseQuery): Promise<Array<T>> {\n\t\tlet dbquery = this.client.find<T>(this.translateQuery(query));\n\t\tconst sort = this.translateSortQuery(query);\n\t\tif (sort) {\n\t\t\tdbquery = dbquery.sort(sort);\n\t\t}\n\t\tif (query.offset) {\n\t\t\tdbquery = dbquery.skip(query.offset);\n\t\t}\n\t\tif (query.amount) {\n\t\t\tdbquery = dbquery.limit(query.amount);\n\t\t}\n\t\treturn new Promise<Array<T>>((resolve, reject) => {\n\t\t\tdbquery.exec((err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(this.hits2Objs(docs));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync queryOne(query: JamServe.DatabaseQuery): Promise<T | undefined> {\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tthis.client.find<T>(this.translateQuery(query)).limit(1).exec((err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else if (docs.length === 0) {\n\t\t\t\t\tresolve();\n\t\t\t\t} else {\n\t\t\t\t\tresolve(this.hit2Obj(docs[0]));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync iterate(query: JamServe.DatabaseQuery, onItems: (items: Array<T>) => Promise<void>): Promise<void> {\n\t\tlet dbquery = this.client.find<T>(this.translateQuery(query));\n\t\tconst sort = this.translateSortQuery(query);\n\t\tif (sort) {\n\t\t\tdbquery = dbquery.sort(sort);\n\t\t}\n\t\tif (query.offset) {\n\t\t\tdbquery = dbquery.skip(query.offset);\n\t\t}\n\t\tif (query.amount) {\n\t\t\tdbquery = dbquery.limit(query.amount);\n\t\t}\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tdbquery.exec((err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tonItems(this.hits2Objs(docs)).then(resolve).catch(reject);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync queryIds(query: JamServe.DatabaseQuery): Promise<Array<string>> {\n\t\tlet dbquery = this.client.find<T>(this.translateQuery(query));\n\t\tconst sort = this.translateSortQuery(query);\n\t\tif (sort) {\n\t\t\tdbquery = dbquery.sort(sort);\n\t\t}\n\t\tif (query.offset) {\n\t\t\tdbquery = dbquery.skip(query.offset);\n\t\t}\n\t\tif (query.amount) {\n\t\t\tdbquery = dbquery.limit(query.amount);\n\t\t}\n\t\treturn new Promise<Array<string>>((resolve, reject) => {\n\t\t\tdbquery.exec((err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(docs.map(o => o.id));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate getDotFieldValues(field: string, o: any): Array<string> {\n\t\tconst result: Array<any> = [];\n\n\t\tconst getFieldValueR = (fields: Array<string>, obj: any) => {\n\t\t\tconst sub = obj[fields[0]];\n\t\t\tif (sub === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(sub)) {\n\t\t\t\tif (fields.length === 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsub.forEach(child => {\n\t\t\t\t\tgetFieldValueR(fields.slice(1), child);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (fields.length === 1) {\n\t\t\t\t\tresult.push(sub.toString());\n\t\t\t\t} else if (typeof sub === 'object') {\n\t\t\t\t\tgetFieldValueR(fields.slice(1), sub);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tgetFieldValueR(field.split('.'), o);\n\t\treturn result;\n\t}\n\n\tasync aggregate(query: JamServe.DatabaseQuery, field: string): Promise<number> {\n\t\tlet dbquery = this.client.find<T>(this.translateQuery(query));\n\t\tconst sort = this.translateSortQuery(query);\n\t\tif (sort) {\n\t\t\tdbquery = dbquery.sort(sort);\n\t\t}\n\t\tif (query.offset) {\n\t\t\tdbquery = dbquery.skip(query.offset);\n\t\t}\n\t\tif (query.amount) {\n\t\t\tdbquery = dbquery.limit(query.amount);\n\t\t}\n\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\tdbquery.exec((err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tconst list: Array<string> = [];\n\t\t\t\t\tdocs.forEach(doc => {\n\t\t\t\t\t\tconst vals = this.getDotFieldValues(field, doc);\n\t\t\t\t\t\tvals.forEach(val => {\n\t\t\t\t\t\t\tif (list.indexOf(val) < 0) {\n\t\t\t\t\t\t\t\tlist.push(val);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tresolve(list.length);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync count(query: JamServe.DatabaseQuery): Promise<number> {\n\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\tthis.client.count(this.translateQuery(query), (err, count) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(count);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync distinct(fieldname: string): Promise<Array<string>> {\n\t\treturn new Promise<Array<string>>((resolve, reject) => {\n\t\t\tthis.client.find<T>({}, (err, docs) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tconst list: Array<string> = [];\n\t\t\t\t\tdocs.forEach(doc => {\n\t\t\t\t\t\tconst vals = this.getDotFieldValues(fieldname, doc);\n\t\t\t\t\t\tvals.forEach(val => {\n\t\t\t\t\t\t\tif (list.indexOf(val) < 0) {\n\t\t\t\t\t\t\t\tlist.push(val);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tresolve(list);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n}\n","module.exports = require(\"nedb\");","module.exports = require(\"md5-typescript\");","\nexport function hexEncode(n: string): string {\n\tconst i: Array<string> = [];\n\tconst r: Array<string> = [];\n\tconst u = '0123456789abcdef';\n\tfor (let t = 0; t < 256; t++) {\n\t\t/* tslint:disable */\n\t\ti[t] = u.charAt(t >> 4) + u.charAt(t & 15);\n\t\t/* tslint:enable */\n\t}\n\tfor (let t = 0; t < n.length; t++) {\n\t\tr[t] = i[n.charCodeAt(t)];\n\t}\n\treturn r.join('');\n}\n\nexport function hexDecode(hex: string): string {\n\tlet str = '';\n\tfor (let i = 0; i < hex.length; i += 2) {\n\t\tstr += String.fromCharCode(parseInt(hex.substr(i, 2), 16));\n\t}\n\treturn str.trim();\n}\n","import {JamServe} from '../model/jamserve';\nimport {ID3v2, IID3V2, IMP3, MP3, simplifyTag} from 'jamp3';\nimport {ChartLyricsClient, ChartLyricsResult} from './clients/chartlyrics-client';\nimport {AcoustidClient} from './clients/acoustid-client';\nimport {LastFMClient} from './clients/lastfm-client';\nimport {MusicbrainzClient} from './clients/musicbrainz-client';\nimport {MusicbrainzClientApi} from './clients/musicbrainz-client.interface';\nimport {LastFM} from '../model/lastfm-rest-data-2.0';\nimport {Acoustid} from '../model/acoustid-rest-data-2.0';\nimport {MusicBrainz} from '../model/musicbrainz-rest-data-2.0';\nimport {fileCopy, fileExists, fileSuffix} from '../utils/fs-utils';\nimport {cleanGenre} from '../utils/genres';\nimport {Jam} from '../model/jam-rest-data-0.1.0';\nimport {Config} from '../config';\n\nexport interface AudioScanResult {\n\tmedia?: JamServe.TrackMedia;\n\ttag?: JamServe.TrackTag;\n}\n\nexport class FORMAT {\n\tstatic packJamServeMpeg(data?: IMP3.MPEG): JamServe.TrackMedia {\n\t\tif (!data) {\n\t\t\treturn {};\n\t\t}\n\t\treturn {\n\t\t\tformat: 'mp3',\n\t\t\tduration: data.durationEstimate,\n\t\t\tbitRate: data.bitRate,\n\t\t\tsampleRate: data.sampleRate,\n\t\t\tchannels: data.channels,\n\t\t\tencoded: data.encoded,\n\t\t\tmode: data.mode,\n\t\t\tversion: data.version + ' ' + data.layer\n\t\t};\n\t}\n\n\tstatic packJamServeTag(data?: IID3V2.Tag): JamServe.TrackTag | undefined {\n\t\tif (!data) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst simple = simplifyTag(data);\n\t\t// ? simplifyTag(result.id3v2) : undefined\n\t\tlet year: number | undefined = simple.year;\n\t\tif (simple.release_year) {\n\t\t\tconst y = parseInt(simple.release_year, 10);\n\t\t\tif (!isNaN(y)) {\n\t\t\t\tyear = y;\n\t\t\t}\n\t\t}\n\t\tif (simple.originalyear) {\n\t\t\tconst y = parseInt(simple.originalyear, 10);\n\t\t\tif (!isNaN(y)) {\n\t\t\t\tyear = y;\n\t\t\t}\n\t\t}\n\t\tif (simple.original_release_year) {\n\t\t\tconst y = parseInt(simple.original_release_year, 10);\n\t\t\tif (!isNaN(y)) {\n\t\t\t\tyear = y;\n\t\t\t}\n\t\t}\n\t\tif (simple.release_date) {\n\t\t\tconst y = parseInt(simple.release_date.slice(0, 4), 10);\n\t\t\tif (!isNaN(y)) {\n\t\t\t\tyear = y;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\talbum: simple.album,\n\t\t\talbumSort: simple.album_sort_order,\n\t\t\talbumArtist: simple.album_artist,\n\t\t\talbumArtistSort: simple.album_artist_sort || simple.album_artist_sort_order,\n\t\t\tartist: simple.artist,\n\t\t\tartistSort: simple.artist_sort,\n\t\t\tgenre: simple.genre ? cleanGenre(simple.genre) : undefined,\n\t\t\tdisc: simple.disc,\n\t\t\ttitle: simple.title,\n\t\t\ttitleSort: simple.title_sort_order,\n\t\t\ttrack: simple.track,\n\t\t\tyear: year,\n\t\t\tmbTrackID: simple.TRACKID,\n\t\t\tmbAlbumType: simple.ALBUMTYPE,\n\t\t\tmbAlbumArtistID: simple.ALBUMARTISTID,\n\t\t\tmbArtistID: simple.ARTISTID,\n\t\t\tmbAlbumID: simple.ALBUMID,\n\t\t\tmbReleaseTrackID: simple.RELEASETRACKID,\n\t\t\tmbReleaseGroupID: simple.RELEASEGROUPID,\n\t\t\tmbRecordingID: simple.RECORDINGID,\n\t\t\tmbAlbumStatus: simple.ALBUMSTATUS,\n\t\t\tmbReleaseCountry: simple.RELEASECOUNTRY\n\t\t};\n\t}\n\n\tstatic packMediaInfoImage(images: Array<LastFM.Image>): JamServe.MetaInfoImage {\n\t\tlet small: string | undefined;\n\t\tlet medium: string | undefined;\n\t\tlet large: string | undefined;\n\t\tlet image = (images || []).find(img => img.size === 'small');\n\t\tif (image && image.url && image.url.length > 0) {\n\t\t\tsmall = image.url;\n\t\t}\n\t\timage = (images || []).find(img => img.size === 'medium');\n\t\tif (image && image.url && image.url.length > 0) {\n\t\t\tmedium = image.url;\n\t\t}\n\t\timage = (images || []).find(img => img.size === 'large');\n\t\tif (image && image.url && image.url.length > 0) {\n\t\t\tlarge = image.url;\n\t\t}\n\t\treturn {\n\t\t\tsmall: small,\n\t\t\tmedium: medium,\n\t\t\tlarge: large\n\t\t};\n\t}\n\n\tstatic packMediaInfoArtist(data?: LastFM.Artist): JamServe.MetaInfoArtist | undefined {\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\tif (!data.mbid) {\n\t\t\treturn;\n\t\t}\n\t\treturn {\n\t\t\tname: data.name,\n\t\t\tmbid: data.mbid,\n\t\t\turl: data.url,\n\t\t\timage: this.packMediaInfoImage(data.image),\n\t\t\ttags: data.tags,\n\t\t\tdescription: data.bio ? data.bio.content : undefined,\n\t\t\tsimilar: data.similar && data.similar.artist ? data.similar.artist.map(artist => {\n\t\t\t\treturn {\n\t\t\t\t\tname: artist.name,\n\t\t\t\t\turl: artist.url,\n\t\t\t\t\timage: this.packMediaInfoImage(artist.image)\n\t\t\t\t};\n\t\t\t}) : undefined\n\t\t};\n\t}\n\n\tstatic packMediaInfoSimilarSong(data?: LastFM.SimilarTracks): Array<JamServe.MetaInfoTrackSimilarSong> {\n\t\tif (!data || !data.track || data.track.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn data.track.map(t => {\n\t\t\treturn {\n\t\t\t\tname: t.name,\n\t\t\t\tmbid: t.mbid,\n\t\t\t\turl: t.url,\n\t\t\t\tduration: parseFloat(t.duration),\n\t\t\t\tartist: {\n\t\t\t\t\tname: t.artist.name,\n\t\t\t\t\tmbid: t.artist.mbid,\n\t\t\t\t\turl: t.artist.name\n\t\t\t\t},\n\t\t\t\timage: this.packMediaInfoImage(t.image)\n\t\t\t};\n\t\t});\n\t}\n\n\tstatic packMediaInfoAlbum(data?: LastFM.Album): JamServe.MetaInfoAlbum | undefined {\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\treturn {\n\t\t\tname: data.name,\n\t\t\tartist: data.artist,\n\t\t\tmbid: data.mbid,\n\t\t\turl: data.url,\n\t\t\timage: this.packMediaInfoImage(data.image),\n\t\t\ttags: data.tags,\n\t\t\tdescription: data.wiki ? data.wiki.content : undefined\n\t\t};\n\t}\n\n\tstatic packMediaInfoTopSongs(data?: LastFM.TopTracks): Array<JamServe.MetaInfoTopSong> {\n\t\tif (!data || !data.track || data.track.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn data.track.map(t => {\n\t\t\treturn {\n\t\t\t\tname: t.name,\n\t\t\t\tmbid: t.mbid,\n\t\t\t\turl: t.url,\n\t\t\t\trank: t.rank,\n\t\t\t\tartist: {\n\t\t\t\t\tname: t.artist.name,\n\t\t\t\t\tmbid: t.artist.mbid,\n\t\t\t\t\turl: t.artist.name\n\t\t\t\t},\n\t\t\t\timage: this.packMediaInfoImage(t.image)\n\t\t\t};\n\t\t});\n\t}\n}\n\nexport class Audio {\n\tmusicbrainz: MusicbrainzClient;\n\tacoustid: AcoustidClient;\n\tlastFM: LastFMClient;\n\tchartLyrics: ChartLyricsClient;\n\n\tconstructor(config: Config) {\n\t\tthis.musicbrainz = new MusicbrainzClient({userAgent: config.tools.musicbrainz.userAgent, retryOn: true});\n\t\tthis.lastFM = new LastFMClient({key: config.tools.lastfm.apiKey, userAgent: config.tools.lastfm.userAgent});\n\t\tthis.acoustid = new AcoustidClient({key: config.tools.acoustid.apiKey, userAgent: config.tools.acoustid.userAgent});\n\t\tthis.chartLyrics = new ChartLyricsClient(config.tools.chartlyrics.userAgent);\n\t}\n\n\tasync read(filename: string): Promise<AudioScanResult> {\n\t\tconst suffix = fileSuffix(filename);\n\t\tif (suffix === 'mp3') {\n\t\t\tconst mp3 = new MP3();\n\t\t\tconst result = await mp3.read({filename, mpegQuick: true, mpeg: true, id3v2: true});\n\t\t\tif (!result) {\n\t\t\t\treturn {tag: {}, media: {}};\n\t\t\t} else {\n\t\t\t\treturn {tag: FORMAT.packJamServeTag(result.id3v2), media: FORMAT.packJamServeMpeg(result.mpeg)};\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO: read other audio file format tags\n\t\t\tconsole.log('TODO: read other audio file format tags', filename);\n\t\t\treturn {tag: {}, media: {}};\n\t\t}\n\t}\n\n\tasync write(filename: string, tag: JamServe.TrackTag): Promise<void> {\n\t\treturn Promise.reject(Error('not implemented'));\n\t\t/*\n\t\t // logger.verbose('Writing Tag', filename);\n\t\t let dest = filename + '.temp.mp3';\n\t\t fs.copyFile(filename, dest, (err) => {\n\t\t\tif (err) {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\tlet frames = [];\n\t\t\tObject.keys(tag).forEach(key => {\n\t\t\t\tif (simpleMapReverse[key]) {\n\t\t\t\t\tframes.push({id: simpleMapReverse[key], text: tag[key]});\n\t\t\t\t} else if (key.indexOf('T:') === 0) {\n\t\t\t\t\tframes.push({id: 'TXXX', description: key.slice(2), text: tag[key]});\n\t\t\t\t}\n\t\t\t});\n\t\t\ttagio.write({\n\t\t\t\tpath: dest,\n\t\t\t\tconfiguration: {\n\t\t\t\t\tconfigurationReadable: true,\n\t\t\t\t\taudioPropertiesReadable: true,\n\t\t\t\t\tid3v1Readable: true,\n\t\t\t\t\tid3v1Writable: true,\n\t\t\t\t\tid3v1Encoding: tagio.Encoding.UTF8,\n\t\t\t\t\tid3v2Readable: true,\n\t\t\t\t\tid3v2Writable: true,\n\t\t\t\t\tapeReadable: false,\n\t\t\t\t\tapeWritable: false\n\t\t\t\t},\n\t\t\t\tid3v1: {\n\t\t\t\t\t'title': tag.title || '',\n\t\t\t\t\t'album': tag.album || '',\n\t\t\t\t\t'artist': tag.artist || '',\n\t\t\t\t\t'track': parseInt(tag.track, 10),\n\t\t\t\t\t'year': parseInt(tag.year || tag.date || 0, 10),\n\t\t\t\t\t'genre': tag.genre || '',\n\t\t\t\t\t'comment': ''\n\t\t\t\t},\n\t\t\t\tid3v2: frames\n\t\t\t}).then((res) => {\n\t\t\t\tcb(null, res);\n\t\t\t}).catch((err) => {\n\t\t\t\tcb(err);\n\t\t\t});\n\t\t});\n\t\t **/\n\t}\n\n\tasync saveID3v2(filename: string, tag: Jam.ID3Tag): Promise<void> {\n\t\tconst exists = await fileExists(filename + '.bak.org');\n\t\tif (exists) {\n\t\t\tawait fileCopy(filename, filename + '.bak.org');\n\t\t}\n\t\tconst frames: Array<IID3V2.Frame> = [];\n\t\tObject.keys(tag.frames).map(id => {\n\t\t\tconst f = tag.frames[id] || [];\n\t\t\tf.forEach(value => {\n\t\t\t\tframes.push({id, head: {statusFlags: {}, formatFlags: {}, size: 0}, value});\n\t\t\t});\n\t\t\treturn;\n\t\t});\n\t\tconst t: IID3V2.Tag = {\n\t\t\tid: 'ID3v2',\n\t\t\thead: {\n\t\t\t\tver: tag.version,\n\t\t\t\trev: 0,\n\t\t\t\tsize: 0,\n\t\t\t\tvalid: true\n\t\t\t},\n\t\t\tstart: 0,\n\t\t\tend: 0,\n\t\t\tframes\n\t\t};\n\t\tconst id3v2 = new ID3v2();\n\t\tawait id3v2.write(filename, t, tag.version, 0);\n\t}\n\n\tasync readID3v2(filename: string): Promise<Jam.ID3Tag> {\n\t\tconst id3v2 = new ID3v2();\n\t\tconst id3v2tag = await id3v2.read(filename);\n\t\tif (!id3v2tag) {\n\t\t\treturn Promise.reject(Error('No ID3v2 Tag found'));\n\t\t}\n\t\tconst tag: Jam.ID3Tag = {\n\t\t\tversion: id3v2tag.head.ver,\n\t\t\tframes: {}\n\t\t};\n\t\tid3v2tag.frames.forEach(frame => {\n\t\t\tconst f = tag.frames[frame.id] || [];\n\t\t\tif (frame.value && frame.value.hasOwnProperty('bin')) {\n\t\t\t\tconst binValue = <any>frame.value;\n\t\t\t\tbinValue.bin = binValue.bin.toString('base64');\n\t\t\t}\n\t\t\tf.push(frame.value);\n\t\t\ttag.frames[frame.id] = f;\n\t\t});\n\t\treturn tag;\n\t}\n\n\tasync readID3v2Image(filename: string, type: number): Promise<{ buffer?: Buffer, mimeType?: string }> {\n\t\tconst id3v2 = new ID3v2();\n\t\tconst tag = await id3v2.read(filename);\n\t\tif (!tag) {\n\t\t\treturn {};\n\t\t}\n\t\tconst frame = tag.frames.find(f => {\n\t\t\tif (['APIC', 'PIC'].indexOf(f.id) >= 0) {\n\t\t\t\treturn (<IID3V2.FrameValue.Pic>f.value).pictureType === type;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\tif (!frame) {\n\t\t\treturn {};\n\t\t}\n\t\treturn {buffer: (<IID3V2.FrameValue.Pic>frame.value).bin, mimeType: (<IID3V2.FrameValue.Pic>frame.value).mimeType};\n\t}\n\n\tasync mediaInfoArtistInfo(artistName: string): Promise<JamServe.MetaInfoArtist | undefined> {\n\t\tconst data = await this.lastFM.artist(artistName);\n\t\treturn FORMAT.packMediaInfoArtist(data);\n\t}\n\n\tasync mediaInfoArtistInfoByArtistID(artistID: string): Promise<JamServe.MetaInfoArtist | undefined> {\n\t\tconst data = await this.lastFM.artistID(artistID);\n\t\treturn FORMAT.packMediaInfoArtist(data);\n\t}\n\n\tasync mediaInfoAlbumInfo(albumName: string, artistName: string): Promise<JamServe.MetaInfoAlbum | undefined> {\n\t\tconst data = await this.lastFM.album(albumName, artistName);\n\t\tconst result = FORMAT.packMediaInfoAlbum(data);\n\t\tif (result && result.mbid) {\n\t\t\tconst mb = await this.musicbrainz.lookup({id: result.mbid, type: 'release', inc: 'labels'});\n\t\t\tresult.releases = mb.releases;\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync mediaInfoAlbumInfoByAlbumID(albumID: string): Promise<JamServe.MetaInfoAlbum | undefined> {\n\t\tconst data = await this.lastFM.albumID(albumID);\n\t\tconst result = FORMAT.packMediaInfoAlbum(data);\n\t\tif (result) {\n\t\t\tconst mb = await this.musicbrainz.lookup({id: albumID, type: 'release', inc: 'labels'});\n\t\t\tresult.releases = mb.releases;\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync mediaInfoSimilarTrack(title: string, artist: string): Promise<Array<JamServe.MetaInfoTrackSimilarSong>> {\n\t\tconst data = await this.lastFM.similarTrack(title, artist);\n\t\treturn FORMAT.packMediaInfoSimilarSong(data);\n\t}\n\n\tasync mediaInfoSimilarTrackByMBTrackID(trackID: string): Promise<Array<JamServe.MetaInfoTrackSimilarSong>> {\n\t\tconst data = await this.lastFM.similarTrackID(trackID);\n\t\treturn FORMAT.packMediaInfoSimilarSong(data);\n\t}\n\n\tasync mediaInfoTopSongs(artistName: string): Promise<Array<JamServe.MetaInfoTopSong>> {\n\t\t// TODO: get more than 50\n\t\tconst data = await this.lastFM.topArtistSongs(artistName);\n\t\treturn FORMAT.packMediaInfoTopSongs(data);\n\t}\n\n\tasync mediaInfoTopSongsByArtistID(artistID: string): Promise<Array<JamServe.MetaInfoTopSong>> {\n\t\t// TODO: get more than 50\n\t\tconst data = await this.lastFM.topArtistSongsID(artistID);\n\t\treturn FORMAT.packMediaInfoTopSongs(data);\n\t}\n\n\tasync acoustidLookup(filename: string, includes: string | undefined): Promise<Array<Acoustid.Result>> {\n\t\treturn this.acoustid.acoustid(filename, includes);\n\t}\n\n\tasync musicbrainzSearch(type: string, query: MusicbrainzClientApi.SearchQuery): Promise<MusicBrainz.Response> {\n\t\treturn this.musicbrainz.search({type: type, query});\n\t}\n\n\tasync musicbrainzLookup(type: string, id: string, inc: string | undefined): Promise<MusicBrainz.Response> {\n\t\treturn this.musicbrainz.lookup({type: type, id, inc});\n\t}\n\n\tasync musicbrainzAlbumByFolder(folder: JamServe.Folder): Promise<MusicBrainz.Response> {\n\t\tconst query: MusicbrainzClientApi.SearchQueryRelease = {\n\t\t\tarid: folder.tag.mbArtistID,\n\t\t\tartist: folder.tag.artist,\n\t\t\trelease: folder.tag.album || folder.tag.title\n\t\t};\n\t\treturn this.musicbrainz.search({type: 'release', query});\n\t}\n\n\tasync lastFMLookup(type: string, id: string): Promise<LastFM.Result> {\n\t\t// TODO: get more than 50\n\t\treturn this.lastFM.lookup(type, id);\n\t}\n\n\tasync getLyrics(artist: string, song: string): Promise<ChartLyricsResult | undefined> {\n\t\treturn this.chartLyrics.search(artist, song);\n\t}\n\n\n}\n","module.exports = require(\"jamp3\");","import {WebserviceXMLClient} from '../../utils/webservice-xml-client';\n\nexport interface ChartLyricsResult {\n\tid: string;\n\ttrackId: string;\n\tchecksum: string;\n\tsong: string;\n\tartist: string;\n\turl: string;\n\tcovertArtUrl: string;\n\trank: string;\n\tcorrectUrl: string;\n\tlyric: string;\n}\n\nexport class ChartLyricsClient extends WebserviceXMLClient {\n\n\tconstructor(userAgent: string) {\n\t\tsuper(1, 1000, userAgent);\n\t}\n\n\tasync search(artistName: string, songName: string): Promise<ChartLyricsResult | undefined> {\n\t\tconst opts = {\n\t\t\tartist: artistName,\n\t\t\tsong: songName\n\t\t};\n\t\tconst data = await this.getJson<any>('http://api.chartlyrics.com/apiv1.asmx/SearchLyricDirect', opts);\n\t\tif (!data || !data.GetLyricResult) {\n\t\t\treturn;\n\t\t}\n\t\tconst o = data.GetLyricResult;\n\t\tconst result: ChartLyricsResult = {\n\t\t\tid: (o ? o.LyricId[0] : '') || '',\n\t\t\ttrackId: (o ? o.TrackId[0] : '') || '',\n\t\t\tchecksum: (o ? o.LyricChecksum[0] : '') || '',\n\t\t\tsong: (o ? o.LyricSong[0] : '') || '',\n\t\t\tartist: (o ? o.LyricArtist[0] : '') || '',\n\t\t\turl: (o ? o.LyricUrl[0] : '') || '',\n\t\t\tcovertArtUrl: (o ? o.LyricCovertArtUrl[0] : '') || '',\n\t\t\trank: (o ? o.LyricRank[0] : '') || '',\n\t\t\tcorrectUrl: (o ? o.LyricCorrectUrl[0] : '') || '',\n\t\t\tlyric: (o ? o.Lyric[0] : '') || ''\n\t\t};\n\t\treturn result;\n\t}\n}\n","import rateLimiter from 'limiter';\nimport request from 'request';\nimport xml2js from 'xml2js';\n\nexport class WebserviceXMLClient {\n\tprivate limiter: rateLimiter.RateLimiter;\n\tprivate userAgent: string;\n\n\tconstructor(requestPerInterval: number, requestIntervalMS: number, userAgent: string) {\n\t\tthis.limiter = new rateLimiter.RateLimiter(requestPerInterval, requestIntervalMS);\n\t\tthis.userAgent = userAgent;\n\t}\n\n\tprotected async getJson<T>(url: string, parameters: object | undefined): Promise<T> {\n\t\tconst options: request.Options = {\n\t\t\turl,\n\t\t\theaders: {'User-Agent': this.userAgent},\n\t\t\tqs: parameters\n\t\t};\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tthis.limiter.removeTokens(1, () => {\n\t\t\t\trequest(options, (err, response, body) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn reject(err);\n\t\t\t\t\t}\n\t\t\t\t\txml2js.parseString(body, (err2, result) => {\n\t\t\t\t\t\tif (err2) {\n\t\t\t\t\t\t\treturn reject(err2);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(<T>result);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t});\n\t}\n\n}\n","module.exports = require(\"xml2js\");","import {fpcalc, FPCalcOptions, FPCalcResult} from '../tools/fpcalc';\nimport {WebserviceClient} from '../../utils/webservice-client';\nimport {Acoustid} from '../../model/acoustid-rest-data-2.0';\nimport Logger from '../../utils/logger';\n\nconst log = Logger('Acoustid');\n\n// const ALL_META_DEFAULT = 'recordings recordingids releases releaseids releasegroups releasegroupids tracks compress usermeta sources';\n\nconst META_DEFAULT = 'recordings releases releasegroups tracks compress usermeta sources';\n\ndeclare namespace AcoustidClient {\n\n\texport interface AcoustidClientOptions {\n\t\tkey: string;\n\t\tuserAgent: string;\n\t\tmeta?: string;\n\t\tfpcalc?: FPCalcOptions;\n\t}\n\n}\n\nexport class AcoustidClient extends WebserviceClient {\n\toptions: AcoustidClient.AcoustidClientOptions;\n\n\tconstructor(options: AcoustidClient.AcoustidClientOptions) {\n\t\t// \"not more than 3 per second\" https://acoustid.org/webservice\n\t\tsuper(3, 1000, options.userAgent);\n\t\tthis.options = options;\n\t}\n\n\tprivate async get(fp: FPCalcResult, includes: string | undefined,): Promise<Array<Acoustid.Result>> {\n\t\tincludes = includes || this.options.meta || META_DEFAULT;\n\t\tlog.info('requesting by fingerprint', includes);\n\t\tconst data = await this.getJson<Acoustid.Results>('http://api.acoustid.org/v2/lookup', {\n\t\t\tformat: 'json',\n\t\t\tmeta: includes,\n\t\t\tclient: this.options.key,\n\t\t\tduration: fp.duration.toFixed(0),\n\t\t\tfingerprint: fp.fingerprint\n\t\t});\n\t\tif (data.status !== 'ok') {\n\t\t\treturn Promise.reject(Error(data.status));\n\t\t}\n\t\treturn data.results;\n\t}\n\n\tasync acoustid(file: string, includes: string | undefined): Promise<Array<Acoustid.Result>> {\n\t\ttry {\n\t\t\tconst result = await fpcalc(file, this.options.fpcalc || {});\n\t\t\treturn this.get(result, includes);\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\treturn [];\n\t\t}\n\t}\n}\n","import {spawnToolJson} from '../../utils/tool';\n\nexport interface FPCalcOptions {\n\tlength?: number;\n\traw?: boolean;\n}\n\nexport interface FPCalcResult {\n\tduration: number;\n\tfingerprint: string;\n\tfingerprintRaw?: Buffer;\n}\n\nexport async function fpcalc(filename: string, options: FPCalcOptions): Promise<FPCalcResult> {\n\tconst cmds: Array<string> = ['-json'];\n\tif (options.length) {\n\t\tcmds.push('-length', options.length.toFixed(0));\n\t}\n\tif (options.raw) {\n\t\tcmds.push('-raw');\n\t}\n\treturn await spawnToolJson<FPCalcResult>('fpcalc', 'FPCALC_PATH', [...cmds, filename]);\n}\n","import fs from 'fs';\nimport path from 'path';\nimport {NodeDataCallback} from '../typings';\nimport {fileExists} from './fs-utils';\n\nconst isWindows = process && (process.platform === 'win32' || /^(msys|cygwin)$/.test(process.env.OSTYPE || ''));\n\nconst cache: { [name: string]: string; } = {};\n\nconst COLON = isWindows ? ';' : ':';\n\nfunction getPathInfo(cmd: string, opt: any) {\n\tconst colon = opt.colon || COLON;\n\tlet pathEnv = opt.path || process.env.PATH || '';\n\tlet pathExt = [''];\n\n\tpathEnv = pathEnv.split(colon);\n\n\tlet pathExtExe = '';\n\tif (isWindows) {\n\t\tpathEnv.unshift(process.cwd());\n\t\tpathExtExe = (opt.pathExt || process.env.PATHEXT || '.EXE;.CMD;.BAT;.COM');\n\t\tpathExt = pathExtExe.split(colon);\n\n\n\t\t// Always test the cmd itself first.  isexe will check to make sure\n\t\t// it's found in the pathExt set.\n\t\tif (cmd.indexOf('.') !== -1 && pathExt[0] !== '') {\n\t\t\tpathExt.unshift('');\n\t\t}\n\t}\n\n\t// If it has a slash, then we don't bother searching the pathenv.\n\t// just check the file itself, and that's it.\n\tif (cmd.match(/\\//) || isWindows && cmd.match(/\\\\/)) {\n\t\tpathEnv = [''];\n\t}\n\n\treturn {\n\t\tenv: pathEnv,\n\t\text: pathExt,\n\t\textExe: pathExtExe\n\t};\n}\n\nfunction getNotFoundError(cmd: string): Error {\n\tconst er = new Error('not found: ' + cmd);\n\t(<any>er).code = 'ENOENT';\n\treturn er;\n}\n\nfunction checkWindowsMode(filename: string, options: { pathExt?: string }, stat: fs.Stats): boolean {\n\tif (!stat.isSymbolicLink() && !stat.isFile()) {\n\t\treturn false;\n\t}\n\tconst pathext = options.pathExt !== undefined ? options.pathExt : process.env.PATHEXT;\n\tif (!pathext) {\n\t\treturn true;\n\t}\n\tconst pathexts = pathext.split(';');\n\tif (pathexts.indexOf('') !== -1) {\n\t\treturn true;\n\t}\n\tfor (let i = 0; i < pathexts.length; i++) {\n\t\tconst p = pathexts[i].toLowerCase();\n\t\tif (p && filename.substr(-p.length).toLowerCase() === p) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nfunction checkMode(filename: string, options: { pathExt?: string }, stat: fs.Stats): boolean {\n\tconst mod = stat.mode;\n\tconst uid = stat.uid;\n\tconst gid = stat.gid;\n\tconst myUid = /*options.uid !== undefined ? options.uid :*/ process.getuid && process.getuid();\n\tconst myGid = /*options.gid !== undefined ? options.gid :*/ process.getgid && process.getgid();\n\tconst u = parseInt('100', 8);\n\tconst g = parseInt('010', 8);\n\tconst o = parseInt('001', 8);\n\tconst ug = u | g;\n\tconst ret = (mod & o) ||\n\t\t(mod & g) && gid === myGid ||\n\t\t(mod & u) && uid === myUid ||\n\t\t(mod & ug) && myUid === 0;\n\treturn !!ret;\n}\n\nfunction isexeStat(filename: string, options: { pathExt?: string }, stat: fs.Stats) {\n\tif (!stat.isFile()) {\n\t\treturn false;\n\t}\n\tif (!isWindows) {\n\t\treturn checkMode(filename, options, stat);\n\t} else {\n\t\treturn checkWindowsMode(filename, options, stat);\n\t}\n}\n\nfunction isexe(filename: string, options: { pathExt?: string }, cb: NodeDataCallback<boolean>) {\n\tfs.stat(filename, (err, stat) => {\n\t\tcb(err, err ? false : isexeStat(filename, options, stat));\n\t});\n}\n\nexport function whichs(cmd: string, cb: (error: Error | null, result?: Array<string>) => void) {\n\tconst opt: { all?: boolean } = {};\n\tconst info = getPathInfo(cmd, opt);\n\tconst pathEnv = info.env;\n\tconst pathExt = info.ext;\n\tconst pathExtExe = info.extExe;\n\tconst found: Array<string> = [];\n\n\t(function F(i, l) {\n\t\tif (i === l) {\n\t\t\tif (opt.all && found.length) {\n\t\t\t\treturn cb(null, found);\n\t\t\t} else {\n\t\t\t\treturn cb(getNotFoundError(cmd));\n\t\t\t}\n\t\t}\n\n\t\tlet pathPart = pathEnv[i];\n\t\tif (pathPart.charAt(0) === '\"' && pathPart.slice(-1) === '\"') {\n\t\t\tpathPart = pathPart.slice(1, -1);\n\t\t}\n\n\t\tlet p = path.join(pathPart, cmd);\n\t\tif (!pathPart && (/^\\.[\\\\\\/]/).test(cmd)) {\n\t\t\tp = cmd.slice(0, 2) + p;\n\t\t}\n\t\t(function E(ii, ll) {\n\t\t\tif (ii === ll) {\n\t\t\t\treturn F(i + 1, l);\n\t\t\t}\n\t\t\tconst ext = pathExt[ii];\n\t\t\tisexe(p + ext, {pathExt: pathExtExe}, (err, is) => {\n\t\t\t\tif (!err && is) {\n\t\t\t\t\tif (opt.all) {\n\t\t\t\t\t\tfound.push(p + ext);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn cb(null, [p + ext]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn E(ii + 1, ll);\n\t\t\t});\n\t\t})(0, pathExt.length);\n\t})(0, pathEnv.length);\n}\n\nasync function which(name: string): Promise<string | undefined> {\n\treturn new Promise<string | undefined>((resolve, reject) => {\n\t\twhichs(name, (err, result) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else if (result && result.length > 0) {\n\t\t\t\tresolve(result[0]);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\nasync function localBin(name: string): Promise<string | undefined> {\n\tconst s = path.join('.', 'bin', 'tools', name, process.platform, process.arch, name) + (isWindows ? '.exe' : '');\n\tconst exists = await fileExists(s);\n\tif (exists) {\n\t\treturn s;\n\t}\n}\n\nasync function enviroment(envName: string): Promise<string | undefined> {\n\tconst s = process.env[envName];\n\tif (s && s.length > 0) {\n\t\tconst exists = await fileExists(s);\n\t\tif (exists) {\n\t\t\treturn s;\n\t\t}\n\t}\n}\n\nexport async function getBinPath(name: string, envName: string): Promise<string | undefined> {\n\tif (name in cache) {\n\t\treturn cache[name];\n\t}\n\ttry {\n\t\t// Try envName\n\t\tconst s = await enviroment(envName);\n\t\tif (s && s.length > 0) {\n\t\t\tcache[name] = s;\n\t\t\treturn s;\n\t\t}\n\t} catch (e) {\n\t}\n\ttry {\n\t\t// Search in the PATH\n\t\tconst s = await which(name);\n\t\tif (s && s.length > 0) {\n\t\t\tcache[name] = s;\n\t\t\treturn s;\n\t\t}\n\t} catch (e) {\n\t}\n\ttry {\n\t\t// Search in the PATH\n\t\tconst s = await localBin(name);\n\t\tif (s && s.length > 0) {\n\t\t\tcache[name] = s;\n\t\t\treturn s;\n\t\t}\n\t} catch (e) {\n\t}\n}\n","module.exports = require(\"child_process\");","import {WebserviceClient} from '../../utils/webservice-client';\nimport {LastFM} from '../../model/lastfm-rest-data-2.0';\nimport Logger from '../../utils/logger';\nimport {LastFMClientApi} from './lastfm-client.interface';\n\nconst log = Logger('LastFM');\n\nexport class LastFMClient extends WebserviceClient {\n\toptions: LastFMClientApi.LastFMClientApiOptions;\n\n\tconstructor(options: LastFMClientApi.LastFMClientApiOptions) {\n\t\t// \"not make more than 5 requests per originating IP address per second\" https://www.last.fm/api/tos\n\t\tsuper(5, 1000, options.userAgent);\n\t\tthis.options = options;\n\t}\n\n\tprivate beautify(obj: any): any {\n\n\t\tconst walk = (o: any, parent: any): any => {\n\t\t\tif (o === null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (o === undefined) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (Array.isArray(o)) {\n\t\t\t\treturn o.map((sub: any) => walk(sub, parent)).filter((sub: any) => sub !== undefined);\n\t\t\t}\n\t\t\tif (typeof o === 'object') {\n\t\t\t\tconst result: any = {};\n\t\t\t\tObject.keys(o).forEach(key => {\n\t\t\t\t\tconst sub = walk(o[key], o);\n\t\t\t\t\tif (sub !== undefined) {\n\t\t\t\t\t\tif (key === '#text') {\n\t\t\t\t\t\t\tresult['url'] = sub;\n\t\t\t\t\t\t} else if (key === '@attr') {\n\t\t\t\t\t\t\tObject.keys(sub).forEach(subkey => {\n\t\t\t\t\t\t\t\tresult[subkey] = sub[subkey];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (key === 'tags') {\n\t\t\t\t\t\t\tif (sub.tag) {\n\t\t\t\t\t\t\t\tif (!Array.isArray(sub.tag)) {\n\t\t\t\t\t\t\t\t\tsub.tag = [sub.tag];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresult[key] = sub.tag;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult[key] = sub;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (key === 'tracks') {\n\t\t\t\t\t\t\tif (sub.track) {\n\t\t\t\t\t\t\t\tif (!Array.isArray(sub.track)) {\n\t\t\t\t\t\t\t\t\tsub.track = [sub.track];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresult[key] = sub.track;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult[key] = sub;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (key === 'links') {\n\t\t\t\t\t\t\tif (sub.link) {\n\t\t\t\t\t\t\t\tif (!Array.isArray(sub.link)) {\n\t\t\t\t\t\t\t\t\tsub.link = [sub.link];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresult[key] = sub.link;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult[key] = sub;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult[key] = sub;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\treturn o;\n\t\t};\n\t\treturn walk(obj, {});\n\t}\n\n\tprivate async get(api: string, params: { [name: string]: string; }): Promise<LastFM.Result> {\n\t\tlog.info('requesting', api, JSON.stringify(params));\n\t\tparams['method'] = api;\n\t\tconst sorted_params: { [name: string]: string; } = {'method': api};\n\t\tObject.keys(params).forEach(key => {\n\t\t\tsorted_params[key] = params[key];\n\t\t});\n\t\tsorted_params['api_key'] = this.options.key;\n\t\tsorted_params['format'] = 'json';\n\t\tconst data = await this.getJson('http://ws.audioscrobbler.com/2.0/', sorted_params);\n\t\treturn <LastFM.Result>this.beautify(data);\n\t}\n\n\tasync artist(artist: string): Promise<LastFM.Artist | undefined> {\n\t\t// https://www.last.fm/api/show/artist.getInfo\n\t\tconst data = await this.get('artist.getInfo', {artist});\n\t\treturn data.artist;\n\t}\n\n\tasync trackID(mbid: string): Promise<LastFM.Track | undefined> {\n\t\t// https://www.last.fm/api/show/artist.getInfo\n\t\tconst data = await this.get('artist.getInfo', {mbid});\n\t\treturn data.track;\n\t}\n\n\tasync artistID(mbid: string): Promise<LastFM.Artist | undefined> {\n\t\t// https://www.last.fm/api/show/artist.getInfo\n\t\tconst data = await this.get('artist.getInfo', {mbid});\n\t\treturn data.artist;\n\t}\n\n\tasync album(album: string, artist: string): Promise<LastFM.Album | undefined> {\n\t\t// https://www.last.fm/api/show/album.getInfo\n\t\tconst data = await this.get('album.getInfo', {artist, album});\n\t\treturn data.album;\n\t}\n\n\tasync albumID(mbid: string): Promise<LastFM.Album | undefined> {\n\t\t// https://www.last.fm/api/show/album.getInfo\n\t\tconst data = await this.get('album.getInfo', {mbid});\n\t\treturn data.album;\n\t}\n\n\tasync albumIDTopTags(mbid: string): Promise<LastFM.TopTracks | undefined> {\n\t\t// https://www.last.fm/api/show/album.getTopTags\n\t\tconst data = await this.get('album.getTopTags', {mbid});\n\t\treturn data.toptracks;\n\t}\n\n\tasync similarTrack(track: string, artist: string): Promise<LastFM.SimilarTracks | undefined> {\n\t\t// https://www.last.fm/api/show/track.getSimilar\n\t\tconst data = await this.get('track.getSimilar', {track, artist});\n\t\treturn data.similartracks;\n\t}\n\n\tasync similarTrackID(mbid: string): Promise<LastFM.SimilarTracks | undefined> {\n\t\t// https://www.last.fm/api/show/track.getSimilar\n\t\tconst data = await this.get('track.getSimilar', {mbid});\n\t\treturn data.similartracks;\n\t}\n\n\tasync topArtistSongs(artist: string): Promise<LastFM.TopTracks | undefined> {\n\t\t// https://www.last.fm/api/show/artist.getTopTracks\n\t\tconst data = await this.get('artist.getTopTracks', {artist});\n\t\treturn data.toptracks;\n\t}\n\n\tasync topArtistSongsID(mbid: string): Promise<LastFM.TopTracks | undefined> {\n\t\t// https://www.last.fm/api/show/artist.getTopTracks\n\t\tconst data = await this.get('artist.getTopTracks', {mbid});\n\t\treturn data.toptracks;\n\t}\n\n\tasync lookup(type: string, id: string): Promise<LastFM.Result> {\n\t\tif (type === 'album') {\n\t\t\tconst album = await this.albumID(id);\n\t\t\treturn {album};\n\t\t} else if (type === 'album-toptracks') {\n\t\t\tconst toptracks = await this.albumIDTopTags(id);\n\t\t\treturn {toptracks};\n\t\t} else if (type === 'artist') {\n\t\t\tconst artist = await this.artistID(id);\n\t\t\treturn {artist};\n\t\t} else if (type === 'track') {\n\t\t\tconst track = await this.trackID(id);\n\t\t\treturn {track};\n\t\t} else if (type === 'track-similar') {\n\t\t\tconst similartracks = await this.similarTrackID(id);\n\t\t\treturn {similartracks};\n\t\t} else if (type === 'artist-toptracks') {\n\t\t\tconst toptracks = await this.topArtistSongsID(id);\n\t\t\treturn {toptracks};\n\t\t} else {\n\t\t\treturn Promise.reject(Error('Invalid LastFM lookup type parameter'));\n\t\t}\n\t}\n\n}\n","import {WebserviceClient} from '../../utils/webservice-client';\nimport {LookupBrowseTypes, LookupIncludes} from './musicbrainz-client.types';\nimport {MusicBrainz} from '../../model/musicbrainz-rest-data-2.0';\nimport Logger from '../../utils/logger';\nimport {MusicbrainzClientApi} from './musicbrainz-client.interface';\n\nconst log = Logger('Musicbrainz');\n\nexport class MusicbrainzClient extends WebserviceClient {\n\toptions = {\n\t\thost: 'http://musicbrainz.org',\n\t\tport: 80,\n\t\tbasePath: '/ws/2/',\n\t\tuserAgent: '',\n\t\tlimit: 25,\n\t\tretryOn: false,\n\t\tretryDelay: 3000,\n\t\tretryCount: 3\n\t};\n\n\tconstructor(options: MusicbrainzClientApi.Options) {\n\t\t// https://musicbrainz.org/doc/XML_Web_Service/Rate_Limiting \"Currently that rate is (on average) 1 request per second. (per ip)\"\n\t\tsuper(1, 1000, options.userAgent);\n\t\tthis.options = Object.assign({}, this.options, options);\n\t}\n\n\tprivate beautify(obj: any): any {\n\t\tconst formatKey = (key: string): string => {\n\t\t\treturn key.split('-').map((value, index) => {\n\t\t\t\tif (index === 0) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\treturn value[0].toUpperCase() + value.slice(1);\n\t\t\t}).join('');\n\t\t};\n\n\t\tconst walk = (o: any): any => {\n\t\t\tif (o === null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (o === undefined) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (Array.isArray(o)) {\n\t\t\t\treturn o.map((sub: any) => walk(sub)).filter((sub: any) => sub !== undefined);\n\t\t\t}\n\t\t\tif (typeof o === 'object') {\n\t\t\t\tconst result: any = {};\n\t\t\t\tObject.keys(o).forEach(key => {\n\t\t\t\t\tconst sub = walk(o[key]);\n\t\t\t\t\tif (sub !== undefined) {\n\t\t\t\t\t\tresult[formatKey(key)] = sub;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\treturn o;\n\t\t};\n\t\treturn walk(obj);\n\t}\n\n\tprivate concatSearchQuery(query: MusicbrainzClientApi.SearchQuery): string {\n\t\treturn Object.keys(query)\n\t\t\t.filter(key => ((<any>query)[key] !== undefined && (<any>query)[key] !== null))\n\t\t\t.map(key => key + ':\"' + encodeURIComponent((<any>query)[key]) + '\"')\n\t\t\t.join('%20AND%20');\n\t}\n\n\tprivate async get(req: MusicbrainzClientApi.Request): Promise<any> {\n\t\tconst q = Object.keys(req.query)\n\t\t\t.filter(key => (req.query[key] !== undefined && req.query[key] !== null))\n\t\t\t.map(key => key + '=' + req.query[key]);\n\t\tq.push('limit=' + (req.limit || this.options.limit || 25));\n\t\tq.push('offset=' + (req.offset || 0));\n\t\tq.push('fmt=json');\n\t\tconst url = this.options.host + (this.options.port !== 80 ? ':' + this.options.port : '') + req.path + '?' + q.join('&');\n\n\t\tconst isRateLimitError = (body: any): boolean => {\n\t\t\treturn (body && body.error && body.error.indexOf('allowable rate limit') >= 0);\n\t\t\t// \"error\":\"Your requests are exceeding the allowable rate limit. Please see http://wiki.musicbrainz.org/XMLWebService for more information.\"\n\t\t};\n\t\tconst options = this.options;\n\t\tconst get = this.get;\n\n\t\tasync function retry(error: Error): Promise<any> {\n\t\t\tif (options.retryOn && req.retry < options.retryCount) {\n\t\t\t\treq.retry++;\n\t\t\t\tlog.info('rate limit hit, retrying in ' + options.retryDelay + 'ms');\n\t\t\t\treturn new Promise<any>((resolve, reject) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tget(req).then(resolve).catch(reject);\n\t\t\t\t\t}, options.retryDelay);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn Promise.reject(error);\n\t\t\t}\n\t\t}\n\n\t\tlog.info('requesting', JSON.stringify(req));\n\t\ttry {\n\t\t\tconst data = await this.getJson<any>(url, undefined);\n\t\t\tif (isRateLimitError(data)) {\n\t\t\t\treturn retry(Error(data.error));\n\t\t\t}\n\t\t\treturn data;\n\t\t} catch (e) {\n\t\t\tconst statusCode = e.statusCode;\n\t\t\tif (statusCode === 502 || statusCode === 503) {\n\t\t\t\treturn retry(e);\n\t\t\t} else {\n\t\t\t\treturn Promise.reject(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync search(params: MusicbrainzClientApi.ParameterSearch): Promise<MusicBrainz.Response> {\n\t\tconst data = await this.get({\n\t\t\tpath: this.options.basePath + params.type + '/',\n\t\t\tquery: {query: this.concatSearchQuery(params.query || {})},\n\t\t\tretry: 0,\n\t\t\tlimit: params.limit,\n\t\t\toffset: params.offset\n\t\t});\n\t\treturn this.beautify(data);\n\t}\n\n\tasync luceneSearch(params: MusicbrainzClientApi.ParameterLuceneSearch): Promise<MusicBrainz.Response> {\n\t\t// https://lucene.apache.org/core/4_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description\n\t\tif (!params.query || params.query.length === 0) {\n\t\t\treturn Promise.reject(Error('Invalid query for type ' + params.type));\n\t\t}\n\t\tconst data = await this.get({\n\t\t\tpath: this.options.basePath + params.type + '/',\n\t\t\tquery: {\n\t\t\t\tquery: encodeURIComponent(params.query || '')\n\t\t\t},\n\t\t\tretry: 0,\n\t\t\tlimit: params.limit,\n\t\t\toffset: params.offset\n\t\t});\n\t\tconst result: any = {};\n\t\tresult[params.type] = data || {};\n\t\treturn this.beautify(result);\n\t}\n\n\tasync lookup(params: MusicbrainzClientApi.ParameterLookup): Promise<MusicBrainz.Response> {\n\t\tif (!params.id || params.id.length === 0) {\n\t\t\treturn Promise.reject(Error('Invalid lookup id for type ' + params.type));\n\t\t}\n\t\tconst lookup = LookupIncludes[params.type];\n\t\tconst inc = params.inc || LookupIncludes[params.type].join('+');\n\t\tif (!lookup) {\n\t\t\treturn Promise.reject(Error('Invalid Lookup'));\n\t\t}\n\t\tconst data = await this.get({\n\t\t\tpath: this.options.basePath + params.type + '/' + params.id,\n\t\t\tquery: {\n\t\t\t\tmbid: params.id,\n\t\t\t\tinc: inc\n\t\t\t},\n\t\t\tretry: 0,\n\t\t\tlimit: params.limit,\n\t\t\toffset: params.offset\n\t\t});\n\t\tconst result: any = {};\n\t\tresult[params.type] = data || {};\n\t\treturn this.beautify(result);\n\t}\n\n\tasync browse(params: MusicbrainzClientApi.ParameterBrowse): Promise<MusicBrainz.Response> {\n\t\tconst invalidKey = Object.keys(params.lookupIds).find(key => !LookupBrowseTypes[params.type] || LookupBrowseTypes[params.type].indexOf(key) < 0);\n\t\tif (invalidKey) {\n\t\t\treturn Promise.reject(Error('Invalid browse lookup key for type ' + params.type + ': ' + invalidKey));\n\t\t}\n\t\tconst query = Object.assign({inc: params.inc}, params.lookupIds);\n\t\tconst data = await this.get({\n\t\t\tpath: this.options.basePath + params.type,\n\t\t\tquery,\n\t\t\tretry: 0,\n\t\t\tlimit: params.limit,\n\t\t\toffset: params.offset\n\t\t});\n\t\tconst result: any = {};\n\t\tresult[params.type] = data || {};\n\t\treturn this.beautify(result);\n\t}\n\n}\n","export const LookupBrowseTypes: { [type: string]: Array<string> } = {\n\tarea: ['collection'],\n\tartist: ['area', 'collection', 'recording', 'release', 'release-group', 'work'],\n\tcollection: ['area', 'artist', 'editor', 'event', 'label', 'place', 'recording', 'release', 'release-group', 'work'],\n\tevent: ['area', 'artist', 'collection', 'place'],\n\tinstrument: ['collection'],\n\tlabel: ['area', 'collection', 'release'],\n\tplace: ['area', 'collection'],\n\trecording: ['artist', 'collection', 'release'],\n\trelease: ['area', 'artist', 'collection', 'label', 'track', 'track_artist', 'recording', 'release-group'],\n\t'release-group': ['artist', 'collection', 'release'],\n\tseries: ['collection'],\n\twork: ['artist', 'collection'],\n\turl: ['resource']\n};\n\nexport const LookupIncludes: { [type: string]: Array<string> } = {\n\tarea: [],\n\tartist: ['recordings', 'releases', 'release-groups', 'works', 'aliases'],\n\tcollection: ['user-collections'],\n\tevent: [],\n\tinstrument: [],\n\tlabel: ['releases'],\n\tplace: [],\n\trecording: ['artists', 'releases', 'artist-credits', 'aliases', 'tags', 'ratings', 'annotation'],\n\trelease: ['artists', 'collections', 'labels', 'recordings', 'release-groups', 'discids', 'media', 'isrcs', 'artist-credits', 'aliases', 'tags', 'annotation'],\n\t'release-group': ['artists', 'releases', 'media', 'artist-credits', 'aliases', 'tags', 'ratings', 'annotation'],\n\tseries: [],\n\twork: [],\n\turl: []\n};\n\nexport const enum LookupEntity {\n\tarea = 'area',\n\tartist = 'artist',\n\tcollection = 'collection',\n\tevent = 'event',\n\tinstrument = 'instrument',\n\tlabel = 'label',\n\tplace = 'place',\n\trecording = 'recording',\n\trelease = 'release',\n\treleaseGroup = 'release-group',\n\tseries = 'series',\n\twork = 'work',\n\turl = 'url'\n}\n","let GenresSlugs: { [slug: string]: string }; // will be build on first use\n\nconst genreByNumbers = [\n\t'Blues',\n\t'Classic Rock',\n\t'Country',\n\t'Dance',\n\t'Disco',\n\t'Funk',\n\t'Grunge',\n\t'Hip Hop',\n\t'Jazz',\n\t'Metal',\n\t'New Age',\n\t'Oldies',\n\t'Other',\n\t'Pop',\n\t'R&B',\n\t'Rap',\n\t'Reggae',\n\t'Rock',\n\t'Techno',\n\t'Industrial',\n\t'Alternative',\n\t'Ska',\n\t'Death Metal',\n\t'Pranks',\n\t'Soundtrack',\n\t'Euro-Techno',\n\t'Ambient',\n\t'Trip-Hop',\n\t'Vocal',\n\t'Jazz+Funk',\n\t'Fusion',\n\t'Trance',\n\t'Classical',\n\t'Instrumental',\n\t'Acid',\n\t'House',\n\t'Game',\n\t'Sound Clip',\n\t'Gospel',\n\t'Noise',\n\t'Alternative Rock',\n\t'Bass',\n\t'Soul',\n\t'Punk',\n\t'Space',\n\t'Meditative',\n\t'Instrumental Pop',\n\t'Instrumental Rock',\n\t'Ethnic',\n\t'Gothic',\n\t'Darkwave',\n\t'Techno-Industrial',\n\t'Electronic',\n\t'Pop-Folk',\n\t'Eurodance',\n\t'Dream',\n\t'Southern Rock',\n\t'Comedy',\n\t'Cult',\n\t'Gangsta Rap',\n\t'Top 40',\n\t'Christian Rap',\n\t'Pop-Funk',\n\t'Jungle',\n\t'Native American',\n\t'Cabaret',\n\t'New Wave',\n\t'Psychedelic',\n\t'Rave',\n\t'Showtunes',\n\t'Trailer',\n\t'Lo-Fi',\n\t'Tribal',\n\t'Acid Punk',\n\t'Acid Jazz',\n\t'Polka',\n\t'Retro',\n\t'Musical',\n\t'Rock & Roll',\n\t'Hard Rock',\n\t'Folk',\n\t'Folk-Rock',\n\t'National Folk',\n\t'Swing',\n\t'Fast Fusion',\n\t'Bebop',\n\t'Latin',\n\t'Revival',\n\t'Celtic',\n\t'Bluegrass',\n\t'Avantgarde',\n\t'Gothic Rock',\n\t'Progressive Rock',\n\t'Psychedelic Rock',\n\t'Symphonic Rock',\n\t'Slow Rock',\n\t'Big Band',\n\t'Chorus',\n\t'Easy Listening',\n\t'Acoustic',\n\t'Humour',\n\t'Speech',\n\t'Chanson',\n\t'Opera',\n\t'Chamber Music',\n\t'Sonata',\n\t'Symphony',\n\t'Booty Bass',\n\t'Primus',\n\t'Porn Groove',\n\t'Satire',\n\t'Slow Jam',\n\t'Club',\n\t'Tango',\n\t'Samba',\n\t'Folklore',\n\t'Ballad',\n\t'Power Ballad',\n\t'Rhythmic Soul',\n\t'Freestyle',\n\t'Duet',\n\t'Punk Rock',\n\t'Drum Solo',\n\t'A Cappella',\n\t'Euro-House',\n\t'Dance Hall',\n\t'Goa',\n\t'Drum & Bass',\n\t'Club-House',\n\t'Hardcore',\n\t'Terror',\n\t'Indie',\n\t'BritPop',\n\t'Weltmusik',\n\t'Polsk Punk',\n\t'Beat',\n\t'Christian Gangsta Rap',\n\t'Heavy Metal',\n\t'Black Metal',\n\t'Crossover',\n\t'Contemporary Christian',\n\t'Christian Rock',\n\t'Merengue',\n\t'Salsa',\n\t'Thrash Metal',\n\t'Anime',\n\t'JPop',\n\t'Synthpop',\n\t'Abstract',\n\t'Art Rock',\n\t'Baroque',\n\t'Bhangra',\n\t'Big Beat',\n\t'Breakbeat',\n\t'Chillout',\n\t'Downtempo',\n\t'Dub',\n\t'EBM',\n\t'Eclectic',\n\t'Electro',\n\t'Electroclash',\n\t'Emo',\n\t'Experimental',\n\t'Garage',\n\t'Global',\n\t'IDM',\n\t'Illbient',\n\t'Industro-Goth',\n\t'Jam Band',\n\t'Krautrock',\n\t'Leftfield',\n\t'Lounge',\n\t'Math Rock',\n\t'New Romantic',\n\t'Nu-Breakz',\n\t'Post-Punk',\n\t'Post-Rock',\n\t'Psytrance',\n\t'Shoegaze',\n\t'Space Rock',\n\t'Trop Rock',\n\t'World Music',\n\t'Neoclassical',\n\t'Audiobook',\n\t'Audio Theatre',\n\t'Neue Deutsche Welle',\n\t'Podcast',\n\t'Indie Rock',\n\t'G-Funk',\n\t'Dubstep',\n\t'Garage Rock',\n\t'Psybient'];\n\nexport const Genres: Array<string> = [\n\t'2 Tone',\n\t'2-Step Garage',\n\t'4-Beat',\n\t'A Cappella',\n\t'Abstract',\n\t'Acid',\n\t'Acid Breaks',\n\t'Acid House',\n\t'Acid Jazz',\n\t'Acid Punk',\n\t'Acid Rock',\n\t'Acid Techno',\n\t'Acid Trance',\n\t'Acousmatic Music',\n\t'Acoustic',\n\t'Adult Contemporary',\n\t'African',\n\t'African Blues',\n\t'African Heavy Metal',\n\t'African Hip Hop',\n\t'Afro / Cosmic Disco',\n\t'Afro-Cuban Jazz',\n\t'Afrobeat',\n\t'Aggrotech',\n\t'Alternative',\n\t'Alternative Country',\n\t'Alternative Dance',\n\t'Alternative Hip Hop',\n\t'Alternative Metal',\n\t'Alternative Rock',\n\t'Ambient',\n\t'Ambient Dub',\n\t'Ambient House',\n\t'American Folk Revival',\n\t'Americana',\n\t'Anarcho Punk',\n\t'Anime',\n\t'Anti-folk',\n\t'Apala',\n\t'Arab Pop',\n\t'Art Punk',\n\t'Art Rock',\n\t'Asian',\n\t'Asian American Jazz',\n\t'Asian Underground',\n\t'Atlanta Hip Hop',\n\t'Audio Theatre',\n\t'Audiobook',\n\t'Australian Country Music',\n\t'Australian Hip Hop',\n\t'AustroPop',\n\t'Avant-garde',\n\t'Avant-garde Jazz',\n\t'Avant-garde Metal',\n\t'Avantgarde',\n\t'Ax',\n\t'Bachata',\n\t'Background Music',\n\t'Baila',\n\t'Baithak Gana',\n\t'Bakersfield sound',\n\t'Balearic Beat',\n\t'Balearic Trance',\n\t'Ballad',\n\t'Baltimore Club',\n\t'Banda',\n\t'Baroque',\n\t'Baroque Pop',\n\t'Bass',\n\t'Bassline',\n\t'Baul',\n\t'Beat',\n\t'Beat Music',\n\t'Beautiful Music',\n\t'Bebop',\n\t'Benga',\n\t'Berlin School',\n\t'Bhangra',\n\t'Big Band',\n\t'Big Beat',\n\t'Big Room',\n\t'Bikutsi',\n\t'BitPop',\n\t'Black Metal',\n\t'Blue-Eyed Soul',\n\t'Bluegrass',\n\t'Blues',\n\t'Blues Country',\n\t'Blues Rock',\n\t'Blues Shouter',\n\t'Bolero',\n\t'Bongo Flava',\n\t'Boogie',\n\t'Boogie-Woogie',\n\t'Booty Bass',\n\t'Bossa Nova',\n\t'Bounce Music',\n\t'Bouncy House',\n\t'Bouncy Techno',\n\t'Bouyon',\n\t'Brazilian',\n\t'Brazilian Rock',\n\t'Breakbeat',\n\t'Breakbeat Hardcore',\n\t'Breakcore',\n\t'Breakstep',\n\t'Brega',\n\t'Brick City club',\n\t'Brill Building',\n\t'British Blues',\n\t'British Dance Band',\n\t'British Folk revival',\n\t'British Hip Hop',\n\t'BritPop',\n\t'Broken Beat',\n\t'Brostep',\n\t'Bubblegum Dance',\n\t'Bubblegum Pop',\n\t'Bullerengue',\n\t'C-Pop',\n\t'Cabaret',\n\t'Cadence-lypso',\n\t'Cajun',\n\t'Cajun fiddle tunes',\n\t'Calypso',\n\t'Canadian Blues',\n\t'Cancin',\n\t'Canterbury scene',\n\t'Canzone',\n\t'Cape Jazz',\n\t'Caribbean',\n\t'Celtic',\n\t'Celtic Metal',\n\t'Celtic Music',\n\t'Celtic Punk',\n\t'Cha Cha Cha',\n\t'Chalga',\n\t'Chamber Jazz',\n\t'Chamber Music',\n\t'Chanson',\n\t'Chap Hop',\n\t'Chicago Blues',\n\t'Chicago Hip Hop',\n\t'Chicago House',\n\t'Chicano Rap',\n\t'Chicha',\n\t'Chill-out',\n\t'Chillout',\n\t'Chillstep',\n\t'Chillwave',\n\t'Chimurenga',\n\t'Chinese Rock',\n\t'Chiptune',\n\t'Chopped & Screwed',\n\t'Choro',\n\t'Chorus',\n\t'Christian Country Music',\n\t'Christian Gangsta Rap',\n\t'Christian Hip Hop',\n\t'Christian Metal',\n\t'Christian Pop',\n\t'Christian Punk',\n\t'Christian Rap',\n\t'Christian Rock',\n\t'Chutney',\n\t'Chutney soca',\n\t'Classic Country',\n\t'Classic female Blues',\n\t'Classic Rock',\n\t'Classical',\n\t'Classical crossover',\n\t'Close harmony',\n\t'Club',\n\t'Club-House',\n\t'Coldwave',\n\t'Comedy',\n\t'Compas',\n\t'Complextro',\n\t'Congolese rumba',\n\t'Conscious Hip Hop',\n\t'Contemporary Christian',\n\t'Contemporary Folk',\n\t'Contemporary R&B',\n\t'Continental Jazz',\n\t'Cool Jazz',\n\t'Country',\n\t'Country Blues',\n\t'Country Pop',\n\t'Country Rap',\n\t'Country Rock',\n\t'Country-Rap',\n\t'Coup-Dcal',\n\t'Western Music',\n\t'CowPunk',\n\t'Criolla',\n\t'Crossover',\n\t'Crossover Jazz',\n\t'Crossover Thrash',\n\t'Crunk',\n\t'Crunkcore',\n\t'Crust Punk',\n\t'Crustgrind',\n\t'Cult',\n\t'Cumbia',\n\t'Cumbia Rap',\n\t'Cybergrind',\n\t'D-beat',\n\t'Dance',\n\t'Dance Hall',\n\t'Dance-Pop',\n\t'Dance-Punk',\n\t'Dance-Rock',\n\t'Dancehall',\n\t'Dancehall Music',\n\t'Dangdut',\n\t'Dansband Music',\n\t'Dark Ambient',\n\t'Dark Cabaret',\n\t'Dark Electro',\n\t'Dark Wave',\n\t'Darkcore',\n\t'Darkcore jungle',\n\t'Darkstep',\n\t'Darkwave',\n\t'Death \\'n\\' roll',\n\t'Death industrial',\n\t'Death Metal',\n\t'Death-Doom',\n\t'Deathcore',\n\t'DeathRock',\n\t'Deep Funk',\n\t'Deep House',\n\t'Delta Blues',\n\t'Desert Rock',\n\t'Detroit Blues',\n\t'Detroit Hip Hop',\n\t'Detroit Techno',\n\t'Digital hardcore',\n\t'Disco',\n\t'Disco polo',\n\t'Diva House',\n\t'Dixieland',\n\t'Djent',\n\t'Doom Metal',\n\t'Doomcore',\n\t'Downtempo',\n\t'Dream',\n\t'Dream Pop',\n\t'Dream Trance',\n\t'Drill',\n\t'Drill & Bass',\n\t'Drone Metal',\n\t'Drone Music',\n\t'Drum & Bass',\n\t'Drum Solo',\n\t'Drumstep',\n\t'Dub',\n\t'Dub Techno',\n\t'Dubstep',\n\t'Dubstyle',\n\t'Dubtronica',\n\t'Duet',\n\t'Dunedin Sound',\n\t'Dutch House',\n\t'East Coast Hip Hop',\n\t'Easy Listening',\n\t'EBM',\n\t'Eclectic',\n\t'Electric Blues',\n\t'Electro',\n\t'Electro House',\n\t'Electro Music',\n\t'Electro Swing',\n\t'Electro-Industrial',\n\t'Electroacoustic',\n\t'Electroacoustic Music',\n\t'Electroclash',\n\t'Electronic',\n\t'Electronic Body Music',\n\t'Electronic Rock',\n\t'Electronica',\n\t'Electronicore',\n\t'ElectroPop',\n\t'ElectroPunk',\n\t'Elevator Music',\n\t'Emo',\n\t'Ethereal Wave',\n\t'Ethnic',\n\t'Ethnic electronica',\n\t'Ethno Jazz',\n\t'Euro Disco',\n\t'Euro-House',\n\t'Euro-Techno',\n\t'Eurobeat',\n\t'Eurodance',\n\t'European free Jazz',\n\t'EuroPop',\n\t'Experimental',\n\t'Experimental Hip Hop',\n\t'Experimental Music',\n\t'Experimental Rock',\n\t'Fado',\n\t'Fann at-Tanbura',\n\t'Fast Fusion',\n\t'Fidget House',\n\t'Fijiri',\n\t'Filk Music',\n\t'Filmi',\n\t'Flamenco',\n\t'Florida Breaks',\n\t'Folk',\n\t'Folk Metal',\n\t'Folk Pop',\n\t'Folk Punk',\n\t'Folk Rock',\n\t'Folk-Rock',\n\t'Folklore',\n\t'Folktronica',\n\t'Forr',\n\t'Franco-Country',\n\t'Freak Folk',\n\t'Freakbeat',\n\t'Free Funk',\n\t'Free Improvisation',\n\t'Free Jazz',\n\t'Free Tekno',\n\t'Freestyle',\n\t'Freestyle Music',\n\t'Freestyle Rap',\n\t'French House',\n\t'French Pop',\n\t'Frevo',\n\t'Fuji Music',\n\t'Full On',\n\t'Funk',\n\t'Funk Carioca',\n\t'Funk Metal',\n\t'Funkstep',\n\t'Funktronica',\n\t'Funky House',\n\t'Furniture Music',\n\t'Fusion',\n\t'Future Garage',\n\t'Future House',\n\t'FuturePop',\n\t'G-Funk',\n\t'Gabba',\n\t'Game',\n\t'Game Boy Music',\n\t'Gamelan',\n\t'Gangsta Rap',\n\t'Garage',\n\t'Garage House',\n\t'Garage Punk',\n\t'Garage Rock',\n\t'Genge',\n\t'Ghetto House',\n\t'Ghettotech',\n\t'Glam Metal',\n\t'Glam Rock',\n\t'Glitch',\n\t'Glitch Hop',\n\t'Global',\n\t'Go-go',\n\t'Goa',\n\t'Goa Trance',\n\t'Golden Age Hip Hop',\n\t'Goregrind',\n\t'Gospel',\n\t'Gospel Blues',\n\t'Gothic',\n\t'Gothic Metal',\n\t'Gothic Rock',\n\t'Grime',\n\t'Grindcore',\n\t'Grindie',\n\t'Groove Metal',\n\t'Grunge',\n\t'Grupera',\n\t'Guajira',\n\t'Gypsy Jazz',\n\t'Gypsy Punk',\n\t'Happy Hardcore',\n\t'Hard Bop',\n\t'Hard House',\n\t'Hard NRG',\n\t'Hard Rock',\n\t'Hard Trance',\n\t'Hardbag',\n\t'Hardcore',\n\t'Hardcore Rap',\n\t'Hardcore Hip Hop',\n\t'Hardcore Punk',\n\t'Hardstep',\n\t'Hardstyle',\n\t'Heavy Metal',\n\t'Hellbilly Music',\n\t'Hi-NRG',\n\t'Highlife',\n\t'Hill Country Blues',\n\t'Hip Hop',\n\t'Hip Hop Soul',\n\t'Hip House',\n\t'Hip Pop',\n\t'Hip Hop',\n\t'Hiplife',\n\t'Hokum',\n\t'Hokum Blues',\n\t'Honky Tonk',\n\t'Horror Punk',\n\t'Horrorcore',\n\t'House',\n\t'House Music',\n\t'Houston Hip Hop',\n\t'Huayno',\n\t'Humour',\n\t'Hyphy',\n\t'IDM',\n\t'Igbo highlife',\n\t'Igbo Rap',\n\t'Illbient',\n\t'Indian Pop',\n\t'Indie',\n\t'Indie Folk',\n\t'Indie Pop',\n\t'Indie Rock',\n\t'Indietronica',\n\t'Industrial',\n\t'Industrial Folk',\n\t'Industrial Hip Hop',\n\t'Industrial Metal',\n\t'Industrial Music',\n\t'Industrial Rock',\n\t'Industro-Goth',\n\t'Instrumental',\n\t'Instrumental Country',\n\t'Instrumental Hip Hop',\n\t'Instrumental Pop',\n\t'Instrumental Rock',\n\t'Iranian Pop',\n\t'Isicathamiya',\n\t'Isolationism',\n\t'Italo Dance',\n\t'Italo Disco',\n\t'Italo House',\n\t'J-Pop',\n\t'Jam Band',\n\t'Jangle Pop',\n\t'Japanoise',\n\t'Jazz',\n\t'Jazz Blues',\n\t'Jazz Fusion',\n\t'Jazz House',\n\t'Jazz Rap',\n\t'Jazz Rock',\n\t'Jazz-Funk',\n\t'Jazz+Funk',\n\t'Jerkin\\'',\n\t'Jersey Club',\n\t'Jit',\n\t'JPop',\n\t'Jj',\n\t'Jump Blues',\n\t'Jump-up',\n\t'Jumpstyle',\n\t'Jungle',\n\t'K-Pop',\n\t'Kadongo Kamu',\n\t'Kansas City Blues',\n\t'Kansas City Jazz',\n\t'Kapuka',\n\t'Keroncong',\n\t'Khaliji',\n\t'Kizomba',\n\t'Krautrock',\n\t'Kuduro',\n\t'Kwaito',\n\t'Kwassa Kwassa',\n\t'Kwela',\n\t'Lak',\n\t'Lambada',\n\t'Laptronica',\n\t'Latin',\n\t'Latin alternative',\n\t'Latin ballad',\n\t'Latin Christian',\n\t'Latin House',\n\t'Latin Jazz',\n\t'Latin Metal',\n\t'Latin Pop',\n\t'Latin Rock',\n\t'Latin Swing',\n\t'Lavani',\n\t'Leftfield',\n\t'Lento Violento',\n\t'Liquid Dubstep',\n\t'Liquid Funk',\n\t'Livetronica',\n\t'Liwa',\n\t'Lo-fi',\n\t'Lo-Fi',\n\t'Louisiana Blues',\n\t'Louisiana Swamp Pop',\n\t'Lounge',\n\t'Lounge Music',\n\t'Lovers Rock',\n\t'Low Bap',\n\t'Lowercase',\n\t'Luk Krung',\n\t'Luk Thung',\n\t'Lyrical Hip Hop',\n\t'M-Base',\n\t'Mafioso Rap',\n\t'Mainstream Jazz',\n\t'Mkina',\n\t'Makossa',\n\t'Maloya',\n\t'Mambo',\n\t'MandoPop',\n\t'Manila Sound',\n\t'Maracatu',\n\t'Mariachi',\n\t'Marrabenta',\n\t'Math Rock',\n\t'Mathcore',\n\t'Mbalax',\n\t'Mbaqanga',\n\t'Mbube',\n\t'Medieval Metal',\n\t'Meditative',\n\t'Melbourne Bounce',\n\t'Melodic Death Metal',\n\t'Melodic Metalcore',\n\t'Memphis Blues',\n\t'Merengue',\n\t'MerenRap',\n\t'Mringue',\n\t'Metal',\n\t'Metalcore',\n\t'Mexican Pop',\n\t'Mexican Son',\n\t'Miami Bass',\n\t'Microhouse',\n\t'Middle of the road',\n\t'Midwest Hip Hop',\n\t'Minimal Techno',\n\t'Minimal Wave',\n\t'Modal Jazz',\n\t'Moombahcore',\n\t'Moombahton',\n\t'Morlam',\n\t'Morna',\n\t'Mosambique',\n\t'Motswako',\n\t'Msica Criolla',\n\t'Msica Popular Brasileira',\n\t'Msica Sertaneja',\n\t'Musical',\n\t'Musique Concrte',\n\t'Nagoya Kei',\n\t'Nashville Sound',\n\t'National Folk',\n\t'Native American',\n\t'NDW',\n\t'Ndombolo',\n\t'NederPop',\n\t'Neo Soul',\n\t'Neo-Bop Jazz',\n\t'Neo-Psychedelia',\n\t'Neo-Swing',\n\t'Neoclassical',\n\t'Neoclassical Metal',\n\t'Neofolk',\n\t'Neotraditional Country',\n\t'Nerdcore',\n\t'Neue Deutsche Welle',\n\t'NeuroFunk',\n\t'Neurohop',\n\t'New Age',\n\t'New Beat',\n\t'New jack swing',\n\t'New Jersey Hip Hop',\n\t'New Prog',\n\t'New Rave',\n\t'New Romantic',\n\t'New Romanticism',\n\t'New School Hip Hop',\n\t'New Wave',\n\t'New-age Music',\n\t'Nintendocore',\n\t'Nitzhonot',\n\t'No wave',\n\t'Noise',\n\t'Noise Rock',\n\t'Noisegrind',\n\t'Nortec',\n\t'Norteo',\n\t'Northern Soul',\n\t'Novelty Ragtime',\n\t'Nu Jazz',\n\t'Nu Metal',\n\t'Nu Skool Breaks',\n\t'Nu-Breakz',\n\t'Nu-Disco',\n\t'Nu-Funk',\n\t'Nu-Gaze',\n\t'Nu-NRG',\n\t'Nueva cancin',\n\t'Old School Hip Hop',\n\t'Oldies',\n\t'Opera',\n\t'Operatic Pop',\n\t'Orchestral Jazz',\n\t'Original Pilipino Music',\n\t'Other',\n\t'Outlaw Country',\n\t'Outsider House',\n\t'P-Funk',\n\t'Pagan Metal',\n\t'Pagode',\n\t'Paisley Underground',\n\t'Palm-wine',\n\t'Piedmont Blues',\n\t'Pinoy Pop',\n\t'Podcast',\n\t'Political Hip Hop',\n\t'Polka',\n\t'Polsk Punk',\n\t'Pop',\n\t'Pop Punk',\n\t'Pop Rap',\n\t'Pop Rock',\n\t'Pop Soul',\n\t'Pop Sunda',\n\t'Pop-Folk',\n\t'Pop-Funk',\n\t'Porn Groove',\n\t'Porro',\n\t'Post-Bop',\n\t'Post-Disco',\n\t'Post-Grunge',\n\t'Post-Hardcore',\n\t'Post-Metal',\n\t'Post-Punk',\n\t'Post-Punk Revival',\n\t'Post-Rock',\n\t'Power Ballad',\n\t'Power Electronics',\n\t'Power Metal',\n\t'Power Noise',\n\t'Power Pop',\n\t'Powerviolence',\n\t'Pranks',\n\t'Primus',\n\t'Progressive Bluegrass',\n\t'Progressive Country',\n\t'Progressive Folk',\n\t'Progressive House',\n\t'Progressive Metal',\n\t'Progressive Pop',\n\t'Progressive Rock',\n\t'Progressive Trance',\n\t'Protest Song',\n\t'Psybient',\n\t'Psychedelic',\n\t'Psychedelic Folk',\n\t'Psychedelic Pop',\n\t'Psychedelic Rock',\n\t'Psychedelic Trance',\n\t'Psychobilly',\n\t'Punkabilly',\n\t'Psytrance',\n\t'Punk',\n\t'Punk Blues',\n\t'Punk Jazz',\n\t'Punk Rock',\n\t'Punta',\n\t'Punta Rock',\n\t'R&B',\n\t'Raga Rock',\n\t'Ragga',\n\t'Ragga Jungle',\n\t'Raggacore',\n\t'Ragini',\n\t'Ragtime',\n\t'Ra',\n\t'Ranchera',\n\t'Rap',\n\t'Rap Metal',\n\t'Rap Music',\n\t'Rap Opera',\n\t'Rap Rock',\n\t'Rapcore',\n\t'Rara tech',\n\t'Rasin',\n\t'Rave',\n\t'Reactionary Bluegrass',\n\t'Rebetiko',\n\t'Red Dirt',\n\t'Reggae',\n\t'Reggae Espaol',\n\t'Spanish Reggae',\n\t'Reggae Fusion',\n\t'Reggaestep',\n\t'Reggaeton',\n\t'Regional Mexican',\n\t'Retro',\n\t'Revival',\n\t'Rhythm & Blues',\n\t'Rhythmic Soul',\n\t'Riot grrrl',\n\t'Rock',\n\t'Rock & Roll',\n\t'Rock en Espaol',\n\t'Rock in Opposition',\n\t'Rockabilly',\n\t'Rocksteady',\n\t'Rumba',\n\t'Russian Pop',\n\t'Sadcore',\n\t'Sakara',\n\t'Salsa',\n\t'Salsa romntica',\n\t'Samba',\n\t'Samba Rock',\n\t'Sambass',\n\t'Satire',\n\t'Sawt',\n\t'Schlager',\n\t'Screamo',\n\t'Sega',\n\t'Seggae',\n\t'Semba',\n\t'Sertanejo',\n\t'Shangaan electro',\n\t'Shibuya-kei',\n\t'Shoegaze',\n\t'Showtunes',\n\t'Singer-songwriter',\n\t'Ska',\n\t'Ska Jazz',\n\t'Ska Punk',\n\t'Skate Punk',\n\t'Skiffle',\n\t'Skweee',\n\t'Slow Jam',\n\t'Slow Rock',\n\t'Slowcore',\n\t'Sludge Metal',\n\t'Smooth Jazz',\n\t'Snap Music',\n\t'Soca',\n\t'Soft Rock',\n\t'Son',\n\t'Son Cubano',\n\t'Sonata',\n\t'Songo',\n\t'Songo-Salsa',\n\t'Sophisti-Pop',\n\t'Soukous',\n\t'Soul',\n\t'Soul Blues',\n\t'Soul Jazz',\n\t'Sound Clip',\n\t'Soundtrack',\n\t'Southern Hip Hop',\n\t'Southern Rock',\n\t'Southern Soul',\n\t'Space',\n\t'Space Age Pop',\n\t'Space Disco',\n\t'Space Music',\n\t'Space Rock',\n\t'Speech',\n\t'Speed garage',\n\t'Speed Metal',\n\t'Speedcore',\n\t'St.Louis Blues',\n\t'St.Louis Hip Hop',\n\t'Stoner Rock',\n\t'Straight-ahead Jazz',\n\t'Street Punk',\n\t'Stride Jazz',\n\t'Sufi Rock',\n\t'SungPoetry',\n\t'Sunshine Pop',\n\t'Suomisaundi',\n\t'Surf Pop',\n\t'Surf Rock',\n\t'Swamp Blues',\n\t'Swing',\n\t'Symphonic black Metal',\n\t'Symphonic Metal',\n\t'Symphonic Rock',\n\t'Symphony',\n\t'Synthpop',\n\t'SynthPop',\n\t'Synthwave',\n\t'Taarab',\n\t'Tango',\n\t'Tech House',\n\t'Tech Trance',\n\t'Techdombe',\n\t'Technical death Metal',\n\t'Techno',\n\t'Techno-Industrial',\n\t'Techstep',\n\t'Tecno Brega',\n\t'Tecnobrega',\n\t'Teen Pop',\n\t'Tejano',\n\t'Terror',\n\t'Texas Blues',\n\t'Texas Country',\n\t'Thai Pop',\n\t'Third stream',\n\t'Thrash Metal',\n\t'Thrashcore',\n\t'Timba',\n\t'Top 40',\n\t'Trad Jazz',\n\t'Traditional Country Music',\n\t'Traditional Pop Music',\n\t'Trailer',\n\t'Trance',\n\t'Trance Music',\n\t'TRap',\n\t'TRapstep',\n\t'Tribal',\n\t'Tribal House',\n\t'Trip hop',\n\t'Trip-Hop',\n\t'Trival',\n\t'Trop Rock',\n\t'Tropical',\n\t'Tropical House',\n\t'Tropicalia',\n\t'TropiPop',\n\t'Truck-driving Country',\n\t'Turkish Pop',\n\t'Turntablism',\n\t'Twin Cities Hip Hop',\n\t'Twoubadou',\n\t'UK Funky',\n\t'UK Garage',\n\t'UK Hardcore',\n\t'Unblack Metal',\n\t'Underground Hip Hop',\n\t'Uplifting Trance',\n\t'Urban Pasifika',\n\t'V-Pop',\n\t'Vallenato',\n\t'Vaporwave',\n\t'Video game Music',\n\t'Viking Metal',\n\t'VisPop',\n\t'Visual Kei',\n\t'Vocal',\n\t'Vocal Jazz',\n\t'Vocal Trance',\n\t'War Metal',\n\t'Weltmusik',\n\t'West Coast Blues',\n\t'West Coast Hip Hop',\n\t'West Coast Jazz',\n\t'Western swing',\n\t'Witch House',\n\t'Wonky',\n\t'Wonky Pop',\n\t'World Fusion',\n\t'World Music',\n\t'Worldbeat',\n\t'Zouglou',\n\t'Zouk',\n\t'Zouk-Lambada',\n\t'Zydeco'\n];\n\nfunction slugify(genre: string): string {\n\treturn genre.replace(/[& \\-\\.]/g, '').toLowerCase();\n}\n\nexport function getKnownGenre(genre: string): string | undefined {\n\tconst slug = slugify(genre);\n\tif (!GenresSlugs) {\n\t\tGenresSlugs = {};\n\t\tGenres.forEach(g => {\n\t\t\tGenresSlugs[slugify(g)] = g;\n\t\t});\n\t}\n\treturn GenresSlugs[slug];\n}\n\nexport function cleanGenre(genre: string): string {\n\tconst results: Array<string> = [];\n\tconst parts = genre.split('/');\n\tparts.forEach((part: string) => {\n\t\t// test for (number)\n\t\tpart = part.trim();\n\t\tconst numpart = /\\((\\d+)\\)/.exec(part);\n\t\tlet num: number | undefined;\n\t\tif (numpart) {\n\t\t\tnum = parseInt(numpart[1], 10);\n\t\t\tpart = part.slice(0, numpart.index) + part.slice(numpart.index + numpart[0].length);\n\t\t}\n\t\tif (part.length === 0 && (num !== undefined)) {\n\t\t\tconst s = genreByNumbers[num];\n\t\t\tif (s) {\n\t\t\t\tpart = s;\n\t\t\t}\n\t\t}\n\t\tif (part.length > 0) {\n\t\t\tconst slug = slugify(part);\n\t\t\tlet result: string | undefined;\n\t\t\tif (!GenresSlugs) {\n\t\t\t\tGenresSlugs = {};\n\t\t\t\tGenres.forEach(g => {\n\t\t\t\t\tGenresSlugs[slugify(g)] = g;\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (GenresSlugs && GenresSlugs[slug]) {\n\t\t\t\tresult = GenresSlugs[slug];\n\t\t\t}\n\t\t\tif (!result && part.indexOf(' & ') >= 0) {\n\t\t\t\tconst subParts = part.split('&');\n\t\t\t\tsubParts.forEach(sub => {\n\t\t\t\t\tsub = cleanGenre(sub);\n\t\t\t\t\tif (results.indexOf(sub) < 0) {\n\t\t\t\t\t\tresults.push(sub);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (result) {\n\t\t\t\tif (results.indexOf(result) < 0) {\n\t\t\t\t\tresults.push(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (results.indexOf(part) < 0) {\n\t\t\t\t\tresults.push(part);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\treturn results.join(' / ');\n}\n","import path from 'path';\nimport Logger from '../../utils/logger';\nimport {downloadFile} from '../../utils/download';\nimport {dirRead, fileDelete, fileDeleteIfExists, fileExists, fileRename, fileWrite} from '../../utils/fs-utils';\nimport {IApiBinaryResult} from '../../typings';\nimport {Config} from '../../config';\nimport Jimp from 'jimp';\nimport mimeTypes from 'mime-types';\nimport {DebouncePromises} from '../../utils/debounce-promises';\n\nconst log = Logger('Images');\n\n/**\n * Handles image access/reading/writing/transforming\n */\n\nexport class Images {\n\tprivate imageCachePath: string;\n\tprivate format = 'png';\n\tprivate font: Jimp.Font | undefined;\n\tprivate imageCacheDebounce = new DebouncePromises<IApiBinaryResult>();\n\n\tconstructor(config: Config) {\n\t\tthis.imageCachePath = config.getDataPath(['cache', 'images']);\n\t}\n\n\tasync storeImage(filepath: string, name: string, imageUrl: string): Promise<string> {\n\t\tlog.debug('Requesting image', imageUrl);\n\t\tconst imageext = path.extname(imageUrl).split('?')[0].trim().toLowerCase();\n\t\tif (imageext.length === 0) {\n\t\t\treturn Promise.reject(Error('Invalid Image Url'));\n\t\t}\n\t\tconst filename = name + imageext;\n\t\tawait downloadFile(imageUrl, path.join(filepath, filename));\n\t\tlog.info('image downloaded', filename);\n\t\treturn filename;\n\t}\n\n\tasync paint(text: string, size: number, format: string | undefined): Promise<IApiBinaryResult> {\n\t\tsize = size || 320;\n\t\tconst image = new Jimp(360, 360, '#282828');\n\t\tif (!this.font) {\n\t\t\tthis.font = await Jimp.loadFont(Jimp.FONT_SANS_32_WHITE);\n\t\t}\n\t\timage.print(this.font, 10, 10, {\n\t\t\ttext: text,\n\t\t\talignmentX: Jimp.HORIZONTAL_ALIGN_CENTER,\n\t\t\talignmentY: Jimp.VERTICAL_ALIGN_MIDDLE\n\t\t}, 340, 340);\n\t\t// image.greyscale();\n\t\timage.resize(size, size);\n\t\tconst mime = mimeTypes.lookup(format ? format : this.format);\n\t\tif (!mime) {\n\t\t\treturn Promise.reject('Unknown Image Format Request');\n\t\t}\n\t\tconst buffer = await image.getBufferAsync(mime);\n\t\treturn {\n\t\t\tbuffer: {\n\t\t\t\tbuffer: buffer,\n\t\t\t\tcontentType: mime\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate async getImage(filename: string, size: number | undefined, name: string): Promise<IApiBinaryResult> {\n\t\tconst exists = await fileExists(filename);\n\t\tif (!exists) {\n\t\t\treturn Promise.reject(Error('File not found'));\n\t\t}\n\t\tif (!size) {\n\t\t\treturn {file: {filename, name}};\n\t\t} else {\n\t\t\tconst image = await Jimp.read(filename);\n\t\t\tconst mime = mimeTypes.lookup(path.extname(filename));\n\t\t\tif (!mime) {\n\t\t\t\treturn Promise.reject('Unknown Image Format Request');\n\t\t\t}\n\t\t\timage.crop(1, 1, image.getWidth() - 2, image.getHeight() - 2);\n\t\t\t// image.autocrop({cropOnlyFrames: false, tolerance: 0.0004, cropSymmetric: true});\n\t\t\timage.contain(size, size);\n\t\t\tconst buffer = await image.getBufferAsync(mime);\n\t\t\treturn {\n\t\t\t\tbuffer: {\n\t\t\t\t\tbuffer: buffer,\n\t\t\t\t\tcontentType: mime\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tasync get(id: string, filename: string, size: number | undefined, format?: string): Promise<IApiBinaryResult> {\n\t\tif (!filename) {\n\t\t\treturn Promise.reject(Error('Invalid Path'));\n\t\t}\n\t\tif (size) {\n\t\t\tconst cacheID = 'thumb-' + id + '-' + size + '.' + this.format;\n\t\t\tif (this.imageCacheDebounce.isPending(cacheID)) {\n\t\t\t\treturn this.imageCacheDebounce.append(cacheID);\n\t\t\t}\n\t\t\tthis.imageCacheDebounce.setPending(cacheID);\n\t\t\ttry {\n\t\t\t\tlet result: IApiBinaryResult;\n\t\t\t\tconst cachefile = path.join(this.imageCachePath, cacheID);\n\t\t\t\tconst exists = await fileExists(cachefile);\n\t\t\t\tif (exists) {\n\t\t\t\t\tresult = {file: {filename: cachefile, name: cacheID}};\n\t\t\t\t} else {\n\t\t\t\t\tresult = await this.getImage(filename, size, cacheID);\n\t\t\t\t\tif (result.buffer) {\n\t\t\t\t\t\tlog.debug('Writing image cache file', cachefile);\n\t\t\t\t\t\tawait fileWrite(cachefile, result.buffer.buffer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait this.imageCacheDebounce.resolve(cacheID, result);\n\t\t\t\treturn result;\n\t\t\t} catch (e) {\n\t\t\t\tawait this.imageCacheDebounce.reject(cacheID, e);\n\t\t\t\treturn Promise.reject(e);\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.getImage(filename, size, id + '.' + this.format);\n\t\t}\n\t}\n\n\tasync resizeImage(filename: string, destination: string, size: number): Promise<void> {\n\t\tconst image = await Jimp.read(filename);\n\t\timage.contain(size, size);\n\t\tawait image.writeAsync(destination);\n\t}\n\n\tasync clearImageCacheByIDs(ids: Array<string>): Promise<void> {\n\t\tconst searches = ids.filter(id => id.length > 0).map(id => 'thumb-' + id);\n\t\tif (searches.length > 0) {\n\t\t\tlet list = await dirRead(this.imageCachePath);\n\t\t\tlist = list.filter(name => {\n\t\t\t\treturn searches.findIndex(s => name.indexOf(s) === 0) >= 0;\n\t\t\t});\n\t\t\tfor (const filename of list) {\n\t\t\t\tawait fileDelete(path.resolve(this.imageCachePath, filename));\n\t\t\t}\n\t\t}\n\t}\n\n\tasync clearImageCacheByID(id: string): Promise<void> {\n\t\tif (id.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst search = 'thumb-' + id;\n\t\tlet list = await dirRead(this.imageCachePath);\n\t\tlist = list.filter(name => name.indexOf(search) === 0);\n\t\tfor (const filename of list) {\n\t\t\tawait fileDelete(path.resolve(this.imageCachePath, filename));\n\t\t}\n\t}\n\n\tasync createAvatar(filename: string, destination: string): Promise<void> {\n\t\tif ((!filename)) {\n\t\t\treturn Promise.reject(Error('Invalid Path'));\n\t\t}\n\t\tconst exists = await fileExists(filename);\n\t\tif (!exists) {\n\t\t\treturn Promise.reject(Error('File not found'));\n\t\t}\n\t\tawait this.resizeImage(filename, filename + '.new', 64);\n\t\tawait fileDeleteIfExists(destination);\n\t\tawait fileRename(filename + '.new', destination);\n\t}\n\n}\n","module.exports = require(\"jimp\");","module.exports = require(\"mime-types\");","import {JamServe} from '../../model/jamserve';\nimport path from 'path';\nimport {Store} from '../../store/store';\nimport {Config} from '../../config';\n\nexport class IndexTreeBuilder {\n\tprivate readonly store: Store;\n\tprivate ignore: string;\n\n\tconstructor(config: Config, store: Store) {\n\t\tthis.ignore = config.app.index.ignore.join('|');\n\t\tthis.store = store;\n\t}\n\n\tremoveArticles(name: string): string {\n\t\t// /^(?:(?:the|los|les)\\s+)?(.*)/gi\n\t\tconst matches = new RegExp('^(?:(?:' + this.ignore + ')\\\\s+)?(.*)', 'gi').exec(name);\n\t\treturn matches ? matches[1] : name;\n\t}\n\n\tgetIndexChar(name: string, sortname?: string): string {\n\t\tconst c = (sortname || this.removeArticles(name) || '').trim().toUpperCase().charAt(0);\n\t\tconst regex_symbols = /[-!$%^&*()_+|~=`{}\\[\\]:\\/;<>?,.@#\\d]/;\n\t\tif (c.match(regex_symbols) === null) {\n\t\t\treturn c;\n\t\t}\n\t\treturn '#';\n\t}\n\n\tasync buildArtistIndex(): Promise<JamServe.ArtistIndex> {\n\t\tconst result: JamServe.ArtistIndex = {groups: [], lastModified: Date.now()};\n\t\tconst artists = await this.store.artist.all();\n\t\tartists.forEach(artist => {\n\t\t\tconst entry: JamServe.ArtistIndexEntry = {artist};\n\t\t\tconst indexChar = this.getIndexChar(artist.name, artist.nameSort);\n\t\t\tlet group = result.groups.find(g => g.name === indexChar);\n\t\t\tif (!group) {\n\t\t\t\tgroup = {name: indexChar, entries: []};\n\t\t\t\tresult.groups.push(group);\n\t\t\t}\n\t\t\tgroup.entries.push(entry);\n\t\t});\n\t\tresult.groups.forEach(group => {\n\t\t\tgroup.entries.sort((a, b) => {\n\t\t\t\treturn a.artist.name.localeCompare(b.artist.name);\n\t\t\t});\n\t\t});\n\t\tresult.groups.sort((a, b) => {\n\t\t\treturn a.name.localeCompare(b.name);\n\t\t});\n\t\treturn result;\n\t}\n\n\tprivate async getTotalTrackCount(folder: JamServe.Folder): Promise<number> {\n\t\treturn this.store.track.searchCount({inPath: folder.path});\n\t}\n\n\tasync buildFolderIndex(): Promise<JamServe.FolderIndex> {\n\t\tconst result: JamServe.FolderIndex = {groups: [], lastModified: Date.now()};\n\t\tconst folders = await this.store.folder.search({level: 1});\n\t\tfor (const folder of folders) {\n\t\t\tconst trackCount = await this.getTotalTrackCount(folder);\n\t\t\tconst entry: JamServe.FolderIndexEntry = {\n\t\t\t\tname: path.basename(folder.path),\n\t\t\t\tnameSort: folder.tag.artistSort || this.removeArticles(path.basename(folder.path)),\n\t\t\t\ttrackCount: trackCount || 0,\n\t\t\t\tfolder\n\t\t\t};\n\t\t\tconst indexChar = this.getIndexChar(entry.name, entry.nameSort);\n\t\t\tlet group = result.groups.find(g => g.name === indexChar);\n\t\t\tif (!group) {\n\t\t\t\tgroup = {name: indexChar, entries: []};\n\t\t\t\tresult.groups.push(group);\n\t\t\t}\n\t\t\tgroup.entries.push(entry);\n\t\t}\n\t\tresult.groups.forEach(group => {\n\t\t\tgroup.entries.sort((a, b) => {\n\t\t\t\treturn a.nameSort.localeCompare(b.nameSort);\n\t\t\t});\n\t\t});\n\t\tresult.groups.sort((a, b) => {\n\t\t\treturn a.name.localeCompare(b.name);\n\t\t});\n\t\treturn result;\n\t}\n\n\tasync buildIndexes(): Promise<JamServe.Indexes> {\n\t\tconst folderIndex = await this.buildFolderIndex();\n\t\tconst artistIndex = await this.buildArtistIndex();\n\t\treturn {folderIndex, artistIndex};\n\t}\n}\n\nexport class IndexTree {\n\tprivate readonly config: Config;\n\tprivate readonly store: Store;\n\tprivate cached?: JamServe.Indexes;\n\n\tconstructor(config: Config, store: Store) {\n\t\tthis.config = config;\n\t\tthis.store = store;\n\t}\n\n\tasync buildIndexes(): Promise<void> {\n\t\tconst builder = new IndexTreeBuilder(this.config, this.store);\n\t\tthis.cached = await builder.buildIndexes();\n\t}\n\n\tasync getIndexes(forcerebuild: boolean): Promise<JamServe.Indexes> {\n\t\tif (forcerebuild || !this.cached) {\n\t\t\tawait this.buildIndexes();\n\t\t}\n\t\treturn <JamServe.Indexes>this.cached;\n\t}\n\n\tasync getFolderIndex(forcerebuild: boolean): Promise<JamServe.FolderIndex> {\n\t\tconst indexes = await this.getIndexes(forcerebuild);\n\t\treturn indexes.folderIndex;\n\t}\n\n\tasync getArtistIndex(forcerebuild: boolean): Promise<JamServe.ArtistIndex> {\n\t\tconst indexes = await this.getIndexes(forcerebuild);\n\t\treturn indexes.artistIndex;\n\t}\n\n\tfilterFolderIndex(rootID: string | undefined, folderIndex: JamServe.FolderIndex): JamServe.FolderIndex {\n\t\tif (!rootID) {\n\t\t\treturn folderIndex;\n\t\t}\n\t\treturn {\n\t\t\tlastModified: folderIndex.lastModified,\n\t\t\tgroups: folderIndex.groups.map(group => {\n\t\t\t\treturn {\n\t\t\t\t\tname: group.name,\n\t\t\t\t\tentries: group.entries.filter(entry => entry.folder.rootID === rootID)\n\t\t\t\t};\n\t\t\t}).filter(group => group.entries.length > 0)\n\t\t};\n\t}\n\n\tfilterArtistIndex(rootID: string | undefined, artistIndex: JamServe.ArtistIndex): JamServe.ArtistIndex {\n\t\tif (!rootID) {\n\t\t\treturn artistIndex;\n\t\t}\n\t\treturn {\n\t\t\tlastModified: artistIndex.lastModified,\n\t\t\tgroups: artistIndex.groups.map(group => {\n\t\t\t\treturn {\n\t\t\t\t\tname: group.name,\n\t\t\t\t\tentries: group.entries.filter(entry => entry.artist.rootIDs.indexOf(rootID) >= 0)\n\t\t\t\t};\n\t\t\t}).filter(group => group.entries.length > 0)\n\t\t};\n\t}\n\n}\n","import {JamServe} from '../../model/jamserve';\nimport {FolderType} from '../../types';\nimport {Store} from '../../store/store';\nimport {Audio} from '../../audio/audio';\nimport {shuffle} from '../../utils/random';\nimport Logger from '../../utils/logger';\nimport MetaInfoSimilarArtist = JamServe.MetaInfoSimilarArtist;\n\nconst log = Logger('Metainfo');\n\nexport class Metainfo {\n\tprivate store: Store;\n\tprivate audio: Audio;\n\n\tconstructor(store: Store, audio: Audio) {\n\t\tthis.store = store;\n\t\tthis.audio = audio;\n\t}\n\n\tprivate async getInfo(isArtist: boolean, artistId: string | undefined, artistName: string | undefined, albumId: string | undefined, albumName: string | undefined): Promise<JamServe.MetaInfo> {\n\t\tconst audio = this.audio;\n\n\t\tasync function checkAlbumById(): Promise<JamServe.MetaInfoAlbum | undefined> {\n\t\t\tif (albumId) {\n\t\t\t\treturn audio.mediaInfoAlbumInfoByAlbumID(albumId);\n\t\t\t}\n\t\t}\n\n\t\tasync function checkAlbumByNameAndArtist(): Promise<JamServe.MetaInfoAlbum | undefined> {\n\t\t\tif (artistName && albumName) {\n\t\t\t\treturn audio.mediaInfoAlbumInfo(albumName, artistName);\n\t\t\t}\n\t\t}\n\n\t\tasync function checkAlbum(): Promise<JamServe.MetaInfoAlbum | undefined> {\n\t\t\tconst data = await checkAlbumById();\n\t\t\tif (data) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t\treturn checkAlbumByNameAndArtist();\n\t\t}\n\n\t\tasync function checkArtist(): Promise<JamServe.MetaInfoArtist | undefined> {\n\t\t\tif (artistId) {\n\t\t\t\treturn audio.mediaInfoArtistInfoByArtistID(artistId);\n\t\t\t} else if (artistName) {\n\t\t\t\treturn audio.mediaInfoArtistInfo(artistName);\n\t\t\t}\n\t\t}\n\n\t\tasync function checkTopSongs(): Promise<Array<JamServe.MetaInfoTopSong> | undefined> {\n\t\t\tif (artistId) {\n\t\t\t\treturn audio.mediaInfoTopSongsByArtistID(artistId);\n\t\t\t} else if (artistName) {\n\t\t\t\treturn audio.mediaInfoTopSongs(artistName);\n\t\t\t}\n\t\t}\n\n\n\t\tif (isArtist) {\n\t\t\tconst artist = await checkArtist();\n\t\t\tconst topSongs = await checkTopSongs();\n\t\t\treturn {\n\t\t\t\tartist: artist || {},\n\t\t\t\ttopSongs: topSongs || [],\n\t\t\t\talbum: {}\n\t\t\t};\n\t\t} else {\n\t\t\tconst album = await checkAlbum();\n\t\t\treturn {\n\t\t\t\tartist: {},\n\t\t\t\ttopSongs: [],\n\t\t\t\talbum: album || {}\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate async createFolderInfo(folder: JamServe.Folder): Promise<JamServe.MetaInfo | undefined> {\n\t\tif (!folder.tag) {\n\t\t\treturn {\n\t\t\t\tartist: {},\n\t\t\t\talbum: {},\n\t\t\t\ttopSongs: []\n\t\t\t};\n\t\t}\n\t\tif (folder.tag.type === FolderType.artist) {\n\t\t\treturn this.getInfo(true, folder.tag.mbArtistID, folder.tag.artist, folder.tag.mbAlbumID, folder.tag.album);\n\t\t} else if ((folder.tag.type === FolderType.album) || (folder.tag.type === FolderType.multialbum)) {\n\t\t\treturn this.getInfo(false, folder.tag.mbArtistID, folder.tag.artist, folder.tag.mbAlbumID, folder.tag.album);\n\t\t}\n\t}\n\n\tprivate async createArtistInfo(artist: JamServe.Artist): Promise<JamServe.MetaInfo> {\n\t\treturn this.getInfo(true, artist.mbArtistID, artist.name, undefined, undefined);\n\t}\n\n\tprivate async createAlbumInfo(album: JamServe.Album): Promise<JamServe.MetaInfo> {\n\t\treturn this.getInfo(false, album.mbArtistID, album.artist, album.mbAlbumID, album.name);\n\t}\n\n\tprivate async createTrackInfo(track: JamServe.Track): Promise<JamServe.MetaInfoTrack> {\n\t\tif (!track.tag) {\n\t\t\treturn {similar: []};\n\t\t}\n\t\tif (track.tag.mbTrackID) {\n\t\t\tconst tracks = await this.audio.mediaInfoSimilarTrackByMBTrackID(track.tag.mbTrackID);\n\t\t\tif (tracks) {\n\t\t\t\treturn {similar: tracks};\n\t\t\t}\n\t\t} else if (track.tag.artist && track.tag.title) {\n\t\t\tconst tracks = await this.audio.mediaInfoSimilarTrack(track.tag.title, track.tag.artist);\n\t\t\tif (tracks) {\n\t\t\t\treturn {similar: tracks};\n\t\t\t}\n\t\t}\n\t\treturn {similar: []};\n\t}\n\n\tprivate async updateArtistInfo(artist: JamServe.Artist): Promise<JamServe.MetaInfo> {\n\t\tlet info: JamServe.MetaInfo;\n\t\ttry {\n\t\t\tinfo = await this.createArtistInfo(artist);\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\treturn {album: {}, artist: {}, topSongs: []};\n\t\t}\n\t\tinfo = info || {album: {}, artist: {}, topSongs: []};\n\t\tartist.info = info;\n\t\tawait this.store.artist.replace(artist);\n\t\treturn info;\n\t}\n\n\tprivate async updateAlbumInfo(album: JamServe.Album): Promise<JamServe.MetaInfo> {\n\t\tlet info: JamServe.MetaInfo;\n\t\ttry {\n\t\t\tinfo = await this.createAlbumInfo(album);\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\treturn {album: {}, artist: {}, topSongs: []};\n\t\t}\n\t\tinfo = info || {album: {}, artist: {}, topSongs: []};\n\t\talbum.info = info;\n\t\tawait this.store.album.replace(album);\n\t\treturn info;\n\t}\n\n\tprivate async updateTrackInfo(track: JamServe.Track): Promise<JamServe.MetaInfoTrack> {\n\t\tlet info: JamServe.MetaInfoTrack;\n\t\ttry {\n\t\t\tinfo = await this.createTrackInfo(track);\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\treturn {similar: []};\n\t\t}\n\t\tinfo = info || {similar: []};\n\t\ttrack.info = info;\n\t\tawait this.store.track.replace(track);\n\t\treturn info;\n\t}\n\n\tprivate async updateFolderInfo(folder: JamServe.Folder): Promise<JamServe.MetaInfo> {\n\t\tlet info: JamServe.MetaInfo | undefined;\n\t\ttry {\n\t\t\tinfo = await this.createFolderInfo(folder);\n\t\t} catch (e) {\n\t\t\tlog.error(e);\n\t\t\treturn {album: {}, artist: {}, topSongs: []};\n\t\t}\n\t\tinfo = info || {album: {}, artist: {}, topSongs: []};\n\t\tfolder.info = info;\n\t\tawait this.store.folder.replace(folder);\n\t\treturn info;\n\t}\n\n\tprivate async getSimilarSongs(similar: Array<JamServe.MetaInfoSimilarArtist>): Promise<Array<JamServe.MetaInfoTrackSimilarSong>> {\n\t\tconst audio = this.audio;\n\n\t\tasync function checkTopSongs(artist: JamServe.MetaInfoSimilarArtist): Promise<Array<JamServe.MetaInfoTopSong> | void> {\n\t\t\tif (artist.mbid) {\n\t\t\t\treturn audio.mediaInfoTopSongsByArtistID(artist.mbid);\n\t\t\t} else if (artist.name) {\n\t\t\t\treturn audio.mediaInfoTopSongs(artist.name);\n\t\t\t}\n\t\t}\n\n\t\tlet tracks: Array<JamServe.MetaInfoTrackSimilarSong> = [];\n\t\tfor (const artist of similar) {\n\t\t\tconst songs = await checkTopSongs(artist);\n\t\t\tif (songs) {\n\t\t\t\ttracks = tracks.concat(songs.map(song => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: song.name,\n\t\t\t\t\t\tartist: song.artist,\n\t\t\t\t\t\tmbid: song.mbid,\n\t\t\t\t\t\turl: song.url,\n\t\t\t\t\t\timage: song.image\n\t\t\t\t\t};\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t\treturn shuffle<JamServe.MetaInfoTrackSimilarSong>(tracks);\n\t}\n\n\tprivate async getSimilarArtistTracks(similars: Array<MetaInfoSimilarArtist>): Promise<Array<JamServe.Track>> {\n\t\tif (!similars || similars.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconst similar = await this.getSimilarSongs(similars);\n\t\tconst ids: Array<JamServe.MetaInfoTrackSimilarSong> = [];\n\t\tconst vals: Array<JamServe.MetaInfoTrackSimilarSong> = [];\n\t\tconst result: Array<JamServe.Track> = [];\n\t\tsimilar.forEach(sim => {\n\t\t\tif (sim.mbid) {\n\t\t\t\tids.push(sim);\n\t\t\t} else {\n\t\t\t\tvals.push(sim);\n\t\t\t}\n\t\t});\n\t\tconst mbTrackIDs = ids.map(track => track.mbid || '-').filter(id => id !== '-');\n\t\tconst tracks = await this.store.track.search({mbTrackIDs});\n\t\tids.forEach(sim => {\n\t\t\tconst t = tracks.find(tr => tr.tag.mbTrackID === sim.mbid);\n\t\t\tif (!t) {\n\t\t\t\tvals.push(sim);\n\t\t\t} else {\n\t\t\t\tresult.push(t);\n\t\t\t}\n\t\t});\n\t\tfor (const sim of vals) {\n\t\t\tconst track = await this.store.track.searchOne({title: sim.name, artist: sim.artist.name});\n\t\t\tif (track) {\n\t\t\t\tresult.push(track);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync getFolderSimilarArtists(info: JamServe.MetaInfo, includeNotPresent: boolean): Promise<Array<JamServe.MetaInfoFolderSimilarArtist>> {\n\t\tif (!info.artist.similar) {\n\t\t\treturn [];\n\t\t}\n\t\tconst names: Array<string> = [];\n\t\tconst artistsHash: {\n\t\t\t[name: string]: {\n\t\t\t\tinfo: JamServe.MetaInfoSimilarArtist;\n\t\t\t\tfolder?: JamServe.Folder;\n\t\t\t}\n\t\t} = {};\n\t\tinfo.artist.similar.forEach(a => {\n\t\t\tif (a.name) {\n\t\t\t\tnames.push(a.name);\n\t\t\t\tartistsHash[a.name] = {info: a};\n\t\t\t}\n\t\t});\n\t\tconst folders = await this.store.folder.search({types: [FolderType.artist], artists: names});\n\t\tfolders.forEach(f => {\n\t\t\tconst name = f.tag.artist || '';\n\t\t\tif (artistsHash[name]) {\n\t\t\t\tartistsHash[name].folder = f;\n\t\t\t} else {\n\t\t\t\tconsole.log('what? a child not in the name list?', f, artistsHash);\n\t\t\t}\n\t\t});\n\t\tconst artists: Array<JamServe.MetaInfoFolderSimilarArtist> = [];\n\t\tObject.keys(artistsHash).forEach(key => {\n\t\t\tconst a = artistsHash[key];\n\t\t\tif (a.folder) {\n\t\t\t\tconst artist: JamServe.MetaInfoFolderSimilarArtist = {\n\t\t\t\t\t// id: a.folder.id,\n\t\t\t\t\tname: key,\n\t\t\t\t\tfolder: a.folder\n\t\t\t\t};\n\t\t\t\tartists.push(artist);\n\t\t\t} else if (includeNotPresent) {\n\t\t\t\tconst artist: JamServe.MetaInfoFolderSimilarArtist = {\n\t\t\t\t\tname: key\n\t\t\t\t};\n\t\t\t\tartists.push(artist);\n\t\t\t}\n\t\t});\n\t\treturn artists;\n\t}\n\n\tasync getSimilarArtists(info: JamServe.MetaInfo, includeNotPresent: boolean): Promise<Array<JamServe.MetaInfoArtistSimilarArtist>> {\n\t\tif (!info.artist.similar) {\n\t\t\treturn [];\n\t\t}\n\t\tconst names: Array<string> = [];\n\t\tconst artistsHash: {\n\t\t\t[name: string]: {\n\t\t\t\tinfo: JamServe.MetaInfoSimilarArtist;\n\t\t\t\tartist?: JamServe.Artist;\n\t\t\t}\n\t\t} = {};\n\t\tinfo.artist.similar.forEach(a => {\n\t\t\tif (a.name) {\n\t\t\t\tnames.push(a.name);\n\t\t\t\tartistsHash[a.name] = {info: a};\n\t\t\t}\n\t\t});\n\t\tconst artists = await this.store.artist.search({names});\n\t\tartists.forEach(a => {\n\t\t\tconst name = a.name || '';\n\t\t\tif (artistsHash[name]) {\n\t\t\t\tartistsHash[name].artist = a;\n\t\t\t} else {\n\t\t\t\tconsole.log('what? a child not in the name list?', a, artistsHash);\n\t\t\t}\n\t\t});\n\t\tconst result: Array<JamServe.MetaInfoFolderSimilarArtist> = [];\n\t\tObject.keys(artistsHash).forEach(key => {\n\t\t\tconst a = artistsHash[key];\n\t\t\tif (a.artist) {\n\t\t\t\tconst artist: JamServe.MetaInfoArtistSimilarArtist = {\n\t\t\t\t\t// id: a.folder.id,\n\t\t\t\t\tname: key,\n\t\t\t\t\tartist: a.artist\n\t\t\t\t};\n\t\t\t\tresult.push(artist);\n\t\t\t} else if (includeNotPresent) {\n\t\t\t\tconst artist: JamServe.MetaInfoArtistSimilarArtist = {\n\t\t\t\t\tname: key\n\t\t\t\t};\n\t\t\t\tresult.push(artist);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n\tasync getFolderArtistInfo(folder: JamServe.Folder, includeNotPresent: boolean, includeSimilar: boolean): Promise<{ similar?: Array<JamServe.MetaInfoFolderSimilarArtist>, info: JamServe.MetaInfo }> {\n\t\tlet info = folder.info;\n\t\tif (!info) {\n\t\t\tinfo = await this.updateFolderInfo(folder);\n\t\t}\n\t\tif (!includeSimilar || !info.artist.similar) {\n\t\t\treturn {info};\n\t\t}\n\t\tconst similar = await this.getFolderSimilarArtists(info, includeNotPresent);\n\t\treturn {similar, info};\n\t}\n\n\tasync getArtistInfos(artist: JamServe.Artist, includeNotPresent: boolean, includeSimilar: boolean): Promise<{ similar?: Array<JamServe.MetaInfoArtistSimilarArtist>, info: JamServe.MetaInfo }> {\n\t\tlet info = artist.info;\n\t\tif (!info) {\n\t\t\tinfo = await this.updateArtistInfo(artist);\n\t\t}\n\t\tif (!includeSimilar || !info.artist.similar) {\n\t\t\treturn {info};\n\t\t}\n\t\tconst similar = await this.getSimilarArtists(info, includeNotPresent);\n\t\treturn {similar, info};\n\t}\n\n\tasync getFolderInfo(folder: JamServe.Folder): Promise<JamServe.MetaInfo> {\n\t\tif (folder.info) {\n\t\t\treturn folder.info;\n\t\t} else {\n\t\t\treturn this.updateFolderInfo(folder);\n\t\t}\n\t}\n\n\tasync getAlbumInfo(album: JamServe.Album): Promise<JamServe.MetaInfo> {\n\t\tif (album.info) {\n\t\t\treturn album.info;\n\t\t} else {\n\t\t\treturn this.updateAlbumInfo(album);\n\t\t}\n\t}\n\n\tasync getTrackInfo(track: JamServe.Track): Promise<JamServe.MetaInfoTrack | undefined> {\n\t\tif (track.info) {\n\t\t\treturn track.info;\n\t\t}\n\t}\n\n\tasync getTopTracks(artist: string, count: number): Promise<Array<JamServe.Track>> {\n\t\tconst folder = await this.store.folder.searchOne({types: [FolderType.artist], artist});\n\t\tif (!folder) {\n\t\t\treturn [];\n\t\t}\n\t\tlet info = folder.info;\n\t\tif (!info) {\n\t\t\tinfo = await this.updateFolderInfo(folder);\n\t\t}\n\t\tif (info.topSongs && info.topSongs.length > 0) {\n\t\t\tconst ids: Array<JamServe.MetaInfoTopSong> = [];\n\t\t\tconst vals: Array<JamServe.MetaInfoTopSong> = [];\n\t\t\tconst result: Array<JamServe.Track> = [];\n\t\t\tinfo.topSongs.forEach(top => {\n\t\t\t\tif (top.mbid) {\n\t\t\t\t\tids.push(top);\n\t\t\t\t} else {\n\t\t\t\t\tvals.push(top);\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst mbTrackIDs = ids.map(track => track.mbid || '-').filter(i => i !== '-');\n\t\t\tconst tracks = await this.store.track.search({mbTrackIDs});\n\t\t\tids.forEach(sim => {\n\t\t\t\tconst t = tracks.find(tr => tr.tag.mbTrackID === sim.mbid);\n\t\t\t\tif (!t) {\n\t\t\t\t\tvals.push(sim);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(t);\n\t\t\t\t}\n\t\t\t});\n\t\t\tfor (const top of vals) {\n\t\t\t\tconst track = await this.store.track.searchOne({title: top.name, artist: top.artist.name});\n\t\t\t\tif (track) {\n\t\t\t\t\tresult.push(track);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\treturn [];\n\t}\n\n\tasync getAlbumSimilarTracks(album: JamServe.Album): Promise<Array<JamServe.Track>> {\n\t\tconst info = await this.getAlbumInfo(album);\n\t\tif (!info || !info.artist.similar) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.getSimilarArtistTracks(info.artist.similar);\n\t}\n\n\tasync getArtistSimilarTracks(artist: JamServe.Artist): Promise<Array<JamServe.Track>> {\n\t\tconst info = await this.getArtistInfos(artist, false, false);\n\t\tif (!info || !info.similar) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.getSimilarArtistTracks(info.similar);\n\t}\n\n\tasync getFolderSimilarTracks(folder: JamServe.Folder): Promise<Array<JamServe.Track>> {\n\t\tconst info = await this.getFolderInfo(folder);\n\t\tif (!info || !info.artist.similar) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.getSimilarArtistTracks(info.artist.similar);\n\t}\n\n\tasync getTrackSimilarTracks(track: JamServe.Track): Promise<Array<JamServe.Track>> {\n\t\tconst info = await this.getTrackInfo(track);\n\t\tif (!info || !info.similar || info.similar.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconst ids: Array<JamServe.MetaInfoTrackSimilarSong> = [];\n\t\tconst vals: Array<JamServe.MetaInfoTrackSimilarSong> = [];\n\t\tconst result: Array<JamServe.Track> = [];\n\t\tinfo.similar.forEach(sim => {\n\t\t\tif (sim.mbid) {\n\t\t\t\tids.push(sim);\n\t\t\t} else {\n\t\t\t\tvals.push(sim);\n\t\t\t}\n\t\t});\n\t\tconst mbTrackIDs = ids.map(t => t.mbid || '-').filter(i => i !== '-');\n\t\tconst tracks = await this.store.track.search({mbTrackIDs});\n\t\tids.forEach(sim => {\n\t\t\tconst t = tracks.find(tr => tr.tag.mbTrackID === sim.mbid);\n\t\t\tif (!t) {\n\t\t\t\tvals.push(sim);\n\t\t\t} else {\n\t\t\t\tresult.push(t);\n\t\t\t}\n\t\t});\n\t\tfor (const sim of vals) {\n\t\t\tconst t = await this.store.track.searchOne({title: sim.name, artist: sim.artist.name});\n\t\t\tif (t) {\n\t\t\t\tresult.push(t);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n}\n","import {JamServe} from '../../model/jamserve';\nimport {fileDeleteIfExists} from '../../utils/fs-utils';\nimport path from 'path';\nimport {Store} from '../../store/store';\nimport {Images} from '../../io/components/images';\nimport {Config} from '../../config';\n\nexport class Users {\n\tcached: {\n\t\t[id: string]: JamServe.User;\n\t} = {};\n\tstore: Store;\n\timages: Images;\n\timagesPath: string;\n\n\tconstructor(config: Config, store: Store, images: Images) {\n\t\tthis.store = store;\n\t\tthis.images = images;\n\t\tthis.imagesPath = config.getDataPath(['images']);\n\t}\n\n\tclearCache() {\n\t\tthis.cached = {};\n\t}\n\n\tasync setUserImage(user: JamServe.User, filename: string): Promise<void> {\n\t\tconst destFileName = 'avatar-' + user.id + '.png';\n\t\tconst destName = path.join(this.imagesPath, destFileName);\n\t\tawait fileDeleteIfExists(destName);\n\t\tawait this.images.createAvatar(filename, destName);\n\t\tawait this.images.clearImageCacheByID(user.id);\n\t\tuser.avatar = destFileName;\n\t\tuser.avatarLastChanged = Date.now();\n\t\tawait this.store.user.replace(user);\n\t}\n\n\tasync deleteUser(user: JamServe.User): Promise<void> {\n\t\tdelete this.cached[user.id];\n\t\tawait this.store.state.removeByQuery({userID: user.id});\n\t\tawait this.store.playlist.removeByQuery({userID: user.id});\n\t\tawait this.store.bookmark.removeByQuery({userID: user.id});\n\t\tawait this.store.playqueue.removeByQuery({userID: user.id});\n\t\tawait this.images.clearImageCacheByID(user.id);\n\t\tawait this.store.user.remove(user.id);\n\t\t// TODO: remove user chat msg on user.delete\n\t\t// this.cachedata.chat = this.cachedata.chat.filter(c => c.username === user.name);\n\t\tif (user.avatar) {\n\t\t\tawait fileDeleteIfExists(path.join(this.imagesPath, user.avatar));\n\t\t}\n\t}\n\n\tasync createUser(user: JamServe.User): Promise<string> {\n\t\tif (!user.name || user.name.trim().length === 0) {\n\t\t\treturn Promise.reject(Error('Invalid Username'));\n\t\t}\n\t\tconst existingUser = await this.store.user.get(user.name);\n\t\tif (existingUser) {\n\t\t\treturn Promise.reject(Error('Username already exists'));\n\t\t}\n\t\treturn this.store.user.add(user);\n\t}\n\n\tasync getUser(id: string): Promise<JamServe.User | undefined> {\n\t\tlet user: JamServe.User | undefined = this.cached[id];\n\t\tif (user) {\n\t\t\treturn user;\n\t\t}\n\t\tuser = await this.store.user.byId(id);\n\t\tif (user) {\n\t\t\tthis.cached[id] = user;\n\t\t}\n\t\treturn user;\n\t}\n\n\tasync auth(name: string, pass: string): Promise<JamServe.User> {\n\t\treturn this.store.user.auth(name, pass);\n\t}\n\n\tasync authToken(name: string, token: string, salt: string): Promise<JamServe.User> {\n\t\treturn this.store.user.authToken(name, token, salt);\n\t}\n\n\tasync updateUser(user: JamServe.User): Promise<void> {\n\t\tawait this.store.user.replace(user);\n\t\tdelete this.cached[user.id];\n\t}\n}\n","import moment from 'moment';\nimport {JamServe} from '../../model/jamserve';\nimport {Config} from '../../config';\n\nexport class Chat {\n\tprivate readonly config: Config;\n\tprivate lastCheck = 0;\n\tprivate messages: Array<JamServe.ChatMessage> = [];\n\n\tconstructor(config: Config) {\n\t\tthis.config = config;\n\t}\n\n\tasync cleanOld(): Promise<void> {\n\t\tconst now = (new Date()).valueOf();\n\t\tif ((now - (60 * 1000)) > this.lastCheck) {\n\t\t\tthis.lastCheck = now;\n\t\t\tconst duration = moment.duration(this.config.app.chat.maxAge.value, <moment.unitOfTime.Base>this.config.app.chat.maxAge.unit);\n\t\t\tconst d = moment().subtract(duration).valueOf();\n\t\t\tthis.messages = this.messages.filter(c => d < c.time);\n\t\t}\n\t}\n\n\tasync find(time: number): Promise<JamServe.ChatMessage | undefined> {\n\t\treturn this.messages.find(msg => msg.time === time);\n\t}\n\n\tasync remove(message: JamServe.ChatMessage): Promise<void> {\n\t\tthis.messages = this.messages.filter(msg => msg === message);\n\t}\n\n\tasync get(since: number | undefined): Promise<Array<JamServe.ChatMessage>> {\n\t\tawait this.cleanOld();\n\t\tlet list: Array<JamServe.ChatMessage> = this.messages;\n\t\tif (since !== undefined && !isNaN(since)) {\n\t\t\tlist = list.filter(msg => msg.time > since);\n\t\t}\n\t\treturn list;\n\t}\n\n\tasync add(message: string, user: JamServe.User): Promise<void> {\n\t\tawait this.cleanOld();\n\t\tconst c = {\n\t\t\tmessage: message,\n\t\t\ttime: (new Date()).valueOf(),\n\t\t\tusername: user.name,\n\t\t\tuserID: user.id\n\t\t};\n\t\tthis.messages.push(c);\n\t\tif (this.messages.length > this.config.app.chat.maxMsgs) {\n\t\t\tthis.messages.shift();\n\t\t}\n\t}\n\n}\n","import {JamServe} from '../../model/jamserve';\nimport {Store} from '../../store/store';\n\nexport interface Genre {\n\tname: string;\n\tsections: Array<{\n\t\trootID: string;\n\t\ttrackCount: number;\n\t\tartistCount: number;\n\t\talbumCount: number;\n\t}>;\n}\n\nexport class Genres {\n\tprivate readonly store: Store;\n\tprivate genres: Array<Genre> = [];\n\n\tconstructor(store: Store) {\n\t\tthis.store = store;\n\t}\n\n\tasync buildGenres(): Promise<void> {\n\t\t// logger.info('Build Genres');\n\t\tconst genreHash: {\n\t\t\t[name: string]: {\n\t\t\t\troots: {\n\t\t\t\t\t[id: string]: {\n\t\t\t\t\t\tcount: number;\n\t\t\t\t\t\tartists: { [name: string]: number };\n\t\t\t\t\t\talbums: { [name: string]: number };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} = {};\n\n\t\tawait this.store.track.iterate(async (tracks) => {\n\t\t\tfor (const track of tracks) {\n\t\t\t\tconst genre = track.tag.genre || '[No genre]';\n\t\t\t\tconst data = genreHash[genre] || {roots: {}};\n\t\t\t\tconst section = data.roots[track.rootID] || {count: 0, artists: {}, albums: {}};\n\t\t\t\tsection.count++;\n\t\t\t\tif (track.artistID) {\n\t\t\t\t\tsection.artists[track.artistID] = (section.artists[track.artistID] || 0) + 1;\n\t\t\t\t}\n\t\t\t\tif (track.albumID) {\n\t\t\t\t\tsection.albums[track.albumID] = (section.albums[track.albumID] || 0) + 1;\n\t\t\t\t}\n\t\t\t\tdata.roots[track.rootID] = section;\n\t\t\t\tgenreHash[genre] = data;\n\t\t\t}\n\t\t});\n\n\t\tthis.genres = Object.keys(genreHash).map(key => {\n\t\t\tconst data = genreHash[key];\n\t\t\treturn {\n\t\t\t\tname: key,\n\t\t\t\tsections: Object.keys(data.roots).map(sec => {\n\t\t\t\t\tconst section = data.roots[sec];\n\t\t\t\t\treturn {\n\t\t\t\t\t\trootID: sec,\n\t\t\t\t\t\tartistCount: Object.keys(section.artists).length,\n\t\t\t\t\t\talbumCount: Object.keys(section.albums).length,\n\t\t\t\t\t\ttrackCount: section.count\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t};\n\t\t});\n\t}\n\n\tasync getGenres(rootID: string | undefined, forcerebuild: boolean): Promise<Array<JamServe.Genre>> {\n\t\tif (forcerebuild || this.genres.length === 0) {\n\t\t\tawait this.buildGenres();\n\t\t}\n\t\treturn this.genres.map(g => {\n\t\t\tconst genre = {\n\t\t\t\tname: g.name,\n\t\t\t\talbumCount: 0,\n\t\t\t\tartistCount: 0,\n\t\t\t\ttrackCount: 0\n\t\t\t};\n\t\t\tg.sections.forEach(section => {\n\t\t\t\tif (!rootID || section.rootID === rootID) {\n\t\t\t\t\tgenre.albumCount += section.albumCount;\n\t\t\t\t\tgenre.artistCount += section.artistCount;\n\t\t\t\t\tgenre.trackCount += section.trackCount;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn genre;\n\t\t}).filter(genre => genre.trackCount > 0);\n\t}\n\n}\n","import {JamServe} from '../../model/jamserve';\nimport {Store} from '../../store/store';\nimport {Feed, PodcastStatus} from '../../utils/feed';\nimport {fileDeleteIfExists, fileSuffix, fsStat, makePath} from '../../utils/fs-utils';\nimport {SupportedAudioFormat} from '../../utils/filetype';\nimport path from 'path';\nimport Logger from '../../utils/logger';\nimport {Audio} from '../../audio/audio';\nimport {DBObjectType} from '../../types';\nimport {downloadFile} from '../../utils/download';\nimport {Config} from '../../config';\n\nconst log = Logger('Podcasts');\n\nexport class Podcasts {\n\tprivate readonly audio: Audio;\n\tprivate readonly store: Store;\n\tprivate readonly podcastsPath: string;\n\tpodstate: {\n\t\t[id: string]: any;\n\t} = {};\n\n\tconstructor(config: Config, store: Store, audio: Audio) {\n\t\tthis.audio = audio;\n\t\tthis.podcastsPath = config.getDataPath(['podcasts']);\n\t\tthis.store = store;\n\t}\n\n\tisDownloadingPodcast(podcastId: string): boolean {\n\t\treturn !!this.podstate[podcastId];\n\t}\n\n\tisDownloadingPodcastEpisode(podcastEpisodeId: string): boolean {\n\t\treturn !!this.podstate[podcastEpisodeId];\n\t}\n\n\tasync mergePodcastEpisodes(podcast: JamServe.Podcast, episodes: Array<JamServe.Episode>): Promise<void> {\n\t\tif ((!episodes) || (!episodes.length)) {\n\t\t\treturn;\n\t\t}\n\t\tconst epi = await this.store.episode.search({podcastID: podcast.id});\n\t\tconst links = epi.map(e => e.link);\n\t\tepisodes = episodes.filter(e => links.indexOf(e.link) < 0);\n\t\tlog.info(podcast.url + ': ' + episodes.length + ' new episodes');\n\t\tawait this.store.episode.upsert(episodes);\n\t}\n\n\tasync downloadPodcastEpisode(episode: JamServe.Episode): Promise<void> {\n\t\ttry {\n\t\t\tthis.podstate[episode.id] = episode;\n\t\t\tlet url = '';\n\t\t\tif (episode.enclosures && episode.enclosures.length > 0) {\n\t\t\t\turl = episode.enclosures[0].url;\n\t\t\t} else {\n\t\t\t\treturn Promise.reject(Error('No podcast episode url found'));\n\t\t\t}\n\t\t\tconst ext = fileSuffix(url);\n\t\t\tif (SupportedAudioFormat.indexOf(ext) < 0) {\n\t\t\t\treturn Promise.reject(Error('Unsupported Podcast audio format'));\n\t\t\t}\n\t\t\tconst p = path.resolve(this.podcastsPath, episode.podcastID);\n\t\t\tawait makePath(p);\n\t\t\tconst filename = path.join(p, episode.id + '.' + (ext || 'mp3'));\n\t\t\tlog.info('retrieving file', url);\n\t\t\tawait downloadFile(url, filename);\n\t\t\tconst stat = await fsStat(filename);\n\t\t\tconst result = await this.audio.read(filename);\n\t\t\tepisode.status = PodcastStatus.completed;\n\t\t\tepisode.tag = result.tag;\n\t\t\tepisode.media = result.media;\n\t\t\tepisode.stat = {\n\t\t\t\tcreated: stat.ctime.valueOf(),\n\t\t\t\tmodified: stat.mtime.valueOf(),\n\t\t\t\tsize: stat.size\n\t\t\t};\n\t\t\tepisode.path = filename;\n\t\t\tlog.info('updating episode', filename);\n\t\t\tawait this.store.episode.replace(episode);\n\t\t\tdelete this.podstate[episode.id];\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tepisode.status = PodcastStatus.error;\n\t\t\tepisode.error = (e || '').toString();\n\t\t\tdelete this.podstate[episode.id];\n\t\t\treturn this.store.episode.replace(episode);\n\t\t}\n\t}\n\n\tasync refreshPodcast(podcast: JamServe.Podcast): Promise<void> {\n\t\tlog.debug('Refreshing Podcast', podcast.url);\n\t\tthis.podstate[podcast.id] = podcast;\n\t\tconst feed = new Feed();\n\t\tlet episodes: Array<JamServe.Episode> = [];\n\t\ttry {\n\t\t\tconst result = await feed.get(podcast);\n\t\t\tif (result) {\n\t\t\t\tpodcast.tag = result.tag;\n\t\t\t\tepisodes = result.episodes;\n\t\t\t}\n\t\t\tpodcast.status = PodcastStatus.completed;\n\t\t\tpodcast.errorMessage = undefined;\n\t\t} catch (e) {\n\t\t\tlog.error('Refreshing Podcast', e);\n\t\t\tpodcast.status = PodcastStatus.error;\n\t\t\tpodcast.errorMessage = (e || '').toString();\n\t\t}\n\t\tpodcast.lastCheck = Date.now();\n\t\tawait this.store.podcast.replace(podcast);\n\t\tawait this.mergePodcastEpisodes(podcast, episodes);\n\t\tdelete this.podstate[podcast.id];\n\t}\n\n\tasync refreshPodcasts(): Promise<void> {\n\t\tlog.info('Refreshing');\n\t\tconst podcasts = await\n\t\t\tthis.store.podcast.all();\n\t\tfor (const podcast of podcasts) {\n\t\t\tawait this.refreshPodcast(podcast);\n\t\t}\n\t\tlog.info('Refreshed');\n\t}\n\n\tasync addPodcast(url: string): Promise<JamServe.Podcast> {\n\t\tconst podcast: JamServe.Podcast = {\n\t\t\tid: '',\n\t\t\ttype: DBObjectType.podcast,\n\t\t\tcreated: Date.now(),\n\t\t\tlastCheck: 0,\n\t\t\turl: url,\n\t\t\tstatus: PodcastStatus.fresh\n\t\t};\n\t\tpodcast.id = await this.store.podcast.add(podcast);\n\t\treturn podcast;\n\t}\n\n\tasync removePodcast(podcast: JamServe.Podcast): Promise<void> {\n\t\tawait this.store.podcast.remove(podcast.id);\n\t\tconst removeEpisodes = await this.store.episode.search({podcastID: podcast.id});\n\t\tconst ids = removeEpisodes.map(episode => episode.id);\n\t\tawait this.store.episode.remove(ids);\n\t\tfor (const episode of removeEpisodes) {\n\t\t\tif (episode.path) {\n\t\t\t\tawait fileDeleteIfExists(episode.path);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync deletePodcastEpisode(episode: JamServe.Episode): Promise<void> {\n\t\tif (episode.path) {\n\t\t\tawait fileDeleteIfExists(episode.path);\n\t\t\tepisode.path = undefined;\n\t\t\tepisode.stat = undefined;\n\t\t\tepisode.media = undefined;\n\t\t\tepisode.status = PodcastStatus.skipped;\n\t\t\tawait this.store.episode.replace(episode);\n\t\t}\n\n\t}\n}\n","module.exports = require(\"zlib\");","module.exports = require(\"feedparser\");","module.exports = require(\"iconv-lite\");","import {JamServe} from '../../model/jamserve';\nimport {Store} from '../../store/store';\nimport {DBObjectType} from '../../types';\n\nexport class NowPlaying {\n\tprivate readonly store: Store;\n\tplaying: Array<JamServe.NowPlaying> = [];\n\n\tconstructor(store: Store) {\n\t\tthis.store = store;\n\t}\n\n\tasync getNowPlaying(): Promise<Array<JamServe.NowPlaying>> {\n\t\treturn this.playing;\n\t}\n\n\tasync reportPlaying(id: string, type: DBObjectType, user: JamServe.User): Promise<void> {\n\t\tconst state = await this.store.state.findOrCreate(id, user.id, type);\n\t\tstate.played++;\n\t\tstate.lastplayed = (new Date()).valueOf();\n\t\tawait this.store.state.upsert([state]);\n\t}\n\n\tasync reportEpisode(episode: JamServe.Episode, user: JamServe.User): Promise<void> {\n\t\tthis.playing = this.playing.filter(np => (np.user.id !== user.id));\n\t\tthis.playing.push({\n\t\t\ttime: (new Date()).valueOf(),\n\t\t\tobj: episode,\n\t\t\tuser: user\n\t\t});\n\t\tawait this.reportPlaying(episode.id, DBObjectType.episode, user);\n\t}\n\n\tasync reportTrack(track: JamServe.Track, user: JamServe.User): Promise<void> {\n\t\tthis.playing = this.playing.filter(np => (np.user.id !== user.id));\n\t\tthis.playing.push({\n\t\t\ttime: (new Date()).valueOf(),\n\t\t\tobj: track,\n\t\t\tuser: user\n\t\t});\n\t\tawait this.reportPlaying(track.id, DBObjectType.track, user);\n\t\tawait this.reportPlaying(track.albumID, DBObjectType.album, user);\n\t\tawait this.reportPlaying(track.artistID, DBObjectType.artist, user);\n\t\tawait this.reportPlaying(track.parentID, DBObjectType.folder, user);\n\t}\n}\n","import archiver from 'archiver';\nimport express from 'express';\nimport {IStreamData} from '../typings';\nimport * as path from 'path';\n\nexport class CompressStream implements IStreamData {\n\tpublic filename: string;\n\tpublic folder: string;\n\tpublic streaming = true;\n\n\tconstructor(folder: string, filename: string) {\n\t\tthis.filename = filename;\n\t\tthis.folder = folder;\n\t}\n\n\tpipe(stream: express.Response) {\n\t\t// logger.verbose('Start streaming');\n\t\tconst format = 'zip';\n\t\tconst archive = archiver(format, {zlib: {level: 0}});\n\t\tarchive.on('error', (err) => {\n\t\t\t// logger.error('archiver err ' + err);\n\t\t\tthrow err;\n\t\t});\n\t\tstream.contentType('zip');\n\t\tstream.setHeader('Content-Disposition', 'attachment; filename=\"' + (this.filename || 'download') + '.' + format + '\"');\n\t\t// stream.setHeader('Content-Length', stat.size); do not report wrong size!\n\t\tstream.on('finish', () => {\n\t\t\t// logger.verbose('streamed ' + archive.pointer() + ' total bytes');\n\t\t\tthis.streaming = false;\n\t\t});\n\t\tarchive.pipe(stream);\n\t\tarchive.directory(this.folder, false);\n\t\tarchive.finalize();\n\t}\n\n}\n\nexport class CompressListStream implements IStreamData {\n\tpublic filename: string;\n\tpublic list: Array<string> = [];\n\tpublic streaming = true;\n\n\tconstructor(list: Array<string>, filename: string) {\n\t\tthis.filename = filename;\n\t\tthis.list = list;\n\t}\n\n\tpipe(stream: express.Response) {\n\t\t// logger.verbose('Start streaming');\n\t\tconst format = 'zip';\n\t\tconst archive = archiver(format, {zlib: {level: 0}});\n\t\tarchive.on('error', (err) => {\n\t\t\t// logger.error('archiver err ' + err);\n\t\t\tthrow err;\n\t\t});\n\t\tstream.contentType('zip');\n\t\tstream.setHeader('Content-Disposition', 'attachment; filename=\"' + (this.filename || 'download') + '.' + format + '\"');\n\t\t// stream.setHeader('Content-Length', stat.size); do not report wrong size!\n\t\tstream.on('finish', () => {\n\t\t\t// logger.verbose('streamed ' + archive.pointer() + ' total bytes');\n\t\t\tthis.streaming = false;\n\t\t});\n\t\tarchive.pipe(stream);\n\t\tthis.list.forEach(file => {\n\t\t\tarchive.file(file, {name: path.basename(file)});\n\t\t});\n\t\tarchive.finalize();\n\t}\n\n}\n","module.exports = require(\"archiver\");","import ffmpeg from 'fluent-ffmpeg';\nimport express from 'express';\nimport tmp from 'tmp';\nimport {IStreamData} from '../typings';\nimport Logger from '../utils/logger';\nimport * as fs from 'fs';\nimport {JamServe} from '../model/jamserve';\n\nconst log = Logger('audio.transcoder');\n\nexport class Transcoder implements IStreamData {\n\tfilename: string;\n\tformat: string;\n\tmaxBitRate: number;\n\tduration?: number;\n\n\tconstructor(filename: string, format: string, maxBitRate: number, duration?: number) {\n\t\tthis.filename = filename;\n\t\tthis.format = format;\n\t\tthis.maxBitRate = maxBitRate;\n\t\tthis.duration = duration;\n\t\tif (maxBitRate <= 0) {\n\t\t\tthis.maxBitRate = 128;\n\t\t}\n\t}\n\n\tstatic needsTranscoding(mediaFormat: string, format: string, maxBitRate: number) {\n\t\treturn (format !== mediaFormat) || (maxBitRate > 0);\n\t}\n\n\tstatic validTranscoding(media: JamServe.TrackMedia, format: string) {\n\t\treturn ['mp3', 'flv', 'ogg', 'oga', 'flac', 'mp4'].indexOf(format) >= 0;\n\t}\n\n\tstatic async getAvailableFormats(): Promise<Array<{ format: string, name: string }>> {\n\t\treturn new Promise<Array<{ format: string, name: string }>>((resolve, reject) => {\n\t\t\tffmpeg().getAvailableFormats((err, formats) => {\n\t\t\t\tif (err || !formats) {\n\t\t\t\t\treturn reject(err);\n\t\t\t\t}\n\t\t\t\tresolve(Object.keys(formats).filter(key => formats[key].canDemux).map(key => {\n\t\t\t\t\treturn {format: key, name: formats[key].description};\n\t\t\t\t}));\n\t\t\t});\n\t\t});\n\t}\n\n\t//\n\t// private getSize(cb: (length: number) => void) {\n\t// \tif (this.duration !== undefined && this.duration > 0) {\n\t// \t\tconst length = Math.round((this.maxBitRate * 1000 * this.duration) / 8);\n\t// \t\treturn cb(length);\n\t// \t}\n\t// \tffmpeg.ffprobe(this.filename, (err, metadata) => {\n\t// \t\tlet length = 0;\n\t// \t\tif (metadata && metadata.format && metadata.format.duration) {\n\t// \t\t\tconst duration = metadata.format ? parseInt(metadata.format.duration, 10) : 0;\n\t// \t\t\tlength = Math.round((this.maxBitRate * 1000 * duration) / 8);\n\t// \t\t}\n\t// \t\tcb(length);\n\t// \t});\n\t// }\n\n\tpipe(stream: express.Response) {\n\t\tlog.info('Start transcode streaming', this.format, this.maxBitRate);\n\t\tconst proc = ffmpeg(<ffmpeg.FfmpegCommandOptions>{source: this.filename, nolog: true});\n\t\tif (this.format === 'mp3') {\n\t\t\tproc.withAudioCodec('libmp3lame');\n\t\t}\n\t\tproc.withNoVideo()\n\t\t\t.toFormat(this.format)\n\t\t\t.withAudioBitrate(this.maxBitRate + 'k')\n\t\t\t.on('end', () => {\n\t\t\t\tlog.debug('file has been transcoded successfully');\n\t\t\t})\n\t\t\t.on('error', (err: Error) => {\n\t\t\t\tlog.error('an error happened while transcoding: ' + err.message);\n\t\t\t});\n\t\tstream.contentType(this.format);\n\t\tproc.writeToStream(stream, {end: true});\n\t}\n\n}\n\nexport class PreTranscoder implements IStreamData {\n\tfilename: string;\n\tformat: string;\n\tmaxBitRate: number;\n\n\tconstructor(filename: string, format: string, maxBitRate: number) {\n\t\tthis.filename = filename;\n\t\tthis.format = format;\n\t\tthis.maxBitRate = maxBitRate;\n\t\tif (maxBitRate <= 0) {\n\t\t\tthis.maxBitRate = 128;\n\t\t}\n\t}\n\n\tpipe(stream: express.Response) {\n\t\tlog.info('Start transcode first and stream after', this.format, this.maxBitRate);\n\t\ttmp.file((err, filename, fd, cleanupCallback) => {\n\t\t\tif (err) {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\tconst proc = ffmpeg(<ffmpeg.FfmpegCommandOptions>{source: this.filename, nolog: true});\n\t\t\tif (this.format === 'mp3') {\n\t\t\t\tproc.withAudioCodec('libmp3lame');\n\t\t\t}\n\t\t\tproc.withNoVideo()\n\t\t\t\t.toFormat(this.format)\n\t\t\t\t.withAudioBitrate(this.maxBitRate + 'k')\n\t\t\t\t.on('end', () => {\n\t\t\t\t\tlog.info('file has been transcoded successfully, sending it now');\n\t\t\t\t\tstream.contentType(this.format);\n\t\t\t\t\tstream.setHeader('Content-Length', fs.statSync(filename).size);\n\t\t\t\t\tconst rs = fs.createReadStream(filename, {autoClose: true});\n\t\t\t\t\trs.on('end', () => {\n\t\t\t\t\t\tcleanupCallback();\n\t\t\t\t\t});\n\t\t\t\t\trs.on('error', () => {\n\t\t\t\t\t\tcleanupCallback();\n\t\t\t\t\t});\n\t\t\t\t\trs.pipe(stream);\n\t\t\t\t})\n\t\t\t\t.on('error', (err2: Error) => {\n\t\t\t\t\tcleanupCallback();\n\t\t\t\t\tconst msg = 'an error happened while transcoding: ' + err2.message;\n\t\t\t\t\tstream.status(400).send(msg);\n\t\t\t\t\tlog.error(msg);\n\t\t\t\t});\n\t\t\tproc.save(filename);\n\t\t});\n\t}\n\n}\n","module.exports = require(\"fluent-ffmpeg\");","import {Store} from '../../store/store';\nimport {JamServe} from '../../model/jamserve';\nimport {IO} from '../../io/io';\n\nexport class Roots {\n\tstore: Store;\n\tio: IO;\n\n\tconstructor(store: Store, io: IO) {\n\t\tthis.store = store;\n\t\tthis.io = io;\n\t}\n\n\tasync createRoot(root: JamServe.Root): Promise<string> {\n\t\tconst roots = await this.store.root.search({});\n\t\tconst invalid = roots.find(r => {\n\t\t\treturn root.path.indexOf(r.path) >= 0 || r.path.indexOf(root.path) >= 0;\n\t\t});\n\t\tif (invalid) {\n\t\t\treturn Promise.reject(Error('Root path already used'));\n\t\t}\n\t\treturn this.store.root.add(root);\n\t}\n\n\tasync removeRoot(root: JamServe.Root): Promise<void> {\n\t\tawait this.store.root.remove(root.id);\n\t\tawait this.io.cleanStore();\n\t}\n\n\tasync updateRoot(root: JamServe.Root): Promise<void> {\n\t\tconst roots = await this.store.root.search({});\n\t\tconst invalid = roots.find(r => {\n\t\t\treturn r.id !== root.id && (root.path.indexOf(r.path) >= 0 || r.path.indexOf(root.path) >= 0);\n\t\t});\n\t\tif (invalid) {\n\t\t\treturn Promise.reject(Error('Root path already used'));\n\t\t}\n\t\tawait this.store.root.replace(root);\n\t}\n}\n","import {Store} from '../../store/store';\nimport {DBObjectType} from '../../types';\nimport {JamServe} from '../../model/jamserve';\n\nexport class PlayQueues {\n\tstore: Store;\n\n\tconstructor(store: Store) {\n\t\tthis.store = store;\n\t}\n\n\tasync getQueueOrCreate(userID: string, client?: string): Promise<JamServe.PlayQueue> {\n\t\tlet playQueue = await this.getQueue(userID);\n\t\tif (!playQueue) {\n\t\t\tplayQueue = {\n\t\t\t\tid: '',\n\t\t\t\ttype: DBObjectType.playqueue,\n\t\t\t\tuserID,\n\t\t\t\ttrackIDs: [],\n\t\t\t\tchanged: Date.now(),\n\t\t\t\tchangedBy: client || 'Unknown Client'\n\t\t\t};\n\t\t}\n\t\tawait this.store.playqueue.replace(playQueue);\n\t\treturn playQueue;\n\t}\n\n\tasync getQueue(userID: string): Promise<JamServe.PlayQueue | undefined> {\n\t\treturn this.store.playqueue.searchOne({userID});\n\t}\n\n\tasync saveQueue(userID: string, trackIDs: Array<string>, currentID: string | undefined, position: number | undefined, client?: string): Promise<void> {\n\t\tlet playQueue = await this.store.playqueue.searchOne({userID});\n\t\tif (!playQueue) {\n\t\t\tplayQueue = {\n\t\t\t\tid: '',\n\t\t\t\ttype: DBObjectType.playqueue,\n\t\t\t\tuserID,\n\t\t\t\ttrackIDs,\n\t\t\t\tcurrentID,\n\t\t\t\tposition,\n\t\t\t\tchanged: Date.now(),\n\t\t\t\tchangedBy: client || 'Unknown Client'\n\t\t\t};\n\t\t\tplayQueue.id = await this.store.playqueue.add(playQueue);\n\t\t} else {\n\t\t\tplayQueue.trackIDs = trackIDs;\n\t\t\tplayQueue.currentID = currentID;\n\t\t\tplayQueue.position = position;\n\t\t\tplayQueue.changed = Date.now();\n\t\t\tplayQueue.changedBy = client || 'Unknown Client';\n\t\t\tawait this.store.playqueue.replace(playQueue);\n\t\t}\n\t}\n}\n","import path from 'path';\nimport Logger from '../../utils/logger';\nimport {dirRead, fileDelete, fileDeleteIfExists, fileExists, fileWrite} from '../../utils/fs-utils';\nimport {IApiBinaryResult} from '../../typings';\nimport {Config} from '../../config';\nimport {DebouncePromises} from '../../utils/debounce-promises';\nimport {getWaveFormSVG} from '../../audio/tools/ffmpeg-waveform-svg';\nimport {JamServe} from '../../model/jamserve';\n\nconst log = Logger('WaveForms');\n\nexport class Waveforms {\n\tprivate waveformCachePath: string;\n\tprivate waveformCacheDebounce = new DebouncePromises<IApiBinaryResult>();\n\n\tconstructor(config: Config) {\n\t\tthis.waveformCachePath = config.getDataPath(['cache', 'waveforms']);\n\t}\n\n\tprivate getCacheID(id: string): string {\n\t\treturn 'waveform-' + id + '.svg';\n\t}\n\n\tprivate async getWaveform(filename: string, name: string): Promise<IApiBinaryResult> {\n\t\tconst exists = await fileExists(filename);\n\t\tif (!exists) {\n\t\t\treturn Promise.reject(Error('File not found'));\n\t\t}\n\t\tconst data = await getWaveFormSVG(filename);\n\t\treturn {buffer: {buffer: Buffer.from(data), contentType: 'image/svg+xml'}};\n\t}\n\n\tasync clearWaveformCacheByID(id: string): Promise<void> {\n\t\tif (id.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst cacheID = this.getCacheID(id);\n\t\tconst filename = path.join(this.waveformCachePath, cacheID);\n\t\tawait fileDeleteIfExists(filename);\n\t}\n\n\tasync clearWaveformCacheByIDs(ids: Array<string>): Promise<void> {\n\t\tconst searches = ids.filter(id => id.length > 0).map(id => this.getCacheID(id));\n\t\tif (searches.length > 0) {\n\t\t\tlet list = await dirRead(this.waveformCachePath);\n\t\t\tlist = list.filter(name => {\n\t\t\t\treturn searches.findIndex(s => name.indexOf(s) === 0) >= 0;\n\t\t\t});\n\t\t\tfor (const filename of list) {\n\t\t\t\tawait fileDelete(path.resolve(this.waveformCachePath, filename));\n\t\t\t}\n\t\t}\n\t}\n\n\tasync get(id: string, filename: string, media: JamServe.TrackMedia): Promise<IApiBinaryResult> {\n\t\tif (!filename) {\n\t\t\treturn Promise.reject(Error('Invalid Path'));\n\t\t}\n\t\tconst cacheID = this.getCacheID(id);\n\t\tif (this.waveformCacheDebounce.isPending(cacheID)) {\n\t\t\treturn this.waveformCacheDebounce.append(cacheID);\n\t\t}\n\t\tthis.waveformCacheDebounce.setPending(cacheID);\n\t\ttry {\n\t\t\tlet result: IApiBinaryResult;\n\t\t\tconst cachefile = path.join(this.waveformCachePath, cacheID);\n\t\t\tconst exists = await fileExists(cachefile);\n\t\t\tif (exists) {\n\t\t\t\tresult = {file: {filename: cachefile, name: cacheID}};\n\t\t\t} else {\n\t\t\t\tresult = await this.getWaveform(filename, cacheID);\n\t\t\t\tif (result.buffer) {\n\t\t\t\t\tlog.debug('Writing waveform cache file', cachefile);\n\t\t\t\t\tawait fileWrite(cachefile, result.buffer.buffer);\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait this.waveformCacheDebounce.resolve(cacheID, result);\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tawait this.waveformCacheDebounce.reject(cacheID, e);\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n\n}\n","/* adapted from\n\thttps://github.com/phding/waveform-node\n\thttps://github.com/t4nz/ffmpeg-peaks\n\thttps://github.com/antonKalinin/audio-waveform-svg-path\n\thttps://github.com/invokemedia/audio-to-svg-waveform\n */\n\nimport {spawnTool} from '../../utils/tool';\nimport SVGO from 'svgo';\nimport {fsStat, tmpFile} from '../../utils/fs-utils';\nimport fs from 'fs';\n\nexport async function getWaveFormSVG(filepath: string): Promise<string> {\n\tconst wf = new WaveFormSVG();\n\tconst result = await wf.generate(filepath);\n\treturn result;\n}\n\nclass PeakData {\n\tlastMax: Array<number>;\n\tlastMin: Array<number>;\n\tindexI: Array<number>;\n\tindexJ: Array<number>;\n\tindexJJOverflow: Array<number>;\n\tsplitPeaks: Array<Array<number>>;\n\n\tconstructor(private channels: number) {\n\t\tthis.lastMax = Array(channels).fill(0);\n\t\tthis.lastMin = Array(channels).fill(0);\n\t\tthis.indexI = Array(channels).fill(0);\n\t\tthis.indexJ = Array(channels).fill(0);\n\t\tthis.indexJJOverflow = Array(channels).fill(0);\n\t\tthis.splitPeaks = [];\n\t\tfor (let i = 0; i < channels; i++) {\n\t\t\tthis.splitPeaks[i] = [];\n\t\t}\n\t}\n}\n\nclass GetPeaks {\n\t/*\n\tSource: https://github.com/t4nz/ffmpeg-peaks/blob/master/getPeaks.js\n\t */\n\tprivate mergedPeaks: Array<number> = [];\n\tprivate data?: PeakData;\n\n\tconstructor(private splitChannels: boolean, private length: number, private sampleStep: number, private totalSamples: number) {\n\t}\n\n\tupdate(buffers: Array<Array<number>>) {\n\t\tconst sampleSize = this.totalSamples / this.length;\n\t\tconst channels = buffers.length;\n\t\tif (this.data === undefined) {\n\t\t\tthis.data = new PeakData(channels);\n\t\t}\n\t\tfor (let c = 0; c < channels; c++) {\n\t\t\tconst chan = buffers[c];\n\t\t\tconst peaks = this.data.splitPeaks[c];\n\t\t\tlet i;\n\t\t\tfor (i = this.data.indexI[c]; i < this.length; i++) {\n\t\t\t\tconst start = Math.max(~~(i * sampleSize), this.data.indexJ[c]);\n\t\t\t\tconst end = ~~((i + 1) * sampleSize);\n\t\t\t\tlet min = this.data.lastMin[c];\n\t\t\t\tlet max = this.data.lastMax[c];\n\n\t\t\t\tlet broken = false;\n\t\t\t\tlet jj;\n\t\t\t\tfor (let j = start; j < end; j += this.sampleStep) {\n\t\t\t\t\tjj = j - this.data.indexJ[c] + this.data.indexJJOverflow[c];\n\n\t\t\t\t\tif (jj > chan.length - 1) {\n\t\t\t\t\t\tthis.data.indexI[c] = i;\n\t\t\t\t\t\tthis.data.indexJJOverflow[c] = jj - (chan.length - 1) - 1;\n\t\t\t\t\t\tthis.data.indexJ[c] = j;\n\t\t\t\t\t\tthis.data.lastMax[c] = max;\n\t\t\t\t\t\tthis.data.lastMin[c] = min;\n\t\t\t\t\t\tbroken = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = chan[jj];\n\t\t\t\t\tif (value > max) {\n\t\t\t\t\t\tmax = value;\n\t\t\t\t\t}\n\t\t\t\t\tif (value < min) {\n\t\t\t\t\t\tmin = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (broken) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tthis.data.lastMax[c] = 0;\n\t\t\t\t\tthis.data.lastMin[c] = 0;\n\t\t\t\t}\n\t\t\t\tpeaks[2 * i] = max;\n\t\t\t\tpeaks[2 * i + 1] = min;\n\t\t\t\tif (c === 0 || max > this.mergedPeaks[2 * i]) {\n\t\t\t\t\tthis.mergedPeaks[2 * i] = max;\n\t\t\t\t}\n\t\t\t\tif (c === 0 || min < this.mergedPeaks[2 * i + 1]) {\n\t\t\t\t\tthis.mergedPeaks[2 * i + 1] = min;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.data.indexI[c] = i;  // We finished for channel c. For the next call start from i = this.length so we do nothing.\n\t\t}\n\t}\n\n\tget() {\n\t\treturn this.splitChannels && this.data ? this.data.splitPeaks : this.mergedPeaks;\n\t}\n}\n\nexport class WaveFormSVG {\n\tprivate svgo = new SVGO();\n\n\tasync generate(filename: string): Promise<string> {\n\t\tconst temp = await tmpFile();\n\t\tawait this.convertFile(filename, temp.filename);\n\t\tconst peaks = await this.getPeaks(temp.filename);\n\t\ttemp.cleanupCallback();\n\t\tconst paths = this.svgPath(peaks);\n\t\tconst svg = this.svg(paths);\n\t\tconst optimized = await this.svgo.optimize(svg);\n\t\treturn optimized.data;\n\t}\n\n\tprivate svg(paths: string): string {\n\t\tconst w = 100;\n\t\tconst h = 81;\n\t\tconst result = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" version=\"1.1\" preserveAspectRatio=\"none\"\n     viewBox=\"0 0 ${w} ${h}\" style=\"fill-rule:evenodd;clip-rule:evenodd;\">\n    <g transform=\"matrix(0.0334504,0,0,81,0,40.5)\">\n\t\t<path stroke=\"black\" d=\"${paths}\" />\n\t</g>\n</svg>`;\n\t\treturn result;\n\t}\n\n\tprivate svgPathMixedChannel(peaks: Array<number>): string {\n\t\tconst totalPeaks = peaks.length;\n\t\tconst d: Array<string> = [];\n\t\t// \"for\" is used for faster iteration\n\t\tfor (let peakNumber = 0; peakNumber < totalPeaks; peakNumber++) {\n\t\t\tconst num = peaks[peakNumber] / 3;\n\t\t\tif (peakNumber % 2 === 0) {\n\t\t\t\td.push(`M${~~(peakNumber / 2)}, ${num}`);\n\t\t\t} else {\n\t\t\t\td.push(`L${~~(peakNumber / 2)}, ${num}`);\n\t\t\t}\n\t\t}\n\t\treturn d.join(' ');\n\t}\n\n\tprivate svgPath(peaks: Array<number> | Array<Array<number>>): string {\n\t\tif (Array.isArray(peaks[0])) {\n\t\t\tconst left: Array<number> = <Array<number>>peaks[0];\n\t\t\tconst right: Array<number> = <Array<number>>peaks[1];\n\t\t\tconst d: Array<string> = [];\n\t\t\tfor (let peakNumber = 0, totalPeaks = left.length; peakNumber < totalPeaks; peakNumber++) {\n\t\t\t\tconst leftValue = left[peakNumber];\n\t\t\t\tconst rightValue = right[peakNumber];\n\t\t\t\td.push(`M${peakNumber}, ${leftValue} L${peakNumber}, ${rightValue} `);\n\t\t\t\tconsole.log(leftValue, rightValue);\n\t\t\t}\n\t\t\treturn d.join(' ');\n\t\t} else {\n\t\t\treturn this.svgPathMixedChannel(<Array<number>>peaks);\n\t\t}\n\t}\n\n\tprivate async getPeaks(filename: string): Promise<Array<number> | Array<Array<number>>> {\n\t\tconst stats = await fsStat(filename);\n\t\tconst opts = Object.assign({\n\t\t\tnumOfChannels: 2,\n\t\t\tsampleRate: 44100,\n\t\t\tmaxValue: 1.0,\n\t\t\tminValue: -1.0,\n\t\t\twidth: 4000,\n\t\t\tprecision: 1\n\t\t}, {});\n\t\tlet oddByte: number | null = null;\n\t\tlet sc = 0;\n\t\tconst totalSamples = ~~((stats.size / 2) / opts.numOfChannels);\n\t\tconst splitChannels = false; // opts.numOfChannels >= 2;\n\t\tconst peaks = new GetPeaks(splitChannels, opts.width, opts.precision, totalSamples);\n\t\tconst readable = fs.createReadStream(filename);\n\t\treadable.on('data', (chunk) => {\n\t\t\tlet i = 0;\n\t\t\tlet value: number;\n\t\t\tconst samples: Array<Array<number>> = [];\n\t\t\tfor (let ii = 0; ii < opts.numOfChannels; ii++) {\n\t\t\t\tsamples[ii] = [];\n\t\t\t}\n\t\t\tif (oddByte !== null) {\n\t\t\t\tvalue = ((chunk.readInt8(i++, true) << 8) | oddByte) / 32768.0;\n\t\t\t\tsamples[sc].push(value);\n\t\t\t\tsc = (sc + 1) % opts.numOfChannels;\n\t\t\t}\n\t\t\tfor (; i + 1 < chunk.length; i += 2) {\n\t\t\t\tvalue = chunk.readInt16LE(i, true) / 32768.0;\n\t\t\t\tsamples[sc].push(value);\n\t\t\t\tsc = (sc + 1) % opts.numOfChannels;\n\t\t\t}\n\t\t\toddByte = (i < chunk.length ? chunk.readUInt8(i, true) : null);\n\t\t\tpeaks.update(samples);\n\t\t});\n\t\treturn new Promise<Array<number> | Array<Array<number>>>((resolve, reject) => {\n\t\t\treadable.on('error', (err) => {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t\treadable.on('end', () => {\n\t\t\t\tresolve(peaks.get());\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate async convertFile(filepath: string, destpath: string): Promise<void> {\n\t\tawait spawnTool('ffmpeg', 'FFMPEG_PATH', ['-v', 'error', '-i', filepath, '-f', 's16le', '-acodec', 'pcm_s16le', '-y', destpath]);\n\t}\n\n}\n","module.exports = require(\"svgo\");","import express from 'express';\nimport {Engine} from '../engine/engine';\nimport bodyParser from 'body-parser';\nimport {initJamRouter} from './jam/router';\nimport {initSubsonicRouter} from './subsonic/router';\nimport path from 'path';\nimport * as http from 'http';\nimport Logger from '../utils/logger';\nimport helmet from 'helmet';\n\nconst log = Logger('Server');\n\nexport interface EngineRequest extends express.Request {\n\tengine: Engine;\n}\n\nexport class Server {\n\tapp: express.Application;\n\tengine: Engine;\n\tserver: http.Server | undefined;\n\n\tconstructor(engine: Engine) {\n\t\tthis.engine = engine;\n\t\tconst app: express.Application = express();\n\t\tapp.use(bodyParser.urlencoded({extended: true, limit: '10mb'}));\n\t\tapp.use(bodyParser.json({}));\n\t\tapp.use(bodyParser.json({type: 'application/vnd.api+json'}));\n\n\t\tapp.use(helmet());\n\n\t\tfunction EngineMiddleWare(req: express.Request, res: express.Response, next: express.NextFunction) {\n\t\t\t(<EngineRequest>req).engine = engine;\n\t\t\tnext();\n\t\t}\n\n\t\tapp.use(EngineMiddleWare);\n\t\tapp.use('/api/v1', initJamRouter(engine));\n\t\tapp.use('/rest', initSubsonicRouter(engine));\n\n\t\t// jamberry\n\t\tapp.get('/assets/config/config.js', (req, res) => {\n\t\t\tres.sendFile(path.resolve('../config/jamberry.config.js'));\n\t\t});\n\t\tapp.get('/*', express.static(path.resolve(engine.config.paths.jamberry)));\n\t\tapp.get('/*', (req: express.Request, res: express.Response) => {\n\t\t\tres.sendFile(path.join(path.resolve(engine.config.paths.jamberry), 'index.html'));\n\t\t});\n\n\t\tthis.app = app;\n\t}\n\n\tgetURL(): string {\n\t\treturn 'http://' + (this.engine.config.server.listen === '127.0.0.1' ? 'localhost' : this.engine.config.server.listen) + ':' + this.engine.config.server.port;\n\t}\n\n\tasync start(): Promise<void> {\n\t\tthis.server = this.app.listen(this.engine.config.server.port, this.engine.config.server.listen);\n\t\tlog.info('Listening ' + this.getURL());\n\t}\n\n\tasync stop(): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\tif (this.server) {\n\t\t\t\t\tthis.server.close(resolve);\n\t\t\t\t\t// this.server.unref();\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n}\n\n","module.exports = require(\"body-parser\");","import express from 'express';\nimport {CheckAuthMiddleWare, UserRequest} from './login';\nimport {ApiResponder} from './response';\nimport multer from 'multer';\nimport path from 'path';\nimport Logger from '../../utils/logger';\nimport {JamServe} from '../../model/jamserve';\nimport {ApiJam} from './api';\nimport {APIVERSION, FORMAT} from './format';\nimport {Engine} from '../../engine/engine';\nimport {Jam} from '../../model/jam-rest-data-0.1.0';\nimport cors, {CorsOptions} from 'cors';\nimport {SessionJSONFileStore} from '../../utils/session-storage';\nimport session from 'express-session';\nimport passport from 'passport';\nimport passportJWT from 'passport-jwt';\nimport passportLocal from 'passport-local';\nimport jwt from 'jsonwebtoken';\nimport {NotFoundError, UnauthError} from './error';\nimport {registerAdminApi, registerPublicApi, registerUserApi} from './routes';\nimport {apiCheck} from './check';\nimport {getMaxAge} from '../../utils/max-age';\n\nconst autoUploadTempReap = require('multer-autoreap'); // TODO: multer-autoreap types\nconst rateLimit = require('express-rate-limit');\n\nconst LoginLimiter = rateLimit({\n\twindowMs: 60 * 60 * 1000, // 1 hour window\n\tmax: 5, // start blocking after 5 requests\n\tmessage: 'Too many login requests from this IP, please try again after an hour'\n});\n\nconst log = Logger('Jam.Api');\n\ninterface JWTPayload {\n\tid: string;\n\texp?: number;\n\tclient: string;\n}\n\nfunction CallSessionLoginHandler(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\tpassport.authenticate('local', (err, user, info) => {\n\t\tif (err || !user) {\n\t\t\treturn next();\n\t\t}\n\t\treq.login(user, (err2) => {\n\t\t\tif (err2) {\n\t\t\t\tlog.error(err2);\n\t\t\t\treturn next();\n\t\t\t}\n\t\t\tconst client = req.body.client || 'Unknown Client';\n\t\t\treq.client = client;\n\t\t\tconst maxAge = getMaxAge(req.engine.config.server.jwt.maxAge);\n\t\t\tconst tokenData: JWTPayload = {\n\t\t\t\tid: user.id,\n\t\t\t\texp: maxAge > 0 ? Math.floor((Date.now() + maxAge) / 1000) : undefined,\n\t\t\t\tclient\n\t\t\t};\n\t\t\tconst token = jwt.sign(tokenData, req.engine.config.server.jwt.secret);\n\t\t\tconst result: Jam.Session = {version: APIVERSION, allowedCookieDomains: req.engine.config.server.session.allowedCookieDomains, jwt: token, user: FORMAT.packUser(req.user)};\n\t\t\tApiResponder.data(res, result);\n\t\t});\n\t})(req, res, next);\n}\n\nfunction CallSessionLogoutHandler(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\treq.logout();\n\tApiResponder.ok(res);\n}\n\nfunction AdminMiddleWare(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\tif (!req.user || !req.user.roles.adminRole) {\n\t\tApiResponder.error(res, UnauthError());\n\t} else {\n\t\tnext();\n\t}\n}\n\nexport function initJamRouter(engine: Engine): express.Router {\n\tconst api = new ApiJam(engine);\n\n\tconst UPLOAD_PATH = engine.config.getDataPath(['cache', 'uploads']);\n\tconst upload = multer({dest: `${UPLOAD_PATH}/`}); // multer configuration\n\n\tconst router = express.Router();\n\n\t// if (router.get('env') === 'production') {\n\t// \trouter.set('trust proxy', 1) // trust first proxy\n\t// \tsess.cookie.secure = true // serve secure cookies\n\t// }\n\tconst maxAge = getMaxAge(engine.config.server.session.cookie.maxAge);\n\trouter.use(session({\n\t\tname: engine.config.server.session.cookie.name,\n\t\tsecret: engine.config.server.session.secret,\n\t\tstore: new SessionJSONFileStore(engine.config.getDataPath(['session', 'sessions.json'])),\n\t\tresave: false,\n\t\tsaveUninitialized: false,\n\t\tcookie: {\n\t\t\tsecure: engine.config.server.session.cookie.secure,\n\t\t\tmaxAge: maxAge > 0 ? maxAge : undefined\n\t\t}\n\t}));\n\trouter.use(passport.initialize());\n\trouter.use(passport.session());\n\tpassport.serializeUser((user: JamServe.User, done) => {\n\t\tdone(null, user.id);\n\t});\n\tpassport.deserializeUser((id: string, done) => {\n\t\tengine.users.getUser(id).then(user => done(null, user ? user : false)).catch(done);\n\t});\n\n\tpassport.use('local', new passportLocal.Strategy(\n\t\t{usernameField: 'username', passwordField: 'password'},\n\t\t(username, password, done) => {\n\t\t\tengine.users.auth(username, password).then(user => done(null, user ? user : false)).catch(done);\n\t\t}\n\t));\n\tpassport.use('jwt-header', new passportJWT.Strategy(\n\t\t{\n\t\t\tjwtFromRequest: passportJWT.ExtractJwt.fromAuthHeaderAsBearerToken(),\n\t\t\tsecretOrKey: engine.config.server.jwt.secret\n\t\t},\n\t\t(jwt_payload, done) => {\n\t\t\tengine.users.getUser(jwt_payload.id).then(user => done(null, user ? user : false, jwt_payload)).catch(done);\n\t\t}\n\t));\n\tpassport.use('jwt-parameter', new passportJWT.Strategy(\n\t\t{\n\t\t\tjwtFromRequest: passportJWT.ExtractJwt.fromUrlQueryParameter('bearer'),\n\t\t\tsecretOrKey: engine.config.server.jwt.secret\n\t\t},\n\t\t(jwt_payload, done) => {\n\t\t\tengine.users.getUser(jwt_payload.id).then(user => done(null, user ? user : false, jwt_payload)).catch(done);\n\t\t}\n\t));\n\n\tfunction jwtParameterAuthMiddleware(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\t\tif (req.user) {\n\t\t\treturn next();\n\t\t}\n\t\tpassport.authenticate('jwt-parameter', {session: false}, (err, user, info: JWTPayload) => {\n\t\t\tif (err) {\n\t\t\t\tlog.error(err);\n\t\t\t\treturn next();\n\t\t\t}\n\t\t\treq.jwt = !!user;\n\t\t\treq.client = info.client;\n\t\t\treq.user = user;\n\t\t\tnext();\n\t\t})(req, res, next);\n\t}\n\n\tfunction jwtHeaderAuthMiddleware(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\t\tif (req.user) {\n\t\t\treturn next();\n\t\t}\n\t\tpassport.authenticate('jwt-header', {session: false}, (err, user, info: JWTPayload) => {\n\t\t\tif (err) {\n\t\t\t\tlog.error(err);\n\t\t\t\treturn next();\n\t\t\t}\n\t\t\treq.jwt = !!user;\n\t\t\treq.client = info.client;\n\t\t\treq.user = user;\n\t\t\tnext();\n\t\t})(req, res, next);\n\t}\n\n\trouter.use((req, res, next) => {\n\t\tlog.info(req.originalUrl);\n\t\tnext();\n\t});\n\n\trouter.use(<express.RequestHandler>jwtHeaderAuthMiddleware);\n\trouter.use(<express.RequestHandler>jwtParameterAuthMiddleware);\n\n\n\trouter.use(cors({\n\t\tpreflightContinue: false,\n\t\tcredentials: true,\n\t\tallowedHeaders: ['Content-Type', 'Authorization'],\n\t\torigin: true,\n\t\tmethods: ['GET', 'POST']\n\t}));\n\tregisterPublicApi(router, api);\n\trouter.post('/login', LoginLimiter, apiCheck('/login'), <express.RequestHandler>CallSessionLoginHandler);\n\n\tconst corsOptionsDelegate = function(req: express.Request, callback: (err: Error | null, options: CorsOptions) => void) {\n\t\tconst origins = engine.config.server.session.allowedCookieDomains || [];\n\t\tconst corsOptions: CorsOptions = {\n\t\t\tpreflightContinue: false,\n\t\t\tcredentials: true,\n\t\t\tallowedHeaders: ['Content-Type', 'Authorization'],\n\t\t\torigin: function(origin, cb) {\n\t\t\t\tif (origins.indexOf(origin) !== -1 || !origin) {\n\t\t\t\t\tcb(null, true);\n\t\t\t\t} else {\n\t\t\t\t\tif (req.method === 'OPTIONS' || req.jwt) {\n\t\t\t\t\t\tcb(null, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcb(new Error('Not allowed by CORS'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmethods: ['GET', 'POST']\n\t\t};\n\t\tcallback(null, corsOptions); // callback expects two parameters: error and options\n\t};\n\trouter.use(cors(corsOptionsDelegate));\n\n\trouter.post('/logout', <express.RequestHandler>CallSessionLogoutHandler);\n\trouter.use('/docs', express.static(path.resolve('./dist/docs/api/')));\n\n\trouter.use(<express.RequestHandler>CheckAuthMiddleWare); // ensure req.user exists for all requests after this\n\n\tregisterUserApi(router, api, upload.single('image'), autoUploadTempReap);\n\n\trouter.use(<express.RequestHandler>AdminMiddleWare); // ensure req.user is an admin for all requests after this\n\n\tregisterAdminApi(router, api, upload.single('image'), autoUploadTempReap);\n\n\trouter.use((req, res, next) => {\n\t\tApiResponder.error(res, NotFoundError('jam api cmd not found'));\n\t});\n\n\treturn router;\n}\n","import express from 'express';\nimport {JamServe} from '../../model/jamserve';\nimport {EngineRequest} from '../server';\n\n/**\n * Fill user into req.user express requests\n */\nexport interface UserRequest extends EngineRequest {\n\tuser: JamServe.User;\n\tclient: string;\n\tjwt: boolean;\n}\n\nexport function CheckAuthMiddleWare(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\tif (!req.client && req.session && req.session.client) {\n\t\treq.client = req.session.client;\n\t}\n\tif (req.user) {\n\t\treturn next();\n\t}\n\treturn res.status(401).json({error: 'Unauthorized'});\n}\n","module.exports = require(\"multer\");","import path from 'path';\nimport {JamServe} from '../../model/jamserve';\nimport {Engine} from '../../engine/engine';\nimport {DBObjectType, FolderType} from '../../types';\nimport {getFolderProblems} from '../../io/components/health';\nimport {fileSuffix} from '../../utils/fs-utils';\nimport {APIVERSION, FORMAT} from './format';\nimport {BaseStore} from '../../store/store';\nimport {JamParameters} from '../../model/jam-rest-params-0.1.0';\nimport {Jam} from '../../model/jam-rest-data-0.1.0';\nimport {paginate} from '../../utils/paginate';\nimport {randomItems} from '../../utils/random';\nimport {PreTranscoder, Transcoder} from '../../audio/transcoder';\nimport {IApiBinaryResult} from '../../typings';\nimport {MusicBrainz} from '../../model/musicbrainz-rest-data-2.0';\nimport {Acoustid} from '../../model/acoustid-rest-data-2.0';\nimport {LastFM} from '../../model/lastfm-rest-data-2.0';\nimport {GenericError, InvalidParamError, NotFoundError, UnauthError} from './error';\nimport {PodcastStatus} from '../../utils/feed';\n\nexport interface ApiOptions<T> {\n\tquery: T;\n\tuser: JamServe.User;\n\tclient?: string;\n\tfile?: string;\n}\n\nabstract class APIJamObj<OBJREQUEST extends JamParameters.ID | INCLUDE, OBJLISTREQUEST extends JamParameters.IDs | INCLUDE, INCLUDE, JAMQUERY extends JamServe.SearchQuery, S extends JamParameters.SearchQuery | INCLUDE, DBOBJECT extends JamServe.DBObject, RESULTOBJ extends { id: string }> {\n\tengine: Engine;\n\tobjstore: BaseStore<DBOBJECT, JamServe.SearchQuery>;\n\ttype: DBObjectType;\n\tapi: ApiJam;\n\n\tprotected constructor(engine: Engine, objstore: BaseStore<DBOBJECT, JamServe.SearchQuery>, type: DBObjectType, api: ApiJam) {\n\t\tthis.engine = engine;\n\t\tthis.objstore = objstore;\n\t\tthis.type = type;\n\t\tthis.api = api;\n\t}\n\n\tabstract async prepare(item: DBOBJECT, includes: INCLUDE, user: JamServe.User): Promise<RESULTOBJ>;\n\n\tabstract translateQuery(query: S, user: JamServe.User): JAMQUERY;\n\n\tasync byID(id?: string): Promise<DBOBJECT> {\n\t\tif (!id) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\tconst obj = await this.objstore.byId(id);\n\t\tif (!obj) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\treturn obj;\n\t}\n\n\tasync byIDs(ids: Array<string>): Promise<Array<DBOBJECT>> {\n\t\tif (!ids) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\treturn await this.objstore.byIds(ids);\n\t}\n\n\tasync getList(listQuery: JamParameters.List, jamquery: S, includes: INCLUDE, user: JamServe.User): Promise<Array<RESULTOBJ>> {\n\t\tconst query = this.translateQuery(jamquery, user);\n\t\tlet ids: Array<string> = [];\n\t\tswitch (listQuery.list) {\n\t\t\tcase 'random':\n\t\t\t\tids = await this.objstore.searchIDs(Object.assign(query, {amount: -1, offset: 0}));\n\t\t\t\tids = randomItems<string>(ids, listQuery.amount || 20);\n\t\t\t\tbreak;\n\t\t\tcase 'highest':\n\t\t\t\tids = await this.engine.getFilteredListHighestRated(this.type, query, user, this.objstore);\n\t\t\t\tids = paginate(ids, listQuery.amount, listQuery.offset);\n\t\t\t\tbreak;\n\t\t\tcase 'avghighest':\n\t\t\t\tids = await this.engine.getFilteredListAvgHighest(this.type, query, user, this.objstore);\n\t\t\t\tids = paginate(ids, listQuery.amount, listQuery.offset);\n\t\t\t\tbreak;\n\t\t\tcase 'frequent':\n\t\t\t\tids = await this.engine.getFilteredListFrequentlyPlayed(this.type, query, user, this.objstore);\n\t\t\t\tids = paginate(ids, listQuery.amount, listQuery.offset);\n\t\t\t\tbreak;\n\t\t\tcase 'faved':\n\t\t\t\tids = await this.engine.getFilteredListFaved(this.type, query, user, this.objstore);\n\t\t\t\tids = paginate(ids, listQuery.amount, listQuery.offset);\n\t\t\t\tbreak;\n\t\t\tcase 'recent':\n\t\t\t\tids = await this.engine.getFilteredListRecentlyPlayed(this.type, query, user, this.objstore);\n\t\t\t\tids = paginate(ids, listQuery.amount, listQuery.offset);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject(InvalidParamError('Unknown List Type'));\n\t\t}\n\t\treturn this.prepareListByIDs(ids, includes, user);\n\t}\n\n\tdefaultTrackSort(tracks: Array<JamServe.Track>): Array<JamServe.Track> {\n\t\treturn tracks.sort((a, b) => {\n\t\t\t\tif (a.tag.track !== undefined && b.tag.track !== undefined) {\n\t\t\t\t\tconst res = a.tag.track - b.tag.track;\n\t\t\t\t\tif (res !== 0) {\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn a.name.localeCompare(b.name);\n\t\t\t}\n\t\t);\n\t}\n\n\tdefaultEpisodesSort(episodes: Array<JamServe.Episode>): Array<JamServe.Episode> {\n\t\treturn episodes.sort((a, b) => {\n\t\t\t\tif (!a.tag) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!b.tag) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\tif (a.tag.track !== undefined && b.tag.track !== undefined) {\n\t\t\t\t\tconst res = a.tag.track - b.tag.track;\n\t\t\t\t\tif (res !== 0) {\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn a.title.localeCompare(b.title);\n\t\t\t}\n\t\t);\n\t}\n\n\tasync prepareList(items: Array<DBOBJECT>, includes: INCLUDE, user: JamServe.User): Promise<Array<RESULTOBJ>> {\n\t\tconst result: Array<RESULTOBJ> = [];\n\t\tfor (const item of items) {\n\t\t\tconst r = await this.prepare(item, includes, user);\n\t\t\tresult.push(r);\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync prepareListByIDs(ids: Array<string>, includes: INCLUDE, user: JamServe.User): Promise<Array<RESULTOBJ>> {\n\t\tconst list = await this.objstore.byIds(ids);\n\t\tconst result = await this.prepareList(list, includes, user);\n\t\treturn result.sort((a, b) => {\n\t\t\treturn ids.indexOf(a.id) - ids.indexOf(b.id);\n\t\t});\n\t}\n\n\tasync id(req: ApiOptions<OBJREQUEST>): Promise<RESULTOBJ> {\n\t\tconst item = await this.byID((<JamParameters.ID>req.query).id);\n\t\treturn this.prepare(item, <INCLUDE>req.query, req.user);\n\t}\n\n\tasync ids(req: ApiOptions<OBJLISTREQUEST>): Promise<Array<RESULTOBJ>> {\n\t\tconst items = await this.byIDs((<JamParameters.IDs>req.query).ids);\n\t\treturn this.prepareList(items, <INCLUDE>req.query, req.user);\n\t}\n\n\tasync state(req: ApiOptions<JamParameters.ID>): Promise<Jam.State> {\n\t\tconst item = await this.byID(req.query.id);\n\t\tconst state = await this.engine.store.state.findOrCreate(item.id, req.user.id, this.type);\n\t\treturn FORMAT.packState(state);\n\t}\n\n\tasync states(req: ApiOptions<JamParameters.IDs>): Promise<Jam.States> {\n\t\tconst items = await this.byIDs(req.query.ids);\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(items.map(item => item.id), req.user.id, this.type);\n\t\treturn FORMAT.packStates(states);\n\t}\n\n\tasync favUpdate(req: ApiOptions<JamParameters.Fav>): Promise<Jam.State> {\n\t\tconst item = await this.byID(req.query.id);\n\t\tconst state = await this.engine.fav(item.id, this.type, req.user.id, req.query.remove ? req.query.remove : false);\n\t\treturn FORMAT.packState(state);\n\t}\n\n\tasync rateUpdate(req: ApiOptions<JamParameters.Rate>): Promise<Jam.State> {\n\t\tconst rating = req.query.rating || 0;\n\t\tif ((rating < 0) || (rating > 5)) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\tconst item = await this.byID(req.query.id);\n\t\tconst state = await this.engine.rate(item.id, this.type, req.user.id, rating);\n\t\treturn FORMAT.packState(state);\n\t}\n\n\tasync search(req: ApiOptions<S>): Promise<Array<RESULTOBJ>> {\n\t\tconst list = await this.objstore.search(this.translateQuery(req.query, req.user));\n\t\treturn this.prepareList(list, <INCLUDE>req.query, req.user);\n\t}\n\n\tasync image(req: ApiOptions<JamParameters.Image>): Promise<IApiBinaryResult> {\n\t\tconst item = await this.byID(req.query.id);\n\t\treturn await this.engine.getObjImage(item, req.query.size, req.query.format);\n\t}\n\n\tasync download(req: ApiOptions<JamParameters.Download>): Promise<IApiBinaryResult> {\n\t\tconst item = await this.byID(req.query.id);\n\t\treturn await this.engine.getObjDownload(item, req.query.format, req.user);\n\t}\n\n}\n\nclass APIJamPodcast extends APIJamObj<JamParameters.Podcast, JamParameters.Podcasts, JamParameters.IncludesPodcast, JamServe.SearchQueryPodcast, JamParameters.PodcastSearch, JamServe.Podcast, Jam.Podcast> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.podcast, DBObjectType.podcast, api);\n\t}\n\n\tasync prepare(podcast: JamServe.Podcast, includes: JamParameters.IncludesPodcast, user: JamServe.User): Promise<Jam.Podcast> {\n\t\tconst result = FORMAT.packPodcast(podcast, this.engine.podcasts.isDownloadingPodcast(podcast.id) ? PodcastStatus.downloading : podcast.status);\n\t\tif (includes.podcastState) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(podcast.id, user.id, DBObjectType.podcast);\n\t\t\tresult.state = FORMAT.packState(state);\n\t\t}\n\t\tif (includes.podcastEpisodes) {\n\t\t\tlet episodes = await this.engine.store.episode.search({podcastID: podcast.id});\n\t\t\tepisodes = this.defaultEpisodesSort(episodes);\n\t\t\tresult.episodes = await this.api.episode.prepareList(episodes, includes, user);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.PodcastSearch, user: JamServe.User): JamServe.SearchQueryPodcast {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\turl: query.url,\n\t\t\ttitle: query.title,\n\t\t\tstatus: query.status,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync tracks(req: ApiOptions<JamParameters.Tracks>): Promise<Array<Jam.PodcastEpisode>> {\n\t\tconst episodes = await this.engine.store.episode.search({podcastIDs: req.query.ids});\n\t\treturn this.api.episode.prepareList(episodes, req.query, req.user);\n\t}\n\n\tasync refreshAll(req: ApiOptions<{}>): Promise<void> {\n\t\tthis.engine.podcasts.refreshPodcasts(); // do not wait\n\t}\n\n\tasync refresh(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst podcast = await this.byID(req.query.id);\n\t\tthis.engine.podcasts.refreshPodcast(podcast); // do not wait\n\t}\n\n\tasync create(req: ApiOptions<JamParameters.PodcastNew>): Promise<Jam.Podcast> {\n\t\tconst podcast = await this.engine.podcasts.addPodcast(req.query.url);\n\t\treturn this.prepare(podcast, {}, req.user);\n\t}\n\n\tasync delete(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst podcast = await this.byID(req.query.id);\n\t\tawait this.engine.podcasts.removePodcast(podcast);\n\t}\n\n\tasync status(req: ApiOptions<JamParameters.ID>): Promise<Jam.PodcastStatus> {\n\t\tconst podcast = await this.byID(req.query.id);\n\t\treturn {\n\t\t\tlastCheck: podcast.lastCheck,\n\t\t\tstatus: this.engine.podcasts.isDownloadingPodcast(podcast.id) ? PodcastStatus.downloading : podcast.status\n\t\t};\n\t}\n}\n\nclass APIJamEpisode extends APIJamObj<JamParameters.Episode, JamParameters.Episodes, JamParameters.IncludesEpisode, JamServe.SearchQueryPodcastEpisode, JamParameters.EpisodeSearch, JamServe.Episode, Jam.PodcastEpisode> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.episode, DBObjectType.episode, api);\n\t}\n\n\tasync prepare(episode: JamServe.Episode, includes: JamParameters.IncludesEpisode, user: JamServe.User): Promise<Jam.PodcastEpisode> {\n\t\tconst result = FORMAT.packPodcastEpisode(episode, includes,\n\t\t\tthis.engine.podcasts.isDownloadingPodcastEpisode(episode.id) ? PodcastStatus.downloading : episode.status\n\t\t);\n\t\tif (includes.trackState) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(episode.id, user.id, DBObjectType.episode);\n\t\t\tresult.state = FORMAT.packState(state);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.EpisodeSearch, user: JamServe.User): JamServe.SearchQueryPodcastEpisode {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\ttitle: query.title,\n\t\t\tpodcastID: query.podcastID,\n\t\t\tstatus: query.status,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync retrieve(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst episode = await this.byID(req.query.id);\n\t\tif (!episode.path) {\n\t\t\tthis.engine.podcasts.downloadPodcastEpisode(episode); // do not wait\n\t\t}\n\t}\n\n\tasync stream(req: ApiOptions<JamParameters.Stream>): Promise<IApiBinaryResult> {\n\t\tconst episode = await this.byID(req.query.id);\n\t\treturn await this.engine.getObjStream(episode, req.query.format, req.query.maxBitRate, req.user);\n\t}\n\n\tasync status(req: ApiOptions<JamParameters.ID>): Promise<Jam.PodcastEpisodeStatus> {\n\t\tconst episode = await this.byID(req.query.id);\n\t\treturn {\n\t\t\tstatus: this.engine.podcasts.isDownloadingPodcastEpisode(episode.id) ? PodcastStatus.downloading : episode.status\n\t\t};\n\t}\n\n}\n\nclass APIJamAlbum extends APIJamObj<JamParameters.Album, JamParameters.Albums, JamParameters.IncludesAlbum, JamServe.SearchQueryAlbum, JamParameters.AlbumSearch, JamServe.Album, Jam.Album> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.album, DBObjectType.album, api);\n\t}\n\n\tasync prepare(album: JamServe.Album, includes: JamParameters.IncludesAlbum, user: JamServe.User): Promise<Jam.Album> {\n\t\tconst result = FORMAT.packAlbum(album, includes);\n\t\tif (includes.albumState) {\n\t\t\tresult.state = await this.engine.store.state.findOrCreate(album.id, user.id, DBObjectType.album);\n\t\t}\n\t\tif (includes.albumInfo) {\n\t\t\tconst info = await this.engine.meta.getAlbumInfo(album);\n\t\t\tresult.info = FORMAT.packAlbumInfo(info);\n\t\t}\n\t\tif (includes.albumTracks) {\n\t\t\tlet tracks = await this.engine.store.track.byIds(album.trackIDs);\n\t\t\ttracks = this.defaultTrackSort(tracks);\n\t\t\tresult.tracks = await this.api.track.prepareList(tracks, includes, user);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.AlbumSearch, user: JamServe.User): JamServe.SearchQueryAlbum {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\tname: query.name,\n\t\t\trootID: query.rootID,\n\t\t\tartist: query.artist,\n\t\t\tartistID: query.artistID,\n\t\t\ttrackID: query.trackID,\n\t\t\tmbAlbumID: query.mbAlbumID,\n\t\t\tmbArtistID: query.mbArtistID,\n\t\t\tgenre: query.genre,\n\t\t\tnewerThan: query.newerThan,\n\t\t\tfromYear: query.fromYear,\n\t\t\ttoYear: query.toYear,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync similarTracks(req: ApiOptions<JamParameters.SimilarTracks>): Promise<Array<Jam.Track>> {\n\t\tconst album = await this.byID(req.query.id);\n\t\tconst tracks = await this.engine.meta.getAlbumSimilarTracks(album);\n\t\treturn this.api.track.prepareList(paginate(tracks, req.query.amount, req.query.offset), req.query, req.user);\n\t}\n\n\tasync list(req: ApiOptions<JamParameters.AlbumList>): Promise<Array<Jam.Album>> {\n\t\treturn this.getList(req.query, req.query, req.query, req.user);\n\t}\n\n\tasync tracks(req: ApiOptions<JamParameters.Tracks>): Promise<Array<Jam.Track>> {\n\t\tconst albums = await this.byIDs(req.query.ids);\n\t\tlet trackIDs: Array<string> = [];\n\t\talbums.forEach(album => {\n\t\t\ttrackIDs = trackIDs.concat(album.trackIDs);\n\t\t});\n\t\treturn this.api.track.prepareListByIDs(trackIDs, req.query, req.user);\n\t}\n\n}\n\nclass APIJamArtist extends APIJamObj<JamParameters.Artist, JamParameters.Artists, JamParameters.IncludesArtist, JamServe.SearchQueryArtist, JamParameters.ArtistSearch, JamServe.Artist, Jam.Artist> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.artist, DBObjectType.artist, api);\n\t}\n\n\tasync prepare(artist: JamServe.Artist, includes: JamParameters.IncludesArtist, user: JamServe.User): Promise<Jam.Artist> {\n\t\tconst result = FORMAT.packArtist(artist, includes);\n\t\tif (includes.artistState) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(artist.id, user.id, DBObjectType.artist);\n\t\t\tresult.state = FORMAT.packState(state);\n\t\t}\n\t\tif (includes.artistInfo) {\n\t\t\tconst infos = await this.engine.meta.getArtistInfos(artist, false, !!includes.artistInfoSimilar);\n\t\t\tresult.info = FORMAT.packArtistInfo(infos.info);\n\t\t\tif (includes.artistInfoSimilar) {\n\t\t\t\tconst similar: Array<Jam.Artist> = [];\n\t\t\t\t(infos.similar || []).forEach(sim => {\n\t\t\t\t\tif (sim.artist) {\n\t\t\t\t\t\tsimilar.push(FORMAT.packArtist(sim.artist, includes));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tresult.info.similar = similar;\n\t\t\t}\n\t\t}\n\t\tif (includes.artistTracks) {\n\t\t\tconst tracks = await this.engine.store.track.byIds(artist.trackIDs);\n\t\t\tresult.tracks = await this.api.track.prepareList(tracks, includes, user);\n\t\t}\n\t\tif (includes.artistAlbums) {\n\t\t\tconst albums = await this.engine.store.album.byIds(artist.albumIDs);\n\t\t\tresult.albums = await this.api.album.prepareList(albums, includes, user);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.ArtistSearch, user: JamServe.User): JamServe.SearchQueryArtist {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\tname: query.name,\n\t\t\trootID: query.rootID,\n\t\t\talbumID: query.albumID,\n\t\t\tmbArtistID: query.mbArtistID,\n\t\t\tgenre: query.genre,\n\t\t\tnewerThan: query.newerThan,\n\t\t\tfromYear: query.fromYear,\n\t\t\ttoYear: query.toYear,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync similar(req: ApiOptions<JamParameters.Artist>): Promise<Array<Jam.Artist>> {\n\t\tconst artist = await this.byID(req.query.id);\n\t\tconst artistInfo = await this.engine.meta.getArtistInfos(artist, false, true);\n\t\tconst list = (artistInfo.similar || []).filter(s => !!s.artist).map(s => <JamServe.Artist>s.artist);\n\t\treturn this.prepareList(list, req.query, req.user);\n\t}\n\n\tasync similarTracks(req: ApiOptions<JamParameters.SimilarTracks>): Promise<Array<Jam.Track>> {\n\t\tconst artist = await this.byID(req.query.id);\n\t\tconst tracks = await this.engine.meta.getArtistSimilarTracks(artist);\n\t\treturn this.api.track.prepareList(paginate(tracks, req.query.amount, req.query.offset), req.query, req.user);\n\t}\n\n\tasync list(req: ApiOptions<JamParameters.ArtistList>): Promise<Array<Jam.Artist>> {\n\t\treturn this.getList(req.query, req.query, req.query, req.user);\n\t}\n\n\tasync index(req: ApiOptions<JamParameters.Index>): Promise<Jam.ArtistIndex> {\n\t\tconst artistIndex = await this.engine.index.getArtistIndex(this.engine.io.scanning);\n\t\treturn FORMAT.packArtistIndex(this.engine.index.filterArtistIndex(req.query.rootID, artistIndex));\n\t}\n\n\tasync tracks(req: ApiOptions<JamParameters.Tracks>): Promise<Array<Jam.Track>> {\n\t\tconst artists = await this.byIDs(req.query.ids);\n\t\tlet trackIDs: Array<string> = [];\n\t\tartists.forEach(artist => {\n\t\t\ttrackIDs = trackIDs.concat(artist.trackIDs);\n\t\t});\n\t\treturn this.api.track.prepareListByIDs(trackIDs, req.query, req.user);\n\t}\n\n}\n\nclass APiJamPlaylist extends APIJamObj<JamParameters.Playlist, JamParameters.Playlists, JamParameters.IncludesPlaylist, JamServe.SearchQueryPlaylist, JamParameters.PlaylistSearch, JamServe.Playlist, Jam.Playlist> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.playlist, DBObjectType.playlist, api);\n\t}\n\n\t// TODO: filter none public playlist in base api functions?\n\n\tasync prepare(playlist: JamServe.Playlist, includes: JamParameters.IncludesPlaylist, user: JamServe.User): Promise<Jam.Playlist> {\n\t\tconst result = FORMAT.packPlaylist(playlist, includes);\n\t\tif (includes.playlistState) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(playlist.id, user.id, DBObjectType.artist);\n\t\t\tresult.state = FORMAT.packState(state);\n\t\t}\n\t\tif (includes.playlistTracks) {\n\t\t\tconst tracks = await this.engine.store.track.byIds(playlist.trackIDs);\n\t\t\tresult.tracks = await this.api.track.prepareList(tracks, includes, user);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.PlaylistSearch, user: JamServe.User): JamServe.SearchQueryPlaylist {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\tname: query.name,\n\t\t\tuserID: user.id,\n\t\t\tisPublic: query.isPublic,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync create(req: ApiOptions<JamParameters.PlaylistNew>): Promise<Jam.Playlist> {\n\t\tconst playlist = await this.engine.playlists.createPlaylist(req.query.name, req.query.comment, req.query.isPublic === undefined ? false : req.query.isPublic, req.user.id, req.query.trackIDs || []);\n\t\treturn this.prepare(playlist, {playlistTracksIDs: true, playlistState: true}, req.user);\n\t}\n\n\tasync update(req: ApiOptions<JamParameters.PlaylistUpdate>): Promise<void> {\n\t\tconst playlist = await this.byID(req.query.id);\n\t\tif (playlist.userID !== req.user.id) {\n\t\t\treturn Promise.reject(UnauthError());\n\t\t}\n\t\tplaylist.name = req.query.name || playlist.name;\n\t\tplaylist.comment = req.query.comment || playlist.comment;\n\t\tplaylist.isPublic = req.query.isPublic === undefined ? playlist.isPublic : req.query.isPublic;\n\t\tplaylist.changed = Date.now();\n\t\tplaylist.trackIDs = req.query.trackIDs || [];\n\t\tawait this.engine.playlists.updatePlaylist(playlist);\n\t}\n\n\tasync tracks(req: ApiOptions<JamParameters.Tracks>): Promise<Array<Jam.Track>> {\n\t\tlet playlists = await this.byIDs(req.query.ids);\n\t\tplaylists = playlists.filter(playlist => playlist.userID === req.user.id);\n\t\tlet trackIDs: Array<string> = [];\n\t\tplaylists.forEach(playlist => {\n\t\t\ttrackIDs = trackIDs.concat(playlist.trackIDs);\n\t\t});\n\t\treturn this.api.track.prepareListByIDs(trackIDs, req.query, req.user);\n\t}\n\n\tasync delete(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst playlist = await this.byID(req.query.id);\n\t\tif (playlist.userID !== req.user.id) {\n\t\t\treturn Promise.reject(UnauthError());\n\t\t}\n\t\tawait this.engine.playlists.removePlaylist(playlist);\n\t}\n\n}\n\nclass APIJamTrack extends APIJamObj<JamParameters.Track, JamParameters.Tracks, JamParameters.IncludesTrack, JamServe.SearchQueryTrack, JamParameters.TrackSearch, JamServe.Track, Jam.Track> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.track, DBObjectType.track, api);\n\t}\n\n\tasync prepare(track: JamServe.Track, includes: JamParameters.IncludesTrack, user: JamServe.User): Promise<Jam.Track> {\n\t\tconst result = FORMAT.packTrack(track, includes);\n\t\tif (includes.trackID3) {\n\t\t\tresult.tagID3 = await this.engine.audio.readID3v2(path.join(track.path, track.name));\n\t\t}\n\t\tif (includes.trackState) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(track.id, user.id, DBObjectType.track);\n\t\t\tresult.state = FORMAT.packState(state);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.TrackSearch, user: JamServe.User): JamServe.SearchQueryTrack {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\trootID: query.rootID,\n\t\t\tparentID: query.parentID,\n\t\t\tartist: query.artist,\n\t\t\ttitle: query.title,\n\t\t\talbum: query.album,\n\t\t\tgenre: query.genre,\n\t\t\tnewerThan: query.newerThan,\n\t\t\tfromYear: query.fromYear,\n\t\t\ttoYear: query.toYear,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\t// more track api\n\n\tasync tagID3(req: ApiOptions<JamParameters.ID>): Promise<Jam.ID3Tag> {\n\t\tconst track = await this.byID(req.query.id);\n\t\treturn this.engine.audio.readID3v2(path.join(track.path, track.name));\n\t}\n\n\tasync tagID3s(req: ApiOptions<JamParameters.IDs>): Promise<Jam.ID3Tags> {\n\t\tlet tracks = await this.byIDs(req.query.ids);\n\t\ttracks = this.defaultTrackSort(tracks);\n\t\tconst result: Jam.ID3Tags = {};\n\t\tfor (const track of tracks) {\n\t\t\tresult[track.id] = await this.engine.audio.readID3v2(path.join(track.path, track.name));\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync tagID3Update(req: ApiOptions<JamParameters.TagID3Update>): Promise<void> {\n\t\tconst track = await this.byID(req.query.id);\n\t\tawait this.engine.audio.saveID3v2(path.join(track.path, track.name), req.query.tag);\n\t\tthis.engine.io.rescanTracks([track]); // do not wait\n\t}\n\n\tasync tagID3sUpdate(req: ApiOptions<JamParameters.TagID3sUpdate>): Promise<void> {\n\t\tconst tracks = await this.byIDs(req.query.tagID3s.map(tagID3 => tagID3.id));\n\t\tconst list: Array<{ track?: JamServe.Track; tag: Jam.ID3Tag }> = req.query.tagID3s.map(tagID3 => {\n\t\t\treturn {track: tracks.find(t => t.id === tagID3.id), tag: tagID3.tag};\n\t\t});\n\t\tfor (const item of list) {\n\t\t\tif (!item.track) {\n\t\t\t\treturn Promise.reject(NotFoundError());\n\t\t\t}\n\t\t\tawait this.engine.audio.saveID3v2(path.join(item.track.path, item.track.name), item.tag);\n\t\t}\n\t\tthis.engine.io.rescanTracks(tracks); // do not wait\n\t}\n\n\tasync prepareBookmark(bookmark: JamServe.Bookmark, includes: JamParameters.IncludesBookmark, user: JamServe.User): Promise<Jam.TrackBookmark> {\n\t\tconst result = FORMAT.packBookmark(bookmark);\n\t\tif (includes.bookmarkTrack && bookmark.destID) {\n\t\t\tconst track = await this.engine.store.track.byId(bookmark.destID);\n\t\t\tif (track) {\n\t\t\t\tresult.track = await this.prepare(track, includes, user);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\n\tasync bookmarkCreate(req: ApiOptions<JamParameters.BookmarkCreate>): Promise<Jam.TrackBookmark> {\n\t\tconst track = await this.byID(req.query.id);\n\t\tconst bookmark = await this.engine.trackBookmarkCreate(track, req.user, req.query.position || 0, req.query.comment);\n\t\treturn this.prepareBookmark(bookmark, {}, req.user);\n\t}\n\n\tasync bookmarkDelete(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tawait this.engine.trackBookmarkRemove(req.query.id, req.user);\n\t}\n\n\tasync bookmarkList(req: ApiOptions<JamParameters.BookmarkList>): Promise<Array<Jam.TrackBookmark>> {\n\t\tconst bookmarks = await this.engine.store.bookmark.search({userID: req.user.id});\n\t\tconst result = bookmarks.map(bookmark => FORMAT.packBookmark(bookmark));\n\t\tif (req.query.bookmarkTrack) {\n\t\t\tconst entries = await this.engine.store.track.byIds(bookmarks.map(b => b.destID));\n\t\t\tconst tracks = await this.prepareList(entries, req.query, req.user);\n\t\t\tresult.forEach(bookmark => {\n\t\t\t\tbookmark.track = tracks.find(t => t.id === bookmark.trackID);\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync stream(req: ApiOptions<JamParameters.Stream>): Promise<IApiBinaryResult> {\n\t\tconst track = await this.byID(req.query.id);\n\t\treturn await this.engine.getObjStream(track, req.query.format, req.query.maxBitRate, req.user);\n\t}\n\n\tasync similar(req: ApiOptions<JamParameters.SimilarTracks>): Promise<Array<Jam.Track>> {\n\t\tconst track = await this.byID(req.query.id);\n\t\tconst tracks = await this.engine.meta.getTrackSimilarTracks(track);\n\t\treturn this.prepareList(paginate(tracks, req.query.amount, req.query.offset), req.query, req.user);\n\t}\n\n\tasync list(req: ApiOptions<JamParameters.TrackList>): Promise<Array<Jam.Track>> {\n\t\treturn this.getList(req.query, req.query, req.query, req.user);\n\t}\n\n}\n\nclass APIJamFolder extends APIJamObj<JamParameters.Folder, JamParameters.Folders, JamParameters.IncludesFolderChildren, JamServe.SearchQueryFolder, JamParameters.FolderSearch, JamServe.Folder, Jam.Folder> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.folder, DBObjectType.folder, api);\n\t}\n\n\tasync prepare(folder: JamServe.Folder, includes: JamParameters.IncludesFolderChildren, user: JamServe.User): Promise<Jam.Folder> {\n\t\tconst result = FORMAT.packFolder(folder, includes);\n\t\tif (includes.folderChildren || includes.folderTracks) {\n\t\t\tlet tracks = await this.engine.store.track.search({parentID: folder.id});\n\t\t\ttracks = this.defaultTrackSort(tracks);\n\t\t\tresult.tracks = await this.api.track.prepareList(tracks, includes, user);\n\t\t}\n\t\tif (includes.folderChildren || includes.folderSubfolders) {\n\t\t\tconst folders = await this.engine.store.folder.search({parentID: folder.id, sorts: [{field: 'name', descending: false}]});\n\t\t\t// TODO: introduce children includes?\n\t\t\tresult.folders = await this.prepareList(folders, {folderState: includes.folderState, folderHealth: includes.folderHealth, folderTag: includes.folderTag}, user);\n\t\t}\n\t\tif (includes.folderState) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(folder.id, user.id, DBObjectType.folder);\n\t\t\tresult.state = FORMAT.packState(state);\n\t\t}\n\t\tif (includes.folderInfo) {\n\t\t\tif (folder.tag.type === FolderType.artist) {\n\t\t\t\tconst infos = await this.engine.meta.getFolderArtistInfo(folder, false, !!includes.folderInfoSimilar);\n\t\t\t\tresult.artistInfo = FORMAT.packArtistFolderInfo(infos.info);\n\t\t\t\tif (includes.folderInfoSimilar) {\n\t\t\t\t\tconst similar: Array<Jam.Folder> = [];\n\t\t\t\t\t(infos.similar || []).forEach(sim => {\n\t\t\t\t\t\tif (sim.folder) {\n\t\t\t\t\t\t\tsimilar.push(FORMAT.packFolder(sim.folder, includes));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresult.artistInfo.similar = similar;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst info = await this.engine.meta.getFolderInfo(folder);\n\t\t\t\tresult.albumInfo = FORMAT.packAlbumFolderInfo(info);\n\t\t\t}\n\t\t}\n\t\tif (includes.folderHealth) {\n\t\t\tconst problems = await getFolderProblems(folder);\n\t\t\tresult.health = {problems};\n\t\t}\n\t\tif (includes.folderParents) {\n\t\t\tresult.parents = await this.engine.getFolderParents(folder);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttranslateQuery(query: JamParameters.FolderSearch, user: JamServe.User): JamServe.SearchQueryFolder {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\trootID: query.rootID,\n\t\t\tparentID: query.parentID,\n\t\t\tartist: query.artist,\n\t\t\ttitle: query.title,\n\t\t\talbum: query.album,\n\t\t\tgenre: query.genre,\n\t\t\tnewerThan: query.newerThan,\n\t\t\tfromYear: query.fromYear,\n\t\t\ttoYear: query.toYear,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\ttypes: query.type ? [query.type] : undefined,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\t/* more folder api */\n\n\tasync subfolders(req: ApiOptions<JamParameters.FolderSubFolders>): Promise<Array<Jam.Folder>> {\n\t\tconst list = await this.engine.store.folder.search({parentID: req.query.id});\n\t\treturn this.prepareList(list, req.query, req.user);\n\t}\n\n\tasync tracks(req: ApiOptions<JamParameters.FolderTracks>): Promise<Array<Jam.Track>> {\n\t\tconst folders = await this.byIDs(req.query.ids);\n\t\tconst trackQuery: JamServe.SearchQueryTrack = req.query.recursive ? {inPaths: folders.map(folder => folder.path)} : {parentIDs: folders.map(folder => folder.id)};\n\t\tconst tracks = await this.engine.store.track.search(trackQuery);\n\t\treturn this.api.track.prepareList(this.defaultTrackSort(tracks), req.query, req.user);\n\t}\n\n\tasync children(req: ApiOptions<JamParameters.FolderChildren>): Promise<Jam.FolderChildren> {\n\t\tconst folders = await this.engine.store.folder.search({parentID: req.query.id});\n\t\tlet tracks = await this.engine.store.track.search({parentID: req.query.id});\n\t\ttracks = this.defaultTrackSort(tracks);\n\t\tconst resultTracks = await this.api.track.prepareList(tracks, req.query, req.user);\n\t\tconst resultFolders = await this.prepareList(folders, req.query, req.user);\n\t\treturn {folders: resultFolders, tracks: resultTracks};\n\t}\n\n\tasync imageUrlUpdate(req: ApiOptions<JamParameters.FolderEditImg>): Promise<void> {\n\t\tconst folder = await this.byID(req.query.id);\n\t\tawait this.engine.downloadFolderImage(folder, req.query.url);\n\t}\n\n\tasync imageUploadUpdate(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tif (!req.file) {\n\t\t\treturn Promise.reject(InvalidParamError('Image upload failed'));\n\t\t}\n\t\tconst folder = await this.byID(req.query.id);\n\t\tawait this.engine.setFolderImage(folder, req.file);\n\t}\n\n\tasync nameUpdate(req: ApiOptions<JamParameters.FolderEditName>): Promise<void> {\n\t\tconst folder = await this.byID(req.query.id);\n\t\tawait this.engine.renameFolder(folder, req.query.name);\n\t}\n\n\tasync artistInfo(req: ApiOptions<JamParameters.ArtistInfo>): Promise<Jam.ArtistFolderInfo> {\n\t\tconst folder = await this.byID(req.query.id);\n\t\tconst artistInfo = await this.engine.meta.getFolderArtistInfo(folder, false, req.query.similar);\n\t\tconst result = FORMAT.packArtistFolderInfo(artistInfo.info);\n\t\tif (req.query.similar) {\n\t\t\tconst list = (artistInfo.similar || []).filter(s => !!s.folder).map(s => <JamServe.Folder>s.folder);\n\t\t\tresult.similar = await this.prepareList(list, {}, req.user);\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync artistSimilar(req: ApiOptions<JamParameters.Folder>): Promise<Array<Jam.Folder>> {\n\t\tconst folder = await this.byID(req.query.id);\n\t\tconst artistInfo = await this.engine.meta.getFolderArtistInfo(folder, false, true);\n\t\tconst list = (artistInfo.similar || []).filter(s => !!s.folder).map(s => <JamServe.Folder>s.folder);\n\t\treturn this.prepareList(list, req.query, req.user);\n\t}\n\n\tasync albumInfo(req: ApiOptions<JamParameters.AlbumInfo>): Promise<Jam.AlbumFolderInfo> {\n\t\tconst folder = await this.byID(req.query.id);\n\t\tconst info = await this.engine.meta.getFolderInfo(folder);\n\t\treturn FORMAT.packAlbumFolderInfo(info);\n\t}\n\n\tasync artistSimilarTracks(req: ApiOptions<JamParameters.SimilarTracks>): Promise<Array<Jam.Track>> {\n\t\tconst folder = await this.byID(req.query.id);\n\t\tconst tracks = await this.engine.meta.getFolderSimilarTracks(folder);\n\t\treturn this.api.track.prepareList(paginate(tracks, req.query.amount, req.query.offset), req.query, req.user);\n\t}\n\n\tasync list(req: ApiOptions<JamParameters.FolderList>): Promise<Array<Jam.Folder>> {\n\t\treturn this.getList(req.query, req.query, req.query, req.user);\n\t}\n\n\tasync index(req: ApiOptions<JamParameters.Index>): Promise<Jam.FolderIndex> {\n\t\tconst folderIndex = await this.engine.index.getFolderIndex(this.engine.io.scanning);\n\t\treturn FORMAT.packFolderIndex(this.engine.index.filterFolderIndex(req.query.rootID, folderIndex));\n\t}\n\n}\n\nclass APIJamRoot extends APIJamObj<JamParameters.ID, JamParameters.IDs, {}, JamServe.SearchQueryRoot, JamParameters.RootSearch, JamServe.Root, Jam.Root> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.root, DBObjectType.root, api);\n\t}\n\n\tasync prepare(root: JamServe.Root, includes: {}, user: JamServe.User): Promise<Jam.Root> {\n\t\treturn FORMAT.packRoot(root, this.engine.io.getRootStatus(root.id));\n\t}\n\n\ttranslateQuery(query: JamParameters.RootSearch, user: JamServe.User): JamServe.SearchQueryRoot {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync create(req: ApiOptions<JamParameters.RootNew>): Promise<Jam.Root> {\n\t\tconst root: JamServe.Root = {\n\t\t\tid: '',\n\t\t\tcreated: Date.now(),\n\t\t\ttype: DBObjectType.root,\n\t\t\tname: req.query.name,\n\t\t\tpath: req.query.path\n\t\t};\n\t\troot.id = await this.engine.roots.createRoot(root);\n\t\treturn this.prepare(root, {}, req.user);\n\t}\n\n\tasync update(req: ApiOptions<JamParameters.RootUpdate>): Promise<Jam.Root> {\n\t\tconst root = await this.byID(req.query.id);\n\t\troot.name = req.query.name;\n\t\troot.path = req.query.path;\n\t\tawait this.engine.roots.updateRoot(root);\n\t\treturn this.prepare(root, {}, req.user);\n\t}\n\n\tasync delete(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst root = await this.byID(req.query.id);\n\t\tawait this.engine.roots.removeRoot(root);\n\t}\n\n\tasync scanAll(req: ApiOptions<{}>): Promise<void> {\n\t\tthis.engine.refresh(); // do not wait\n\t}\n\n\tasync scan(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst root = await this.byID(req.query.id);\n\t\tthis.engine.refreshRoot(root); // do not wait\n\t}\n\n\tasync status(req: ApiOptions<JamParameters.ID>): Promise<Jam.RootStatus> {\n\t\tconst root = await this.byID(req.query.id);\n\t\treturn this.engine.io.getRootStatus(root.id);\n\t}\n\n}\n\nclass APIJamUser extends APIJamObj<JamParameters.ID, JamParameters.IDs, {}, JamServe.SearchQueryUser, JamParameters.UserSearch, JamServe.User, Jam.User> {\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tsuper(engine, engine.store.user, DBObjectType.user, api);\n\t}\n\n\tasync prepare(item: JamServe.User, includes: {}, user: JamServe.User): Promise<Jam.User> {\n\t\treturn FORMAT.packUser(item);\n\t}\n\n\ttranslateQuery(query: JamParameters.UserSearch, user: JamServe.User): JamServe.SearchQueryUser {\n\t\treturn {\n\t\t\tquery: query.query,\n\t\t\tname: query.name,\n\t\t\tisAdmin: query.isAdmin,\n\t\t\toffset: query.offset,\n\t\t\tamount: query.amount,\n\t\t\tsorts: query.sortField ? [{field: query.sortField, descending: !!query.sortDescending}] : undefined\n\t\t};\n\t}\n\n\tasync create(req: ApiOptions<JamParameters.UserNew>): Promise<Jam.User> {\n\t\tconst u: JamServe.User = {\n\t\t\tid: '',\n\t\t\tname: req.query.name || '',\n\t\t\tpass: '',\n\t\t\temail: '',\n\t\t\ttype: DBObjectType.user,\n\t\t\tcreated: Date.now(),\n\t\t\tldapAuthenticated: false,\n\t\t\tscrobblingEnabled: false,\n\t\t\troles: {\n\t\t\t\tadminRole: req.query.roleAdmin !== undefined ? req.query.roleAdmin : false,\n\t\t\t\tstreamRole: req.query.roleStream !== undefined ? req.query.roleStream : true,\n\t\t\t\tuploadRole: req.query.roleUpload !== undefined ? req.query.roleUpload : false,\n\t\t\t\tpodcastRole: req.query.rolePodcast !== undefined ? req.query.rolePodcast : false,\n\t\t\t\t// settingsRole: false,\n\t\t\t\t// jukeboxRole: false,\n\t\t\t\t// downloadRole: false,\n\t\t\t\t// playlistRole: false,\n\t\t\t\t// coverArtRole: false,\n\t\t\t\t// commentRole: false,\n\t\t\t\t// shareRole: false,\n\t\t\t\t// videoConversionRole: false\n\t\t\t}\n\t\t};\n\t\tu.id = await this.engine.users.createUser(u);\n\t\treturn this.prepare(u, {}, req.user);\n\t}\n\n\tasync update(req: ApiOptions<JamParameters.UserUpdate>): Promise<Jam.User> {\n\t\tconst u = await this.byID(req.query.id);\n\t\tif (req.query.name) {\n\t\t\tif (req.query.name !== u.name) {\n\t\t\t\tconst u2 = await this.engine.store.user.get(req.query.name);\n\t\t\t\tif (u2) {\n\t\t\t\t\treturn Promise.reject(GenericError('Username already exists'));\n\t\t\t\t}\n\t\t\t}\n\t\t\tu.name = req.query.name.trim();\n\t\t}\n\t\tif (req.query.email) {\n\t\t\tu.email = req.query.email.trim();\n\t\t}\n\t\tif (req.query.roleAdmin !== undefined) {\n\t\t\tu.roles.adminRole = req.query.roleAdmin;\n\t\t}\n\t\tif (req.query.rolePodcast !== undefined) {\n\t\t\tu.roles.podcastRole = req.query.rolePodcast;\n\t\t}\n\t\tif (req.query.roleStream !== undefined) {\n\t\t\tu.roles.streamRole = req.query.roleStream;\n\t\t}\n\t\tif (req.query.roleUpload !== undefined) {\n\t\t\tu.roles.uploadRole = req.query.roleUpload;\n\t\t}\n\t\tawait this.engine.users.updateUser(u);\n\t\treturn this.prepare(u, {}, req.user);\n\t}\n\n\tasync playqueueUpdate(req: ApiOptions<JamParameters.PlayQueueSet>): Promise<void> {\n\t\tawait this.engine.playqueues.saveQueue(req.user.id, req.query.trackIDs, req.query.currentID, req.query.position, req.client);\n\t}\n\n\tasync playqueue(req: ApiOptions<JamParameters.IncludesPlayQueue>): Promise<Jam.PlayQueue> {\n\t\tconst playQueue = await this.engine.playqueues.getQueueOrCreate(req.user.id, req.client);\n\t\tconst result = FORMAT.packPlayQueue(playQueue, req.query);\n\t\tif (req.query.playQueueTracks) {\n\t\t\tconst entries = await this.engine.store.track.byIds(playQueue.trackIDs);\n\t\t\tresult.tracks = await this.api.track.prepareList(entries, req.query, req.user);\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync delete(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tconst u = await this.byID(req.query.id);\n\t\tawait this.engine.users.deleteUser(u);\n\t}\n\n\tasync imageUploadUpdate(req: ApiOptions<JamParameters.ID>): Promise<void> {\n\t\tif (!req.file) {\n\t\t\treturn Promise.reject(InvalidParamError('Image upload failed'));\n\t\t}\n\t\tconst u = await this.byID(req.query.id);\n\t\tif (u.id !== req.user.id && !req.user.roles.adminRole) {\n\t\t\treturn Promise.reject(UnauthError());\n\t\t}\n\t\tawait this.engine.users.setUserImage(u, req.file);\n\t}\n\n}\n\nclass APiJamChat {\n\tengine: Engine;\n\tapi: ApiJam;\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tthis.engine = engine;\n\t\tthis.api = api;\n\t}\n\n\tasync list(req: ApiOptions<JamParameters.Chat>): Promise<Array<Jam.ChatMessage>> {\n\t\tconst messages = await this.engine.chat.get(req.query.since);\n\t\treturn messages.map(msg => FORMAT.packChatMessage(msg));\n\t}\n\n\tasync create(req: ApiOptions<JamParameters.ChatNew>): Promise<void> {\n\t\tawait this.engine.chat.add(req.query.message, req.user);\n\t}\n\n\tasync delete(req: ApiOptions<JamParameters.ChatDelete>): Promise<void> {\n\t\tconst message = await this.engine.chat.find(req.query.time);\n\t\tif (!message) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\tif (message.userID !== req.user.id) {\n\t\t\treturn Promise.reject(UnauthError());\n\t\t}\n\t\tawait this.engine.chat.remove(message);\n\t}\n\n}\n\nclass APiJamMetadata {\n\tengine: Engine;\n\tapi: ApiJam;\n\tprivate cache: { [key: string]: any } = {};\n\n\tconstructor(engine: Engine, api: ApiJam) {\n\t\tthis.engine = engine;\n\t\tthis.api = api;\n\t}\n\n\tasync genreList(req: ApiOptions<JamParameters.Genres>): Promise<Array<Jam.Genre>> {\n\t\tconst genres = await this.engine.genres.getGenres(req.query.rootID, false);\n\t\treturn genres.map(genre => FORMAT.packGenre(genre));\n\t}\n\n\tasync brainzSearch(req: ApiOptions<JamParameters.BrainzSearch>): Promise<MusicBrainz.Response> {\n\t\tconst query = Object.assign({}, req.query);\n\t\tdelete query.type;\n\t\tconst key = 'search-' + req.query.type + JSON.stringify(query);\n\t\tif (this.cache[key]) {\n\t\t\tconsole.log('serving from cache search');\n\t\t\treturn this.cache[key];\n\t\t}\n\t\tconst brainz = await this.engine.audio.musicbrainzSearch(req.query.type, query);\n\t\tthis.cache[key] = brainz;\n\t\treturn brainz;\n\t}\n\n\tasync acoustidLookup(req: ApiOptions<JamParameters.AcoustidLookup>): Promise<Array<Acoustid.Result>> {\n\t\tconst key = 'acoustid-' + req.query.id + req.query.inc;\n\t\tif (this.cache[key]) {\n\t\t\tconsole.log('serving from cache acoustid');\n\t\t\treturn this.cache[key];\n\t\t}\n\t\tconst track = await this.api.track.byID(req.query.id);\n\t\tconst acoustid = await this.engine.audio.acoustidLookup(path.join(track.path, track.name), req.query.inc);\n\t\tthis.cache[key] = acoustid;\n\t\treturn acoustid;\n\t}\n\n\tasync lastfmLookup(req: ApiOptions<JamParameters.LastFMLookup>): Promise<LastFM.Result> {\n\t\tconst key = 'lastfm-' + req.query.type + req.query.id;\n\t\tif (this.cache[key]) {\n\t\t\tconsole.log('serving from cache lastfm');\n\t\t\treturn this.cache[key];\n\t\t}\n\t\tconst lastfm = await this.engine.audio.lastFMLookup(req.query.type, req.query.id);\n\t\tthis.cache[key] = lastfm;\n\t\treturn lastfm;\n\t}\n\n\tasync brainzLookup(req: ApiOptions<JamParameters.BrainzLookup>): Promise<MusicBrainz.Response> {\n\t\tconst key = 'lookup-' + req.query.type + req.query.id + req.query.inc;\n\t\tif (this.cache[key]) {\n\t\t\tconsole.log('serving from cache lookup');\n\t\t\treturn this.cache[key];\n\t\t}\n\t\tconst brainz = await this.engine.audio.musicbrainzLookup(req.query.type, req.query.id, req.query.inc);\n\t\tthis.cache[key] = brainz;\n\t\treturn brainz;\n\t}\n}\n\nexport class ApiJam {\n\tprivate readonly engine: Engine;\n\tpodcast: APIJamPodcast;\n\tepisode: APIJamEpisode;\n\talbum: APIJamAlbum;\n\ttrack: APIJamTrack;\n\tartist: APIJamArtist;\n\tfolder: APIJamFolder;\n\troot: APIJamRoot;\n\tuser: APIJamUser;\n\tchat: APiJamChat;\n\tplaylist: APiJamPlaylist;\n\tmetadata: APiJamMetadata;\n\n\tconstructor(engine: Engine) {\n\t\tthis.engine = engine;\n\t\tthis.podcast = new APIJamPodcast(engine, this);\n\t\tthis.episode = new APIJamEpisode(engine, this);\n\t\tthis.album = new APIJamAlbum(engine, this);\n\t\tthis.track = new APIJamTrack(engine, this);\n\t\tthis.artist = new APIJamArtist(engine, this);\n\t\tthis.folder = new APIJamFolder(engine, this);\n\t\tthis.root = new APIJamRoot(engine, this);\n\t\tthis.user = new APIJamUser(engine, this);\n\t\tthis.playlist = new APiJamPlaylist(engine, this);\n\t\tthis.metadata = new APiJamMetadata(engine, this);\n\t\tthis.chat = new APiJamChat(engine, this);\n\t}\n\n\tasync ping(req: ApiOptions<{}>): Promise<Jam.Ping> {\n\t\treturn {version: APIVERSION};\n\t}\n\n\tasync session(req: ApiOptions<{}>): Promise<Jam.Session> {\n\t\tif (req.user) {\n\t\t\treturn {version: APIVERSION, allowedCookieDomains: this.engine.config.server.session.allowedCookieDomains, user: FORMAT.packUser(req.user)};\n\t\t} else {\n\t\t\treturn {version: APIVERSION, allowedCookieDomains: this.engine.config.server.session.allowedCookieDomains};\n\t\t}\n\t}\n\n\tasync nowPlaying(req: ApiOptions<{}>): Promise<Array<Jam.NowPlaying>> {\n\t\tconst list = await this.engine.nowPlaying.getNowPlaying();\n\t\treturn list.map(entry => FORMAT.packNowPlaying(entry));\n\t}\n\n\tasync autocomplete(req: ApiOptions<JamParameters.AutoComplete>): Promise<Jam.AutoComplete> {\n\t\treturn await this.engine.autocomplete(req.query);\n\t}\n\n\tasync genreList(req: ApiOptions<JamParameters.Genres>): Promise<Array<Jam.Genre>> {\n\t\tconst genres = await this.engine.genres.getGenres(req.query.rootID, false);\n\t\treturn genres.map(genre => FORMAT.packGenre(genre));\n\t}\n\n\tasync image(req: ApiOptions<JamParameters.Image>): Promise<IApiBinaryResult> {\n\t\tconst id = req.query.id;\n\t\tif (!id || id.length === 0) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\tconst obj = await this.engine.store.findInAll(id);\n\t\tif (!obj) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\tconst result = await this.engine.getObjImage(obj, req.query.size, req.query.format);\n\t\tif (!result) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync stream(req: ApiOptions<JamParameters.PathStream>): Promise<IApiBinaryResult> {\n\t\tconst id = req.query.id;\n\t\tif (!id || id.length === 0) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\tconst obj = await this.engine.store.findInAll(id);\n\t\tif (!obj) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\tconst result = await this.engine.getObjStream(obj, req.query.format, undefined, req.user);\n\t\tif (!result) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync streamSVG(req: ApiOptions<JamParameters.ID>): Promise<IApiBinaryResult> {\n\t\tconst id = req.query.id;\n\t\tif (!id || id.length === 0) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\tconst obj = await this.engine.store.findInAll(id);\n\t\tif (!obj) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\tconst result = await this.engine.getObjStreamSVG(obj, req.user);\n\t\tif (!result) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync download(req: ApiOptions<JamParameters.Download>): Promise<IApiBinaryResult> {\n\t\tconst id = req.query.id;\n\t\tif (!id || id.length === 0) {\n\t\t\treturn Promise.reject(InvalidParamError());\n\t\t}\n\t\tconst obj = await this.engine.store.findInAll(id);\n\t\tif (!obj) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\tconst result = await this.engine.getObjDownload(obj, req.query.format, req.user);\n\t\tif (!result) {\n\t\t\treturn Promise.reject(NotFoundError());\n\t\t}\n\t\treturn result;\n\t}\n\n\n}\n","import {JamServe} from '../../model/jamserve';\nimport path from 'path';\nimport {FolderType} from '../../types';\nimport {Jam} from '../../model/jam-rest-data-0.1.0';\nimport {replaceFileSystemChars} from '../../utils/fs-utils';\n\ninterface ProblemCheck {\n\tname: string;\n\tcheck: (folder: JamServe.Folder) => Promise<boolean>;\n}\n\n\nfunction getNiceFolderName(tag: JamServe.FolderTag): string {\n\tconst year = tag.year ? tag.year.toString() : '';\n\tconst s = (year.length > 0 ? '[' + year + '] ' : '') + replaceFileSystemChars(tag.album || '', '_');\n\treturn s.trim();\n}\n\nconst ProblemDefs: { [id: string]: ProblemCheck; } = {\n\tFOLDER_TAG_MISSING: {\n\t\tname: 'Missing TAG',\n\t\tcheck: async (folder) => {\n\t\t\treturn !folder.tag;\n\t\t}\n\t},\n\tFOLDER_TAG_VALUES_MISSING: {\n\t\tname: 'Missing Tag Values (album, artist, year)',\n\t\tcheck: async (folder) => {\n\t\t\treturn folder.tag &&\n\t\t\t\t(\n\t\t\t\t\t(folder.tag.type === FolderType.album) ||\n\t\t\t\t\t(folder.tag.type === FolderType.multialbum)\n\t\t\t\t) &&\n\t\t\t\t(\n\t\t\t\t\t(!folder.tag.album) || (!folder.tag.artist) || (!folder.tag.year)\n\t\t\t\t);\n\t\t}\n\t},\n\tALBUM_IMAGE_MISSING: {\n\t\tname: 'Missing album image',\n\t\tcheck: async (folder) => {\n\t\t\treturn !!folder.tag &&\n\t\t\t\t((folder.tag.type === FolderType.album) || (folder.tag.type === FolderType.multialbum))\n\t\t\t\t&& !folder.tag.image;\n\t\t}\n\t},\n\tALBUM_IMAGE_NAME_NONCONFORM: {\n\t\tname: 'Album Image Name is not cover.[ext]',\n\t\tcheck: async (folder) => {\n\t\t\treturn !!folder.tag &&\n\t\t\t\t(\n\t\t\t\t\t(folder.tag.type === FolderType.album) ||\n\t\t\t\t\t(folder.tag.type === FolderType.multialbum)\n\t\t\t\t)\n\t\t\t\t&& !!folder.tag.image &&\n\t\t\t\tfolder.tag.image.indexOf('cover.') !== 0;\n\t\t}\n\n\t},\n\tALBUM_NAME_NONCONFORM: {\n\t\tname: 'Album folder name is not \"[Year] Album-Name\"',\n\t\tcheck: async (folder) => {\n\t\t\tif (folder.tag && (folder.tag.type === FolderType.album) &&\n\t\t\t\t(folder.tag.album) && (folder.tag.year) && (folder.tag.year > 0)) {\n\t\t\t\tconst name = path.basename(folder.path).trim().replace(/[_:!?\\/ ]/g, '').toLowerCase();\n\t\t\t\tconst nicename = getNiceFolderName(folder.tag).replace(/[_:!?\\/ ]/g, '').toLowerCase();\n\t\t\t\treturn name.localeCompare(nicename) !== 0;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t},\n\tALBUM_GENRE_MISSING: {\n\t\tname: 'Album genre is missing',\n\t\tcheck: async (folder) => {\n\t\t\treturn (folder.tag && (!folder.tag.genre || folder.tag.genre.length === 0));\n\t\t}\n\n\t},\n\tALBUM_ID_MISSING: {\n\t\tname: 'Missing musicbrainz album id',\n\t\tcheck: async (folder) => {\n\t\t\treturn folder.tag && (\n\t\t\t\t(folder.tag.type === FolderType.album) ||\n\t\t\t\t(folder.tag.type === FolderType.multialbum)\n\t\t\t) && !folder.tag.mbAlbumID;\n\t\t}\n\t},\n\tARTIST_IMAGE_NAME_NONCONFORM: {\n\t\tname: 'Artist Image Name is not artist.[ext]',\n\t\tcheck: async (folder) => {\n\t\t\treturn (!!folder.tag) &&\n\t\t\t\t(\n\t\t\t\t\t(folder.tag.type === FolderType.artist) ||\n\t\t\t\t\t(folder.tag.type === FolderType.multiartist)\n\t\t\t\t) && (!!folder.tag.image) && folder.tag.image.indexOf('artist.') !== 0;\n\t\t}\n\n\t},\n\tARTIST_IMAGE_MISSING: {\n\t\tname: 'Missing artist image',\n\t\tcheck: async (folder) => {\n\t\t\treturn !!folder.tag && (\n\t\t\t\t\t(folder.tag.type === FolderType.artist) ||\n\t\t\t\t\t(folder.tag.type === FolderType.multiartist)\n\t\t\t\t)\n\t\t\t\t&& !folder.tag.image;\n\t\t}\n\t}\n};\n\nexport async function getFolderProblems(node: JamServe.Folder): Promise<Array<Jam.FolderProblem>> {\n\tconst probs: Array<Jam.FolderProblem> = [];\n\tconst keys = Object.keys(ProblemDefs);\n\tfor (const key of keys) {\n\t\tif (ProblemDefs[key].check) {\n\t\t\tconst match = await ProblemDefs[key].check(node);\n\t\t\tif (match) {\n\t\t\t\tprobs.push({id: key, name: ProblemDefs[key].name});\n\t\t\t}\n\t\t}\n\t}\n\treturn probs;\n}\n","import fs from 'fs';\nimport path from 'path';\nimport {Store} from 'express-session';\nimport {Express} from 'express';\n\nexport interface Sessions {\n\t[key: string]: Express.SessionData;\n}\n\nexport class SessionJSONFileStore extends Store {\n\tfilename: string;\n\tcache: Sessions = {};\n\n\tconstructor(filename: string) {\n\t\tsuper();\n\t\tthis.filename = filename || 'sessions.json';\n\n\t\tfs.mkdir(path.dirname(filename), (err) => {\n\t\t\tif (err && err.code !== 'EEXIST') {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\tfs.readFile(filename, 'utf8', (err2, data) => {\n\t\t\t\tif (err2 && err2.code !== 'ENOENT') {\n\t\t\t\t\tthrow err2;\n\t\t\t\t}\n\t\t\t\tif ((!err2) && (data)) {\n\t\t\t\t\tthis.cache = {};\n\t\t\t\t\tconst archive = JSON.parse(data.toString());\n\t\t\t\t\tObject.keys(archive).forEach(key => {\n\t\t\t\t\t\tconst sessionData = archive[key];\n\t\t\t\t\t\tif (sessionData.cookie.expires !== undefined && typeof sessionData.cookie.expires !== 'boolean') {\n\t\t\t\t\t\t\tsessionData.cookie.expires = new Date(sessionData.cookie.expires);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!this.expired(sessionData)) {\n\t\t\t\t\t\t\tthis.cache[key] = sessionData;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget: (sid: string, callback: (err: any, data?: Express.SessionData | null) => void) => void = (sid, callback) => {\n\t\tconst sessionData = this.cache[sid];\n\t\tif (sessionData && this.expired(sessionData)) {\n\t\t\treturn this.destroy(sid, (err) => {\n\t\t\t\tcallback(err);\n\t\t\t});\n\t\t}\n\t\tcallback(null, sessionData);\n\t};\n\n\tset: (sid: string, data: Express.SessionData, callback?: (err?: any) => void) => void = (sid, data, callback) => {\n\t\tthis.cache[sid] = data;\n\t\tthis.savejson(callback);\n\t};\n\n\tdestroy: (sid: string, callback?: (err?: any) => void) => void = (sid, callback) => {\n\t\tdelete this.cache[sid];\n\t\tthis.savejson(callback);\n\t};\n\n\tall: (callback: (err: any, obj?: { [sid: string]: Express.SessionData; } | null) => void) => void = (callback) => {\n\t\tcallback(null, this.cache);\n\t};\n\n\tlength: (callback: (err: any, length?: number | null) => void) => void = (callback) => {\n\t\tcallback(null, Object.keys(this.cache).length);\n\t};\n\n\tclear: (callback?: (err?: any) => void) => void = (callback) => {\n\t\tthis.cache = {};\n\t\tthis.savejson(callback);\n\t};\n\n\t// touch: (sid: string, session: Express.Session, callback?: (err?: any) => void) => void = (sid, session, callback) => {\n\t// \tthis.set(sid, session, callback);\n\t// };\n\n\tprivate expired(data: Express.SessionData): boolean {\n\t\tif (data.cookie && data.cookie.expires instanceof Date) {\n\t\t\treturn data.cookie.expires.valueOf() < Date.now();\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate savejson(callback?: (err?: Error) => void): void {\n\t\tfs.writeFile(this.filename, JSON.stringify(this.cache), (err) => {\n\t\t\tif (callback) {\n\t\t\t\tcallback(err);\n\t\t\t}\n\t\t});\n\t}\n\n}\n\n","module.exports = require(\"passport\");","module.exports = require(\"passport-jwt\");","module.exports = require(\"passport-local\");","module.exports = require(\"jsonwebtoken\");","import {Jam} from '../../model/jam-rest-data-0.1.0';\nimport {MusicBrainz} from '../../model/musicbrainz-rest-data-2.0';\nimport {Acoustid} from '../../model/acoustid-rest-data-2.0';\nimport {LastFM} from '../../model/lastfm-rest-data-2.0';\nimport {JamParameters} from '../../model/jam-rest-params-0.1.0';\nimport {ApiJam, ApiOptions} from './api';\nimport {ApiResponder} from './response';\nimport express from 'express';\nimport {IApiBinaryResult} from '../../typings';\nimport {apiCheck} from './check';\n\nexport function registerPublicApi(router: express.Router, api: ApiJam): void {\n\trouter.get('/ping', apiCheck('/ping'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Ping = await api.ping(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/session', apiCheck('/session'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Session = await api.session(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n}\n\nexport function registerUserApi(router: express.Router, api: ApiJam, image: express.RequestHandler, uploadAutoRemove: express.RequestHandler): void {\n\trouter.get('/lastfm/lookup', apiCheck('/lastfm/lookup'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.LastFMLookup> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: LastFM.Result = await api.metadata.lastfmLookup(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/acoustid/lookup', apiCheck('/acoustid/lookup'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.AcoustidLookup> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Acoustid.Result> = await api.metadata.acoustidLookup(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/brainz/lookup', apiCheck('/brainz/lookup'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.BrainzLookup> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: MusicBrainz.Response = await api.metadata.brainzLookup(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/brainz/search', apiCheck('/brainz/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.BrainzSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: MusicBrainz.Response = await api.metadata.brainzSearch(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/autocomplete', apiCheck('/autocomplete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.AutoComplete> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.AutoComplete = await api.autocomplete(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/genre/list', apiCheck('/genre/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Genres> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Genre> = await api.genreList(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/nowPlaying', apiCheck('/nowPlaying'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.NowPlaying> = await api.nowPlaying(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/chat/list', apiCheck('/chat/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Chat> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.ChatMessage> = await api.chat.list(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/index', apiCheck('/folder/index'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Index> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.FolderIndex = await api.folder.index(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/id', apiCheck('/folder/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Folder> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Folder = await api.folder.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/ids', apiCheck('/folder/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Folders> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Folder> = await api.folder.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/children', apiCheck('/folder/children'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderChildren> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.FolderChildren = await api.folder.children(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/tracks', apiCheck('/folder/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderTracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.folder.tracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/subfolders', apiCheck('/folder/subfolders'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderSubFolders> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Folder> = await api.folder.subfolders(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/artist/similar', apiCheck('/folder/artist/similar'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Folder> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Folder> = await api.folder.artistSimilar(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/artist/info', apiCheck('/folder/artist/info'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ArtistInfo> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.ArtistFolderInfo = await api.folder.artistInfo(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/album/info', apiCheck('/folder/album/info'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.AlbumInfo> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.AlbumFolderInfo = await api.folder.albumInfo(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/list', apiCheck('/folder/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderList> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Folder> = await api.folder.list(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/search', apiCheck('/folder/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Folder> = await api.folder.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/state', apiCheck('/folder/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.folder.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/states', apiCheck('/folder/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.folder.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/artist/similar/tracks', apiCheck('/folder/artist/similar/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.SimilarTracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.folder.artistSimilarTracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/id', apiCheck('/track/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Track> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Track = await api.track.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/ids', apiCheck('/track/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Tracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.track.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/tagID3', apiCheck('/track/tagID3'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.ID3Tag = await api.track.tagID3(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/tagID3s', apiCheck('/track/tagID3s'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.ID3Tags = await api.track.tagID3s(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/search', apiCheck('/track/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.TrackSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.track.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/state', apiCheck('/track/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.track.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/states', apiCheck('/track/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.track.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/list', apiCheck('/track/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.TrackList> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.track.list(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/similar', apiCheck('/track/similar'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.SimilarTracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.track.similar(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/bookmark/list', apiCheck('/track/bookmark/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.BookmarkList> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.TrackBookmark> = await api.track.bookmarkList(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/id', apiCheck('/episode/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Episode> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.PodcastEpisode = await api.episode.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/ids', apiCheck('/episode/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Episodes> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.PodcastEpisode> = await api.episode.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/search', apiCheck('/episode/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.EpisodeSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.PodcastEpisode> = await api.episode.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/state', apiCheck('/episode/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.episode.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/states', apiCheck('/episode/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.episode.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/status', apiCheck('/episode/status'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.PodcastEpisodeStatus = await api.episode.status(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/id', apiCheck('/podcast/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Podcast> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Podcast = await api.podcast.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/ids', apiCheck('/podcast/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Podcasts> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Podcast> = await api.podcast.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/status', apiCheck('/podcast/status'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.PodcastStatus = await api.podcast.status(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/search', apiCheck('/podcast/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PodcastSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Podcast> = await api.podcast.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/refreshAll', apiCheck('/podcast/refreshAll'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.podcast.refreshAll(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/refresh', apiCheck('/podcast/refresh'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.podcast.refresh(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/state', apiCheck('/podcast/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.podcast.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/states', apiCheck('/podcast/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.podcast.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/id', apiCheck('/artist/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Artist> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Artist = await api.artist.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/ids', apiCheck('/artist/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Artists> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Artist> = await api.artist.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/search', apiCheck('/artist/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ArtistSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Artist> = await api.artist.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/state', apiCheck('/artist/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.artist.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/states', apiCheck('/artist/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.artist.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/list', apiCheck('/artist/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ArtistList> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Artist> = await api.artist.list(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/similar/tracks', apiCheck('/artist/similar/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.SimilarTracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.artist.similarTracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/similar', apiCheck('/artist/similar'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Artist> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Artist> = await api.artist.similar(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/index', apiCheck('/artist/index'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Index> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.ArtistIndex = await api.artist.index(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/tracks', apiCheck('/artist/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Tracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.artist.tracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/id', apiCheck('/album/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Album> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Album = await api.album.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/ids', apiCheck('/album/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Albums> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Album> = await api.album.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/list', apiCheck('/album/list'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.AlbumList> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Album> = await api.album.list(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/search', apiCheck('/album/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.AlbumSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Album> = await api.album.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/state', apiCheck('/album/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.album.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/states', apiCheck('/album/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.album.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/similar/tracks', apiCheck('/album/similar/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.SimilarTracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.album.similarTracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/tracks', apiCheck('/album/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Tracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.album.tracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/id', apiCheck('/playlist/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Playlist> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Playlist = await api.playlist.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/ids', apiCheck('/playlist/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Playlists> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Playlist> = await api.playlist.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/search', apiCheck('/playlist/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PlaylistSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Playlist> = await api.playlist.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/state', apiCheck('/playlist/state'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.State = await api.playlist.state(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/states', apiCheck('/playlist/states'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.States = await api.playlist.states(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/tracks', apiCheck('/playlist/tracks'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Tracks> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Track> = await api.playlist.tracks(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/user/playqueue', apiCheck('/user/playqueue'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IncludesPlayQueue> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.PlayQueue = await api.user.playqueue(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/search', apiCheck('/root/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.RootSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Root> = await api.root.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/id', apiCheck('/root/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Root = await api.root.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/ids', apiCheck('/root/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.Root> = await api.root.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/status', apiCheck('/root/status'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.RootStatus = await api.root.status(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/download', apiCheck('/folder/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.folder.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/folder/image', apiCheck('/folder/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.folder.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/stream', apiCheck('/track/stream'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Stream> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.track.stream(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/download', apiCheck('/track/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.track.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/track/image', apiCheck('/track/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.track.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/stream', apiCheck('/episode/stream'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Stream> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.episode.stream(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/download', apiCheck('/episode/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.episode.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/episode/image', apiCheck('/episode/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.episode.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/image', apiCheck('/podcast/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.podcast.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/podcast/download', apiCheck('/podcast/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.podcast.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/image', apiCheck('/artist/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.artist.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/artist/download', apiCheck('/artist/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.artist.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/image', apiCheck('/album/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.album.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/album/download', apiCheck('/album/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.album.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/image', apiCheck('/playlist/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.playlist.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/playlist/download', apiCheck('/playlist/download'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.playlist.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/user/image', apiCheck('/user/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.user.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/image', apiCheck('/root/image'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.root.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/image/:id-:size.:format', apiCheck('/image/{id}-{size}.{format}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Image> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/image/:id-:size', apiCheck('/image/{id}-{size}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PathImageSize> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/image/:id.:format', apiCheck('/image/{id}.{format}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PathImageFormat> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/image/:id', apiCheck('/image/{id}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.image(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/stream/:id.:format', apiCheck('/stream/{id}.{format}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PathStream> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.stream(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/stream/:id', apiCheck('/stream/{id}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.stream(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/streamSVG/:id', apiCheck('/streamSVG/{id}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.streamSVG(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/download/:id', apiCheck('/download/{id}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/download/:id.:format', apiCheck('/download/{id}.{format}'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Download> = {query: req.params, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.download(options);\n\t\t\tawait ApiResponder.binary(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/track/bookmark/delete', apiCheck('/track/bookmark/delete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.track.bookmarkDelete(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/chat/delete', apiCheck('/chat/delete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ChatDelete> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.chat.delete(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/playlist/delete', apiCheck('/playlist/delete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.playlist.delete(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/chat/create', apiCheck('/chat/create'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ChatNew> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.chat.create(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/track/fav/update', apiCheck('/track/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.track.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/track/rate/update', apiCheck('/track/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.track.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/folder/fav/update', apiCheck('/folder/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.folder.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/folder/rate/update', apiCheck('/folder/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.folder.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/track/bookmark/create', apiCheck('/track/bookmark/create'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.BookmarkCreate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tconst result: Jam.TrackBookmark = await api.track.bookmarkCreate(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/album/fav/update', apiCheck('/album/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.album.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/album/rate/update', apiCheck('/album/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.album.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/artist/fav/update', apiCheck('/artist/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.artist.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/artist/rate/update', apiCheck('/artist/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.artist.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/episode/fav/update', apiCheck('/episode/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.episode.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/episode/rate/update', apiCheck('/episode/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.episode.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/podcast/fav/update', apiCheck('/podcast/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.podcast.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/podcast/rate/update', apiCheck('/podcast/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.podcast.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/playlist/create', apiCheck('/playlist/create'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PlaylistNew> = {query: req.body, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Playlist = await api.playlist.create(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/playlist/update', apiCheck('/playlist/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PlaylistUpdate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.playlist.update(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/playlist/fav/update', apiCheck('/playlist/fav/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Fav> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.playlist.favUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/playlist/rate/update', apiCheck('/playlist/rate/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.Rate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.playlist.rateUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/user/playqueue/update', apiCheck('/user/playqueue/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PlayQueueSet> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.user.playqueueUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/user/imageUpload/update', image, uploadAutoRemove, apiCheck('/user/imageUpload/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client, file: req.file ? req.file.path : undefined};\n\t\t\tawait api.user.imageUploadUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n}\n\nexport function registerAdminApi(router: express.Router, api: ApiJam, image: express.RequestHandler, uploadAutoRemove: express.RequestHandler): void {\n\trouter.get('/episode/retrieve', apiCheck('/episode/retrieve'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.episode.retrieve(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/user/search', apiCheck('/user/search'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.UserSearch> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.User> = await api.user.search(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/user/id', apiCheck('/user/id'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Jam.User = await api.user.id(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/user/ids', apiCheck('/user/ids'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.IDs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: Array<Jam.User> = await api.user.ids(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/scan', apiCheck('/root/scan'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.root.scan(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.get('/root/scanAll', apiCheck('/root/scanAll'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.root.scanAll(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/podcast/delete', apiCheck('/podcast/delete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.podcast.delete(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/user/delete', apiCheck('/user/delete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.user.delete(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/root/delete', apiCheck('/root/delete'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.root.delete(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/track/tagID3/update', apiCheck('/track/tagID3/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.TagID3Update> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.track.tagID3Update(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/track/tagID3s/update', apiCheck('/track/tagID3s/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.TagID3sUpdate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.track.tagID3sUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/folder/imageUpload/update', image, uploadAutoRemove, apiCheck('/folder/imageUpload/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.ID> = {query: req.body, user: req.user, client: req.client, file: req.file ? req.file.path : undefined};\n\t\t\tawait api.folder.imageUploadUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/folder/imageUrl/update', apiCheck('/folder/imageUrl/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderEditImg> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.folder.imageUrlUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/folder/name/update', apiCheck('/folder/name/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.FolderEditName> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.folder.nameUpdate(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/podcast/create', apiCheck('/podcast/create'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.PodcastNew> = {query: req.body, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Podcast = await api.podcast.create(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/user/create', apiCheck('/user/create'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.UserNew> = {query: req.body, user: req.user, client: req.client};\n\t\t\tconst result: Jam.User = await api.user.create(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/user/update', apiCheck('/user/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.UserUpdate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.user.update(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/root/create', apiCheck('/root/create'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.RootNew> = {query: req.body, user: req.user, client: req.client};\n\t\t\tconst result: Jam.Root = await api.root.create(options);\n\t\t\tawait ApiResponder.data(res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n\n\trouter.post('/root/update', apiCheck('/root/update'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<JamParameters.RootUpdate> = {query: req.body, user: req.user, client: req.client};\n\t\t\tawait api.root.update(options);\n\t\t\tawait ApiResponder.ok(res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(res, e);\n\t\t}\n\t});\n}\n","const Ajv = require('ajv');\nconst ajv = new Ajv(); // options can be passed, e.g. {allErrors: true}\n\nexport async function validate(data: any, schema: any): Promise<{ errors: Array<Error> }> {\n\tconst validator = ajv.compile(schema);\n\tconst valid = validator(data);\n\tif (valid) {\n\t\treturn {errors: []};\n\t} else {\n\t\treturn {errors: validator.errors};\n\t}\n}\n","module.exports = require(\"ajv\");","import moment from 'moment';\n\nexport function getMaxAge(maxAgeSpec: { value: number; unit: string }): number {\n\tlet maxAge = 0;\n\tif (maxAgeSpec.value > 0) {\n\t\tmaxAge = moment.duration(maxAgeSpec.value, <moment.unitOfTime.Base>maxAgeSpec.unit).asMilliseconds();\n\t}\n\treturn maxAge;\n}\n","module.exports = require(\"multer-autoreap\");","module.exports = require(\"express-rate-limit\");","import express from 'express';\nimport {CheckAuthMiddleWare, SubsonicLoginMiddleWare} from './login';\nimport {SubsonicParameterMiddleWare, SubsonicParameterRequest} from './parameters';\nimport Logger from '../../utils/logger';\nimport {FORMAT} from './format';\nimport {SubsonicApi} from './api';\nimport {Engine} from '../../engine/engine';\nimport {Subsonic} from '../../model/subsonic-rest-data-1.16.0';\nimport cors from 'cors';\nimport {registerApi, SubsonicRolesHandler} from './routes';\nimport {ApiResponder} from './response';\n\nconst log = Logger('Subsonic.Api');\n\nexport function AdminMiddleWare(req: SubsonicParameterRequest, res: express.Response, next: express.NextFunction) {\n\tif (!req.user || !req.user.roles.adminRole) {\n\t\tApiResponder.error(req, res, {fail: FORMAT.FAIL.UNAUTH});\n\t}\n\tnext();\n}\n\nexport function PodcastAdminMiddleWare(req: SubsonicParameterRequest, res: express.Response, next: express.NextFunction) {\n\tif (!req.user || !req.user.roles.podcastRole) {\n\t\tApiResponder.error(req, res, {fail: FORMAT.FAIL.UNAUTH});\n\t}\n\tnext();\n}\n\nexport function ShareMiddleWare(req: SubsonicParameterRequest, res: express.Response, next: express.NextFunction) {\n\tif (!req.user || !req.user.roles.shareRole) {\n\t\tApiResponder.error(req, res, {fail: FORMAT.FAIL.UNAUTH});\n\t}\n\tnext();\n}\n\nexport function JukeboxMiddleWare(req: SubsonicParameterRequest, res: express.Response, next: express.NextFunction) {\n\tif (!req.user || !req.user.roles.jukeboxRole) {\n\t\tApiResponder.error(req, res, {fail: FORMAT.FAIL.UNAUTH});\n\t}\n\tnext();\n}\n\nexport function initSubsonicRouter(engine: Engine): express.Router {\n\tconst api = new SubsonicApi(engine);\n\tconst roles: SubsonicRolesHandler = {\n\t\tadmin: <express.RequestHandler>AdminMiddleWare,\n\t\tpodcast: <express.RequestHandler>PodcastAdminMiddleWare,\n\t\tshare: <express.RequestHandler>ShareMiddleWare,\n\t\tjukebox: <express.RequestHandler>JukeboxMiddleWare\n\t};\n\n\tconst router = express.Router();\n\trouter.options('*', cors());\n\trouter.use((req, res, next) => {\n\t\tlog.info(req.method, req.originalUrl);\n\t\tnext();\n\t});\n\n\trouter.use(SubsonicParameterMiddleWare);\n\trouter.use(<express.RequestHandler>SubsonicLoginMiddleWare);\n\trouter.use(<express.RequestHandler>CheckAuthMiddleWare);\n\tregisterApi(router, api, roles);\n\n\trouter.use((req, res, next) => {\n\t\tres.status(404).send('subsonic api cmd not found');\n\t});\n\n\treturn router;\n}\n","/*\n\nAuthentication\n\nIf your targeting API version 1.12.0 or earlier, authentication is performed by sending the password as clear text or hex-encoded. Examples:\n\nhttp://your-server/rest/ping.view?u=joe&p=sesame&v=1.12.0&c=myapp\nhttp://your-server/rest/ping.view?u=joe&p=enc:736573616d65&v=1.12.0&c=myapp\n\nStarting with API version 1.13.0, the recommended authentication scheme is to send an authentication token, calculated as a one-way salted hash of the password.\n\nThis involves two steps:\n\n    For each REST call, generate a random string called the salt. Send this as parameter s.\n    Use a salt length of at least six characters.\n    Calculate the authentication token as follows: token = md5(password + salt). The md5() function takes a string and returns the 32-byte ASCII hexadecimal representation of the MD5 hash, using lower case characters for the hex values. The '+' operator represents concatenation of the two strings. Treat the strings as UTF-8 encoded when calculating the hash. Send the result as parameter t.\n\nFor example: if the password is sesame and the random salt is c19b2d, then token = md5(\"sesamec19b2d\") = 26719a1196d2a940705a59634eb18eab. The corresponding request URL then becomes:\n\nhttp://your-server/rest/ping.view?u=joe&t=26719a1196d2a940705a59634eb18eab&s=c19b2d&v=1.12.0&c=myapp\n\n */\n\nimport express from 'express';\nimport {JamServe} from '../../model/jamserve';\nimport {SubsonicParameterRequest} from './parameters';\nimport {ApiResponder} from './response';\nimport {FORMAT} from './format';\n\n/**\n * Fill user into req.user express requests\n */\nexport interface UserRequest extends SubsonicParameterRequest {\n\tuser: JamServe.User;\n\tclient: string;\n}\n\nasync function validateCredentials(req: SubsonicParameterRequest): Promise<JamServe.User> {\n\tif (req.user) {\n\t\treturn <JamServe.User>req.user;\n\t}\n\tif (req.parameters.password) {\n\t\treturn req.engine.users.auth(req.parameters.username, req.parameters.password);\n\t} else if (req.parameters.token && req.parameters.salt) {\n\t\treturn req.engine.users.authToken(req.parameters.username, req.parameters.token, req.parameters.salt);\n\t} else {\n\t\treturn Promise.reject('Invalid Login Type');\n\t}\n}\n\nexport function SubsonicLoginMiddleWare(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\tif (req.user) {\n\t\treturn next();\n\t}\n\tif (!req.parameters) {\n\t\treturn next();\n\t}\n\treq.client = req.parameters.client;\n\tvalidateCredentials(req)\n\t\t.then(user => {\n\t\t\treq.user = user;\n\t\t\tnext();\n\t\t})\n\t\t.catch(e => {\n\t\t\tnext();\n\t\t});\n}\n\nexport function CheckAuthMiddleWare(req: UserRequest, res: express.Response, next: express.NextFunction) {\n\tif (req.user) {\n\t\treturn next();\n\t}\n\treturn ApiResponder.error(req, res, {fail: FORMAT.FAIL.UNAUTH});\n}\n","import util from 'util';\n\nexport function toXML(obj: any): string {\n\n\tconst xmls = (s: any): string => s.toString().replace(/&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/\"/g, '&quot;')\n\t\t.replace(/'/g, '&apos;');\n\n\tconst xmli = (o: any) => {\n\t\tlet s = '';\n\t\tObject.keys(o).forEach(key => {\n\t\t\tif ((key !== 'content')) {\n\t\t\t\tconst sub = o[key];\n\t\t\t\tif (!util.isArray(sub) && (typeof sub !== 'object')) {\n\t\t\t\t\tconst val = JSON.stringify(sub);\n\t\t\t\t\tif (val !== undefined) {\n\t\t\t\t\t\ts += ' ' + key + '=\"' + xmls(sub) + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn s;\n\t};\n\n\tconst xmlc = (o: any): string => {\n\t\tfor (const key in o) {\n\t\t\tif (key === 'content' && o.hasOwnProperty(key)) {\n\t\t\t\treturn o[key];\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t};\n\n\tconst xmlo = (o: any): string => {\n\t\tlet s = '';\n\t\tObject.keys(o).forEach(key => {\n\t\t\tconst sub = o[key];\n\t\t\tif (util.isArray(sub)) {\n\t\t\t\tsub.forEach((entry) => {\n\t\t\t\t\tconst val = xmlc(entry) + xmlo(entry);\n\t\t\t\t\ts += '<' + key + xmli(entry);\n\t\t\t\t\tif (val.length > 0) {\n\t\t\t\t\t\ts += '>' + val + '</' + key + '>';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ts += ' />';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof sub === 'object') {\n\t\t\t\tconst val = xmlo(sub);\n\t\t\t\ts += '<' + key + xmli(sub);\n\t\t\t\tif (val.length > 0) {\n\t\t\t\t\ts += '>' + val + '</' + key + '>';\n\t\t\t\t} else {\n\t\t\t\t\ts += ' />';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn s;\n\t};\n\n\tconst xml = (o: any): string => {\n\t\tlet s = '';\n\t\tObject.keys(o).forEach(key => {\n\t\t\tconst val = xmlo(o[key]);\n\t\t\ts += '<' + key + xmli(o[key]);\n\t\t\tif (val.length > 0) {\n\t\t\t\ts += '>' + val + '</' + key + '>';\n\t\t\t} else {\n\t\t\t\ts += ' />';\n\t\t\t}\n\t\t});\n\t\treturn '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' + s;\n\t};\n\n\treturn xml(obj);\n}\n","module.exports = require(\"util\");","import express from 'express';\nimport {EngineRequest} from '../server';\n\nexport interface SubsonicBaseParams {\n\tusername: string;\n\tpassword?: string;\n\ttoken?: string;\n\tsalt?: string;\n\tformat: string;\n\tclient: string;\n\tversion: string;\n\tcallback?: string;\n}\n\nfunction processParams(req: express.Request): SubsonicBaseParams {\n\t/*\n\tParameter \tRequired \tDefault \tComment\n\tu \tYes \t\tThe username.\n\tp \tYes* \t\tThe password, either in clear text or hex-encoded with a \"enc:\" prefix. Since 1.13.0 this should only be used for testing purposes.\n\tt \tYes* \t\t(Since 1.13.0) The authentication token computed as md5(password + salt). See below for details.\n\ts \tYes* \t\t(Since 1.13.0) A random string (\"salt\") used as input for computing the password hash. See below for details.\n\tv \tYes \t\tThe protocol version implemented by the client, i.e., the version of the subsonic-rest-api.xsd schema used (see below).\n\tc \tYes \t\tA unique string identifying the client application.\n\tf \tNo \txml \tRequest data to be returned in this format. Supported values are \"xml\", \"json\" (since 1.4.0) and \"jsonp\" (since 1.6.0). If using jsonp, specify name of javascript callback function using a callback parameter.\n\t */\n\tconst params: SubsonicBaseParams = {\n\t\tusername: req.query.u,\n\t\tpassword: req.query.p,\n\t\tformat: req.query.f,\n\t\tversion: req.query.v,\n\t\ttoken: req.query.t,\n\t\tsalt: req.query.s,\n\t\tclient: req.query.c,\n\t\tcallback: req.query.callback\n\t};\n\tdelete req.query.t;\n\tdelete req.query.u;\n\tdelete req.query.p;\n\tdelete req.query.f;\n\tdelete req.query.v;\n\tdelete req.query.c;\n\tdelete req.query.s;\n\tdelete req.query.callback;\n\treturn params;\n}\n\nexport interface SubsonicParameterRequest extends EngineRequest {\n\tparameters: SubsonicBaseParams;\n}\n\nexport function SubsonicParameterMiddleWare(req: express.Request, res: express.Response, next: express.NextFunction) {\n\t(<SubsonicParameterRequest>req).parameters = processParams(req);\n\tnext();\n}\n","import {IApiBinaryResult} from '../../typings';\nimport {Engine} from '../../engine/engine';\nimport {DBObjectType, FolderType, FolderTypesAlbum} from '../../types';\nimport {PodcastStatus} from '../../utils/feed';\nimport {randomItems} from '../../utils/random';\nimport {paginate} from '../../utils/paginate';\nimport {FORMAT} from './format';\nimport {Subsonic} from '../../model/subsonic-rest-data-1.16.0';\nimport {SubsonicParameters} from '../../model/subsonic-rest-params-1.16.0';\nimport {BaseStore} from '../../store/store';\nimport {JamServe} from '../../model/jamserve';\nimport DBObject = JamServe.DBObject;\n\n/*\n\thttp://www.subsonic.org/pages/api.jsp\n */\n\nexport interface ApiOptions<T> {\n\tquery: T;\n\tuser: JamServe.User;\n\tclient?: string;\n}\n\nexport class SubsonicApi {\n\tpublic engine: Engine;\n\n\tconstructor(engine: Engine) {\n\t\tthis.engine = engine;\n\t}\n\n\t/* helper functions */\n\n\tprivate async prepareList<T extends JamServe.DBObject, R>(type: DBObjectType, objs: Array<T>, pack: (o: T, state: JamServe.State) => R, user: JamServe.User): Promise<Array<R>> {\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(objs.map(o => o.id), user.id, type);\n\t\treturn objs.map(o => {\n\t\t\treturn pack(o, states[o.id]);\n\t\t});\n\t}\n\n\tprivate async prepareObj<T extends JamServe.DBObject, R>(type: DBObjectType, obj: T, pack: (o: T, state: JamServe.State) => R, user: JamServe.User): Promise<R> {\n\t\tconst state = await this.engine.store.state.findOrCreate(obj.id, user.id, type);\n\t\treturn pack(obj, state);\n\t}\n\n\tprivate async prepareAlbums(albums: Array<JamServe.Album>, user: JamServe.User): Promise<Array<Subsonic.AlbumID3>> {\n\t\treturn this.prepareList<JamServe.Album, Subsonic.AlbumID3>(DBObjectType.album, albums, FORMAT.packAlbum, user);\n\t}\n\n\tprivate async prepareArtists(artists: Array<JamServe.Artist>, user: JamServe.User): Promise<Array<Subsonic.ArtistID3>> {\n\t\treturn this.prepareList<JamServe.Artist, Subsonic.ArtistID3>(DBObjectType.artist, artists, FORMAT.packArtist, user);\n\t}\n\n\tprivate async prepareFolders(folders: Array<JamServe.Folder>, user: JamServe.User): Promise<Array<Subsonic.Child>> {\n\t\treturn this.prepareList<JamServe.Folder, Subsonic.Child>(DBObjectType.folder, folders, FORMAT.packFolder, user);\n\t}\n\n\tprivate async prepareFolderArtists(folders: Array<JamServe.Folder>, user: JamServe.User): Promise<Array<Subsonic.Artist>> {\n\t\treturn this.prepareList<JamServe.Folder, Subsonic.Artist>(DBObjectType.folder, folders, FORMAT.packFolderArtist, user);\n\t}\n\n\tprivate async prepareTrack(track: JamServe.Track, user: JamServe.User): Promise<Subsonic.Child> {\n\t\treturn this.prepareObj<JamServe.Track, Subsonic.Child>(DBObjectType.track, track, FORMAT.packTrack, user);\n\t}\n\n\tprivate async prepareTracks(tracks: Array<JamServe.Track>, user: JamServe.User): Promise<Array<Subsonic.Child>> {\n\t\treturn this.prepareList<JamServe.Track, Subsonic.Child>(DBObjectType.track, tracks, FORMAT.packTrack, user);\n\t}\n\n\tprivate async prepareBookmarks(bookmarks: Array<JamServe.Bookmark>, user: JamServe.User): Promise<Array<Subsonic.Bookmark>> {\n\n\t\tconst removeDups = (list: Array<string>): Array<string> => {\n\t\t\treturn list.filter(function(item, pos) {\n\t\t\t\treturn list.indexOf(item) === pos;\n\t\t\t});\n\t\t};\n\n\t\tconst trackIDs = removeDups(bookmarks.map(bookmark => bookmark.destID));\n\t\tconst userIds = removeDups(bookmarks.map(bookmark => bookmark.userID));\n\t\tconst tracks = await this.engine.store.track.byIds(trackIDs);\n\t\tconst childs = await this.prepareTracks(tracks, user);\n\t\tconst users = await this.engine.store.user.byIds(userIds);\n\t\tconst result: Array<Subsonic.Bookmark> = [];\n\t\tbookmarks.forEach(bookmark => {\n\t\t\tconst entry = childs.find(child => child.id === bookmark.destID);\n\t\t\tconst bookmarkuser = users.find(u => u.id === bookmark.userID);\n\t\t\tif (entry && bookmarkuser) {\n\t\t\t\tresult.push(FORMAT.packBookmark(bookmark, bookmarkuser ? bookmarkuser.name : '', entry));\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t}\n\n\tprivate async preparePlaylist(playlist: JamServe.Playlist, user: JamServe.User): Promise<Subsonic.PlaylistWithSongs> {\n\t\tconst tracks = await this.engine.store.track.byIds(playlist.trackIDs);\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(playlist.trackIDs || [], user.id, DBObjectType.track);\n\t\treturn FORMAT.packPlaylistWithSongs(playlist, tracks, states);\n\t}\n\n\tprivate async prepareEpisodes(episodes: Array<JamServe.Episode>, user: JamServe.User): Promise<Array<Subsonic.PodcastEpisode>> {\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(episodes.map(episode => episode.id), user.id, DBObjectType.episode);\n\t\treturn episodes.map(episode => {\n\t\t\treturn FORMAT.packPodcastEpisode(episode, states[episode.id], (this.engine.podcasts.isDownloadingPodcastEpisode(episode.id) ? PodcastStatus.downloading : episode.status));\n\t\t});\n\t}\n\n\tprivate async collectStateChangeObjects(req: ApiOptions<SubsonicParameters.State>): Promise<{ [type: string]: Array<DBObject> }> {\n\t\tconst typesObjs: { [type: string]: Array<DBObject> } = {};\n\t\tif (req.query.id) {\n\t\t\tconst ids = Array.isArray(req.query.id) ? req.query.id : [req.query.id];\n\t\t\tconst list = await this.engine.store.findMultiInAll(ids);\n\t\t\tlist.forEach(item => {\n\t\t\t\ttypesObjs[item.type] = typesObjs[item.type] || [];\n\t\t\t\ttypesObjs[item.type].push(item);\n\t\t\t});\n\t\t}\n\t\tif (req.query.albumId) {\n\t\t\tconst ids = Array.isArray(req.query.albumId) ? req.query.albumId : [req.query.albumId];\n\t\t\tconst list = await this.engine.store.album.byIds(ids);\n\t\t\ttypesObjs[DBObjectType.album] = (typesObjs[DBObjectType.album] || []).concat(list);\n\t\t}\n\t\tif (req.query.artistId) {\n\t\t\tconst ids = Array.isArray(req.query.artistId) ? req.query.artistId : [req.query.artistId];\n\t\t\tconst list = await this.engine.store.artist.byIds(ids);\n\t\t\ttypesObjs[DBObjectType.artist] = (typesObjs[DBObjectType.artist] || []).concat(list);\n\t\t}\n\t\treturn typesObjs;\n\t}\n\n\t/* api functions */\n\n\tasync ping(req: ApiOptions<{}>): Promise<void> {\n\t\t/*\n\t\t ping\n\n\t\t http://your-server/rest/ping.view\n\t\t Since 1.0.0\n\n\t\t Used to test connectivity with the server. Takes no extra parameters.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\treturn;\n\t}\n\n\tasync getLicense(req: ApiOptions<{}>): Promise<{ license: Subsonic.License }> {\n\t\t/*\n\t\t getLicense\n\n\t\t http://your-server/rest/getLicense.view\n\t\t Since 1.0.0\n\n\t\t Get details about the software license. Takes no extra parameters. Please note that access to the REST API requires that the server has a valid license (after a 30-day trial period). To get a license key you must upgrade to Subsonic Premium.\n\n\t\t Returns a <subsonic-response> element with a nested <license> element on success.\n\t\t */\n\t\treturn {license: {valid: true, email: 'dummy', licenseExpires: '', trialExpires: ''}};\n\t}\n\n\tasync getMusicDirectory(req: ApiOptions<SubsonicParameters.ID>): Promise<{ directory: Subsonic.Directory }> {\n\t\t/*\n\t\t getMusicDirectory\n\n\t\t http://your-server/rest/getMusicDirectory.view\n\t\t Since 1.0.0\n\n\t\t Returns a listing of all files in a music directory. Typically used to get list of albums for an artist, or list of songs for an album.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tA string which uniquely identifies the music folder. Obtained by calls to getIndexes or getMusicDirectory.\n\n\t\t Returns a <subsonic-response> element with a nested <directory> element on success.\n\t\t */\n\t\tconst folder = await this.byID<JamServe.Folder>(req.query.id, this.engine.store.folder);\n\t\tconst tracks = await this.engine.store.track.search({path: folder.path});\n\t\ttracks.sort((a, b) => {\n\t\t\tconst a1 = (a.tag ? a.tag.track : '') || '';\n\t\t\tconst b1 = (b.tag ? b.tag.track : '') || '';\n\t\t\tif (a1 < b1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a1 > b1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t\tconst folders = await this.engine.store.folder.search({parentID: folder.id});\n\t\tfolders.sort((a, b) => {\n\t\t\tconst a1 = (a.tag ? a.tag.album : '') || '';\n\t\t\tconst b1 = (b.tag ? b.tag.album : '') || '';\n\t\t\tif (a1 < b1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a1 > b1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\n\t\tlet childs: Array<Subsonic.Child> = [];\n\t\tlet list = await this.prepareFolders(folders, req.user);\n\t\tchilds = childs.concat(list);\n\t\tlist = await this.prepareTracks(tracks, req.user);\n\t\tchilds = childs.concat(list);\n\t\tconst state = await this.engine.store.state.findOrCreate(folder.id, req.user.id, DBObjectType.folder);\n\t\tconst directory = FORMAT.packDirectory(folder, state);\n\t\tdirectory.child = childs;\n\t\treturn {directory};\n\t}\n\n\tasync getIndexes(req: ApiOptions<SubsonicParameters.Indexes>): Promise<{ indexes: Subsonic.Indexes }> {\n\t\t/*\n\t\t getIndexes\n\n\t\t http://your-server/rest/getIndexes.view\n\t\t Since 1.0.0\n\n\t\t Returns an indexed structure of all artists.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t musicFolderId \tNo \t\tIf specified, only return artists in the music folder with the given ID. See getMusicFolders.\n\t\t ifModifiedSince \tNo \t\tIf specified, only return a result if the artist collection has changed since the given time (in milliseconds since 1 Jan 1970).\n\n\t\t Returns a <subsonic-response> element with a nested <indexes> element on success.\n\t\t */\n\n\t\tconst folderIndex = await this.engine.index.getFolderIndex(this.engine.io.scanning);\n\t\tif (req.query.ifModifiedSince && req.query.ifModifiedSince > 0 && (folderIndex.lastModified <= req.query.ifModifiedSince)) {\n\t\t\tconst empty: any = {};\n\t\t\treturn empty;\n\t\t} else {\n\t\t\tconst index = this.engine.index.filterFolderIndex(req.query.musicFolderId ? req.query.musicFolderId.toString() : undefined, folderIndex);\n\t\t\tlet ids: Array<string> = [];\n\t\t\tindex.groups.forEach(entry => {\n\t\t\t\tids = ids.concat(entry.entries.map(e => e.folder.id));\n\t\t\t});\n\t\t\tconst states = await this.engine.store.state.findOrCreateMulti(ids, req.user.id, DBObjectType.folder);\n\t\t\treturn {\n\t\t\t\tindexes: {\n\t\t\t\t\tlastModified: index.lastModified,\n\t\t\t\t\tignoredArticles: (this.engine.store.config.app.index.ignore || []).join(' '),\n\t\t\t\t\tindex: FORMAT.packFolderIndex(index, states),\n\t\t\t\t\t// shortcut?: Artist[]; use unknown, there is no api to add/remove shortcuts\n\t\t\t\t\t// child?: Child[]; use unknown\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tasync getArtists(req: ApiOptions<SubsonicParameters.MusicFolderID>): Promise<{ artists: Subsonic.ArtistsID3 }> {\n\t\t/*\n\t\t getArtists\n\n\t\t http://your-server/rest/getArtists.view\n\t\t Since 1.8.0\n\n\t\t Similar to getIndexes, but organizes music according to ID3 tags.\n\n         Parameter \tRequired \tDefault \tComment\n\t\t musicFolderId \tNo \t\tIf specified, only return artists in the music folder with the given ID. See getMusicFolders.\n\n\t\t Returns a <subsonic-response> element with a nested <artists> element on success.\n\t\t */\n\t\tconst artistIndex = await this.engine.index.getArtistIndex(this.engine.io.scanning);\n\t\tconst index = this.engine.index.filterArtistIndex(req.query.musicFolderId ? req.query.musicFolderId.toString() : undefined, artistIndex);\n\t\tlet ids: Array<string> = [];\n\t\tindex.groups.forEach(entry => {\n\t\t\tids = ids.concat(entry.entries.map(e => e.artist.id));\n\t\t});\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(ids, req.user.id, DBObjectType.artist);\n\t\treturn {\n\t\t\tartists: {\n\t\t\t\tignoredArticles: (this.engine.store.config.app.index.ignore || []).join(' '),\n\t\t\t\tindex: FORMAT.packArtistIndex(index, states)\n\t\t\t}\n\t\t};\n\t}\n\n\tasync getAlbumList(req: ApiOptions<SubsonicParameters.AlbumList>): Promise<{ albumList: Subsonic.AlbumList }> {\n\t\t/*\n\t\t getAlbumList\n\n\t\t http://your-server/rest/getAlbumList.view\n\t\t Since 1.2.0\n\n\t\t Returns a list of random, newest, highest rated etc. albums. Similar to the album lists on the home page of the Subsonic web interface.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t type \tYes \t\tThe list type. Must be one of the following: random, newest, highest, frequent, recent.\n\t\t Since 1.8.0 you can also use alphabeticalByName or alphabeticalByArtist to page through all albums alphabetically, and starred to retrieve starred albums.\n\t\t Since 1.10.1 you can use byYear and byGenre to list albums in a given year range or genre.\n\t\t size \tNo \t10 \tThe number of albums to return. Max 500.\n\t\t offset \tNo \t0 \tThe list offset. Useful if you for example want to page through the list of newest albums.\n\t\t fromYear \tYes (if type is byYear) \t\tThe first year in the range.\n\t\t toYear \tYes (if type is byYear) \t\tThe last year in the range.\n\t\t genre \tYes (if type is byGenre) \t\tThe name of the genre, e.g., \"Rock\".\n\n\t\t Returns a <subsonic-response> element with a nested <albumList> element on success.\n\t\t */\n\t\tconst amount = req.query.size || 20;\n\t\tconst offset = req.query.offset || 0;\n\t\tlet ids: Array<string> = [];\n\t\tlet folders: Array<JamServe.Folder> = [];\n\t\tswitch (req.query.type) {\n\t\t\tcase 'random':\n\t\t\t\tids = await this.engine.store.folder.searchIDs({types: FolderTypesAlbum});\n\t\t\t\tfolders = await this.engine.store.folder.byIds(randomItems<string>(ids, amount));\n\t\t\t\tbreak;\n\t\t\tcase 'newest':\n\t\t\t\tfolders = await this.engine.store.folder.search({types: FolderTypesAlbum, offset, amount, sorts: [{field: 'created', descending: true}]});\n\t\t\t\tbreak;\n\t\t\tcase 'alphabeticalByArtist':\n\t\t\t\tfolders = await this.engine.store.folder.search({types: FolderTypesAlbum, offset, amount, sorts: [{field: 'artist', descending: false}]});\n\t\t\t\tbreak;\n\t\t\tcase 'alphabeticalByName':\n\t\t\t\tfolders = await this.engine.store.folder.search({types: FolderTypesAlbum, offset, amount, sorts: [{field: 'album', descending: false}]});\n\t\t\t\tbreak;\n\t\t\tcase 'starred':\n\t\t\t\tids = await this.engine.getFilteredListFaved<JamServe.SearchQueryFolder>(DBObjectType.folder, {types: FolderTypesAlbum}, req.user, this.engine.store.folder);\n\t\t\t\tfolders = await this.engine.store.folder.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'frequent':\n\t\t\t\tids = await this.engine.getFilteredListFrequentlyPlayed<JamServe.SearchQueryFolder>(DBObjectType.folder, {types: FolderTypesAlbum}, req.user, this.engine.store.folder);\n\t\t\t\tfolders = await this.engine.store.folder.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'recent':\n\t\t\t\tids = await this.engine.getFilteredListRecentlyPlayed<JamServe.SearchQueryFolder>(DBObjectType.folder, {types: FolderTypesAlbum}, req.user, this.engine.store.folder);\n\t\t\t\tfolders = await this.engine.store.folder.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'highest':\n\t\t\t\tids = await this.engine.getFilteredListHighestRated<JamServe.SearchQueryFolder>(DBObjectType.folder, {types: FolderTypesAlbum}, req.user, this.engine.store.folder);\n\t\t\t\tfolders = await this.engine.store.folder.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'byGenre':\n\t\t\t\tfolders = await this.engine.store.folder.search({types: FolderTypesAlbum, offset, amount, genre: req.query.genre || ''});\n\t\t\t\tbreak;\n\t\t\tcase 'byYear':\n\t\t\t\tfolders = await this.engine.store.folder.search({offset, amount, types: FolderTypesAlbum, fromYear: req.query.fromYear, toYear: req.query.toYear});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.PARAMETER, text: 'Unknown Album List Type'});\n\t\t}\n\t\tconst result = await this.prepareFolders(folders, req.user);\n\t\treturn {albumList: {album: result}};\n\t}\n\n\tasync getAlbumList2(req: ApiOptions<SubsonicParameters.AlbumList2>): Promise<{ albumList2: Subsonic.AlbumList2 }> {\n\t\t/*\t getAlbumList2\n\n\t\t http://your-server/rest/getAlbumList2.view\n\t\t Since 1.8.0\n\n\t\t Similar to getAlbumList, but organizes music according to ID3 tags.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t type \tYes \t\tThe list type. Must be one of the following: random, newest, frequent, recent, starred, alphabeticalByName or alphabeticalByArtist. Since 1.10.1 you can use byYear and byGenre to list albums in a given year range or genre.\n\t\t size \tNo \t10 \tThe number of albums to return. Max 500\n\t\t offset \tNo \t0 \tThe list offset. Useful if you for example want to page through the list of newest albums.\n\t\t fromYear \tYes (if type is byYear) \t\tThe first year in the range.\n\t\t toYear \tYes (if type is byYear) \t\tThe last year in the range.\n\t\t genre \tYes (if type is byGenre) \t\tThe name of the genre, e.g., \"Rock\".\n\t\t musicFolderId \tNo \t\t(Since 1.12.0) Only return albums in the music folder with the given ID. See getMusicFolders.\n\n\t\t Returns a <subsonic-response> element with a nested <albumList2> element on success.\n\t\t */\n\n\t\tconst amount = Math.min(req.query.size || 20, 500);\n\t\tconst offset = req.query.offset || 0;\n\t\tconst rootID = req.query.musicFolderId ? req.query.musicFolderId.toString() : undefined;\n\t\tlet albums: Array<JamServe.Album> = [];\n\t\tlet ids: Array<string> = [];\n\t\tswitch (req.query.type) {\n\t\t\tcase 'random':\n\t\t\t\tids = await this.engine.store.album.searchIDs({rootID});\n\t\t\t\talbums = await this.engine.store.album.byIds(randomItems<string>(ids, amount));\n\t\t\t\tbreak;\n\t\t\tcase 'byGenre':\n\t\t\t\talbums = await this.engine.store.album.search({amount, offset, genre: req.query.genre || '', rootID});\n\t\t\t\tbreak;\n\t\t\tcase 'byYear':\n\t\t\t\talbums = await this.engine.store.album.search({amount, offset, fromYear: req.query.fromYear, toYear: req.query.toYear, rootID});\n\t\t\t\tbreak;\n\t\t\tcase 'newest':\n\t\t\t\talbums = await this.engine.store.album.search({rootID, offset, amount, sorts: [{field: 'created', descending: true}]});\n\t\t\t\tbreak;\n\t\t\tcase 'alphabeticalByArtist':\n\t\t\t\talbums = await this.engine.store.album.search({rootID, offset, amount, sorts: [{field: 'artist', descending: false}]});\n\t\t\t\tbreak;\n\t\t\tcase 'alphabeticalByName':\n\t\t\t\talbums = await this.engine.store.album.search({rootID, offset, amount, sorts: [{field: 'name', descending: false}]});\n\t\t\t\tbreak;\n\t\t\tcase 'starred':\n\t\t\t\tids = await this.engine.getFilteredListFaved<JamServe.SearchQueryAlbum>(DBObjectType.album, {rootID}, req.user, this.engine.store.album);\n\t\t\t\talbums = await this.engine.store.album.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'frequent':\n\t\t\t\tids = await this.engine.getFilteredListFrequentlyPlayed<JamServe.SearchQueryAlbum>(DBObjectType.album, {rootID}, req.user, this.engine.store.album);\n\t\t\t\talbums = await this.engine.store.album.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'recent':\n\t\t\t\tids = await this.engine.getFilteredListRecentlyPlayed<JamServe.SearchQueryAlbum>(DBObjectType.album, {rootID}, req.user, this.engine.store.album);\n\t\t\t\talbums = await this.engine.store.album.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tcase 'highest':\n\t\t\t\tids = await this.engine.getFilteredListHighestRated<JamServe.SearchQueryAlbum>(DBObjectType.album, {rootID}, req.user, this.engine.store.album);\n\t\t\t\talbums = await this.engine.store.album.byIds(paginate(ids, amount, offset));\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.PARAMETER, text: 'Unknown Album List Type'});\n\t\t}\n\t\tconst result = await this.prepareAlbums(albums, req.user);\n\t\treturn {albumList2: {album: result}};\n\t}\n\n\tasync getCoverArt(req: ApiOptions<SubsonicParameters.CoverArt>): Promise<IApiBinaryResult> {\n\t\t/*\n\t\t getCoverArt\n\n\t\t http://your-server/rest/getCoverArt.view\n\t\t Since 1.0.0\n\n\t\t Returns a cover art image.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe ID of a song, album or artist.\n\t\t size \tNo \t\tIf specified, scale image to this size.\n\n\t\t Returns the cover art image in binary form.\n\t\t */\n\t\tconst o = await this.engine.store.findInAll(req.query.id);\n\t\tif (!o) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\treturn await this.engine.getObjImage(o, req.query.size, undefined);\n\t}\n\n\tasync getAvatar(req: ApiOptions<SubsonicParameters.Username>): Promise<IApiBinaryResult> {\n\t\t/*\n\t\t getAvatar\n\n\t\t http://your-server/rest/getAvatar.view\n\t\t Since 1.8.0\n\n\t\t Returns the avatar (personal image) for a user.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tYes \t\tThe user in question.\n\n\t\t Returns the avatar image in binary form.\n\t\t */\n\t\tconst name = req.query.username;\n\t\tconst user = await this.engine.store.user.get(name);\n\t\tif (!user) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\treturn await this.engine.getObjImage(user, undefined, undefined);\n\t}\n\n\tasync getAlbumInfo(req: ApiOptions<SubsonicParameters.ID>): Promise<{ albumInfo: Subsonic.AlbumInfo }> {\n\t\t/*\n\t\t http://your-server/rest/getAlbumInfo\n\t\t Since 1.14.0\n\n\t\t Returns album notes, image URLs etc, using data from last.fm.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe album or song ID.\n\n\t\t Returns a <subsonic-response> element with a nested <albumInfo> element on success.\n\t\t */\n\t\tconst folder = await this.engine.store.folder.byId(req.query.id);\n\t\tif (!folder) {\n\t\t\treturn {albumInfo: {}};\n\t\t}\n\t\tconst info = await this.engine.meta.getFolderInfo(folder);\n\t\tif (!info) {\n\t\t\treturn {albumInfo: {}};\n\t\t}\n\t\treturn {albumInfo: FORMAT.packAlbumInfo(info)};\n\t}\n\n\tasync getAlbumInfo2(req: ApiOptions<SubsonicParameters.ID>): Promise<{ albumInfo: Subsonic.AlbumInfo }> {\n\t\t/*\n\t\t http://your-server/rest/getAlbumInfo2\n\n\t\t Since 1.14.0\n\n\t\tSimilar to getAlbumInfo, but organizes music according to ID3 tags.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe album ID.\n\n\t\tReturns a <subsonic-response> element with a nested <albumInfo> element on success.\n\t\t */\n\t\tconst album = await this.engine.store.album.byId(req.query.id);\n\t\tif (!album) {\n\t\t\treturn {albumInfo: {}};\n\t\t} else {\n\t\t\tconst info = await this.engine.meta.getAlbumInfo(album);\n\t\t\treturn {albumInfo: FORMAT.packAlbumInfo(info)};\n\t\t}\n\t}\n\n\tasync getArtistInfo(req: ApiOptions<SubsonicParameters.ArtistInfo>): Promise<{ artistInfo: Subsonic.ArtistInfo }> {\n\t\t/*\n\t\t http://your-server/rest/getArtistInfo Since 1.11.0\n\n\t\tReturns artist info with biography, image URLs and similar artists, using data from last.fm.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe artist, album or song ID.\n\t\tcount \tNo \t20 \tMax number of similar artists to return.\n\t\tincludeNotPresent \tNo \tfalse \tWhether to return artists that are not present in the media library.\n\n\t\tReturns a <subsonic-response> element with a nested <artistInfo> element on success.\n\t\t */\n\n\t\tlet includeNotPresent = false;\n\t\tif (req.query.includeNotPresent !== undefined) {\n\t\t\tincludeNotPresent = req.query.includeNotPresent;\n\t\t}\n\t\tconst limitCount = req.query.count || 20;\n\t\tconst folder = await this.byID<JamServe.Folder>(req.query.id, this.engine.store.folder);\n\t\tconst artistInfo = await this.engine.meta.getFolderArtistInfo(folder, includeNotPresent, true);\n\t\tif (!artistInfo) {\n\t\t\treturn {artistInfo: {}};\n\t\t}\n\t\tlet similar = artistInfo.similar || [];\n\t\tsimilar = paginate(similar, limitCount, 0);\n\t\tconst folders: Array<JamServe.Folder> = similar.filter(s => !!s.folder).map(s => <JamServe.Folder>s.folder);\n\t\tconst children = await this.prepareFolders(folders, req.user);\n\t\tconst artists: Array<Subsonic.Artist> = similar.map(s => {\n\t\t\tlet child: Subsonic.Child | undefined;\n\t\t\tif (s.folder) {\n\t\t\t\tconst f = s.folder;\n\t\t\t\tchild = children.find(c => c.id === f.id);\n\t\t\t}\n\t\t\tif (child) {\n\t\t\t\treturn {\n\t\t\t\t\tid: child.id,\n\t\t\t\t\tname: s.name,\n\t\t\t\t\tstarred: child.starred,\n\t\t\t\t\tuserRating: child.userRating,\n\t\t\t\t\taverageRating: child.averageRating\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tid: '-1', // report an invalid id (as does subsonic/airsonic)\n\t\t\t\tname: s.name\n\t\t\t};\n\t\t});\n\t\treturn {artistInfo: FORMAT.packArtistInfo(artistInfo.info, artists)};\n\t}\n\n\tasync getArtistInfo2(req: ApiOptions<SubsonicParameters.ArtistInfo>): Promise<{ artistInfo2: Subsonic.ArtistInfo2 }> {\n\t\t/*\n\t\t http://your-server/rest/getArtistInfo2\n\t\t Since 1.11.0\n\n\t\tSimilar to getArtistInfo, but organizes music according to ID3 tags.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe artist ID.\n\t\tcount \tNo \t20 \tMax number of similar artists to return.\n\t\tincludeNotPresent \tNo \tfalse \tWhether to return artists that are not present in the media library.\n\n\t\t Returns a <subsonic-response> element with a nested <artistInfo2> element on success.\n\t\t*/\n\n\t\tlet includeNotPresent = false;\n\t\tif (req.query.includeNotPresent !== undefined) {\n\t\t\tincludeNotPresent = req.query.includeNotPresent;\n\t\t}\n\t\tconst artist = await this.engine.store.artist.byId(req.query.id);\n\t\tif (!artist) {\n\t\t\treturn {artistInfo2: {}};\n\t\t}\n\t\tconst infos = await this.engine.meta.getArtistInfos(artist, includeNotPresent, true);\n\t\tconst ids = (infos.similar || []).filter(sim => !!sim.artist).map(sim => (<JamServe.Artist>sim.artist).id);\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(ids, req.user.id, DBObjectType.artist);\n\t\tconst result: Array<Subsonic.ArtistID3> = [];\n\t\t(infos.similar || []).forEach(sim => {\n\t\t\tif (sim.artist) {\n\t\t\t\tresult.push(FORMAT.packArtist(sim.artist, states[sim.artist.id]));\n\t\t\t} else if (includeNotPresent) {\n\t\t\t\tresult.push({\n\t\t\t\t\tid: '-1', // report an invalid id (as does subsonic/airsonic)\n\t\t\t\t\tname: sim.name,\n\t\t\t\t\talbumCount: 0\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn {artistInfo2: FORMAT.packArtistInfo2(infos.info, result)};\n\t}\n\n\tasync getTopSongs(req: ApiOptions<SubsonicParameters.TopSongs>): Promise<{ topSongs: Subsonic.TopSongs }> {\n\t\t/*\n\t\t  http://your-server/rest/getTopSongs Since 1.13.0\n\n\t\tReturns top songs for the given artist, using data from last.fm.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tartist \tYes \t\tThe artist name.\n\t\tcount \tNo \t50 \tMax number of songs to return.\n\n\t\tReturns a <subsonic-response> element with a nested <topSongs> element on success.\n\t\t */\n\t\tconst limitCount = req.query.count || 50;\n\t\tconst tracks = await this.engine.meta.getTopTracks(req.query.artist, limitCount);\n\t\tconst childs = await this.prepareTracks(tracks, req.user);\n\t\treturn {topSongs: {song: childs}};\n\t}\n\n\tasync getSimilarSongs(req: ApiOptions<SubsonicParameters.SimilarSongs>): Promise<{ similarSongs: Subsonic.SimilarSongs }> {\n\t\t/*\n\t\t http://your-server/rest/getSimilarSongs Since 1.11.0\n\n\t\tReturns a random collection of songs from the given artist and similar artists, using data from last.fm. Typically used for artist radio features.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe artist, album or song ID.\n\t\tcount \tNo \t50 \tMax number of songs to return.\n\n\t\tReturns a <subsonic-response> element with a nested <similarSongs> element on success.\n\t\t */\n\t\tconst o = await this.engine.store.findInAll(req.query.id);\n\t\tif (!o) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t} else {\n\t\t\tlet tracks: Array<JamServe.Track> = [];\n\t\t\tswitch (o.type) {\n\t\t\t\tcase DBObjectType.track:\n\t\t\t\t\ttracks = await this.engine.meta.getTrackSimilarTracks(<JamServe.Track>o);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DBObjectType.folder:\n\t\t\t\t\ttracks = await this.engine.meta.getFolderSimilarTracks(<JamServe.Folder>o);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DBObjectType.artist:\n\t\t\t\t\ttracks = await this.engine.meta.getArtistSimilarTracks(<JamServe.Artist>o);\n\t\t\t\t\tbreak;\n\t\t\t\tcase DBObjectType.album:\n\t\t\t\t\ttracks = await this.engine.meta.getAlbumSimilarTracks(<JamServe.Album>o);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst limit = paginate(tracks, req.query.count || 50, 0);\n\t\t\tconst childs = await this.prepareTracks(limit, req.user);\n\t\t\treturn {similarSongs: FORMAT.packSimilarSongs(childs)};\n\t\t}\n\t}\n\n\tasync getSimilarSongs2(req: ApiOptions<SubsonicParameters.SimilarSongs>): Promise<{ similarSongs2: Subsonic.SimilarSongs2 }> {\n\t\t/*\n\t\t http://your-server/rest/getSimilarSongs2\n\t\t Since 1.11.0\n\n\t\tSimilar to getSimilarSongs, but organizes music according to ID3 tags.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe artist ID.\n\t\tcount \tNo \t50 \tMax number of songs to return.\n\n\t\tReturns a <subsonic-response> element with a nested <similarSongs2> element on success.\n\t\t */\n\t\tconst artist = await this.byID<JamServe.Artist>(req.query.id, this.engine.store.artist);\n\t\tconst tracks = await this.engine.meta.getArtistSimilarTracks(artist);\n\t\tconst limit = paginate(tracks, req.query.count || 50, 0);\n\t\tconst childs = await this.prepareTracks(limit, req.user);\n\t\treturn {similarSongs2: FORMAT.packSimilarSongs2(childs)};\n\t}\n\n\tasync download(req: ApiOptions<SubsonicParameters.ID>): Promise<IApiBinaryResult> {\n\t\t/*\n\t\t download\n\n\t\t http://your-server/rest/download.view\n\t\t Since 1.0.0\n\n\t\t Downloads a given media file. Similar to stream, but this method returns the original media data without transcoding or downsampling.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tA string which uniquely identifies the file to download. Obtained by calls to getMusicDirectory.\n\n\t\t Returns binary data on success, or an XML document on error (in which case the HTTP content type will start with \"text/xml\").\n\t\t */\n\t\tconst o = await this.engine.store.findInAll(req.query.id);\n\t\tif (!o) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t} else {\n\t\t\tconst result = await this.engine.getObjDownload(o, undefined, req.user);\n\t\t\tif (!result) {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tasync stream(req: ApiOptions<SubsonicParameters.Stream>): Promise<IApiBinaryResult> {\n\t\t/*\n\t\t stream\n\n\t\t http://your-server/rest/stream.view\n\t\t Since 1.0.0\n\n\t\t Streams a given media file.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tA string which uniquely identifies the file to stream. Obtained by calls to getMusicDirectory.\n\t\t maxBitRate \tNo \t\t(Since 1.2.0) If specified, the server will attempt to limit the bitrate to this value, in kilobits per second. If set to zero, no limit is imposed.\n\t\t format \tNo \t\t(Since 1.6.0) Specifies the preferred target format (e.g., \"mp3\" or \"flv\") in case there are multiple applicable transcodings. Starting with 1.9.0 you can use the special value \"raw\" to disable transcoding.\n\t\t timeOffset \tNo \t\tOnly applicable to video streaming. If specified, start streaming at the given offset (in seconds) into the video. Typically used to implement video skipping.\n\t\t size \tNo \t\t(Since 1.6.0) Only applicable to video streaming. Requested video size specified as WxH, for instance \"640x480\".\n\t\t estimateContentLength \tNo \tfalse \t(Since 1.8.0). If set to \"true\", the Content-Length HTTP header will be set to an estimated value for transcoded or downsampled media.\n\t\t converted \tNo \tfalse \t(Since 1.14.0) Only applicable to video streaming. Subsonic can optimize videos for streaming by converting them to MP4. If a conversion exists for the video in question, then setting this parameter to \"true\" will cause the converted video to be returned instead of the original.\n\n\t\t Returns binary data on success, or an XML document on error (in which case the HTTP content type will start with \"text/xml\").\n\t\t */\n\t\tconst o = await this.engine.store.findInAll(req.query.id);\n\t\tif (!o) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t} else {\n\t\t\tconst result = await this.engine.getObjStream(o, req.query.format, req.query.maxBitRate, req.user);\n\t\t\tif (!result) {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tasync getSong(req: ApiOptions<SubsonicParameters.ID>): Promise<{ song: Subsonic.Child }> {\n\t\t/*\n\t\t getSong\n\n\t\t http://your-server/rest/getSong.view\n\t\t Since 1.8.0\n\n\t\t Returns details for a song.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe song ID.\n\n\t\t Returns a <subsonic-response> element with a nested <song> element on success.\n\t\t */\n\t\tconst track = await this.byID<JamServe.Track>(req.query.id, this.engine.store.track);\n\t\tconst child = await this.prepareTrack(track, req.user);\n\t\treturn {song: child};\n\t}\n\n\tasync getGenres(req: ApiOptions<{}>): Promise<{ genres: Subsonic.Genres }> {\n\t\t/*\n\t\t getGenres\n\n\t\t http://your-server/rest/getGenres.view\n\t\t Since 1.9.0\n\n\t\t Returns all genres.\n\n\t\t Returns a <subsonic-response> element with a nested <genres> element on success.\n\t\t */\n\t\tconst genres = await this.engine.genres.getGenres(undefined, false);\n\t\tconst list: Array<Subsonic.Genre> = genres.map(genre => FORMAT.packGenre(genre));\n\t\tif (list.length === 0) {\n\t\t\tconst dummy: Subsonic.Genre = {\n\t\t\t\tcontent: '-',\n\t\t\t\tsongCount: 0,\n\t\t\t\tartistCount: 0,\n\t\t\t\talbumCount: 0\n\t\t\t};\n\t\t\tlist.push(dummy);\n\t\t}\n\t\treturn {genres: {genre: list}};\n\t}\n\n\tasync getMusicFolders(req: ApiOptions<{}>): Promise<{ musicFolders: Subsonic.MusicFolders }> {\n\t\t/*\n\t\t getMusicFolders\n\n\t\t http://your-server/rest/getMusicFolders.view\n\t\t Since 1.0.0\n\n\t\t Returns all configured top-level music folders. Takes no extra parameters.\n\n\t\t Returns a <subsonic-response> element with a nested <musicFolders> element on success.\n\t\t */\n\t\tconst list = await this.engine.store.root.all();\n\t\treturn {musicFolders: {musicFolder: list.map(FORMAT.packRoot)}};\n\t}\n\n\tasync getUser(req: ApiOptions<SubsonicParameters.Username>): Promise<{ user: Subsonic.User }> {\n\n\t\t/*\n\t\t getUser\n\n\t\t http://your-server/rest/getUser.view\n\t\t Since 1.3.0\n\n\t\t Get details about a given user, including which authorization roles it has. Can be used to enable/disable certain features in the client, such as jukebox control.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tYes \t\tThe name of the user to retrieve. You can only retrieve your own user unless you have admin privileges.\n\n\t\t Returns a <subsonic-response> element with a nested <user> element on success.\n\t\t */\n\n\t\tif ((!req.query.username) || (req.user.name === req.query.username)) {\n\t\t\treturn {user: FORMAT.packUser(req.user)};\n\t\t} else if (!req.user.roles.adminRole) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.UNAUTH});\n\t\t} else {\n\t\t\tconst u = await this.engine.store.user.get(req.query.username);\n\t\t\tif (!u) {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t\t} else {\n\t\t\t\treturn {user: FORMAT.packUser(u)};\n\t\t\t}\n\t\t}\n\t}\n\n\tasync star(req: ApiOptions<SubsonicParameters.State>): Promise<void> {\n\t\t/*\n\t\t http://your-server/rest/star.view\n\t\t Since 1.8.0\n\n\t\t Attaches a star to a song, album or artist.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tNo \t\tThe ID of the file (song) or folder (album/artist) to star. Multiple parameters allowed.\n\t\t albumId \tNo \t\tThe ID of an album to star. Use this rather than id if the client accesses the media collection according to ID3 tags rather than file structure. Multiple parameters allowed.\n\t\t artistId \tNo \t\tThe ID of an artist to star. Use this rather than id if the client accesses the media collection according to ID3 tags rather than file structure. Multiple parameters allowed.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst typesObjs = await this.collectStateChangeObjects(req);\n\t\tfor (const key of Object.keys(typesObjs)) {\n\t\t\tconst type: DBObjectType = parseInt(key, 10);\n\t\t\tfor (const item of typesObjs[type]) {\n\t\t\t\tawait this.engine.fav(item.id, type, req.user.id, false);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync unstar(req: ApiOptions<SubsonicParameters.State>): Promise<void> {\n\t\t/*\n\t\t http://your-server/rest/unstar.view\n\t\t Since 1.8.0\n\n\t\t Removes the star from a song, album or artist.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tNo \t\tThe ID of the file (song) or folder (album/artist) to unstar. Multiple parameters allowed.\n\t\t albumId \tNo \t\tThe ID of an album to unstar. Use this rather than id if the client accesses the media collection according to ID3 tags rather than file structure. Multiple parameters allowed.\n\t\t artistId \tNo \t\tThe ID of an artist to unstar. Use this rather than id if the client accesses the media collection according to ID3 tags rather than file structure. Multiple parameters allowed.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst typesObjs = await this.collectStateChangeObjects(req);\n\t\tfor (const key of Object.keys(typesObjs)) {\n\t\t\tconst type: DBObjectType = parseInt(key, 10);\n\t\t\tfor (const item of typesObjs[type]) {\n\t\t\t\tawait this.engine.fav(item.id, type, req.user.id, true);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync setRating(req: ApiOptions<SubsonicParameters.Rate>): Promise<void> {\n\t\t/*\n\t\t setRating\n\n\t\t http://your-server/rest/setRating.view\n\t\t Since 1.6.0\n\n\t\t Sets the rating for a music file.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tA string which uniquely identifies the file (song) or folder (album/artist) to rate.\n\t\t rating \tYes \t\tThe rating between 1 and 5 (inclusive), or 0 to remove the rating.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tif ((req.query.rating < 0) || (req.query.rating > 5)) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.PARAMETER});\n\t\t}\n\t\tconst typesObjs = await this.collectStateChangeObjects(req);\n\t\tfor (const key of Object.keys(typesObjs)) {\n\t\t\tconst type: DBObjectType = parseInt(key, 10);\n\t\t\tfor (const item of typesObjs[type]) {\n\t\t\t\tawait this.engine.rate(item.id, type, req.user.id, req.query.rating);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync getNowPlaying(req: ApiOptions<{}>): Promise<{ nowPlaying: Subsonic.NowPlaying }> {\n\t\t/*\n\t\t getNowPlaying\n\n\t\t http://your-server/rest/getNowPlaying.view\n\t\t Since 1.0.0\n\n\t\t Returns what is currently being played by all users. Takes no extra parameters.\n\n\t\t Returns a <subsonic-response> element with a nested <nowPlaying> element on success.\n\t\t */\n\t\tconst list = await this.engine.nowPlaying.getNowPlaying();\n\t\tconst result: Array<Subsonic.NowPlayingEntry> = [];\n\t\tfor (const entry of list) {\n\t\t\tconst state = await this.engine.store.state.findOrCreate(entry.obj.id, req.user.id, entry.obj.type);\n\t\t\tresult.push(FORMAT.packNowPlaying(entry, state));\n\t\t}\n\t\treturn {nowPlaying: {entry: result}};\n\t}\n\n\tasync getUsers(req: ApiOptions<{}>): Promise<{ users: Subsonic.Users }> {\n\t\t/* getUsers\n\n\t\t http://your-server/rest/getUsers.view\n\t\t Since 1.8.0\n\n\t\t Get details about all users, including which authorization roles they have. Only users with admin privileges are allowed to req this method.\n\n\t\t Returns a <subsonic-response> element with a nested <users> element on success.\n\t\t */\n\t\tconst users = await this.engine.store.user.all();\n\t\treturn {users: {user: users.map(FORMAT.packUser)}};\n\t}\n\n\tasync updateUser(req: ApiOptions<SubsonicParameters.UpdateUser>): Promise<void> {\n\t\t/*\n\t\t updateUser\n\n\t\t http://your-server/rest/updateUser.view\n\t\t Since 1.10.1\n\n\t\t Modifies an existing Subsonic user, using the following parameters:\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tYes \t\tThe name of the user.\n\t\t password \tNo \t\tThe password of the user, either in clear text of hex-encoded (see above).\n\t\t email \tNo \t\tThe email address of the user.\n\t\t ldapAuthenticated \tNo \t\tWhether the user is authenicated in LDAP.\n\t\t adminRole \tNo \t\tWhether the user is administrator.\n\t\t settingsRole \tNo \t\tWhether the user is allowed to change settings and password.\n\t\t streamRole \tNo \t\tWhether the user is allowed to play files.\n\t\t jukeboxRole \tNo \t\tWhether the user is allowed to play files in jukebox mode.\n\t\t downloadRole \tNo \t\tWhether the user is allowed to download files.\n\t\t uploadRole \tNo \t\tWhether the user is allowed to upload files.\n\t\t coverArtRole \tNo \t\tWhether the user is allowed to change cover art and tags.\n\t\t commentRole \tNo \t\tWhether the user is allowed to create and edit comments and ratings.\n\t\t podcastRole \tNo \t\tWhether the user is allowed to administrate Podcasts.\n\t\t shareRole \tNo \t\tWhether the user is allowed to share files with anyone.\n\t\t videoConversionRole \tNo \tfalse \t(Since 1.15.0) Whether the user is allowed to start video conversions.\n\t\t musicFolderId \tNo \t\t(Since 1.12.0) IDs of the music folders the user is allowed access to. Include the parameter once for each folder.\n\t\t maxBitRate \tNo \t\t(Since 1.13.0) The maximum bit rate (in Kbps) for the user. Audio streams of higher bit rates are automatically downsampled to this bit rate. Legal values: 0 (no limit), 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320.\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\n\t\tconst getBool = (b: boolean | undefined, def: boolean): boolean => {\n\t\t\treturn b === undefined ? def : b;\n\t\t};\n\t\tconst username = req.query.username;\n\t\tconst u = await this.engine.store.user.get(username);\n\t\tif (!u) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\tif (req.query.email) {\n\t\t\tu.email = req.query.email;\n\t\t}\n\t\tif (req.query.password) {\n\t\t\tu.pass = req.query.password;\n\t\t}\n\t\tif (req.query.musicFolderId) {\n\t\t\tu.allowedfolder = (Array.isArray(req.query.musicFolderId) ? req.query.musicFolderId : [req.query.musicFolderId]).map(id => id.toString());\n\t\t}\n\t\tif (req.query.maxBitRate !== undefined) {\n\t\t\tu.maxBitRate = req.query.maxBitRate || 0;\n\t\t}\n\t\tif (req.query.username) {\n\t\t\tu.name = req.query.username;\n\t\t}\n\t\tu.ldapAuthenticated = getBool(req.query.ldapAuthenticated, u.ldapAuthenticated);\n\t\t// u.scrobblingEnabled = getBool(req.query.scrobblingEnabled, u.scrobblingEnabled);\n\t\tu.roles.adminRole = getBool(req.query.adminRole, u.roles.adminRole);\n\t\t// u.roles.settingsRole = getBool(req.query.settingsRole, u.roles.settingsRole);\n\t\tu.roles.streamRole = getBool(req.query.streamRole, u.roles.streamRole);\n\t\t// u.roles.jukeboxRole = getBool(req.query.jukeboxRole, u.roles.jukeboxRole);\n\t\t// u.roles.downloadRole = getBool(req.query.downloadRole, u.roles.downloadRole);\n\t\tu.roles.uploadRole = getBool(req.query.uploadRole, u.roles.uploadRole);\n\t\t// u.roles.coverArtRole = getBool(req.query.coverArtRole, u.roles.coverArtRole);\n\t\t// u.roles.commentRole = getBool(req.query.commentRole, u.roles.commentRole);\n\t\tu.roles.podcastRole = getBool(req.query.podcastRole, u.roles.podcastRole);\n\t\t// u.roles.playlistRole = getBool(req.query.playlistRole, u.roles.playlistRole);\n\t\t// u.roles.shareRole = getBool(req.query.shareRole, u.roles.shareRole);\n\t\t// u.roles.videoConversionRole = getBool(req.query.videoConversionRole, u.roles.videoConversionRole);\n\t\tawait this.engine.users.updateUser(u);\n\t}\n\n\tasync createUser(req: ApiOptions<SubsonicParameters.UpdateUser>): Promise<void> {\n\t\t/*\n\t\t createUser\n\n\t\t http://your-server/rest/createUser.view\n\t\t Since 1.1.0\n\n\t\t Creates a new Subsonic user, using the following parameters:\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tYes \t\tThe name of the new user.\n\t\t password \tYes \t\tThe password of the new user, either in clear text of hex-encoded (see above).\n\t\t email \tYes \t\tThe email address of the new user.\n\t\t ldapAuthenticated \tNo \tfalse \tWhether the user is authenicated in LDAP.\n\t\t adminRole \tNo \tfalse \tWhether the user is administrator.\n\t\t settingsRole \tNo \ttrue \tWhether the user is allowed to change settings and password.\n\t\t streamRole \tNo \ttrue \tWhether the user is allowed to play files.\n\t\t jukeboxRole \tNo \tfalse \tWhether the user is allowed to play files in jukebox mode.\n\t\t downloadRole \tNo \tfalse \tWhether the user is allowed to download files.\n\t\t uploadRole \tNo \tfalse \tWhether the user is allowed to upload files.\n\t\t playlistRole \tNo \tfalse \tWhether the user is allowed to create and delete playlists. Since 1.8.0, changing this role has no effect.\n\t\t coverArtRole \tNo \tfalse \tWhether the user is allowed to change cover art and tags.\n\t\t commentRole \tNo \tfalse \tWhether the user is allowed to create and edit comments and ratings.\n\t\t podcastRole \tNo \tfalse \tWhether the user is allowed to administrate Podcasts.\n\t\t shareRole \tNo \tfalse \t(Since 1.8.0)Whether the user is allowed to share files with anyone.\n\t\t videoConversionRole \tNo \tfalse \t(Since 1.15.0) Whether the user is allowed to start video conversions.\n\t\t musicFolderId \tNo \tAll folders \t(Since 1.12.0) IDs of the music folders the user is allowed access to. Include the parameter once for each folder.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\n\t\tif (\n\t\t\t(!req.query.username) || (req.query.username.length === 0) ||\n\t\t\t(!req.query.password) || (req.query.password.length === 0) ||\n\t\t\t(!req.query.email) || (req.query.email.length === 0)\n\t\t) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.PARAMETER});\n\t\t}\n\t\tconst getBool = (b: boolean | undefined, def: boolean): boolean => {\n\t\t\treturn b === undefined ? def : b;\n\t\t};\n\t\tconst u: JamServe.User = {\n\t\t\tid: '',\n\t\t\tname: req.query.username || '',\n\t\t\tpass: req.query.password || 'invalid',\n\t\t\temail: req.query.email || 'invalid',\n\t\t\tavatarLastChanged: Date.now(),\n\t\t\tcreated: Date.now(),\n\t\t\ttype: DBObjectType.user,\n\t\t\tldapAuthenticated: getBool(req.query.ldapAuthenticated, false),\n\t\t\tscrobblingEnabled: false, // getBool(req.query.scrobblingEnabled, false),\n\t\t\troles: {\n\t\t\t\tadminRole: getBool(req.query.adminRole, false),\n\t\t\t\t// settingsRole: getBool(req.query.settingsRole, true),\n\t\t\t\tstreamRole: getBool(req.query.streamRole, true),\n\t\t\t\t// jukeboxRole: getBool(req.query.jukeboxRole, false),\n\t\t\t\t// downloadRole: getBool(req.query.downloadRole, false),\n\t\t\t\tuploadRole: getBool(req.query.uploadRole, false),\n\t\t\t\t// playlistRole: getBool(req.query.playlistRole, false),\n\t\t\t\t// coverArtRole: getBool(req.query.coverArtRole, false),\n\t\t\t\t// commentRole: getBool(req.query.commentRole, false),\n\t\t\t\tpodcastRole: getBool(req.query.podcastRole, false),\n\t\t\t\t// shareRole: getBool(req.query.shareRole, false),\n\t\t\t\t// videoConversionRole: getBool(req.query.videoConversionRole, false)\n\t\t\t}\n\t\t};\n\t\tawait this.engine.users.createUser(u);\n\t}\n\n\tasync deleteUser(req: ApiOptions<SubsonicParameters.Username>): Promise<void> {\n\t\t/*\n\t\t deleteUser\n\n\t\t http://your-server/rest/deleteUser.view\n\t\t Since 1.3.0\n\n\t\t Deletes an existing Subsonic user, using the following parameters:\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tYes \t\tThe name of the user to delete.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst u = await this.engine.store.user.get(req.query.username);\n\t\tif (!u) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\tawait this.engine.users.deleteUser(u);\n\t}\n\n\tasync changePassword(req: ApiOptions<SubsonicParameters.ChangePassword>): Promise<void> {\n\t\t/*\n\t\t changePassword\n\n\t\t http://your-server/rest/changePassword.view\n\t\t Since 1.1.0\n\n\t\t Changes the password of an existing Subsonic user, using the following parameters. You can only change your own password unless you have admin privileges.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tYes \t\tThe name of the user which should change its password.\n\t\t password \tYes \t\tThe new password of the new user, either in clear text of hex-encoded (see above).\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tif (\n\t\t\t(!req.query.username) ||\n\t\t\t(!req.query.password) ||\n\t\t\t(req.query.password.length === 0)\n\t\t) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.PARAMETER});\n\t\t}\n\t\tif (req.query.username !== req.user.name) {\n\t\t\tif (!req.user.roles.adminRole) {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.UNAUTH});\n\t\t\t}\n\t\t}\n\t\tconst u = await this.engine.store.user.get(req.query.username);\n\t\tif (!u) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\tu.pass = req.query.password;\n\t\tawait this.engine.store.user.replace(u);\n\t}\n\n\tasync getChatMessages(req: ApiOptions<SubsonicParameters.ChatMessages>): Promise<{ chatMessages: Subsonic.ChatMessages }> {\n\t\t/*\n\t\t getChatMessages\n\n\t\t http://your-server/rest/getChatMessages.view\n\t\t Since 1.2.0\n\n\t\t Returns the current visible (non-expired) chat messages.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t since \tNo \t\tOnly return messages newer than this time (in millis since Jan 1 1970).\n\n\t\t Returns a <subsonic-response> element with a nested <chatMessages> element on success.\n\t\t */\n\t\tconst messages = await this.engine.chat.get(req.query.since);\n\t\treturn {chatMessages: {chatMessage: messages.map(msg => FORMAT.packChatMessage(msg))}};\n\t}\n\n\tasync addChatMessage(req: ApiOptions<SubsonicParameters.ChatMessage>): Promise<void> {\n\t\t/*\n\t\t addChatMessage\n\n\t\t http://your-server/rest/addChatMessage.view\n\t\t Since 1.2.0\n\n\t\t Adds a message to the chat log.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t message \tYes \t\tThe chat message.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tawait this.engine.chat.add(req.query.message, req.user);\n\t}\n\n\tasync getPlaylists(req: ApiOptions<SubsonicParameters.Playlists>): Promise<{ playlists: Subsonic.Playlists }> {\n\t\t/*\n\t\t getPlaylists\n\n\t\t http://your-server/rest/getPlaylists.view\n\t\t Since 1.0.0\n\n\t\t Returns all playlists a user is allowed to play.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t username \tno \t\t(Since 1.8.0) If specified, return playlists for this user rather than for the authenticated user. The authenticated user must have admin role if this parameter is used.\n\n\t\t Returns a <subsonic-response> element with a nested <playlists> element on success.\n\t\t */\n\t\tlet userID = req.user.id;\n\t\tif ((req.query.username) && (req.query.username !== req.user.name)) {\n\t\t\tif (!req.user.roles.adminRole) {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.UNAUTH});\n\t\t\t}\n\t\t\tconst u = await this.engine.store.user.get(req.query.username);\n\t\t\tif (!u) {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t\t}\n\t\t\tuserID = u.id;\n\t\t}\n\t\tconst list = await this.engine.store.playlist.search({userID, isPublic: req.user.id !== userID});\n\t\tconst playlists: Subsonic.Playlists = {};\n\t\tconst result: Array<Subsonic.Playlist> = [];\n\t\tfor (const playlist of list) {\n\t\t\tconst plist = await this.preparePlaylist(playlist, req.user);\n\t\t\tresult.push(plist);\n\t\t}\n\t\tplaylists.playlist = result;\n\t\treturn {playlists};\n\t}\n\n\tasync getPlaylist(req: ApiOptions<SubsonicParameters.ID>): Promise<{ playlist: Subsonic.Playlist }> {\n\t\t/*\n\t\t getPlaylist\n\n\t\t http://your-server/rest/getPlaylist.view\n\t\t Since 1.0.0\n\n\t\t Returns a listing of files in a saved playlist.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tyes \t\tID of the playlist to return, as obtained by getPlaylists.\n\n\t\t Returns a <subsonic-response> element with a nested <playlist> element on success.\n\t\t */\n\n\t\tconst playlist = await this.byID<JamServe.Playlist>(req.query.id, this.engine.store.playlist);\n\t\tif (playlist.userID !== req.user.id) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.UNAUTH});\n\t\t}\n\t\tconst result = await this.preparePlaylist(playlist, req.user);\n\t\treturn {playlist: result};\n\t}\n\n\tasync createPlaylist(req: ApiOptions<SubsonicParameters.PlaylistCreate>): Promise<{ playlist: Subsonic.PlaylistWithSongs }> {\n\t\t/*\n\t\t createPlaylist\n\n\t\t http://your-server/rest/createPlaylist.view\n\t\t Since 1.2.0\n\n\t\t Creates (or updates) a playlist.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t playlistId \tYes (if updating) \t\tThe playlist ID.\n\t\t name \tYes (if creating) \t\tThe human-readable name of the playlist.\n\t\t songId \tYes \t\tID of a song in the playlist. Use one songId parameter for each song in the playlist.\n\n\t\t Since 1.14.0 the newly created/updated playlist is returned. In earlier versions an empty <subsonic-response> element is returned.\n\t\t */\n\t\tlet playlist: JamServe.Playlist | undefined;\n\t\tif (!req.query.playlistId && !req.query.name) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.PARAMETER});\n\t\t} else if (req.query.playlistId) {\n\t\t\tconst updateQuery: SubsonicParameters.PlaylistUpdate = {\n\t\t\t\tplaylistId: req.query.playlistId,\n\t\t\t\tname: req.query.name,\n\t\t\t\tsongIdToAdd: req.query.songId\n\t\t\t};\n\t\t\t(<any>req).query = updateQuery;\n\t\t\tawait this.updatePlaylist(<ApiOptions<SubsonicParameters.PlaylistUpdate>>req);\n\t\t\tplaylist = await this.byID<JamServe.Playlist>(req.query.playlistId, this.engine.store.playlist);\n\t\t} else if (req.query.name) {\n\t\t\tplaylist = await this.engine.playlists.createPlaylist(req.query.name, undefined, false, req.user.id, req.query.songId !== undefined ? (Array.isArray(req.query.songId) ? req.query.songId : [req.query.songId]) : []);\n\t\t}\n\t\tif (!playlist) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\tconst tracks = await this.engine.store.track.byIds(playlist.trackIDs);\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(playlist.trackIDs, req.user.id, DBObjectType.track);\n\t\treturn {playlist: FORMAT.packPlaylistWithSongs(playlist, tracks, states)};\n\t}\n\n\tasync updatePlaylist(req: ApiOptions<SubsonicParameters.PlaylistUpdate>): Promise<void> {\n\t\t/*\n\t\t updatePlaylist\n\n\t\t http://your-server/rest/updatePlaylist.view\n\t\t Since 1.8.0\n\n\t\t Updates a playlist. Only the owner of a playlist is allowed to update it.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t playlistId \tYes \t\tThe playlist ID.\n\t\t name \tNo \t\tThe human-readable name of the playlist.\n\t\t comment \tNo \t\tThe playlist comment.\n\t\t public \tNo \t\ttrue if the playlist should be visible to all users, false otherwise.\n\t\t songIdToAdd \tNo \t\tAdd this song with this ID to the playlist. Multiple parameters allowed.\n\t\t songIndexToRemove \tNo \t\tRemove the song at this position in the playlist. Multiple parameters allowed.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst playlist = await this.byID<JamServe.Playlist>(req.query.playlistId, this.engine.store.playlist);\n\t\tif (req.user.id !== playlist.userID) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.UNAUTH});\n\t\t}\n\n\t\tconst removetracks = req.query.songIndexToRemove !== undefined ? (Array.isArray(req.query.songIndexToRemove) ? req.query.songIndexToRemove : [req.query.songIndexToRemove]) : [];\n\t\tplaylist.trackIDs = playlist.trackIDs.filter((id, index) => removetracks.indexOf(index) < 0);\n\n\t\tconst tracks: Array<string> = playlist.trackIDs;\n\t\tif (req.query.songIdToAdd) {\n\t\t\tconst songadd = req.query.songIdToAdd !== undefined ? (Array.isArray(req.query.songIdToAdd) ? req.query.songIdToAdd : [req.query.songIdToAdd]) : [];\n\t\t\tplaylist.trackIDs = tracks.concat(songadd);\n\t\t}\n\t\tplaylist.name = req.query.name || playlist.name;\n\t\tplaylist.comment = req.query.comment || playlist.comment;\n\t\tplaylist.isPublic = req.query.public !== undefined ? req.query.public : playlist.isPublic;\n\t\tplaylist.changed = Date.now();\n\t\tawait this.engine.playlists.updatePlaylist(playlist);\n\t}\n\n\tasync deletePlaylist(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\t deletePlaylist\n\n\t\t http://your-server/rest/deletePlaylist.view\n\t\t Since 1.2.0\n\n\t\t Deletes a saved playlist.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tyes \t\tID of the playlist to delete, as obtained by getPlaylists.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst playlist = await this.byID<JamServe.Playlist>(req.query.id, this.engine.store.playlist);\n\t\tif (playlist.userID !== req.user.id) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.UNAUTH});\n\t\t}\n\t\tawait this.engine.playlists.removePlaylist(playlist);\n\t}\n\n\tasync getStarred(req: ApiOptions<SubsonicParameters.MusicFolderID>): Promise<{ starred: Subsonic.Starred }> {\n\t\t/*\n\t\t getStarred\n\n\t\t http://your-server/rest/getStarred.view\n\t\t Since 1.8.0\n\n\t\t Returns starred songs, albums and artists.\n\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t musicFolderId \tNo \t\t(Since 1.12.0) Only return results from the music folder with the given ID. See getMusicFolders.\n\n\t\t Returns a <subsonic-response> element with a nested <starred> element on success.\n\t\t */\n\t\tconst rootID = (req.query.musicFolderId !== undefined ? req.query.musicFolderId.toString() : undefined);\n\t\tconst starred: Subsonic.Starred = {};\n\t\tconst trackIDs = await this.engine.getFilteredListFaved<JamServe.SearchQueryTrack>(DBObjectType.track, {rootID}, req.user, this.engine.store.track);\n\t\tif (trackIDs.length > 0) {\n\t\t\tconst tracks = await this.engine.store.track.byIds(trackIDs);\n\t\t\tstarred.song = await this.prepareTracks(tracks, req.user);\n\t\t}\n\t\tconst artistFolderIDs = await this.engine.getFilteredListFaved<JamServe.SearchQueryFolder>(DBObjectType.folder, {types: [FolderType.artist], rootID}, req.user, this.engine.store.folder);\n\t\tif (artistFolderIDs.length > 0) {\n\t\t\tconst folders = await this.engine.store.folder.byIds(artistFolderIDs);\n\t\t\tstarred.artist = await this.prepareFolderArtists(folders, req.user);\n\t\t}\n\t\tconst albumFolderIDs = await this.engine.getFilteredListFaved<JamServe.SearchQueryFolder>(DBObjectType.folder, {types: FolderTypesAlbum, rootID}, req.user, this.engine.store.folder);\n\t\tif (albumFolderIDs.length > 0) {\n\t\t\tconst folders = await this.engine.store.folder.byIds(albumFolderIDs);\n\t\t\tstarred.album = await this.prepareFolders(folders, req.user);\n\t\t}\n\t\treturn {starred};\n\t}\n\n\tasync getStarred2(req: ApiOptions<SubsonicParameters.MusicFolderID>): Promise<{ starred2: Subsonic.Starred2 }> {\n\t\t/*\n\t\t getStarred2\n\n\t\t http://your-server/rest/getStarred2.view\n\t\t Since 1.8.0\n\n\t\t Similar to getStarred, but organizes music according to ID3 tags.\n\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t musicFolderId \tNo \t\t(Since 1.12.0) Only return results from the music folder with the given ID. See getMusicFolders\n\n\t\t Returns a <subsonic-response> element with a nested <starred2> element on success.\n\n\t\t */\n\t\tconst rootID = (req.query.musicFolderId !== undefined ? req.query.musicFolderId.toString() : undefined);\n\t\tconst starred2: Subsonic.Starred2 = {};\n\t\tconst trackIDs = await this.engine.getFilteredListFaved<JamServe.SearchQueryTrack>(DBObjectType.track, {rootID}, req.user, this.engine.store.track);\n\t\tif (trackIDs.length > 0) {\n\t\t\tconst tracks = await this.engine.store.track.byIds(trackIDs);\n\t\t\tstarred2.song = await this.prepareTracks(tracks, req.user);\n\t\t}\n\t\tconst albumIDs = await this.engine.getFilteredListFaved<JamServe.SearchQueryAlbum>(DBObjectType.album, {rootID}, req.user, this.engine.store.album);\n\t\tif (albumIDs.length > 0) {\n\t\t\tconst albums = await this.engine.store.album.byIds(albumIDs);\n\t\t\tstarred2.album = await this.prepareAlbums(albums, req.user);\n\t\t}\n\t\tconst artistIDs = await this.engine.getFilteredListFaved<JamServe.SearchQueryArtist>(DBObjectType.artist, {rootID}, req.user, this.engine.store.artist);\n\t\tif (artistIDs.length > 0) {\n\t\t\tconst artists = await this.engine.store.artist.byIds(artistIDs);\n\t\t\tstarred2.artist = await this.prepareArtists(artists, req.user);\n\t\t}\n\t\treturn {starred2};\n\t}\n\n\tasync refreshPodcasts(req: ApiOptions<{}>): Promise<void> {\n\t\t/*\n\t\t refreshPodcasts\n\n\t\t http://your-server/rest/refreshPodcasts.view\n\t\t Since 1.9.0\n\n\t\t Requests the server to check for new Podcast episodes. Note: The user must be authorized for Podcast administration (see Settings > Users > user is allowed to administrate Podcasts).\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tthis.engine.podcasts.refreshPodcasts(); // do not wait\n\t}\n\n\tasync createPodcastChannel(req: ApiOptions<SubsonicParameters.PodcastChannel>): Promise<void> {\n\t\t/*\n\t\t createPodcastChannel\n\n\t\t http://your-server/rest/createPodcastChannel.view\n\t\t Since 1.9.0\n\n\t\t Adds a new Podcast channel. Note: The user must be authorized for Podcast administration (see Settings > Users > user is allowed to administrate Podcasts).\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t url \tYes \t\tThe URL of the Podcast to add.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tawait this.engine.podcasts.addPodcast(req.query.url);\n\t}\n\n\tasync getPodcasts(req: ApiOptions<SubsonicParameters.PodcastChannels>): Promise<{ podcasts: Subsonic.Podcasts }> {\n\t\t/*\n\t\t getPodcasts\n\n\t\t http://your-server/rest/getPodcasts.view\n\t\t Since 1.6.0\n\n\t\t Returns all Podcast channels the server subscribes to, and (optionally) their episodes.\n\t\t This method can also be used to return details for only one channel - refer to the id parameter.\n\t\t A typical use case for this method would be to first retrieve all channels without episodes,\n\t\t and then retrieve all episodes for the single channel the user selects.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t includeEpisodes \tNo \ttrue \t(Since 1.9.0) Whether to include Podcast episodes in the returned result.\n\t\t id \tNo \t\t(Since 1.9.0) If specified, only return the Podcast channel with this ID.\n\n\t\t Returns a <subsonic-response> element with a nested <podcasts> element on success.\n\t\t */\n\n\t\tlet includeEpisodes = false;\n\t\tif (req.query.includeEpisodes !== undefined) {\n\t\t\tincludeEpisodes = req.query.includeEpisodes;\n\t\t}\n\t\tlet podcastList: Array<JamServe.Podcast> = [];\n\t\tif (req.query.id) {\n\t\t\tconst podcast = await this.engine.store.podcast.byId(req.query.id);\n\t\t\tif (podcast) {\n\t\t\t\tpodcastList.push(podcast);\n\t\t\t} else {\n\t\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t\t}\n\t\t} else {\n\t\t\tpodcastList = await this.engine.store.podcast.all();\n\t\t}\n\t\tconst channel = podcastList.map(podcast => FORMAT.packPodcast(podcast, (this.engine.podcasts.isDownloadingPodcast(podcast.id) ? PodcastStatus.downloading : undefined)));\n\t\tconst podcasts: Subsonic.Podcasts = {channel};\n\t\tif (includeEpisodes) {\n\t\t\tfor (const podcast of channel) {\n\t\t\t\tconst episodes = await this.engine.store.episode.search({podcastID: podcast.id});\n\t\t\t\tpodcast.episode = await this.prepareEpisodes(episodes.sort((a, b) => (b.date || 0) - (a.date || 0)), req.user);\n\t\t\t}\n\t\t}\n\t\treturn {podcasts};\n\t}\n\n\tasync getNewestPodcasts(req: ApiOptions<SubsonicParameters.PodcastEpisodesNewest>): Promise<{ newestPodcasts: Subsonic.NewestPodcasts }> {\n\t\t/*\n\t\t http://your-server/rest/getNewestPodcasts Since 1.13.0\n\n\t\tReturns the most recently published Podcast episodes.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tcount \tNo \t20 \tThe maximum number of episodes to return.\n\n\t\tReturns a <subsonic-response> element with a nested <newestPodcasts> element on success.\n\t\t */\n\t\t// TODO: do this with a limit & sort db request\n\t\tlet episodes = await this.engine.store.episode.all();\n\t\tepisodes = episodes.sort((a, b) => {\n\t\t\treturn (b.date || 0) - (a.date || 0);\n\t\t});\n\t\tconst newestPodcasts: Subsonic.NewestPodcasts = {};\n\t\tnewestPodcasts.episode = await this.prepareEpisodes(paginate(episodes, req.query.count || 20, 0), req.user);\n\t\treturn {newestPodcasts};\n\t}\n\n\tasync byID<T extends DBObject>(id: string, objstore: BaseStore<T, JamServe.SearchQuery>): Promise<T> {\n\t\tconst item = await objstore.byId(id);\n\t\tif (!item) {\n\t\t\treturn Promise.reject({fail: FORMAT.FAIL.NOTFOUND});\n\t\t}\n\t\treturn item;\n\t}\n\n\tasync deletePodcastChannel(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\t deletePodcastChannel\n\n\t\t http://your-server/rest/deletePodcastChannel.view\n\t\t Since 1.9.0\n\n\t\t Deletes a Podcast channel. Note: The user must be authorized for Podcast administration (see Settings > Users > user is allowed to administrate Podcasts).\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe ID of the Podcast channel to delete.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst podcast = await this.byID<JamServe.Podcast>(req.query.id, this.engine.store.podcast);\n\t\tawait this.engine.podcasts.removePodcast(podcast);\n\t}\n\n\tasync downloadPodcastEpisode(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\t downloadPodcastEpisode\n\n\t\t http://your-server/rest/downloadPodcastEpisode.view\n\t\t Since 1.9.0\n\n\t\t Request the server to start downloading a given Podcast episode. Note: The user must be authorized for Podcast administration (see Settings > Users > user is allowed to administrate Podcasts).\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe ID of the Podcast episode to download.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\n\t\tconst episode = await this.byID<JamServe.Episode>(req.query.id, this.engine.store.episode);\n\t\tif (!episode.path) {\n\t\t\tthis.engine.podcasts.downloadPodcastEpisode(episode); // do not wait\n\t\t}\n\t}\n\n\tasync deletePodcastEpisode(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\t deletePodcastEpisode\n\n\t\t http://your-server/rest/deletePodcastEpisode.view\n\t\t Since 1.9.0\n\n\t\t Deletes a Podcast episode. Note: The user must be authorized for Podcast administration (see Settings > Users > user is allowed to administrate Podcasts).\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe ID of the Podcast episode to delete.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst episode = await this.byID<JamServe.Episode>(req.query.id, this.engine.store.episode);\n\t\tawait this.engine.podcasts.deletePodcastEpisode(episode);\n\t}\n\n\tasync getBookmarks(req: ApiOptions<{}>): Promise<{ bookmarks: Subsonic.Bookmarks }> {\n\t\t/*\n\t\t getBookmarks\n\n\t\t http://your-server/rest/getBookmarks.view\n\t\t Since 1.9.0\n\n\t\t Returns all bookmarks for this user. A bookmark is a position within a certain media file.\n\n\t\t Returns a <subsonic-response> element with a nested <bookmarks> element on success.\n\t\t */\n\t\tconst bookmarklist = await this.engine.store.bookmark.search({userID: req.user.id});\n\t\tconst bookmarks: Subsonic.Bookmarks = {};\n\t\tbookmarks.bookmark = await this.prepareBookmarks(bookmarklist, req.user);\n\t\treturn {bookmarks};\n\t}\n\n\tasync createBookmark(req: ApiOptions<SubsonicParameters.Bookmark>): Promise<void> {\n\t\t/*\n\t\t createBookmark\n\n\t\t http://your-server/rest/createBookmark.view\n\t\t Since 1.9.0\n\n\t\t Creates or updates a bookmark (a position within a media file). Bookmarks are personal and not visible to other users.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tID of the media file to bookmark. If a bookmark already exists for this file it will be overwritten.\n\t\t position \tYes \t\tThe position (in milliseconds) within the media file.\n\t\t comment \tNo \t\tA user-defined comment.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst track = await this.byID<JamServe.Track>(req.query.id, this.engine.store.track);\n\t\tawait this.engine.trackBookmarkCreate(track, req.user, req.query.position, req.query.comment);\n\t}\n\n\tasync deleteBookmark(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\t deleteBookmark\n\n\t\t http://your-server/rest/deleteBookmark.view\n\t\t Since 1.9.0\n\n\t\t Deletes the bookmark for a given file.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tID of the media file for which to delete the bookmark. Other users' bookmarks are not affected.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tawait this.engine.trackBookmarkRemove(req.query.id, req.user);\n\t}\n\n\tasync getRandomSongs(req: ApiOptions<SubsonicParameters.RandomSong>): Promise<{ randomSongs: Subsonic.Songs }> {\n\t\t/*\n\t\t getRandomSongs\n\n\t\t http://your-server/rest/getRandomSongs.view\n\t\t Since 1.2.0\n\n\t\t Returns random songs matching the given criteria.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t size \tNo \t10 \tThe maximum number of songs to return. Max 500.\n\t\t genre \tNo \t\tOnly returns songs belonging to this genre.\n\t\t fromYear \tNo \t\tOnly return songs published after or in this year.\n\t\t toYear \tNo \t\tOnly return songs published before or in this year.\n\t\t musicFolderId \tNo \t\tOnly return songs in the music folder with the given ID. See getMusicFolders.\n\n\t\t Returns a <subsonic-response> element with a nested <randomSongs> element on success.\n\t\t */\n\n\t\tconst amount = Math.min(req.query.size || 10, 500);\n\t\tconst query: JamServe.SearchQueryTrack = {\n\t\t\tgenre: req.query.genre,\n\t\t\tfromYear: req.query.fromYear,\n\t\t\ttoYear: req.query.toYear,\n\t\t\trootID: req.query.musicFolderId ? req.query.musicFolderId.toString() : undefined\n\t\t};\n\t\tconst randomSongs: Subsonic.Songs = {};\n\t\tconst trackids = await this.engine.store.track.searchIDs(query);\n\t\tif (trackids.length > 0) {\n\t\t\tconst limit: Array<string> = randomItems(trackids, amount);\n\t\t\tconst tracks = await this.engine.store.track.byIds(limit);\n\t\t\trandomSongs.song = await this.prepareTracks(tracks, req.user);\n\t\t}\n\t\treturn {randomSongs};\n\t}\n\n\tasync getSongsByGenre(req: ApiOptions<SubsonicParameters.SongsByGenre>): Promise<{ songsByGenre: Subsonic.Songs }> {\n\t\t/*\n\t\t getSongsByGenre\n\n\t\t http://your-server/rest/getSongsByGenre.view\n\t\t Since 1.9.0\n\n\t\t Returns songs in a given genre.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t genre \tYes \t\tThe genre, as returned by getGenres.\n\t\t count \tNo \t10 \tThe maximum number of songs to return. Max 500.\n\t\t offset \tNo \t0 \tThe offset. Useful if you want to page through the songs in a genre.\n\t\t musicFolderId \tNo \t\t(Since 1.12.0) Only return albums in the music folder with the given ID. See getMusicFolders\n\n\t\t Returns a <subsonic-response> element with a nested <songsByGenre> element on success.\n\t\t */\n\t\tconst songsByGenre: Subsonic.Songs = {};\n\t\tconst tracklist = await this.engine.store.track.searchIDs({genre: req.query.genre, rootID: req.query.musicFolderId ? req.query.musicFolderId.toString() : undefined});\n\t\tconst limit = paginate(tracklist, req.query.count || 10, req.query.offset || 0);\n\t\tconst tracks = await this.engine.store.track.byIds(limit);\n\t\tsongsByGenre.song = await this.prepareTracks(tracks, req.user);\n\t\treturn {songsByGenre};\n\t}\n\n\tasync search(req: ApiOptions<SubsonicParameters.Search>): Promise<{ searchResult: Subsonic.SearchResult }> {\n\t\t/*\n\t\t search\n\n\t\t http://your-server/rest/search.view\n\t\t Since 1.0.0\n\t\t Deprecated since 1.4.0, use search2 instead.\n\n\t\t Returns a listing of files matching the given search criteria. Supports paging through the result.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t artist \tNo \t\tArtist to search for.\n\t\t album \tNo \t\tAlbum to search for.\n\t\t title \tNo \t\tSong title to search for.\n\t\t any \tNo \t\tSearches all fields.\n\t\t count \tNo \t20 \tMaximum number of results to return.\n\t\t offset \tNo \t0 \tSearch result offset. Used for paging.\n\t\t newerThan \tNo \t\tOnly return matches that are newer than this. Given as milliseconds since 1970.\n\n\t\t Returns a <subsonic-response> element with a nested <searchResult> element on success.\n\t\t */\n\t\tif (req.query.any) {\n\t\t\treq.query.artist = req.query.any;\n\t\t\treq.query.album = req.query.any;\n\t\t\treq.query.title = req.query.any;\n\t\t}\n\t\tlet list = await this.engine.store.track.searchIDs({\n\t\t\tartist: req.query.artist,\n\t\t\talbum: req.query.album,\n\t\t\ttitle: req.query.title,\n\t\t\tnewerThan: req.query.newerThan\n\t\t});\n\t\tconst searchResult: Subsonic.SearchResult = {offset: req.query.offset || 0, totalHits: list.length};\n\t\tlist = paginate(list, req.query.count || 20, req.query.offset || 0);\n\t\tconst tracks = await this.engine.store.track.byIds(list);\n\t\tsearchResult.match = await this.prepareTracks(tracks, req.user);\n\t\treturn {searchResult};\n\t}\n\n\tasync search2(req: ApiOptions<SubsonicParameters.Search2>): Promise<{ searchResult2: Subsonic.SearchResult2 }> {\n\t\t/*\n\t\t search2\n\n\t\t http://your-server/rest/search2.view\n\t\t Since 1.4.0\n\n\t\t Returns albums, artists and songs matching the given search criteria. Supports paging through the result.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t query \tYes \t\tSearch query.\n\t\t artistCount \tNo \t20 \tMaximum number of artists to return.\n\t\t artistOffset \tNo \t0 \tSearch result offset for artists. Used for paging.\n\t\t albumCount \tNo \t20 \tMaximum number of albums to return.\n\t\t albumOffset \tNo \t0 \tSearch result offset for albums. Used for paging.\n\t\t songCount \tNo \t20 \tMaximum number of songs to return.\n\t\t songOffset \tNo \t0 \tSearch result offset for songs. Used for paging.\n\t\t musicFolderId \tNo \t\t(Since 1.12.0) Only return results from the music folder with the given ID. See getMusicFolders\n\n\t\t Returns a <subsonic-response> element with a nested <searchResult2> element on success.\n\t\t */\n\n\t\tconst searchResult2: Subsonic.SearchResult2 = {};\n\t\tconst rootID = req.query.musicFolderId ? req.query.musicFolderId.toString() : undefined;\n\t\tconst tracklist = await this.engine.store.track.searchIDs({query: req.query.query, rootID});\n\t\tif (tracklist.length > 0) {\n\t\t\tconst limit = paginate(tracklist, req.query.songCount || 20, req.query.songOffset || 0);\n\t\t\tconst tracks = await this.engine.store.track.byIds(limit);\n\t\t\tsearchResult2.song = await this.prepareTracks(tracks, req.user);\n\t\t}\n\t\tconst folderlist = await this.engine.store.folder.search({query: req.query.query, rootID});\n\t\tif (folderlist.length > 0) {\n\t\t\tconst states = await this.engine.store.state.findOrCreateMulti(folderlist.map(f => f.id), req.user.id, DBObjectType.folder);\n\t\t\tconst artists: Array<Subsonic.Artist> = [];\n\t\t\tconst albums: Array<Subsonic.Child> = [];\n\t\t\tfolderlist.forEach(folder => {\n\t\t\t\tif (folder.tag.type === FolderType.artist) {\n\t\t\t\t\tartists.push(FORMAT.packFolderArtist(folder, states[folder.id]));\n\t\t\t\t} else {\n\t\t\t\t\talbums.push(FORMAT.packFolder(folder, states[folder.id]));\n\t\t\t\t}\n\t\t\t});\n\t\t\tsearchResult2.artist = paginate(artists, req.query.artistCount || 20, req.query.artistOffset || 0);\n\t\t\tsearchResult2.album = paginate(albums, req.query.albumCount || 20, req.query.albumOffset || 0);\n\t\t}\n\t\treturn {searchResult2};\n\t}\n\n\tasync search3(req: ApiOptions<SubsonicParameters.Search2>): Promise<{ searchResult3: Subsonic.SearchResult3 }> {\n\t\t/*\n\t\t search3\n\n\t\t http://your-server/rest/search3.view\n\t\t Since 1.8.0\n\n\t\t Similar to search2, but organizes music according to ID3 tags.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t query \tYes \t\tSearch query.\n\t\t artistCount \tNo \t20 \tMaximum number of artists to return.\n\t\t artistOffset \tNo \t0 \tSearch result offset for artists. Used for paging.\n\t\t albumCount \tNo \t20 \tMaximum number of albums to return.\n\t\t albumOffset \tNo \t0 \tSearch result offset for albums. Used for paging.\n\t\t songCount \tNo \t20 \tMaximum number of songs to return.\n\t\t songOffset \tNo \t0 \tSearch result offset for songs. Used for paging.\n\n\t\t Returns a <subsonic-response> element with a nested <searchResult3> element on success.\n\t\t */\n\n\t\tconst searchResult3: Subsonic.SearchResult3 = {};\n\t\tconst tracklist = await this.engine.store.track.searchIDs({query: req.query.query});\n\t\tif (tracklist.length > 0) {\n\t\t\tconst limit = paginate(tracklist, req.query.songCount || 20, req.query.songOffset || 0);\n\t\t\tconst tracks = await this.engine.store.track.byIds(limit);\n\t\t\tsearchResult3.song = await this.prepareTracks(tracks, req.user);\n\t\t}\n\t\tconst albumlist = await this.engine.store.album.searchIDs({query: req.query.query});\n\t\tif (albumlist.length > 0) {\n\t\t\tconst limit = paginate(albumlist, req.query.albumCount || 20, req.query.albumOffset || 0);\n\t\t\tconst albums = await this.engine.store.album.byIds(limit);\n\t\t\tsearchResult3.album = await this.prepareAlbums(albums, req.user);\n\t\t}\n\t\tconst artistlist = await this.engine.store.artist.searchIDs({query: req.query.query});\n\t\tif (artistlist.length > 0) {\n\t\t\tconst limit = paginate(artistlist, req.query.artistCount || 20, req.query.artistOffset || 0);\n\t\t\tconst artists = await this.engine.store.artist.byIds(limit);\n\t\t\tsearchResult3.artist = await this.prepareArtists(artists, req.user);\n\t\t}\n\t\treturn {searchResult3};\n\t}\n\n\tasync getScanStatus(req: ApiOptions<{}>): Promise<{ scanStatus: Subsonic.ScanStatus }> {\n\t\t/*\n\t\thttp://your-server/rest/getScanStatus Since 1.15.0\n\n\t\tReturns the current status for media library scanning. Takes no extra parameters.\n\n\t\tReturns a <subsonic-response> element with a nested <scanStatus> element on success.\n\t\t */\n\t\treturn {scanStatus: this.engine.io.getScanStatus()};\n\t}\n\n\tasync startScan(req: ApiOptions<{}>): Promise<void> {\n\t\t/*\n\t\thttp://your-server/rest/startScan Since 1.15.0\n\n\t\tInitiates a rescan of the media libraries. Takes no extra parameters.\n\n\t\tReturns a <subsonic-response> element with a nested <scanStatus> element on success.\n\t\t */\n\t\tthis.engine.refresh(); // do not wait\n\t}\n\n\tasync getArtist(req: ApiOptions<SubsonicParameters.ID>): Promise<{ artist: Subsonic.ArtistWithAlbumsID3 }> {\n\t\t/*\n\t\t getArtist\n\n\t\t http://your-server/rest/getArtist.view\n\t\t Since 1.8.0\n\n\t\t Returns details for an artist, including a list of albums. This method organizes music according to ID3 tags.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe artist ID.\n\n\t\t Returns a <subsonic-response> element with a nested <artist> element on success.\n\t\t */\n\t\tconst artist = await this.byID<JamServe.Artist>(req.query.id, this.engine.store.artist);\n\t\tconst albumlist = await this.engine.store.album.search({artistID: artist.id});\n\t\talbumlist.sort((a, b) => {\n\t\t\treturn (a.year || 0) - (b.year || 0);\n\t\t});\n\t\tconst state = await this.engine.store.state.findOrCreate(artist.id, req.user.id, DBObjectType.artist);\n\t\tconst states = await this.engine.store.state.findOrCreateMulti(albumlist.map(a => a.id), req.user.id, DBObjectType.album);\n\t\tconst artistid3 = <Subsonic.ArtistWithAlbumsID3>FORMAT.packArtist(artist, state);\n\t\tartistid3.album = albumlist.map(a => FORMAT.packAlbum(a, states[a.id]));\n\t\treturn {artist: artistid3};\n\t}\n\n\tasync getAlbum(req: ApiOptions<SubsonicParameters.ID>): Promise<{ album: Subsonic.AlbumWithSongsID3 }> {\n\t\t/*\n\t\t getAlbum\n\n\t\t http://your-server/rest/getAlbum.view\n\t\t Since 1.8.0\n\n\t\t Returns details for an album, including a list of songs. This method organizes music according to ID3 tags.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tThe album ID.\n\n\t\t Returns a <subsonic-response> element with a nested <album> element on success.\n\t\t */\n\t\tconst album = await this.byID<JamServe.Album>(req.query.id, this.engine.store.album);\n\t\tconst tracks = await this.engine.store.track.byIds(album.trackIDs);\n\t\tconst state = await this.engine.store.state.findOrCreate(album.id, req.user.id, DBObjectType.album);\n\t\ttracks.sort((a, b) => {\n\t\t\treturn (a.tag.track || 0) - (b.tag.track || 0);\n\t\t});\n\t\tconst childs = await this.prepareTracks(tracks, req.user);\n\t\tconst albumid3 = <Subsonic.AlbumWithSongsID3>FORMAT.packAlbum(album, state);\n\t\talbumid3.song = childs;\n\t\treturn {album: albumid3};\n\t}\n\n\tasync getLyrics(req: ApiOptions<SubsonicParameters.Lyrics>): Promise<{ lyrics: Subsonic.Lyrics }> {\n\t\t/*\n\t\t getLyrics\n\n\t\t http://your-server/rest/getLyrics.view\n\t\t Since 1.2.0\n\n\t\t Searches for and returns lyrics for a given song.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t artist \tNo \t\tThe artist name.\n\t\t title \tNo \t\tThe song title.\n\n\t\t Returns a <subsonic-response> element with a nested <lyrics> element on success. The <lyrics> element is empty if no matching lyrics was found.\n\t\t */\n\t\tif (!req.query.artist || !req.query.title) {\n\t\t\treturn {lyrics: {content: ''}};\n\t\t}\n\t\tconst lyrics = await this.engine.audio.getLyrics(req.query.artist, req.query.title);\n\t\tif (!lyrics) {\n\t\t\treturn {lyrics: {content: ''}};\n\t\t}\n\t\treturn {lyrics: {artist: lyrics.artist, title: lyrics.song, content: lyrics.lyric.replace(/\\r\\n/g, '\\n')}};\n\t}\n\n\tasync getPlayQueue(req: ApiOptions<{}>): Promise<{ playQueue: Subsonic.PlayQueue }> {\n\t\t/*\n\t\t http://your-server/rest/getPlayQueue Since 1.12.0\n\n\t\tReturns the state of the play queue for this user (as set by savePlayQueue).\n\t\tThis includes the tracks in the play queue, the currently playing track, and the position within this track.\n\t\t Typically used to allow a user to move between different clients/apps while retaining the same play queue\n\t\t (for instance when listening to an audio book).\n\n\t\tReturns a <subsonic-response> element with a nested <playQueue> element on success,\n\t\tor an empty <subsonic-response> if no play queue has been saved.\n\t\t */\n\t\tconst playqueue = await this.engine.playqueues.getQueue(req.user.id);\n\t\tif (!playqueue) {\n\t\t\tconst empty: any = {};\n\t\t\treturn empty;\n\t\t}\n\t\tconst tracks = await this.engine.store.track.byIds(playqueue.trackIDs);\n\t\tconst childs = await this.prepareTracks(tracks, req.user);\n\t\treturn {playQueue: FORMAT.packPlayQueue(playqueue, req.user, childs)};\n\t}\n\n\tasync savePlayQueue(req: ApiOptions<SubsonicParameters.PlayQueue>): Promise<void> {\n\t\t/*\n\t\t http://your-server/rest/savePlayQueue Since 1.12.0\n\n\t\tSaves the state of the play queue for this user. This includes the tracks in the play queue,\n\t\tthe currently playing track, and the position within this track. Typically used to allow a user to move between different clients/apps\n\t\twhile retaining the same play queue (for instance when listening to an audio book).\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tID of a song in the play queue. Use one id parameter for each song in the play queue.\n\t\tcurrent \tNo \t\tThe ID of the current playing song.\n\t\tposition \tNo \t\tThe position in milliseconds within the currently playing song.\n\n\t\tReturns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst ids: Array<string> = req.query.id ? (Array.isArray(req.query.id) ? req.query.id : [req.query.id]) : [];\n\t\tawait this.engine.playqueues.saveQueue(req.user.id, ids, req.query.current, req.query.position, req.client);\n\t}\n\n\tasync deleteInternetRadioStation(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\tdeleteInternetRadioStation\n\n\t\thttp://your-server/rest/deleteInternetRadioStation Since 1.16.0\n\n\t\tDeletes an existing internet radio station. Only users with admin privileges are allowed to call this method.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe ID for the station.\n\n\t\tReturns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst radio = await this.byID(req.query.id, await this.engine.store.radio);\n\t\tawait this.engine.store.radio.remove(radio.id);\n\t}\n\n\tasync createInternetRadioStation(req: ApiOptions<SubsonicParameters.InternetRadioCreate>): Promise<void> {\n\t\t/*\n\t\tcreateInternetRadioStation\n\n\t\thttp://your-server/rest/createInternetRadioStation Since 1.16.0\n\n\t\tAdds a new internet radio station. Only users with admin privileges are allowed to call this method.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tstreamUrl \tYes \t\tThe stream URL for the station.\n\t\tname \tYes \t\tThe user-defined name for the station.\n\t\thomepageUrl \tNo \t\tThe home page URL for the station.\n\n\t\tReturns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst radio: JamServe.Radio = {\n\t\t\tid: '',\n\t\t\ttype: DBObjectType.radio,\n\t\t\tname: req.query.name,\n\t\t\turl: req.query.streamUrl,\n\t\t\thomepage: req.query.homepageUrl,\n\t\t\tdisabled: false\n\t\t};\n\t\tawait this.engine.store.radio.add(radio);\n\t}\n\n\tasync updateInternetRadioStation(req: ApiOptions<SubsonicParameters.InternetRadioUpdate>): Promise<void> {\n\t\t/*\n\t\tupdateInternetRadioStation\n\n\t\thttp://your-server/rest/updateInternetRadioStation Since 1.16.0\n\n\t\tUpdates an existing internet radio station. Only users with admin privileges are allowed to call this method.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe ID for the station.\n\t\tstreamUrl \tYes \t\tThe stream URL for the station.\n\t\tname \tYes \t\tThe user-defined name for the station.\n\t\thomepageUrl \tNo \t\tThe home page URL for the station.\n\n\t\tReturns an empty <subsonic-response> element on success.\n\t\t */\n\t\tconst radio = await this.byID(req.query.id, await this.engine.store.radio);\n\t\tradio.homepage = req.query.homepageUrl;\n\t\tradio.name = req.query.name;\n\t\tradio.url = req.query.streamUrl;\n\t\tawait this.engine.store.radio.replace(radio);\n\t}\n\n\tasync getInternetRadioStations(req: ApiOptions<{}>): Promise<{ internetRadioStations: Subsonic.InternetRadioStations }> {\n\t\t/*\n\t\t getInternetRadioStations\n\n\t\t http://your-server/rest/getInternetRadioStations.view\n\t\t Since 1.9.0\n\n\t\t Returns all internet radio stations. Takes no extra parameters.\n\n\t\t Returns a <subsonic-response> element with a nested <internetRadioStations> element on success.\n\t\t */\n\t\tconst radios = await this.engine.store.radio.all();\n\t\treturn {internetRadioStations: {internetRadioStation: radios.filter(radio => !radio.disabled).map(radio => FORMAT.packRadio(radio))}};\n\t}\n\n\t/* Maybe implement someday? */\n\n\tasync getVideos(req: ApiOptions<{}>): Promise<{ videos: Subsonic.Videos }> {\n\t\t/*\n\t\t getVideos\n\n\t\t http://your-server/rest/getVideos.view\n\t\t Since 1.8.0\n\n\t\t Returns all video files.\n\n\t\t Returns a <subsonic-response> element with a nested <videos> element on success.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t\treturn {videos: {}};\n\t}\n\n\tasync getVideoInfo(req: ApiOptions<SubsonicParameters.ID>): Promise<{ videoInfo: Subsonic.VideoInfo }> {\n\t\t/*.\n\t\t http://your-server/rest/getVideoInfo Since 1.14.0\n\n\t\tReturns details for a video, including information about available audio tracks, subtitles (captions) and conversions.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe video ID.\n\n\t\tReturns a <subsonic-response> element with a nested <videoInfo> element on success.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t\treturn {videoInfo: {id: ''}};\n\t}\n\n\tasync getCaptions(req: ApiOptions<SubsonicParameters.Captions>): Promise<IApiBinaryResult> {\n\t\t/*\n\t\t http://your-server/rest/getCaptions Since 1.14.0\n\n\t\tReturns captions (subtitles) for a video. Use getVideoInfo to get a list of available captions.\n\t\tParameter \tRequired \tDefault \tComment\n\t\tid \tYes \t\tThe ID of the video.\n\t\tformat \tNo \t\tPreferred captions format (\"srt\" or \"vtt\").\n\n\t\tReturns the raw video captions.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t\treturn {};\n\t}\n\n\tasync scrobble(req: ApiOptions<SubsonicParameters.Scrobble>): Promise<void> {\n\t\t/*\n\t\t scrobble\n\n\t\t http://your-server/rest/scrobble.view\n\t\t Since 1.5.0\n\n\t\t Registers the local playback of one or more media files. Typically used when playing media that is cached on the client. This operation includes the following:\n\n\t\t\t\"Scrobbles\" the media files on last.fm if the user has configured his/her last.fm credentials on the Subsonic server (Settings > Personal).\n\t\t\tUpdates the play count and last played timestamp for the media files. (Since 1.11.0)\n\t\t\tMakes the media files appear in the \"Now playing\" page in the web app, and appear in the list of songs returned by getNowPlaying (Since 1.11.0)\n\n\t\t Since 1.8.0 you may specify multiple id (and optionally time) parameters to scrobble multiple files.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tA string which uniquely identifies the file to scrobble.\n\t\t time \tNo \t\t(Since 1.8.0) The time (in milliseconds since 1 Jan 1970) at which the song was listened to.\n\t\t submission \tNo \tTrue \tWhether this is a \"submission\" or a \"now playing\" notification.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t}\n\n\tasync getShares(req: ApiOptions<{}>): Promise<{ shares: Subsonic.Shares }> {\n\t\t/*\n\t\t getShares\n\n\t\t http://your-server/rest/getShares.view\n\t\t Since 1.6.0\n\n\t\t Returns information about shared media this user is allowed to manage. Takes no extra parameters.\n\n\t\t Returns a <subsonic-response> element with a nested <shares> element on success.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t\treturn {shares: {}};\n\t}\n\n\tasync createShare(req: ApiOptions<SubsonicParameters.Share>): Promise<void> {\n\t\t/*\n\t\t createShare\n\n\t\t http://your-server/rest/createShare.view\n\t\t Since 1.6.0\n\n\t\t Creates a public URL that can be used by anyone to stream music or video from the Subsonic server.\n\t\t The URL is short and suitable for posting on Facebook, Twitter etc. Note: The user must be authorized to share (see Settings > Users > user is allowed to share files with anyone).\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tID of a song, album or video to share. Use one id parameter for each entry to share.\n\t\t description \tNo \t\tA user-defined description that will be displayed to people visiting the shared media.\n\t\t expires \tNo \t\tThe time at which the share expires. Given as milliseconds since 1970.\n\n\t\t Returns a <subsonic-response> element with a nested <shares> element on success, which in turns contains a single <share> element for the newly created share.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t}\n\n\tasync updateShare(req: ApiOptions<SubsonicParameters.Share>): Promise<void> {\n\t\t/*\n\t\t updateShare\n\n\t\t http://your-server/rest/updateShare.view\n\t\t Since 1.6.0\n\n\t\t Updates the description and/or expiration date for an existing share.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tID of the share to update.\n\t\t description \tNo \t\tA user-defined description that will be displayed to people visiting the shared media.\n\t\t expires \tNo \t\tThe time at which the share expires. Given as milliseconds since 1970, or zero to remove the expiration.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t}\n\n\tasync deleteShare(req: ApiOptions<SubsonicParameters.ID>): Promise<void> {\n\t\t/*\n\t\t deleteShare\n\n\t\t http://your-server/rest/deleteShare.view\n\t\t Since 1.6.0\n\n\t\t Deletes an existing share.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tID of the share to delete.\n\n\t\t Returns an empty <subsonic-response> element on success.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t}\n\n\tasync hls(req: ApiOptions<SubsonicParameters.HLS>): Promise<IApiBinaryResult> {\n\t\t/*\n\t\t hls\n\n\t\t http://your-server/rest/hls.m3u8\n\t\t Since 1.8.0\n\n\t\t Creates an HLS (HTTP Live Streaming) playlist used for streaming video or audio. HLS is a streaming protocol implemented by Apple and works by breaking the overall stream\n\t\t into a sequence of small HTTP-based file downloads. It's supported by iOS and newer versions of Android.\n\t\t This method also supports adaptive bitrate streaming, see the bitRate parameter.\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t id \tYes \t\tA string which uniquely identifies the media file to stream.\n\t\t bitRate \tNo \t\tIf specified, the server will attempt to limit the bitrate to this value, in kilobits per second. If this parameter is specified more than once,\n\t\t the server will create a variant playlist, suitable for adaptive bitrate streaming. The playlist will support streaming at all the specified bitrates.\n\t\t The server will automatically choose video dimensions that are suitable for the given bitrates. Since 1.9.0 you may explicitly request a certain width (480)\n\t\t  and height (360) like so: bitRate=1000@480x360\n\n\t\t Returns an M3U8 playlist on success (content type \"application/vnd.apple.mpegurl\"), or an XML document on error (in which case the HTTP content type will start with \"text/xml\").\n\t\t */\n\t\tPromise.reject('not implemented');\n\t\treturn {};\n\t}\n\n\tasync jukeboxControl(req: ApiOptions<SubsonicParameters.Jukebox>): Promise<{ jukeboxStatus: Subsonic.JukeboxStatus }> {\n\t\t/*\n\t\t jukeboxControl\n\n\t\t http://your-server/rest/jukeboxControl.view\n\t\t Since 1.2.0\n\n\t\t Controls the jukebox, i.e., playback directly on the server's audio hardware. Note: The user must be authorized to control the jukebox (see Settings > Users > user is allowed to play files in jukebox mode).\n\t\t Parameter \tRequired \tDefault \tComment\n\t\t action \tYes \t\tThe operation to perform. Must be one of: get, status (since 1.7.0), set (since 1.7.0), start, stop, skip, add, clear, remove, shuffle, setGain\n\t\t index \tNo \t\tUsed by skip and remove. Zero-based index of the song to skip to or remove.\n\t\t offset \tNo \t\t(Since 1.7.0) Used by skip. Start playing this many seconds into the track.\n\t\t id \tNo \t\tUsed by add and set. ID of song to add to the jukebox playlist. Use multiple id parameters to add many songs in the same request. (set is similar to a clear followed by a add, but will not change the currently playing track.)\n\t\t gain \tNo \t\tUsed by setGain to control the playback volume. A float value between 0.0 and 1.0.\n\n\t\t Returns a <jukeboxStatus> element on success, unless the get action is used, in which case a nested <jukeboxPlaylist> element is returned.\n\t\t */\n\t\tPromise.reject('not implemented');\n\t\treturn {jukeboxStatus: {currentIndex: 0, playing: false, gain: 0}};\n\t}\n\n}\n\n","import {Subsonic} from '../../model/subsonic-rest-data-1.16.0';\nimport {SubsonicParameters} from '../../model/subsonic-rest-params-1.16.0';\nimport {SubsonicApi, ApiOptions} from './api';\nimport {ApiResponder} from './response';\nimport express from 'express';\nimport {IApiBinaryResult} from '../../typings';\nimport {apiCheck} from './check';\n\nexport interface SubsonicRolesHandler {\n\tpodcast: express.RequestHandler;\n\tshare: express.RequestHandler;\n\tadmin: express.RequestHandler;\n\tjukebox: express.RequestHandler;\n}\n\nexport function registerApi(router: express.Router, api: SubsonicApi, roles: SubsonicRolesHandler): void {\n\trouter.all('/addChatMessage.view', apiCheck('/addChatMessage.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ChatMessage> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.addChatMessage(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/changePassword.view', apiCheck('/changePassword.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ChangePassword> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.changePassword(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/createBookmark.view', apiCheck('/createBookmark.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Bookmark> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.createBookmark(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/createPlaylist.view', apiCheck('/createPlaylist.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.PlaylistCreate> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { playlist: Subsonic.PlaylistWithSongs } = await api.createPlaylist(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/createPodcastChannel.view', roles.podcast, apiCheck('/createPodcastChannel.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.PodcastChannel> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.createPodcastChannel(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/createShare.view', roles.share, apiCheck('/createShare.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Share> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.createShare(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/createUser.view', roles.admin, apiCheck('/createUser.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.CreateUser> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.createUser(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deleteBookmark.view', apiCheck('/deleteBookmark.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deleteBookmark(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deleteInternetRadioStation.view', roles.admin, apiCheck('/deleteInternetRadioStation.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deleteInternetRadioStation(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deletePlaylist.view', apiCheck('/deletePlaylist.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deletePlaylist(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deletePodcastChannel.view', roles.podcast, apiCheck('/deletePodcastChannel.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deletePodcastChannel(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deletePodcastEpisode.view', roles.podcast, apiCheck('/deletePodcastEpisode.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deletePodcastEpisode(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deleteShare.view', apiCheck('/deleteShare.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deleteShare(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/deleteUser.view', roles.admin, apiCheck('/deleteUser.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Username> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.deleteUser(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/downloadPodcastEpisode.view', roles.podcast, apiCheck('/downloadPodcastEpisode.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.downloadPodcastEpisode(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getAlbum.view', apiCheck('/getAlbum.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { album: Subsonic.AlbumWithSongsID3 } = await api.getAlbum(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getAlbumInfo.view', apiCheck('/getAlbumInfo.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { albumInfo: Subsonic.AlbumInfo } = await api.getAlbumInfo(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getAlbumInfo2.view', apiCheck('/getAlbumInfo2.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { albumInfo: Subsonic.AlbumInfo } = await api.getAlbumInfo2(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getAlbumList.view', apiCheck('/getAlbumList.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.AlbumList> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { albumList: Subsonic.AlbumList } = await api.getAlbumList(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getAlbumList2.view', apiCheck('/getAlbumList2.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.AlbumList2> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { albumList2: Subsonic.AlbumList2 } = await api.getAlbumList2(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getArtist.view', apiCheck('/getArtist.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { artist: Subsonic.ArtistWithAlbumsID3 } = await api.getArtist(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getArtistInfo.view', apiCheck('/getArtistInfo.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ArtistInfo> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { artistInfo: Subsonic.ArtistInfo } = await api.getArtistInfo(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getArtistInfo2.view', apiCheck('/getArtistInfo2.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ArtistInfo> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { artistInfo2: Subsonic.ArtistInfo2 } = await api.getArtistInfo2(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getArtists.view', apiCheck('/getArtists.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.MusicFolderID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { artists: Subsonic.ArtistsID3 } = await api.getArtists(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getBookmarks.view', apiCheck('/getBookmarks.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { bookmarks: Subsonic.Bookmarks } = await api.getBookmarks(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getChatMessages.view', apiCheck('/getChatMessages.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ChatMessages> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { chatMessages: Subsonic.ChatMessages } = await api.getChatMessages(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getGenres.view', apiCheck('/getGenres.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { genres: Subsonic.Genres } = await api.getGenres(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getIndexes.view', apiCheck('/getIndexes.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Indexes> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { indexes: Subsonic.Indexes } = await api.getIndexes(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getInternetRadioStations.view', apiCheck('/getInternetRadioStations.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { internetRadioStations: Subsonic.InternetRadioStations } = await api.getInternetRadioStations(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/createInternetRadioStation.view', roles.admin, apiCheck('/createInternetRadioStation.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.InternetRadioCreate> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.createInternetRadioStation(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/updateInternetRadioStation.view', roles.admin, apiCheck('/updateInternetRadioStation.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.InternetRadioUpdate> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.updateInternetRadioStation(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getLicense.view', apiCheck('/getLicense.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { license: Subsonic.License } = await api.getLicense(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getLyrics.view', apiCheck('/getLyrics.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Lyrics> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { lyrics: Subsonic.Lyrics } = await api.getLyrics(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getMusicDirectory.view', apiCheck('/getMusicDirectory.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { directory: Subsonic.Directory } = await api.getMusicDirectory(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getMusicFolders.view', apiCheck('/getMusicFolders.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { musicFolders: Subsonic.MusicFolders } = await api.getMusicFolders(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getNewestPodcasts.view', apiCheck('/getNewestPodcasts.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.PodcastEpisodesNewest> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { newestPodcasts: Subsonic.NewestPodcasts } = await api.getNewestPodcasts(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getNowPlaying.view', apiCheck('/getNowPlaying.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { nowPlaying: Subsonic.NowPlaying } = await api.getNowPlaying(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getPlaylist.view', apiCheck('/getPlaylist.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { playlist: Subsonic.PlaylistWithSongs } = await api.getPlaylist(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getPlaylists.view', apiCheck('/getPlaylists.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Playlists> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { playlists: Subsonic.Playlists } = await api.getPlaylists(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getPlayQueue.view', apiCheck('/getPlayQueue.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { playQueue: Subsonic.PlayQueue } = await api.getPlayQueue(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getPodcasts.view', apiCheck('/getPodcasts.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.PodcastChannels> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { podcasts: Subsonic.Podcasts } = await api.getPodcasts(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getRandomSongs.view', apiCheck('/getRandomSongs.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.RandomSong> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { randomSongs: Subsonic.Songs } = await api.getRandomSongs(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getScanStatus.view', apiCheck('/getScanStatus.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { scanStatus: Subsonic.ScanStatus } = await api.getScanStatus(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/startScan.view', apiCheck('/startScan.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.startScan(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getShares.view', apiCheck('/getShares.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { shares: Subsonic.Shares } = await api.getShares(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getSimilarSongs.view', apiCheck('/getSimilarSongs.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.SimilarSongs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { similarSongs: Subsonic.SimilarSongs } = await api.getSimilarSongs(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getSimilarSongs2.view', apiCheck('/getSimilarSongs2.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.SimilarSongs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { similarSongs2: Subsonic.SimilarSongs2 } = await api.getSimilarSongs2(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getSong.view', apiCheck('/getSong.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { song: Subsonic.Child } = await api.getSong(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getSongsByGenre.view', apiCheck('/getSongsByGenre.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.SongsByGenre> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { songsByGenre: Subsonic.Songs } = await api.getSongsByGenre(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getStarred.view', apiCheck('/getStarred.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.MusicFolderID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { starred: Subsonic.Starred } = await api.getStarred(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getStarred2.view', apiCheck('/getStarred2.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.MusicFolderID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { starred2: Subsonic.Starred2 } = await api.getStarred2(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getTopSongs.view', apiCheck('/getTopSongs.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.TopSongs> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { topSongs: Subsonic.TopSongs } = await api.getTopSongs(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getUser.view', apiCheck('/getUser.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Username> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { user: Subsonic.User } = await api.getUser(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getUsers.view', roles.admin, apiCheck('/getUsers.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { users: Subsonic.Users } = await api.getUsers(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getVideoInfo.view', apiCheck('/getVideoInfo.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.ID> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { videoInfo: Subsonic.VideoInfo } = await api.getVideoInfo(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getVideos.view', apiCheck('/getVideos.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { videos: Subsonic.Videos } = await api.getVideos(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/jukeboxControl.view', roles.jukebox, apiCheck('/jukeboxControl.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Jukebox> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { jukeboxStatus: Subsonic.JukeboxStatus } = await api.jukeboxControl(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/ping.view', apiCheck('/ping.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.ping(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/refreshPodcasts.view', roles.podcast, apiCheck('/refreshPodcasts.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<{}> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.refreshPodcasts(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/savePlayQueue.view', apiCheck('/savePlayQueue.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.PlayQueue> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.savePlayQueue(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/scrobble.view', apiCheck('/scrobble.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Scrobble> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.scrobble(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/search.view', apiCheck('/search.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Search> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { searchResult: Subsonic.SearchResult } = await api.search(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/search2.view', apiCheck('/search2.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Search2> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { searchResult2: Subsonic.SearchResult2 } = await api.search2(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/search3.view', apiCheck('/search3.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Search2> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: { searchResult3: Subsonic.SearchResult3 } = await api.search3(options);\n\t\t\tawait ApiResponder.data(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/setRating.view', apiCheck('/setRating.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Rate> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.setRating(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/star.view', apiCheck('/star.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.State> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.star(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/unstar.view', apiCheck('/unstar.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.State> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.unstar(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/updatePlaylist.view', apiCheck('/updatePlaylist.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.PlaylistUpdate> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.updatePlaylist(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/updateShare.view', apiCheck('/updateShare.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Share> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.updateShare(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/updateUser.view', roles.admin, apiCheck('/updateUser.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.UpdateUser> = {query: req.query, user: req.user, client: req.client};\n\t\t\tawait api.updateUser(options);\n\t\t\tawait ApiResponder.ok(req, res);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getAvatar.view', apiCheck('/getAvatar.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Username> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.getAvatar(options);\n\t\t\tawait ApiResponder.binary(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getCaptions.view', apiCheck('/getCaptions.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Captions> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.getCaptions(options);\n\t\t\tawait ApiResponder.binary(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/getCoverArt.view', apiCheck('/getCoverArt.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.CoverArt> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.getCoverArt(options);\n\t\t\tawait ApiResponder.binary(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/hls.view', apiCheck('/hls.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.HLS> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.hls(options);\n\t\t\tawait ApiResponder.binary(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/stream.view', apiCheck('/stream.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Stream> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.stream(options);\n\t\t\tawait ApiResponder.binary(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n\n\trouter.all('/download.view', apiCheck('/download.view'), async (req, res) => {\n\t\ttry {\n\t\t\tconst options: ApiOptions<SubsonicParameters.Download> = {query: req.query, user: req.user, client: req.client};\n\t\t\tconst result: IApiBinaryResult = await api.download(options);\n\t\t\tawait ApiResponder.binary(req, res, result);\n\t\t} catch (e) {\n\t\t\tawait ApiResponder.error(req, res, e);\n\t\t}\n\t});\n}\n","import express from 'express';\nimport {checkOpenApiParameters} from '../../utils/openapi-parameters-check';\nimport {ApiResponder} from './response';\nimport {FORMAT} from './format';\nimport {OpenAPIObject} from '../../model/openapi';\n\nconst SubsonicApiSchema = require('../../model/subsonic-rest-api-1.16.0.schema.json');\nconst openapi: OpenAPIObject = require('../../model/subsonic-openapi-1.16.0.json');\n\nexport function apiCheck(name: string): express.RequestHandler {\n\tfunction CheckApiParametersHandler(req: express.Request, res: express.Response, next: express.NextFunction) {\n\t\tcheckOpenApiParameters(name, req, openapi, SubsonicApiSchema, 'get').then(() => {\n\t\t\tnext();\n\t\t}).catch((e) => {\n\t\t\tApiResponder.error(req, res, {fail: FORMAT.FAIL.PARAMETER, text: e.toString()});\n\t\t});\n\t}\n\treturn CheckApiParametersHandler;\n}\n","module.exports = require(\"helmet\");","import path from 'path';\nimport {AppConfig} from './config/app.config';\nimport {ThirdPartyConfig} from './config/thirdparty.config';\n\ntype LogLevel = 'error' | 'warn' | 'info' | 'debug';\ntype ElasticLogLevel = 'warning' | 'error' | 'trace';\n\nexport interface BaseConfig {\n\tlog: { level: LogLevel };\n\tserver: {\n\t\tlisten: string;\n\t\tport: number;\n\t\tsession: {\n\t\t\tallowedCookieDomains: Array<string>;\n\t\t\tsecret: string;\n\t\t\tcookie: {\n\t\t\t\tname: string;\n\t\t\t\tsecure: boolean\n\t\t\t\tmaxAge: {\n\t\t\t\t\tvalue: number;\n\t\t\t\t\tunit: string;\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t\tjwt: {\n\t\t\tsecret: string;\n\t\t\tmaxAge: {\n\t\t\t\tvalue: number;\n\t\t\t\tunit: string;\n\t\t\t};\n\t\t}\n\t};\n\tdatabase: {\n\t\tuse: string;\n\t\toptions: {\n\t\t\telasticsearch: {\n\t\t\t\thost: string,\n\t\t\t\tindexPrefix: string\n\t\t\t\tindexRefresh?: string\n\t\t\t\tlog?: Array<ElasticLogLevel>;\n\t\t\t};\n\t\t\tnedb?: {};\n\t\t}\n\t};\n\tpaths: {\n\t\tdata: string,\n\t\tjamberry: string\n\t};\n}\n\nexport interface Config extends BaseConfig {\n\tapp: {\n\t\tchat: {\n\t\t\tmaxMsgs: number;\n\t\t\tmaxAge: {\n\t\t\t\tvalue: number;\n\t\t\t\tunit: string;\n\t\t\t};\n\t\t};\n\t\tindex: {\n\t\t\tignore: Array<string>;\n\t\t};\n\t};\n\ttools: {\n\t\tacoustid: {\n\t\t\tapiKey: string;\n\t\t\tuserAgent: string;\n\t\t};\n\t\tlastfm: {\n\t\t\tapiKey: string;\n\t\t\tuserAgent: string;\n\t\t};\n\t\tmusicbrainz: {\n\t\t\tuserAgent: string;\n\t\t};\n\t\tchartlyrics: {\n\t\t\tuserAgent: string;\n\t\t};\n\t};\n\tfirstStart?: {\n\t\tadminUser?: {\n\t\t\tname: string;\n\t\t\tpass: string;\n\t\t\tmail: string;\n\t\t};\n\t\troots?: Array<{ name: string; path: string; }>;\n\t};\n\n\tgetDataPath(parts: Array<string>): string;\n}\n\nexport function extendConfig(config: BaseConfig): Config {\n\tconst result = <Config>config;\n\tresult.tools = ThirdPartyConfig;\n\tresult.app = AppConfig;\n\tresult.getDataPath = (parts: Array<string>): string => {\n\t\treturn path.resolve(config.paths.data, ...parts);\n\t};\n\treturn result;\n}\n\nexport function loadConfig(): Config {\n\tconst config: Config = require('../config/config.js');\n\tconfig.firstStart = require('../config/firststart.config.js');\n\treturn extendConfig(config);\n}\n","// TODO make these settings changeable via api\n\nexport const AppConfig = {\n  chat: {\n    maxMsgs: 100,\n    maxAge: {value: 1, unit: 'day'}\n  },\n  index: {\n    ignore: ['The', 'El', 'La', 'Los', 'Las', 'Le', 'Les', 'Die']\n  }\n};\n","/*\n\tThird Party Web Services\n */\nexport const ThirdPartyConfig = {\n\t/*\n\t\tAcoustid\n\t\thttps://acoustid.org/\n\t\taudio identification via fingerprinting\n\t */\n\tacoustid: {apiKey: 'xuwbosoqd4', userAgent: 'JamServe/0.1.0'},\n\t/*\n\t\tLastFM\n\t\thttps://www.last.fm/api\n\t\tmusic database\n\t */\n\tlastfm: {apiKey: 'ead198fb293eefea29e8a5b8f0908e55', userAgent: 'JamServe/0.1.0'},\n\t/*\n\t\tMusicBrainz\n\t\thttps://musicbrainz.org/\n\t\topen music encyclopedia\n\t */\n\tmusicbrainz: {userAgent: 'JamServe/0.1.0 ( jamserve@protonmail.com )'},\n\t/*\n\t\tChart Lyrics\n\t\thttp://www.chartlyrics.com/\n\t\tlyrics database\n\t */\n\tchartlyrics: {userAgent: 'JamServe/0.1.0'}\n};\n","module.exports = require(\"../config/config.js\");","module.exports = require(\"../config/firststart.config.js\");"],"sourceRoot":""}