!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=1)}([function(t,n){t.exports=require("fs-extra")},function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,s)}c((r=r.apply(t,n||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});const i=o(e(0)),u=e(2),s=e(3);u.parentPort&&u.parentPort.on("message",t=>r(void 0,void 0,void 0,(function*(){if("string"!=typeof t)throw new Error("param must be a string.");yield function(t){return r(this,void 0,void 0,(function*(){const n=t+".bak";(yield i.default.pathExists(n))||(yield i.default.copy(t,n)),yield s.mp3val(t,!0)}))}(t),u.parentPort&&u.parentPort.postMessage(void 0)})))},function(t,n){t.exports=require("worker_threads")},function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,s)}c((r=r.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const o=e(4);function i(t){let n,e=t,r=e.indexOf('"');return e=e.slice(r),r=e.indexOf('"'),e=e.slice(r).trim(),"("===e[0]&&(r=e.indexOf(")"),n=e.slice(1,r-1)),r=e.indexOf(":"),e=e.slice(r).trim(),{offset:n,msg:e}}n.mp3val=function(t,n){return r(this,void 0,void 0,(function*(){const e=["-si"];n&&e.push("-f");const r=yield o.spawnTool("mp3val","MP3VAL_PATH",[...e,t]);return r.errMsg?Promise.reject(Error(r.errMsg)):function(t){const n=t.split("\n"),e={fixed:!1,warnings:[]};for(const t of n)t.startsWith("WARNING:")?e.warnings.push(i(t)):t.startsWith("FIXED")&&(e.fixed=!0);return e}(r.result)}))}},function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,s)}c((r=r.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const o=e(5),i=e(6);function u(t,n,e){return r(this,void 0,void 0,(function*(){const r=yield i.getBinPath(t,n);return r&&0!==r.length?new Promise((t,n)=>{const i=o.spawn(r,e);if(!i.stdout||!i.stderr)return n(Error("Unsupported std out"));let u="",s="";i.stdout.on("data",t=>{u+=t.toString()}),i.stderr.on("data",t=>{s+=t.toString()}),i.on("close",n=>{t({result:u,errMsg:s})})}):Promise.reject(Error("Tool binary not found "+t))}))}n.spawnTool=u,n.spawnToolJson=function(t,n,e){return r(this,void 0,void 0,(function*(){const r=yield u(t,n,e);return JSON.parse(r.result)}))}},function(t,n){t.exports=require("child_process")},function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,s)}c((r=r.apply(t,n||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});const i=o(e(0)),u=o(e(7)),s=o(e(8));n.isWindows=["win32","cygwin","msys"].includes(process.platform);const c={};n.getBinPath=function(t,e){return r(this,void 0,void 0,(function*(){if(t in c)return c[t];try{const n=yield function(t){return r(this,void 0,void 0,(function*(){const n=process.env[t];if(n&&n.length>0){if(yield i.default.pathExists(n))return n}}))}(e);if(n&&n.length>0)return c[t]=n,n}catch(t){}try{const n=yield function(t){return r(this,void 0,void 0,(function*(){return new Promise((n,e)=>{s.default(t,(t,r)=>{t?e(t):n(r)})})}))}(t);if(n&&n.length>0)return c[t]=n,n}catch(t){}try{const e=yield function(t){return r(this,void 0,void 0,(function*(){const e=u.default.join(".","bin","tools",t,process.platform,process.arch,t)+(n.isWindows?".exe":"");if(yield i.default.pathExists(e))return e}))}(t);if(e&&e.length>0)return c[t]=e,e}catch(t){}}))}},function(t,n){t.exports=require("path")},function(t,n){t.exports=require("which")}]);
//# sourceMappingURL=task-fix-mp3.js.map