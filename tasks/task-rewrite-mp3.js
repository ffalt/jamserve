!function(e){var t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t){e.exports=require("fs-extra")},function(e,t,a){"use strict";var r=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(o,i){function n(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(n,u)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(a(0)),n=o(a(6));t.fileDeleteIfExists=function(e){return r(this,void 0,void 0,(function*(){(yield i.default.pathExists(e))&&(yield i.default.unlink(e))}))},t.pathDeleteIfExists=function(e){return r(this,void 0,void 0,(function*(){(yield i.default.pathExists(e))&&(yield i.default.remove(e))}))},t.fileSuffix=function(e){return n.default.extname(e).slice(1).toLowerCase()},t.fileExt=function(e){return n.default.extname(e).toLowerCase()},t.basenameStripExt=function(e){return n.default.basename(e,n.default.extname(e))},t.replaceFileSystemChars=function(e,t){return e.toString().replace(/:/g," - ").replace(/[?/!\\"]/g,t)};const u=/[<>:"/\\|?*\x00-\x1F]|^(?:aux|con|clock\$|nul|prn|com[1-9]|lpt[1-9])$/i;t.containsFolderSystemChars=function(e){return u.test(e)},t.replaceFolderSystemChars=function(e,t){return e.toString().replace(/:/g," -").replace(/[|*?/!\\<>"]/g,t)},t.ensureTrailingPathSeparator=function(e){return e.length>0&&e[e.length-1]!==n.default.sep?e+n.default.sep:e},t.removeTrailingPathSeparator=function(e){return e.length>0&&e[e.length-1]===n.default.sep?e.slice(0,e.length-1):e}},function(e,t,a){"use strict";var r=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(o,i){function n(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(n,u)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(a(0)),n=a(3),u=a(4),l=a(5),s=a(1),c=a(7);u.parentPort&&u.parentPort.on("message",e=>r(void 0,void 0,void 0,(function*(){if("string"!=typeof e)throw new Error("param must be a string.");yield function(e){return r(this,void 0,void 0,(function*(){const t=e+".tmp",a=e+".bak";try{const r=s.fileSuffix(e),o=new n.ID3v2;let u;r===l.AudioFormatType.mp3&&(u=yield o.read(e)),yield c.rewriteWriteFFmpeg(e,t),(yield i.default.pathExists(a))?yield s.fileDeleteIfExists(e):yield i.default.copy(e,a),u&&(yield o.write(t,u,4,0,{keepBackup:!1,paddingSize:10})),yield i.default.rename(t,e)}catch(e){return yield s.fileDeleteIfExists(t),Promise.reject(e)}}))}(e),u.parentPort&&u.parentPort.postMessage(void 0)})))},function(e,t){e.exports=require("jamp3")},function(e,t){e.exports=require("worker_threads")},function(e,t,a){"use strict";var r,o,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.root="root",e.user="user",e.folder="folder",e.track="track",e.state="state",e.playlist="playlist",e.podcast="podcast",e.episode="episode",e.series="series",e.bookmark="bookmark",e.album="album",e.artist="artist",e.playqueue="playqueue",e.radio="radio"}(t.JamObjectType||(t.JamObjectType={})),function(e){e.auto="auto",e.artistalbum="artistalbum",e.compilation="compilation",e.audiobook="audiobook"}(t.RootScanStrategy||(t.RootScanStrategy={})),t.AudioMimeTypes={mp3:"audio/mpeg",m4a:"audio/mp4",mp4:"audio/mp4",ogg:"audio/ogg",oga:"audio/ogg",flv:"aaudio/x-flv",flac:"audio/flac",webma:"audio/webm",webm:"audio/webm",wav:"audio/wav"},function(e){e.svg="svg",e.json="json",e.dat="dat"}(r=t.WaveformFormatType||(t.WaveformFormatType={})),function(e){e.mp3="mp3",e.m4a="m4a",e.mp4="mp4",e.ogg="ogg",e.oga="oga",e.flv="flv",e.flac="flac",e.webma="webma",e.wav="wav"}(t.AudioFormatType||(t.AudioFormatType={})),t.VideoMimeTypes={mp4:"audio/mp4",m4v:"audio/mp4",ogv:"audio/ogg",webmv:"audio/webm",webm:"audio/webm"},function(e){e.unknown="unknown",e.artist="artist",e.collection="collection",e.album="album",e.multialbum="multialbum",e.extras="extras"}(o=t.FolderType||(t.FolderType={})),function(e){e.new="new",e.downloading="downloading",e.completed="completed",e.error="error",e.deleted="deleted"}(t.PodcastStatus||(t.PodcastStatus={})),t.FolderTypeImageName={unknown:"folder",artist:"artist",collection:"folder",album:"cover",multialbum:"cover",extras:"folder"},function(e){e.front="front",e.back="back",e.booklet="booklet",e.medium="medium",e.tray="tray",e.obi="obi",e.spine="spine",e.track="track",e.liner="liner",e.sticker="sticker",e.poster="poster",e.watermark="watermark",e.raw="raw",e.unedited="unedited",e.other="other",e.artist="artist"}(t.ArtworkImageType||(t.ArtworkImageType={})),t.FolderTypesAlbum=[o.album,o.multialbum],function(e){e[e.ascending=0]="ascending",e[e.descending=1]="descending"}(t.DatabaseQuerySortType||(t.DatabaseQuerySortType={})),function(e){e.unknown="unknown",e.album="album",e.compilation="compilation",e.live="live",e.bootleg="bootleg",e.soundtrack="soundtrack",e.audiobook="audiobook",e.ep="ep",e.single="single",e.series="series"}(i=t.AlbumType||(t.AlbumType={})),t.AlbumTypesArtistMusic=[i.album,i.live,i.bootleg,i.ep,i.single],function(e){e.UNKNOWN="unknown",e.AUDIO="audio",e.IMAGE="image",e.TAG="tag",e.BACKUP="backup",e.OTHER="other"}(t.FileTyp||(t.FileTyp={})),function(e){e.album="album",e.albumToptracks="album-toptracks",e.artist="artist",e.track="track",e.trackSimilar="track-similar",e.artistToptracks="artist-toptracks"}(t.LastFMLookupType||(t.LastFMLookupType={})),function(e){e.area="area",e.artist="artist",e.collection="collection",e.event="event",e.instrument="instrument",e.label="label",e.place="place",e.recording="recording",e.release="release",e.releaseGroup="release-group",e.series="series",e.work="work",e.url="url"}(t.MusicBrainzLookupType||(t.MusicBrainzLookupType={})),function(e){e.artist="artist",e.label="label",e.recording="recording",e.release="release",e.releaseGroup="release-group",e.work="work",e.area="area"}(t.MusicBrainzSearchType||(t.MusicBrainzSearchType={})),function(e){e.release="release",e.releaseGroup="release-group"}(t.CoverArtArchiveLookupType||(t.CoverArtArchiveLookupType={})),function(e){e.none="none",e.ffmpeg="ffmpeg",e.id3v20="id3v20",e.id3v21="id3v21",e.id3v22="id3v22",e.id3v23="id3v23",e.id3v24="id3v24",e.id3v1="id3v1",e.vorbis="vorbis"}(t.TrackTagFormatType||(t.TrackTagFormatType={})),function(e){e.album="Album",e.single="Single",e.ep="EP",e.broadcast="Broadcast",e.other="Other"}(t.MusicBrainzAlbumPrimaryType||(t.MusicBrainzAlbumPrimaryType={})),function(e){e.compilation="Compilation",e.soundtrack="Soundtrack",e.spokenword="Spokenword",e.interview="Interview",e.audiobook="Audiobook",e.audiodrama="Audio drama",e.live="Live",e.remix="Remix",e.djmix="DJ-mix",e.mixtape="Mixtape"}(t.MusicBrainzAlbumSecondaryType||(t.MusicBrainzAlbumSecondaryType={})),t.MUSICBRAINZ_VARIOUS_ARTISTS_ID="89ad4ac3-39f7-470e-963a-56509c546377",t.MUSICBRAINZ_VARIOUS_ARTISTS_NAME="Various Artists",t.cUnknownArtist="[Unknown Artist]",t.cUnknownAlbum="[Unknown Album]",function(e){e.tagValuesExists="track.tag.values.exists",e.id3v2Exists="track.mp3.id3v2.exists",e.id3v2Valid="track.mp3.id3v2.valid",e.id3v2Garbage="track.mp3.id3v2.garbage.frames",e.mp3HeaderExists="track.mp3.vbr.header.exists",e.mp3HeaderValid="track.mp3.vbr.header.valid",e.mp3MediaValid="track.mp3.media.valid",e.flacMediaValid="track.flac.media.valid",e.id3v2NoId3v1="track.mp3.id3v2.no.id3v1",e.mp3Garbage="track.mp3.garbage.data"}(t.TrackHealthID||(t.TrackHealthID={})),function(e){e.albumTagsExists="folder.album.tags.exists",e.albumMBIDExists="folder.album.mbid.exists",e.albumTracksComplete="folder.album.tracks.complete",e.albumNameConform="folder.album.name.conform",e.albumImageExists="folder.album.image.exists",e.albumImageValid="folder.album.image.valid",e.albumImageQuality="folder.album.image.quality",e.artistNameConform="folder.artist.name.conform",e.artistImageExists="folder.artist.image.exists",e.artistImageValid="folder.artist.image.valid"}(t.FolderHealthID||(t.FolderHealthID={})),t.AudioFormats=["mp3","m4a","mp4","ogg","oga","flv","flac","webma","wav"],t.DownloadFormats=["zip","tar"],t.DefaultDownloadFormat="zip",t.WaveformFormats=["svg","json","dat"],t.WaveformDefaultFormat=r.svg},function(e,t){e.exports=require("path")},function(e,t,a){"use strict";var r=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(o,i){function n(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(n,u)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(a(8)),n=a(1);t.rewriteWriteFFmpeg=function(e,t){return r(this,void 0,void 0,(function*(){return new Promise((a,r)=>{const o=i.default({source:e}).addOption("-c:a","copy").addOption("-c:v","copy").addOption("-map_metadata","-1").output(t).format(n.fileSuffix(e));o.on("end",()=>{a()}).on("error",e=>{r(e)}),o.run()})}))}},function(e,t){e.exports=require("fluent-ffmpeg")}]);
//# sourceMappingURL=task-rewrite-mp3.js.map